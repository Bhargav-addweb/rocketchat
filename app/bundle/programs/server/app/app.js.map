{"version":3,"sources":["meteor://ðŸ’»app/imports/message-read-receipt/server/lib/ReadReceipt.js","meteor://ðŸ’»app/imports/message-read-receipt/server/api/methods/getReadReceipts.js","meteor://ðŸ’»app/imports/message-read-receipt/server/models/ReadReceipts.js","meteor://ðŸ’»app/imports/message-read-receipt/server/dbIndexes.js","meteor://ðŸ’»app/imports/message-read-receipt/server/hooks.js","meteor://ðŸ’»app/imports/message-read-receipt/server/index.js","meteor://ðŸ’»app/imports/message-read-receipt/server/settings.js","meteor://ðŸ’»app/imports/personal-access-tokens/server/api/methods/generateToken.js","meteor://ðŸ’»app/imports/personal-access-tokens/server/api/methods/index.js","meteor://ðŸ’»app/imports/personal-access-tokens/server/api/methods/regenerateToken.js","meteor://ðŸ’»app/imports/personal-access-tokens/server/api/methods/removeToken.js","meteor://ðŸ’»app/imports/personal-access-tokens/server/models/Users.js","meteor://ðŸ’»app/imports/personal-access-tokens/server/models/index.js","meteor://ðŸ’»app/imports/personal-access-tokens/server/publications/index.js","meteor://ðŸ’»app/imports/personal-access-tokens/server/publications/personalAccessTokens.js","meteor://ðŸ’»app/imports/personal-access-tokens/server/index.js","meteor://ðŸ’»app/imports/personal-access-tokens/server/settings.js","meteor://ðŸ’»app/imports/startup/server/index.js","meteor://ðŸ’»app/server/lib/cordova/facebook-login.js","meteor://ðŸ’»app/server/lib/accounts.js","meteor://ðŸ’»app/server/lib/cordova.js","meteor://ðŸ’»app/server/lib/roomFiles.js","meteor://ðŸ’»app/server/startup/migrations/v001.js","meteor://ðŸ’»app/server/startup/migrations/v002.js","meteor://ðŸ’»app/server/startup/migrations/v003.js","meteor://ðŸ’»app/server/startup/migrations/v004.js","meteor://ðŸ’»app/server/startup/migrations/v005.js","meteor://ðŸ’»app/server/startup/migrations/v006.js","meteor://ðŸ’»app/server/startup/migrations/v007.js","meteor://ðŸ’»app/server/startup/migrations/v008.js","meteor://ðŸ’»app/server/startup/migrations/v009.js","meteor://ðŸ’»app/server/startup/migrations/v010.js","meteor://ðŸ’»app/server/startup/migrations/v011.js","meteor://ðŸ’»app/server/startup/migrations/v012.js","meteor://ðŸ’»app/server/startup/migrations/v013.js","meteor://ðŸ’»app/server/startup/migrations/v014.js","meteor://ðŸ’»app/server/startup/migrations/v015.js","meteor://ðŸ’»app/server/startup/migrations/v016.js","meteor://ðŸ’»app/server/startup/migrations/v017.js","meteor://ðŸ’»app/server/startup/migrations/v018.js","meteor://ðŸ’»app/server/startup/migrations/v019.js","meteor://ðŸ’»app/server/startup/migrations/v020.js","meteor://ðŸ’»app/server/startup/migrations/v021.js","meteor://ðŸ’»app/server/startup/migrations/v022.js","meteor://ðŸ’»app/server/startup/migrations/v023.js","meteor://ðŸ’»app/server/startup/migrations/v024.js","meteor://ðŸ’»app/server/startup/migrations/v025.js","meteor://ðŸ’»app/server/startup/migrations/v026.js","meteor://ðŸ’»app/server/startup/migrations/v027.js","meteor://ðŸ’»app/server/startup/migrations/v028.js","meteor://ðŸ’»app/server/startup/migrations/v029.js","meteor://ðŸ’»app/server/startup/migrations/v030.js","meteor://ðŸ’»app/server/startup/migrations/v031.js","meteor://ðŸ’»app/server/startup/migrations/v032.js","meteor://ðŸ’»app/server/startup/migrations/v033.js","meteor://ðŸ’»app/server/startup/migrations/v034.js","meteor://ðŸ’»app/server/startup/migrations/v035.js","meteor://ðŸ’»app/server/startup/migrations/v036.js","meteor://ðŸ’»app/server/startup/migrations/v037.js","meteor://ðŸ’»app/server/startup/migrations/v038.js","meteor://ðŸ’»app/server/startup/migrations/v039.js","meteor://ðŸ’»app/server/startup/migrations/v040.js","meteor://ðŸ’»app/server/startup/migrations/v041.js","meteor://ðŸ’»app/server/startup/migrations/v042.js","meteor://ðŸ’»app/server/startup/migrations/v043.js","meteor://ðŸ’»app/server/startup/migrations/v044.js","meteor://ðŸ’»app/server/startup/migrations/v045.js","meteor://ðŸ’»app/server/startup/migrations/v046.js","meteor://ðŸ’»app/server/startup/migrations/v047.js","meteor://ðŸ’»app/server/startup/migrations/v048.js","meteor://ðŸ’»app/server/startup/migrations/v049.js","meteor://ðŸ’»app/server/startup/migrations/v050.js","meteor://ðŸ’»app/server/startup/migrations/v051.js","meteor://ðŸ’»app/server/startup/migrations/v052.js","meteor://ðŸ’»app/server/startup/migrations/v053.js","meteor://ðŸ’»app/server/startup/migrations/v054.js","meteor://ðŸ’»app/server/startup/migrations/v055.js","meteor://ðŸ’»app/server/startup/migrations/v056.js","meteor://ðŸ’»app/server/startup/migrations/v057.js","meteor://ðŸ’»app/server/startup/migrations/v058.js","meteor://ðŸ’»app/server/startup/migrations/v059.js","meteor://ðŸ’»app/server/startup/migrations/v060.js","meteor://ðŸ’»app/server/startup/migrations/v061.js","meteor://ðŸ’»app/server/startup/migrations/v062.js","meteor://ðŸ’»app/server/startup/migrations/v063.js","meteor://ðŸ’»app/server/startup/migrations/v064.js","meteor://ðŸ’»app/server/startup/migrations/v065.js","meteor://ðŸ’»app/server/startup/migrations/v066.js","meteor://ðŸ’»app/server/startup/migrations/v067.js","meteor://ðŸ’»app/server/startup/migrations/v068.js","meteor://ðŸ’»app/server/startup/migrations/v069.js","meteor://ðŸ’»app/server/startup/migrations/v070.js","meteor://ðŸ’»app/server/startup/migrations/v071.js","meteor://ðŸ’»app/server/startup/migrations/v072.js","meteor://ðŸ’»app/server/startup/migrations/v073.js","meteor://ðŸ’»app/server/startup/migrations/v074.js","meteor://ðŸ’»app/server/startup/migrations/v075.js","meteor://ðŸ’»app/server/startup/migrations/v076.js","meteor://ðŸ’»app/server/startup/migrations/v077.js","meteor://ðŸ’»app/server/startup/migrations/v078.js","meteor://ðŸ’»app/server/startup/migrations/v079.js","meteor://ðŸ’»app/server/startup/migrations/v080.js","meteor://ðŸ’»app/server/startup/migrations/v081.js","meteor://ðŸ’»app/server/startup/migrations/v082.js","meteor://ðŸ’»app/server/startup/migrations/v083.js","meteor://ðŸ’»app/server/startup/migrations/v084.js","meteor://ðŸ’»app/server/startup/migrations/v085.js","meteor://ðŸ’»app/server/startup/migrations/v086.js","meteor://ðŸ’»app/server/startup/migrations/v087.js","meteor://ðŸ’»app/server/startup/migrations/v088.js","meteor://ðŸ’»app/server/startup/migrations/v089.js","meteor://ðŸ’»app/server/startup/migrations/v090.js","meteor://ðŸ’»app/server/startup/migrations/v091.js","meteor://ðŸ’»app/server/startup/migrations/v092.js","meteor://ðŸ’»app/server/startup/migrations/v093.js","meteor://ðŸ’»app/server/startup/migrations/v094.js","meteor://ðŸ’»app/server/startup/migrations/v095.js","meteor://ðŸ’»app/server/startup/migrations/v096.js","meteor://ðŸ’»app/server/startup/migrations/v097.js","meteor://ðŸ’»app/server/startup/migrations/v098.js","meteor://ðŸ’»app/server/startup/migrations/v099.js","meteor://ðŸ’»app/server/startup/migrations/v100.js","meteor://ðŸ’»app/server/startup/migrations/v101.js","meteor://ðŸ’»app/server/startup/migrations/v102.js","meteor://ðŸ’»app/server/startup/migrations/v103.js","meteor://ðŸ’»app/server/startup/migrations/v104.js","meteor://ðŸ’»app/server/startup/migrations/v105.js","meteor://ðŸ’»app/server/startup/migrations/v106.js","meteor://ðŸ’»app/server/startup/migrations/v107.js","meteor://ðŸ’»app/server/startup/migrations/v108.js","meteor://ðŸ’»app/server/startup/migrations/v109.js","meteor://ðŸ’»app/server/startup/migrations/v110.js","meteor://ðŸ’»app/server/startup/migrations/v111.js","meteor://ðŸ’»app/server/startup/migrations/v112.js","meteor://ðŸ’»app/server/startup/migrations/v113.js","meteor://ðŸ’»app/server/startup/migrations/v114.js","meteor://ðŸ’»app/server/startup/migrations/v115.js","meteor://ðŸ’»app/server/startup/migrations/v116.js","meteor://ðŸ’»app/server/startup/migrations/v117.js","meteor://ðŸ’»app/server/startup/migrations/v118.js","meteor://ðŸ’»app/server/startup/migrations/v119.js","meteor://ðŸ’»app/server/startup/migrations/v120.js","meteor://ðŸ’»app/server/startup/migrations/v121.js","meteor://ðŸ’»app/server/startup/migrations/v122.js","meteor://ðŸ’»app/server/startup/migrations/v123.js","meteor://ðŸ’»app/server/startup/migrations/v124.js","meteor://ðŸ’»app/server/startup/migrations/v125.js","meteor://ðŸ’»app/server/startup/migrations/v126.js","meteor://ðŸ’»app/server/startup/migrations/v127.js","meteor://ðŸ’»app/server/startup/migrations/v128.js","meteor://ðŸ’»app/server/startup/migrations/v129.js","meteor://ðŸ’»app/server/startup/migrations/v130.js","meteor://ðŸ’»app/server/startup/migrations/v131.js","meteor://ðŸ’»app/server/startup/migrations/v132.js","meteor://ðŸ’»app/server/startup/migrations/v133.js","meteor://ðŸ’»app/server/startup/migrations/v134.js","meteor://ðŸ’»app/server/startup/migrations/v135.js","meteor://ðŸ’»app/server/startup/migrations/xrun.js","meteor://ðŸ’»app/server/startup/appcache.js","meteor://ðŸ’»app/server/startup/avatar.js","meteor://ðŸ’»app/server/startup/cron.js","meteor://ðŸ’»app/server/startup/i18n-validation.js","meteor://ðŸ’»app/server/startup/initialData.js","meteor://ðŸ’»app/server/startup/presence.js","meteor://ðŸ’»app/server/startup/serverRunning.js","meteor://ðŸ’»app/server/configuration/accounts_meld.js","meteor://ðŸ’»app/server/methods/OEmbedCacheCleanup.js","meteor://ðŸ’»app/server/methods/addAllUserToRoom.js","meteor://ðŸ’»app/server/methods/addRoomLeader.js","meteor://ðŸ’»app/server/methods/addRoomModerator.js","meteor://ðŸ’»app/server/methods/addRoomOwner.js","meteor://ðŸ’»app/server/methods/afterVerifyEmail.js","meteor://ðŸ’»app/server/methods/browseChannels.js","meteor://ðŸ’»app/server/methods/canAccessRoom.js","meteor://ðŸ’»app/server/methods/channelsList.js","meteor://ðŸ’»app/server/methods/createDirectMessage.js","meteor://ðŸ’»app/server/methods/deleteFileMessage.js","meteor://ðŸ’»app/server/methods/deleteUser.js","meteor://ðŸ’»app/server/methods/eraseRoom.js","meteor://ðŸ’»app/server/methods/getAvatarSuggestion.js","meteor://ðŸ’»app/server/methods/getRoomIdByNameOrId.js","meteor://ðŸ’»app/server/methods/getRoomNameById.js","meteor://ðŸ’»app/server/methods/getTotalChannels.js","meteor://ðŸ’»app/server/methods/getUsernameSuggestion.js","meteor://ðŸ’»app/server/methods/getUsersOfRoom.js","meteor://ðŸ’»app/server/methods/hideRoom.js","meteor://ðŸ’»app/server/methods/ignoreUser.js","meteor://ðŸ’»app/server/methods/loadHistory.js","meteor://ðŸ’»app/server/methods/loadLocale.js","meteor://ðŸ’»app/server/methods/loadMissedMessages.js","meteor://ðŸ’»app/server/methods/loadNextMessages.js","meteor://ðŸ’»app/server/methods/loadSurroundingMessages.js","meteor://ðŸ’»app/server/methods/logoutCleanUp.js","meteor://ðŸ’»app/server/methods/messageSearch.js","meteor://ðŸ’»app/server/methods/migrate.js","meteor://ðŸ’»app/server/methods/muteUserInRoom.js","meteor://ðŸ’»app/server/methods/openRoom.js","meteor://ðŸ’»app/server/methods/readMessages.js","meteor://ðŸ’»app/server/methods/registerUser.js","meteor://ðŸ’»app/server/methods/removeRoomLeader.js","meteor://ðŸ’»app/server/methods/removeRoomModerator.js","meteor://ðŸ’»app/server/methods/removeRoomOwner.js","meteor://ðŸ’»app/server/methods/removeUserFromRoom.js","meteor://ðŸ’»app/server/methods/reportMessage.js","meteor://ðŸ’»app/server/methods/requestDataDownload.js","meteor://ðŸ’»app/server/methods/resetAvatar.js","meteor://ðŸ’»app/server/methods/roomNameExists.js","meteor://ðŸ’»app/server/methods/saveUserPreferences.js","meteor://ðŸ’»app/server/methods/saveUserProfile.js","meteor://ðŸ’»app/server/methods/sendConfirmationEmail.js","meteor://ðŸ’»app/server/methods/sendForgotPasswordEmail.js","meteor://ðŸ’»app/server/methods/setAvatarFromService.js","meteor://ðŸ’»app/server/methods/setUserActiveStatus.js","meteor://ðŸ’»app/server/methods/setUserPassword.js","meteor://ðŸ’»app/server/methods/toogleFavorite.js","meteor://ðŸ’»app/server/methods/unmuteUserInRoom.js","meteor://ðŸ’»app/server/methods/userSetUtcOffset.js","meteor://ðŸ’»app/server/publications/activeUsers.js","meteor://ðŸ’»app/server/publications/channelAndPrivateAutocomplete.js","meteor://ðŸ’»app/server/publications/fullUserData.js","meteor://ðŸ’»app/server/publications/messages.js","meteor://ðŸ’»app/server/publications/room.js","meteor://ðŸ’»app/server/publications/roomFiles.js","meteor://ðŸ’»app/server/publications/roomFilesWithSearchText.js","meteor://ðŸ’»app/server/publications/roomSubscriptionsByRole.js","meteor://ðŸ’»app/server/publications/spotlight.js","meteor://ðŸ’»app/server/publications/subscription.js","meteor://ðŸ’»app/server/publications/userAutocomplete.js","meteor://ðŸ’»app/server/publications/userChannels.js","meteor://ðŸ’»app/server/publications/userData.js","meteor://ðŸ’»app/server/stream/messages.js","meteor://ðŸ’»app/server/stream/streamBroadcast.js","meteor://ðŸ’»app/server/main.js","meteor://ðŸ’»app/lib/RegExp.js","meteor://ðŸ’»app/lib/francocatena_fix.js"],"names":["module","export","ReadReceipt","Random","watch","require","v","ModelReadReceipts","default","rawReadReceipts","model","rawCollection","list","debounceByRoomId","fn","roomId","args","clearTimeout","setTimeout","call","updateMessages","Meteor","bindEnvironment","firstSubscription","RocketChat","models","Subscriptions","getMinimumLastSeenByRoomId","Messages","setAsRead","ls","markMessagesAsRead","userId","userLastSeen","settings","get","room","Rooms","findOneById","fields","lm","storeReadReceipts","findUnreadMessagesByRoomAndDate","markMessageAsReadBySender","message","unread","ts","setAsReadById","_id","messages","Date","receipts","map","id","messageId","length","insertMany","e","console","error","getReceipts","findByMessageId","receipt","user","Users","username","name","methods","getReadReceipts","Error","method","rid","_Base","constructor","tryEnsureIndex","unique","find","exportDefault","sparse","callbacks","add","editedAt","setAsReadByRoomIdAndUserId","u","group","type","public","enableQuery","value","Accounts","tokenName","token","secret","tokenExist","findPersonalAccessTokenByTokenNameAndUserId","addPersonalAccessTokenToUser","loginTokenObject","hashedToken","_hashLoginToken","createdAt","lastTokenPart","slice","removePersonalAccessTokenOfUser","getLoginTokensByUserId","query","$exists","$eq","update","$push","$pull","$elemMatch","findOne","publish","ready","self","getFieldsToPublish","services","resume","loginTokens","filter","loginToken","handle","observeChanges","added","tokens","changed","removed","onStop","stop","addGroup","section","_","getIdentity","accessToken","HTTP","params","access_token","data","extend","response","registerLoginHandler","loginRequest","cordova","authResponse","identity","serviceData","expiresAt","now","expiresIn","whitelisted","pick","options","profile","updateOrCreateUserFromExternalService","s","Mailer","accountsConfig","forbidClientAccountCreation","loginExpirationInDays","config","emailTemplates","siteName","from","userToActivate","subject","TAPi18n","__","html","email","reason","replace","escapeHTML","userActivated","active","activated","action","verifyEmailTemplate","enrollAccountTemplate","startup","getTemplateWrapped","verifyEmail","url","absoluteUrl","Verification_Url","urls","resetPassword","text","enrollAccount","emails","address","onCreateUser","run","status","firstName","lastName","service","Object","values","verified","destinations","Roles","findUsersInRole","forEach","adminUser","Array","isArray","push","to","send","insertUserDoc","wrap","roles","Match","test","globalRoles","String","concat","password","defaultAuthServiceRoles","split","trim","users","joinDefaultChannels","runAsUser","joinDefaultChannelsSilenced","defer","hasAdmin","Settings","updateValueById","authz","addUserRoles","validateLoginAttempt","login","allowed","function","includes","validEmail","updateLastLoginById","validateNewUser","domainWhiteList","isEmpty","domain","inWhiteList","some","match","RegExp","escape","push_test","hasRole","Push","enabled","$and","$or","appCollection","count","title","apn","sound","sendPush","tries","post","statusCode","log","remove","SystemLogger","milli","Math","pow","configurePush","debug","allow","gcm","apiKey","projectNumber","passphrase","keyData","certData","gateway","undefined","Configure","production","sendInterval","sendBatchSize","serverSend","badge","app","topic","appName","roomFiles","pub","searchText","limit","cursorFileListHandle","Uploads","findNotHiddenFilesOfRoom","record","recordChanges","hasOwnProperty","Migrations","version","up","lastLogin","generateUsernameSuggestion","setUsername","JSON","stringify","avatarOrigin","avatars","getAvatarSuggestionForUser","keys","dataURI","blob","image","contentType","RocketChatFile","dataURIParse","rs","bufferToStream","Buffer","fileStore","FileUpload","getStore","deleteByName","file","insert","setAvatarOrigin","tryDropIndex","uid","nonreactive","sub","$set","$unset","$in","uids","usernames","t","k","oldId","sort","join","removeById","multi","rn","$rename","item","toLowerCase","setNameById","$ne","msgs","$lt","removeByRoomId","$size","newUserName","findOneByUsername","floor","random","findByType","newId","id0","id1","ids","by","findOneByName","upsert","index","isString","OEmbed","rocketUrlParser","CDN_PREFIX","ENV","MAIL_URL","denyUnverifiedEmails","avatarStore","path","toMigrate","source","Mongo","Collection","target","OEmbedCache","collection","collectionName","doc","rawSource","wrapAsync","drop","err","errmsg","newUsernames","uniq","admin","findOneAdmin","oldestUser","setAllUsersActive","metaKeys","old","new","oldAndNew","oldSetting","oldValue","newSetting","newValue","oldFilesCollection","oldGridFSCollection","oldChunkCollection","newFilesCollection","newGridFSCollection","newChunkCollection","cfsRecord","nameParts","original","extension","pop","size","complete","uploading","store","uploadedAt","updatedAt","oldGridFsFile","ObjectID","copies","files","key","filename","chunkSize","uploadDate","aliases","metadata","md5","files_id","oldChunk","n","urlsItem","parsedUrl","pathname","msg","_hidden","changes","Accounts_Facebook","Accounts_Facebook_id","Accounts_Facebook_secret","Accounts_Google","Accounts_Google_id","Accounts_Google_secret","Accounts_Github","Accounts_Github_id","Accounts_Github_secret","Accounts_Gitlab","Accounts_Gitlab_id","Accounts_Gitlab_secret","Accounts_Linkedin","Accounts_Linkedin_id","Accounts_Linkedin_secret","Accounts_Meteor","Accounts_Meteor_id","Accounts_Meteor_secret","Accounts_Twitter","Accounts_Twitter_id","Accounts_Twitter_secret","ServiceConfiguration","configurations","admins","fetch","pluck","green","rooms","findByTypes","creator","msgQuery","msgOptions","cursorFileMessages","$multi","i18nLabel","upgradeEtsToEditAt","Permissions","persistent","hidden","mentions","_roles","scope","addRole","LDAP_Url","LDAP_TLS","LDAP_DN","LDAP_Bind_Search","$setOnInsert","WebRTC_STUN_Server","WebRTC_TURN_Server","WebRTC_TURN_Username","WebRTC_TURN_Password","servers","encodeURIComponent","API_Analytics","scriptAlert","integrations","Integrations","script","processIncomingRequestScript","prepareOutgoingRequestScript","processOutgoingResponseScript","integration","loginHeader","requestUrl","resolve","result","npmRequestOptions","encoding","Assets","setAsset","content","headers","addUserPermission","allowPinning","$addToSet","footer","footerValue","packageValue","customOauth","parts","valueSource","blocked","sorter","i18nDescription","bot","__migration_assets_files","chunks","__migration_assets_chunks","oldFile","mime","updateById","defaultUrl","assets","newRoomNotification","preferences","disableNewRoomNotification","newMessageNotification","disableNewMessageNotification","optOut","favoriteRooms","lastVisitor","lastNumber","parseInt","autolinkerUrls","RocketBot_Enabled","RocketBot_Name","code","label","Statistics","installedAt","subscriptions","$not","$type","subscription","setArchivedByUsername","forward","timeout","replace1","replace2","replace3","replace4","replace5","replace6","oldColor","LivechatDepartment","showOnRegistration","GoogleSiteVerification_id","editor","setting","reactions","visitor","visitorEmails","oauth","athorizedClients","channel","OAuthApps","redirectUri","getUsersInRole","removeUserFromRoles","oldPermission","down","newPermission","rids","outgoingIntegrations","i","event","retryFailedCalls","retryCount","retryDelay","linkedin","setName","runOnEdits","emailAddress","existingUser","emailHeader","emailFooter","startWithHTML","endsWithHTML","fs","logError","insertAvatar","details","avatarsFileStore","stream","callback","Promise","batch","arr","all","splice","then","s3","direct","AmazonS3","GoogleStorage","googleCloudStorage","avatarOrigins","avatarsPathRecord","avatarStoreTypeRecord","avatarsPath","process","env","AVATARS_PATH","avatarStoreType","oldAvatarGridFS","GridFS","countSync","Number","error_box","usersTotal","current","gridFSAvatar","getFileWithReadStream","readStream","deleteFile","filePath","stat","statSync","isFile","createReadStream","unlinkSync","avatarsFiles","avatarsChunks","audioNotification","lastActivity","LDAP_Domain_Base","LDAP_Domain_Search_User_ID","LDAP_Use_Custom_Domain_Search","LDAP_Custom_Domain_Search","LDAP_Domain_Search_User","LDAP_Domain_Search_Password","LDAP_Domain_Search_Filter","LDAP_Domain_Search_Object_Class","LDAP_Domain_Search_Object_Category","Custom_Domain_Search","parse","userDN","LDAP_Sync_User_Data","LDAP_Import_Users","majorColors","newvariables","lightenDarkenColor","col","amt","usePound","num","r","b","g","toString","color","newPreference","unreadRoomsMode","settingsMap","Desktop_Notifications_Default_Alert","Mobile_Notifications_Default_Alert","Audio_Notifications_Default_Alert","Desktop_Notifications_Duration","Audio_Notifications_Value","newSettingKey","LivechatVisitors","visitors","total","deparment","userAgent","ip","host","phone","role","createOrUpdate","FileUpload_GoogleStorage_Proxy","FileUpload_S3_Proxy","idleTimeLimit","fileQuery","filesToUpdate","messageQuery","announcement","desktopNotifications","desktopPrefOrigin","mobilePushNotifications","mobilePrefOrigin","emailNotifications","emailPrefOrigin","mobileNotifications","emailNotificationMode","userHighlights","highlights","pageVisitedCollection","messageCollection","roomCollection","roomIdByToken","batchSize","migrateHistory","items","toArray","actions","reduce","page","location","href","groupable","navigation","expireAt","ops","removeMany","LivechatPageVisited","pages","close","Future","_db","originals","usersCount","findByRoomId","fname","usersByUsername","obj","updateSubscription","fut","processBatch","itens","return","wait","userOptions","userIds","subscriptionQuery","$nin","subscriptionOptions","removeFilesByRoomId","$gte","updateIfDefault","customized","idEmail","idSubject","newSettingEmail","newSettingSubject","i18nDefaultQuery","rename","entries","Email_Header","Email_Footer","Email_Footer_Direct_Reply","fixURLs","header","getVersion","migrateTo","MIGRATION_VERSION","control","_getControl","last","_list","_setControl","AppCache","onlineOnly","sharp","Cookies","cookie","isUserAuthenticated","req","rc_uid","rc_token","findOneByIdAndLoginToken","warnUnauthenticatedAccess","debounce","warn","userCanAccessAvatar","WebApp","connectHandlers","use","res","decodeURIComponent","cacheTime","writeHead","write","end","exec","sandstorm","picture","setHeader","Avatars","reqModifiedHeader","toUTCString","initials","getAvatarColor","substr","toUpperCase","viewSize","fontSize","svg","format","toFormat","pipe","logger","Logger","SyncedCron","opts","level","generateStatistics","statistics","save","cleanupOEmbedCache","schedule","parser","cron","getMinutes","job","getHours","start","flat","newObj","isObject","i18nValidation","l","errors","langs","TAPi18next","resStore","lang","len","present","difference","red","white","rpad","createWithIdTypeAndName","create","statusDefault","utcOffset","getBinary","ADMIN_PASS","ADMIN_NAME","ADMIN_EMAIL","re","findOneByEmailAddress","ADMIN_USERNAME","nameValidation","checkUsernameAvailability","setPassword","INITIAL_USER","initialUser","getOldest","TEST_MODE","addUserToDefaultChannels","instance","port","PORT","INSTANCE_IP","InstanceStatus","registerInstance","UserPresence","UserPresenceMonitor","semver","oplogState","MongoInternals","defaultRemoteCollectionDriver","mongo","_oplogHandle","onOplogEntry","desiredNodeVersion","clean","readFileSync","cwd","desiredNodeVersionMajor","major","Info","versions","node","arch","platform","commit","hash","branch","satisfies","startup_box","exit","orig_updateOrCreateUserFromExternalService","serviceName","_OAuthCustom","primaryEmail","a","primary","findQuery","findWhere","resetPasswordAndSetRequirePasswordChange","setServiceId","setEmailVerified","apply","OEmbedCacheCleanup","date","expirationDays","setDate","getDate","removeAfterDate","addAllUserToRoom","activeUsersOnly","check","Boolean","userCount","userFilter","findOneByRoomIdAndUserId","createWithRoomAndUser","open","alert","userMentions","groupMentions","createUserJoinWithRoomIdAndUser","addRoomLeader","hasPermission","addRoleById","fromUser","createSubscriptionRoleAddedWithRoomIdAndUser","Notifications","notifyLogged","addRoomModerator","addRoomOwner","afterVerifyEmail","verifiedEmail","removeUserRoles","sortChannels","field","direction","sortUsers","browseChannels","sortBy","sortDirection","offset","regex","escapeRegExp","skip","max","results","findByNameAndType","description","lastMessage","archived","findByActiveUsersExcept","DDPRateLimiter","addRule","canAccessRoom","extraData","Maybe","channelsList","channelType","unblock","Optional","isNumber","channels","findByTypeAndNameContaining","roomIds","findByTypeAndUserId","findByTypeInIds","findByTypeInIdsAndNameContaining","userPref","getUserPreference","groupByType","createDirectMessage","me","myNotificationPref","getDefaultSubscriptionPref","upsertSubscription","customFields","toNotificationPref","RateLimiter","limitMethod","deleteFileMessage","fileID","getMessageByFileId","deleteById","deleteUser","adminCount","userIsAdmin","indexOf","eraseRoom","Apps","isLoaded","prevent","await","getBridges","getListenerBridge","roomEvent","roomTypes","canBeDeleted","facebook","google","github","pictureUrl","twitter","profile_image_url_https","gitlab","avatar_url","blockstack","Gravatar","imageUrl","secure","validAvatars","avatar","getAvatarSuggestion","getRoomIdByNameOrId","getRoomNameById","getTotalChannels","slug","slugify","usernameIsAvaliable","generateSuggestion","preferredHandle","first","flatten","compact","getUsernameSuggestion","getUsersOfRoom","showAll","broadcast","findByRoomIdWhenUsernameExists","findUsersWithUsernameByIds","findUsersWithUsernameByIdsNotOffline","records","hideRoom","hideByRoomIdAndUserId","ignoreUser","ignoredUser","ignore","subscriptionIgnoredUser","hideMessagesOfType","types","loadHistory","fromId","canAnonymous","canPreview","loadMessageHistory","loadLocale","locale","getText","shift","loadMissedMessages","findVisibleByRoomIdAfterTimestamp","loadNextMessages","findVisibleByRoomId","starred","loadSurroundingMessages","ceil","recordsBefore","findVisibleByRoomIdBeforeTimestamp","moreBefore","recordsAfter","afterMessages","moreAfter","logoutCleanUp","messageSearch","docs","currentUserId","currentUserName","currentUserTimezoneOffset","filterStarred","filterUrl","filterPinned","pinned","filterLocation","$exist","filterBeforeDate","day","month","year","beforeDate","setHours","getUTCHours","getTimezoneOffset","$lte","filterAfterDate","afterDate","setUTCHours","filterOnDate","dayAfter","filterLabel","tag","sortByTimestamp","startsWith","$regex","$options","mention","$text","$search","score","$meta","findByUserId","getMigrationVersion","muteUserInRoom","ObjectIncluding","findOneByRoomIdAndUsername","mutedUser","muteUsernameByRoomId","createUserMutedWithRoomIdAndUser","openRoom","openByRoomIdAndUserId","readMessages","userSubscription","assign","registerUser","formData","AllowAnonymousRead","AllowAnonymousWrite","manuallyApproveNewUsers","_loginUser","pass","secretURL","passwordPolicy","validate","validateEmailDomain","userData","importedUser","importIds","createUser","setReason","saveCustomFields","userModel","replacekey","sendVerificationEmail","removeRoomLeader","removeRoleById","createSubscriptionRoleRemovedWithRoomIdAndUser","removeRoomModerator","removeRoomOwner","numOwners","removeUserFromRoom","removedUser","removeByRoomIdAndUserId","createUserRemovedWithRoomIdAndUser","reportMessage","Reports","createWithMessageDescriptionAndUserId","tempFolder","requestDataDownload","fullExport","currentUserData","lastOperation","ExportOperations","findLastOperationByUser","yesterday","setUTCDate","getUTCDate","requested","exportOperation","existsSync","mkdirSync","subFolderName","baseFolder","folderName","assetsFolder","roomList","exportPath","assetsPath","fileList","generatedFile","resetAvatar","unsetAvatarOrigin","roomNameExists","saveUserPreferences","language","clockMode","useEmojis","convertAsciiEmoji","saveMobileBandwidth","collapseMediaByDefault","autoImageLoad","unreadAlert","notificationsSoundVolume","enableAutoAway","desktopNotificationDuration","messageViewMode","hideUsernames","hideRoles","hideAvatars","hideFlexTab","sendOnEnter","roomCounterSidebar","sidebarShowFavorites","sidebarShowUnread","sidebarSortby","sidebarViewMode","sidebarHideAvatar","sidebarGroupByType","muteFocusedConversations","oldDesktopNotifications","oldMobileNotifications","oldEmailNotifications","clearSettings","setLanguage","setPreferences","clearDesktopNotificationUserPreferences","updateDesktopNotificationUserPreferences","clearMobileNotificationUserPreferences","updateMobileNotificationUserPreferences","clearEmailNotificationUserPreferences","updateEmailNotificationUserPreferences","updateUserHighlights","saveUserProfile","checkPassword","typedPassword","bcrypt","passCheck","_checkPassword","digest","algorithm","realname","newPassword","logout","setProfile","sendConfirmationEmail","template","sendForgotPasswordEmail","userEmail","sendResetPasswordEmail","setAvatarFromService","setUserAvatar","setUserActiveStatus","setUserActive","unsetLoginTokens","unsetReason","sendNoWrap","setUserPassword","requirePasswordChange","unsetRequirePasswordChange","toggleFavorite","f","setFavoriteByRoomIdAndUserId","unmuteUserInRoom","unmutedUser","unmuteUsernameByRoomId","createUserUnmutedWithRoomIdAndUser","userSetUtcOffset","setUtcOffset","findUsersNotOffline","selector","cursorHandle","findChannelAndPrivateByNameStarting","getFullUserData","publication","cursor","cursorDelete","findInvisibleByRoomId","cursorDeleteHandle","lastUpdate","latestDate","oldestDate","inclusive","unreads","updated","findForUpdates","deleted","trashFindDeletedAfter","_deletedAt","latest","oldest","cl","announcementDetails","muted","_updatedAt","jitsiTimeout","retention","livechatData","tags","sms","joinCodeRequired","ro","reactWhenReadOnly","sysMes","sentiment","tokenpass","streamingOptions","encrypted","e2eKeyId","roomMap","findByDefaultAndTypes","findBySubscriptionUserIdUpdatedAfter","findBySubscriptionUserId","getRoomByTypeAndName","roomFind","getRoomFind","findByTypeAndName","on","clientAction","notifyUserInThisInstance","findByRoomIdAndRoles","fetchRooms","spotlight","searchForChannels","searchForDMs","roomOptions","findByNameAndTypeNotDefault","searchableRoomTypes","roomType","includeInRoomSearch","findByUserIdAndTypes","findByNameAndTypesNotInIds","audioNotifications","audioNotificationValue","blocker","autoTranslate","autoTranslateLanguage","disableNotifications","hideUnreadStatus","muteGroupMentions","ignored","E2EKey","trashFindOneById","exceptions","findActiveByUsernameOrNameRegexWithExceptions","term","statusConnection","defaultRoom","requirePasswordChangeReason","statusLivechat","banners","msgStream","Streamer","allowWrite","allowRead","eventName","allowEmit","roomParticipant","roomName","publishMessage","imported","UI_Use_Real_Name","emitWithoutBroadcast","DDPCommon","connections","sections","connection","auth","_authorizeConnection","info","instanceId","ok","broadcastAuth","authorizeConnection","getCollection","startMatrixBroadcast","_createdAt","observe","extraInformation","isDocker","instanceRecord","disconnect","DDP","connect","_dontPrintErrors","LoggerManager","logLevel","onReconnect","remoteId","selfId","streamName","StreamerCentral","instances","serverOnly","emitWithScope","_emit","startStreamCastBroadcast","_stream","raw_msg","parseDDP","subscribe","startStreamBroadcast","fromInstance","connected","endpoint","conn","currentStatus","i18n_status_func"],"mappings":"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","file":"/app.js","sourcesContent":["import { Random } from 'meteor/random';\nimport ModelReadReceipts from '../models/ReadReceipts';\n\nconst rawReadReceipts = ModelReadReceipts.model.rawCollection();\n\n// debounced function by roomId, so multiple calls within 2 seconds to same roomId runs only once\nconst list = {};\nconst debounceByRoomId = function(fn) {\n\treturn function(roomId, ...args) {\n\t\tclearTimeout(list[roomId]);\n\t\tlist[roomId] = setTimeout(() => { fn.call(this, roomId, ...args); }, 2000);\n\t};\n};\n\nconst updateMessages = debounceByRoomId(Meteor.bindEnvironment((roomId) => {\n\t// @TODO maybe store firstSubscription in room object so we don't need to call the above update method\n\tconst firstSubscription = RocketChat.models.Subscriptions.getMinimumLastSeenByRoomId(roomId);\n\tRocketChat.models.Messages.setAsRead(roomId, firstSubscription.ls);\n}));\n\nexport const ReadReceipt = {\n\tmarkMessagesAsRead(roomId, userId, userLastSeen) {\n\t\tif (!RocketChat.settings.get('Message_Read_Receipt_Enabled')) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(roomId, { fields: { lm: 1 } });\n\n\t\t// if users last seen is greadebounceByRoomIdter than room's last message, it means the user already have this room marked as read\n\t\tif (userLastSeen > room.lm) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (userLastSeen) {\n\t\t\tthis.storeReadReceipts(RocketChat.models.Messages.findUnreadMessagesByRoomAndDate(roomId, userLastSeen), roomId, userId);\n\t\t}\n\n\t\tupdateMessages(roomId);\n\t},\n\n\tmarkMessageAsReadBySender(message, roomId, userId) {\n\t\tif (!RocketChat.settings.get('Message_Read_Receipt_Enabled')) {\n\t\t\treturn;\n\t\t}\n\n\t\t// this will usually happens if the message sender is the only one on the room\n\t\tconst firstSubscription = RocketChat.models.Subscriptions.getMinimumLastSeenByRoomId(roomId);\n\t\tif (message.unread && message.ts < firstSubscription.ls) {\n\t\t\tRocketChat.models.Messages.setAsReadById(message._id, firstSubscription.ls);\n\t\t}\n\n\t\tthis.storeReadReceipts([{ _id: message._id }], roomId, userId);\n\t},\n\n\tstoreReadReceipts(messages, roomId, userId) {\n\t\tif (RocketChat.settings.get('Message_Read_Receipt_Store_Users')) {\n\t\t\tconst ts = new Date();\n\t\t\tconst receipts = messages.map((message) => ({\n\t\t\t\t_id: Random.id(),\n\t\t\t\troomId,\n\t\t\t\tuserId,\n\t\t\t\tmessageId: message._id,\n\t\t\t\tts,\n\t\t\t}));\n\n\t\t\tif (receipts.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\trawReadReceipts.insertMany(receipts);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('Error inserting read receipts per user');\n\t\t\t}\n\t\t}\n\t},\n\n\tgetReceipts(message) {\n\t\treturn ModelReadReceipts.findByMessageId(message._id).map((receipt) => ({\n\t\t\t...receipt,\n\t\t\tuser: RocketChat.models.Users.findOneById(receipt.userId, { fields: { username: 1, name: 1 } }),\n\t\t}));\n\t},\n};\n","import { Meteor } from 'meteor/meteor';\n\nimport { ReadReceipt } from '../../lib/ReadReceipt';\n\nMeteor.methods({\n\tgetReadReceipts({ messageId }) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getReadReceipts' });\n\t\t}\n\n\t\tif (!messageId) {\n\t\t\tthrow new Meteor.Error('error-invalid-message', 'The required \\'messageId\\' param is missing.', { method: 'getReadReceipts' });\n\t\t}\n\n\t\tconst message = RocketChat.models.Messages.findOneById(messageId);\n\n\t\tif (!message) {\n\t\t\tthrow new Meteor.Error('error-invalid-message', 'Invalid message', { method: 'getReadReceipts' });\n\t\t}\n\n\t\tconst room = Meteor.call('canAccessRoom', message.rid, Meteor.userId());\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getReadReceipts' });\n\t\t}\n\n\t\treturn ReadReceipt.getReceipts(message);\n\t},\n});\n","class ModelReadReceipts extends RocketChat.models._Base {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.tryEnsureIndex({\n\t\t\troomId: 1,\n\t\t\tuserId: 1,\n\t\t\tmessageId: 1,\n\t\t}, {\n\t\t\tunique: 1,\n\t\t});\n\t}\n\n\tfindByMessageId(messageId) {\n\t\treturn this.find({ messageId });\n\t}\n}\n\nexport default new ModelReadReceipts('message_read_receipt');\n","RocketChat.models.Messages.tryEnsureIndex({\n\tunread: 1,\n}, {\n\tsparse: true,\n});\n","import { ReadReceipt } from './lib/ReadReceipt';\n\nRocketChat.callbacks.add('afterSaveMessage', (message, room) => {\n\n\t// skips this callback if the message was edited\n\tif (message.editedAt) {\n\t\treturn message;\n\t}\n\n\t// set subscription as read right after message was sent\n\tRocketChat.models.Subscriptions.setAsReadByRoomIdAndUserId(room._id, message.u._id);\n\n\t// mark message as read as well\n\tReadReceipt.markMessageAsReadBySender(message, room._id, message.u._id);\n});\n","import './dbIndexes';\nimport './hooks';\nimport './settings';\n\nimport './api/methods/getReadReceipts';\n","RocketChat.settings.add('Message_Read_Receipt_Enabled', false, {\n\tgroup: 'Message',\n\ttype: 'boolean',\n\tpublic: true,\n});\n\nRocketChat.settings.add('Message_Read_Receipt_Store_Users', false, {\n\tgroup: 'Message',\n\ttype: 'boolean',\n\tpublic: true,\n\tenableQuery: { _id: 'Message_Read_Receipt_Enabled', value: true },\n});\n","import { Meteor } from 'meteor/meteor';\nimport { Random } from 'meteor/random';\nimport { Accounts } from 'meteor/accounts-base';\n\nMeteor.methods({\n\t'personalAccessTokens:generateToken'({ tokenName }) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('not-authorized', 'Not Authorized', { method: 'personalAccessTokens:generateToken' });\n\t\t}\n\t\tif (!RocketChat.settings.get('API_Enable_Personal_Access_Tokens')) {\n\t\t\tthrow new Meteor.Error('error-personal-access-tokens-are-current-disabled', 'Personal Access Tokens are currently disabled', { method: 'personalAccessTokens:generateToken' });\n\t\t}\n\n\t\tconst token = Random.secret();\n\t\tconst tokenExist = RocketChat.models.Users.findPersonalAccessTokenByTokenNameAndUserId({\n\t\t\tuserId: Meteor.userId(),\n\t\t\ttokenName,\n\t\t});\n\t\tif (tokenExist) {\n\t\t\tthrow new Meteor.Error('error-token-already-exists', 'A token with this name already exists', { method: 'personalAccessTokens:generateToken' });\n\t\t}\n\n\t\tRocketChat.models.Users.addPersonalAccessTokenToUser({\n\t\t\tuserId: Meteor.userId(),\n\t\t\tloginTokenObject: {\n\t\t\t\thashedToken: Accounts._hashLoginToken(token),\n\t\t\t\ttype: 'personalAccessToken',\n\t\t\t\tcreatedAt: new Date(),\n\t\t\t\tlastTokenPart: token.slice(-6),\n\t\t\t\tname: tokenName,\n\t\t\t},\n\t\t});\n\t\treturn token;\n\t},\n});\n","import './generateToken';\nimport './regenerateToken';\nimport './removeToken';\n","import { Meteor } from 'meteor/meteor';\n\nMeteor.methods({\n\t'personalAccessTokens:regenerateToken'({ tokenName }) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('not-authorized', 'Not Authorized', { method: 'personalAccessTokens:regenerateToken' });\n\t\t}\n\t\tif (!RocketChat.settings.get('API_Enable_Personal_Access_Tokens')) {\n\t\t\tthrow new Meteor.Error('error-personal-access-tokens-are-current-disabled', 'Personal Access Tokens are currently disabled', { method: 'personalAccessTokens:regenerateToken' });\n\t\t}\n\n\t\tconst tokenExist = RocketChat.models.Users.findPersonalAccessTokenByTokenNameAndUserId({\n\t\t\tuserId: Meteor.userId(),\n\t\t\ttokenName,\n\t\t});\n\t\tif (!tokenExist) {\n\t\t\tthrow new Meteor.Error('error-token-does-not-exists', 'Token does not exist', { method: 'personalAccessTokens:regenerateToken' });\n\t\t}\n\n\t\tMeteor.call('personalAccessTokens:removeToken', { tokenName });\n\t\treturn Meteor.call('personalAccessTokens:generateToken', { tokenName });\n\t},\n});\n","import { Meteor } from 'meteor/meteor';\n\nMeteor.methods({\n\t'personalAccessTokens:removeToken'({ tokenName }) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('not-authorized', 'Not Authorized', { method: 'personalAccessTokens:removeToken' });\n\t\t}\n\t\tif (!RocketChat.settings.get('API_Enable_Personal_Access_Tokens')) {\n\t\t\tthrow new Meteor.Error('error-personal-access-tokens-are-current-disabled', 'Personal Access Tokens are currently disabled', { method: 'personalAccessTokens:removeToken' });\n\t\t}\n\t\tconst tokenExist = RocketChat.models.Users.findPersonalAccessTokenByTokenNameAndUserId({\n\t\t\tuserId: Meteor.userId(),\n\t\t\ttokenName,\n\t\t});\n\t\tif (!tokenExist) {\n\t\t\tthrow new Meteor.Error('error-token-does-not-exists', 'Token does not exist', { method: 'personalAccessTokens:removeToken' });\n\t\t}\n\t\tRocketChat.models.Users.removePersonalAccessTokenOfUser({\n\t\t\tuserId: Meteor.userId(),\n\t\t\tloginTokenObject: {\n\t\t\t\ttype: 'personalAccessToken',\n\t\t\t\tname: tokenName,\n\t\t\t},\n\t\t});\n\t},\n});\n","RocketChat.models.Users.getLoginTokensByUserId = function(userId) {\n\tconst query = {\n\t\t'services.resume.loginTokens.type': {\n\t\t\t$exists: true,\n\t\t\t$eq: 'personalAccessToken',\n\t\t},\n\t\t_id: userId,\n\t};\n\n\treturn this.find(query, { fields: { 'services.resume.loginTokens': 1 } });\n};\n\nRocketChat.models.Users.addPersonalAccessTokenToUser = function({ userId, loginTokenObject }) {\n\treturn this.update(userId, {\n\t\t$push: {\n\t\t\t'services.resume.loginTokens': loginTokenObject,\n\t\t},\n\t});\n};\n\nRocketChat.models.Users.removePersonalAccessTokenOfUser = function({ userId, loginTokenObject }) {\n\treturn this.update(userId, {\n\t\t$pull: {\n\t\t\t'services.resume.loginTokens': loginTokenObject,\n\t\t},\n\t});\n};\n\nRocketChat.models.Users.findPersonalAccessTokenByTokenNameAndUserId = function({ userId, tokenName }) {\n\tconst query = {\n\t\t'services.resume.loginTokens': {\n\t\t\t$elemMatch: { name: tokenName, type: 'personalAccessToken' },\n\t\t},\n\t\t_id: userId,\n\t};\n\n\treturn this.findOne(query);\n};\n\n","import './Users';\n","import './personalAccessTokens';\n","import { Meteor } from 'meteor/meteor';\n\nMeteor.publish('personalAccessTokens', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\tif (!RocketChat.settings.get('API_Enable_Personal_Access_Tokens')) {\n\t\treturn this.ready();\n\t}\n\tconst self = this;\n\tconst getFieldsToPublish = (fields) => fields.services.resume.loginTokens\n\t\t.filter((loginToken) => loginToken.type && loginToken.type === 'personalAccessToken')\n\t\t.map((loginToken) => ({\n\t\t\tname: loginToken.name,\n\t\t\tcreatedAt: loginToken.createdAt,\n\t\t\tlastTokenPart: loginToken.lastTokenPart,\n\t\t}));\n\tconst handle = RocketChat.models.Users.getLoginTokensByUserId(this.userId).observeChanges({\n\t\tadded(id, fields) {\n\t\t\tself.added('personal_access_tokens', id, { tokens: getFieldsToPublish(fields) });\n\t\t},\n\t\tchanged(id, fields) {\n\t\t\tself.changed('personal_access_tokens', id, { tokens: getFieldsToPublish(fields) });\n\t\t},\n\t\tremoved(id) {\n\t\t\tself.removed('personal_access_tokens', id);\n\t\t},\n\t});\n\n\tself.ready();\n\n\tself.onStop(function() {\n\t\thandle.stop();\n\t});\n});\n","import './api/methods';\nimport './settings';\nimport './models';\nimport './publications';\n\n\n","RocketChat.settings.addGroup('General', function() {\n\tthis.section('REST API', function() {\n\t\tthis.add('API_Enable_Personal_Access_Tokens', false, { type: 'boolean', public: true });\n\t});\n});\n","import '../../message-read-receipt/server';\nimport '../../personal-access-tokens/server';\n","import _ from 'underscore';\n\nfunction getIdentity(accessToken) {\n\ttry {\n\t\treturn HTTP.get('https://graph.facebook.com/me', {\n\t\t\tparams: {\n\t\t\t\taccess_token: accessToken,\n\t\t\t},\n\t\t}).data;\n\t} catch (error) {\n\t\tthrow _.extend(new Error(`Failed to fetch identity from Facebook. ${ error.message }`), {\n\t\t\tresponse: error.response,\n\t\t});\n\t}\n}\n\nAccounts.registerLoginHandler(function(loginRequest) {\n\tif (!loginRequest.cordova) {\n\t\treturn;\n\t}\n\n\tloginRequest = loginRequest.authResponse;\n\n\tconst identity = getIdentity(loginRequest.accessToken);\n\tconst serviceData = {\n\t\taccessToken: loginRequest.accessToken,\n\t\texpiresAt: Date.now() + 1000 * loginRequest.expiresIn,\n\t};\n\n\tconst whitelisted = ['id', 'email', 'name', 'first_name', 'last_name', 'link', 'username', 'gender', 'locale', 'age_range'];\n\tconst fields = _.pick(identity, whitelisted);\n\tconst options = {\n\t\tprofile: {},\n\t};\n\n\t_.extend(serviceData, fields);\n\t_.extend(options.profile, fields);\n\n\treturn Accounts.updateOrCreateUserFromExternalService('facebook', serviceData, options);\n});\n","import _ from 'underscore';\nimport s from 'underscore.string';\nimport * as Mailer from 'meteor/rocketchat:mailer';\n\nconst accountsConfig = {\n\tforbidClientAccountCreation: true,\n\tloginExpirationInDays: RocketChat.settings.get('Accounts_LoginExpiration'),\n};\n\nAccounts.config(accountsConfig);\n\nAccounts.emailTemplates.siteName = RocketChat.settings.get('Site_Name');\n\nAccounts.emailTemplates.from = `${ RocketChat.settings.get('Site_Name') } <${ RocketChat.settings.get('From_Email') }>`;\n\nAccounts.emailTemplates.userToActivate = {\n\tsubject() {\n\t\tconst subject = TAPi18n.__('Accounts_Admin_Email_Approval_Needed_Subject_Default');\n\t\tconst siteName = RocketChat.settings.get('Site_Name');\n\n\t\treturn `[${ siteName }] ${ subject }`;\n\t},\n\n\thtml(options = {}) {\n\t\tconst email = options.reason ? 'Accounts_Admin_Email_Approval_Needed_With_Reason_Default' : 'Accounts_Admin_Email_Approval_Needed_Default';\n\n\t\treturn Mailer.replace(TAPi18n.__(email), {\n\t\t\tname: s.escapeHTML(options.name),\n\t\t\temail: s.escapeHTML(options.email),\n\t\t\treason: s.escapeHTML(options.reason),\n\t\t});\n\t},\n};\n\nAccounts.emailTemplates.userActivated = {\n\tsubject({ active, username }) {\n\t\tconst activated = username ? 'Activated' : 'Approved';\n\t\tconst action = active ? activated : 'Deactivated';\n\t\tconst subject = `Accounts_Email_${ action }_Subject`;\n\t\tconst siteName = RocketChat.settings.get('Site_Name');\n\n\t\treturn `[${ siteName }] ${ TAPi18n.__(subject) }`;\n\t},\n\n\thtml({ active, name, username }) {\n\t\tconst activated = username ? 'Activated' : 'Approved';\n\t\tconst action = active ? activated : 'Deactivated';\n\n\t\treturn Mailer.replace(TAPi18n.__(`Accounts_Email_${ action }`), {\n\t\t\tname: s.escapeHTML(name),\n\t\t});\n\t},\n};\n\n\n// const verifyEmailHtml = Accounts.emailTemplates.verifyEmail.html;\nlet verifyEmailTemplate = '';\nlet enrollAccountTemplate = '';\nMeteor.startup(() => {\n\tMailer.getTemplateWrapped('Verification_Email', (value) => {\n\t\tverifyEmailTemplate = value;\n\t});\n\tMailer.getTemplateWrapped('Accounts_Enrollment_Email', (value) => {\n\t\tenrollAccountTemplate = value;\n\t});\n});\nAccounts.emailTemplates.verifyEmail.html = function(user, url) {\n\turl = url.replace(Meteor.absoluteUrl(), `${ Meteor.absoluteUrl() }login/`);\n\treturn Mailer.replace(verifyEmailTemplate, { Verification_Url: url });\n};\n\nAccounts.urls.resetPassword = function(token) {\n\treturn Meteor.absoluteUrl(`reset-password/${ token }`);\n};\n\nAccounts.emailTemplates.resetPassword.html = Accounts.emailTemplates.resetPassword.text;\n\nAccounts.emailTemplates.enrollAccount.subject = function(user) {\n\tconst subject = RocketChat.settings.get('Accounts_Enrollment_Email_Subject');\n\treturn Mailer.replace(subject, user);\n};\n\nAccounts.emailTemplates.enrollAccount.html = function(user = {}/* , url*/) {\n\treturn Mailer.replace(enrollAccountTemplate, {\n\t\tname: s.escapeHTML(user.name),\n\t\temail: user.emails && user.emails[0] && s.escapeHTML(user.emails[0].address),\n\t});\n};\n\nAccounts.onCreateUser(function(options, user = {}) {\n\tRocketChat.callbacks.run('beforeCreateUser', options, user);\n\n\tuser.status = 'offline';\n\tuser.active = !RocketChat.settings.get('Accounts_ManuallyApproveNewUsers');\n\n\tif (!user.name) {\n\t\tif (options.profile) {\n\t\t\tif (options.profile.name) {\n\t\t\t\tuser.name = options.profile.name;\n\t\t\t} else if (options.profile.firstName && options.profile.lastName) {\n\t\t\t\t// LinkedIn format\n\t\t\t\tuser.name = `${ options.profile.firstName } ${ options.profile.lastName }`;\n\t\t\t} else if (options.profile.firstName) {\n\t\t\t\t// LinkedIn format\n\t\t\t\tuser.name = options.profile.firstName;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.services) {\n\t\tfor (const service of Object.values(user.services)) {\n\t\t\tif (!user.name) {\n\t\t\t\tuser.name = service.name || service.username;\n\t\t\t}\n\n\t\t\tif (!user.emails && service.email) {\n\t\t\t\tuser.emails = [{\n\t\t\t\t\taddress: service.email,\n\t\t\t\t\tverified: true,\n\t\t\t\t}];\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!user.active) {\n\t\tconst destinations = [];\n\n\t\tRocketChat.models.Roles.findUsersInRole('admin').forEach((adminUser) => {\n\t\t\tif (Array.isArray(adminUser.emails)) {\n\t\t\t\tadminUser.emails.forEach((email) => {\n\t\t\t\t\tdestinations.push(`${ adminUser.name }<${ email.address }>`);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tconst email = {\n\t\t\tto: destinations,\n\t\t\tfrom: RocketChat.settings.get('From_Email'),\n\t\t\tsubject: Accounts.emailTemplates.userToActivate.subject(),\n\t\t\thtml: Accounts.emailTemplates.userToActivate.html(options),\n\t\t};\n\n\t\tMailer.send(email);\n\t}\n\n\treturn user;\n});\n\nAccounts.insertUserDoc = _.wrap(Accounts.insertUserDoc, function(insertUserDoc, options, user) {\n\tlet roles = [];\n\n\tif (Match.test(user.globalRoles, [String]) && user.globalRoles.length > 0) {\n\t\troles = roles.concat(user.globalRoles);\n\t}\n\n\tdelete user.globalRoles;\n\n\tif (user.services && !user.services.password) {\n\t\tconst defaultAuthServiceRoles = String(RocketChat.settings.get('Accounts_Registration_AuthenticationServices_Default_Roles')).split(',');\n\t\tif (defaultAuthServiceRoles.length > 0) {\n\t\t\troles = roles.concat(defaultAuthServiceRoles.map((s) => s.trim()));\n\t\t}\n\t}\n\n\tif (!user.type) {\n\t\tuser.type = 'user';\n\t}\n\n\tconst _id = insertUserDoc.call(Accounts, options, user);\n\n\tuser = Meteor.users.findOne({\n\t\t_id,\n\t});\n\n\tif (user.username) {\n\t\tif (options.joinDefaultChannels !== false && user.joinDefaultChannels !== false) {\n\t\t\tMeteor.runAsUser(_id, function() {\n\t\t\t\treturn Meteor.call('joinDefaultChannels', options.joinDefaultChannelsSilenced);\n\t\t\t});\n\t\t}\n\n\t\tif (user.type !== 'visitor') {\n\t\t\tMeteor.defer(function() {\n\t\t\t\treturn RocketChat.callbacks.run('afterCreateUser', user);\n\t\t\t});\n\t\t}\n\t}\n\n\tif (roles.length === 0) {\n\t\tconst hasAdmin = RocketChat.models.Users.findOne({\n\t\t\troles: 'admin',\n\t\t\ttype: 'user',\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t},\n\t\t});\n\n\t\tif (hasAdmin) {\n\t\t\troles.push('user');\n\t\t} else {\n\t\t\troles.push('admin');\n\t\t\tif (RocketChat.settings.get('Show_Setup_Wizard') === 'pending') {\n\t\t\t\tRocketChat.models.Settings.updateValueById('Show_Setup_Wizard', 'in_progress');\n\t\t\t}\n\t\t}\n\t}\n\n\tRocketChat.authz.addUserRoles(_id, roles);\n\n\treturn _id;\n});\n\nAccounts.validateLoginAttempt(function(login) {\n\tlogin = RocketChat.callbacks.run('beforeValidateLogin', login);\n\n\tif (login.allowed !== true) {\n\t\treturn login.allowed;\n\t}\n\n\tif (login.user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tif (!!login.user.active !== true) {\n\t\tthrow new Meteor.Error('error-user-is-not-activated', 'User is not activated', {\n\t\t\tfunction: 'Accounts.validateLoginAttempt',\n\t\t});\n\t}\n\n\tif (!login.user.roles || !Array.isArray(login.user.roles)) {\n\t\tthrow new Meteor.Error('error-user-has-no-roles', 'User has no roles', {\n\t\t\tfunction: 'Accounts.validateLoginAttempt',\n\t\t});\n\t}\n\n\tif (login.user.roles.includes('admin') === false && login.type === 'password' && RocketChat.settings.get('Accounts_EmailVerification') === true) {\n\t\tconst validEmail = login.user.emails.filter((email) => email.verified === true);\n\t\tif (validEmail.length === 0) {\n\t\t\tthrow new Meteor.Error('error-invalid-email', 'Invalid email __email__');\n\t\t}\n\t}\n\n\tlogin = RocketChat.callbacks.run('onValidateLogin', login);\n\n\tRocketChat.models.Users.updateLastLoginById(login.user._id);\n\tMeteor.defer(function() {\n\t\treturn RocketChat.callbacks.run('afterValidateLogin', login);\n\t});\n\n\treturn true;\n});\n\nAccounts.validateNewUser(function(user) {\n\tif (user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tif (RocketChat.settings.get('Accounts_Registration_AuthenticationServices_Enabled') === false && RocketChat.settings.get('LDAP_Enable') === false && !(user.services && user.services.password)) {\n\t\tthrow new Meteor.Error('registration-disabled-authentication-services', 'User registration is disabled for authentication services');\n\t}\n\n\treturn true;\n});\n\nAccounts.validateNewUser(function(user) {\n\tif (user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tlet domainWhiteList = RocketChat.settings.get('Accounts_AllowedDomainsList');\n\tif (_.isEmpty(s.trim(domainWhiteList))) {\n\t\treturn true;\n\t}\n\n\tdomainWhiteList = domainWhiteList.split(',').map((domain) => domain.trim());\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tconst email = user.emails[0].address;\n\t\tconst inWhiteList = domainWhiteList.some((domain) => email.match(`@${ RegExp.escape(domain) }$`));\n\n\t\tif (inWhiteList === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-domain');\n\t\t}\n\t}\n\n\treturn true;\n});\n","/* global Push, SystemLogger */\n\nMeteor.methods({\n\t// log() {\n\t// \treturn console.log(...arguments);\n\t// },\n\n\tpush_test() {\n\t\tconst user = Meteor.user();\n\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'push_test',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'push_test',\n\t\t\t});\n\t\t}\n\n\t\tif (Push.enabled !== true) {\n\t\t\tthrow new Meteor.Error('error-push-disabled', 'Push is disabled', {\n\t\t\t\tmethod: 'push_test',\n\t\t\t});\n\t\t}\n\n\t\tconst query = {\n\t\t\t$and: [{\n\t\t\t\tuserId: user._id,\n\t\t\t}, {\n\t\t\t\t$or: [{\n\t\t\t\t\t'token.apn': {\n\t\t\t\t\t\t$exists: true,\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\t'token.gcm': {\n\t\t\t\t\t\t$exists: true,\n\t\t\t\t\t},\n\t\t\t\t}],\n\t\t\t}],\n\t\t};\n\n\t\tconst tokens = Push.appCollection.find(query).count();\n\n\t\tif (tokens === 0) {\n\t\t\tthrow new Meteor.Error('error-no-tokens-for-this-user', 'There are no tokens for this user', {\n\t\t\t\tmethod: 'push_test',\n\t\t\t});\n\t\t}\n\n\t\tPush.send({\n\t\t\tfrom: 'push',\n\t\t\ttitle: `@${ user.username }`,\n\t\t\ttext: TAPi18n.__('This_is_a_push_test_messsage'),\n\t\t\tapn: {\n\t\t\t\ttext: `@${ user.username }:\\n${ TAPi18n.__('This_is_a_push_test_messsage') }`,\n\t\t\t},\n\t\t\tsound: 'default',\n\t\t\tquery: {\n\t\t\t\tuserId: user._id,\n\t\t\t},\n\t\t});\n\n\t\treturn {\n\t\t\tmessage: 'Your_push_was_sent_to_s_devices',\n\t\t\tparams: [tokens],\n\t\t};\n\t},\n});\n\nfunction sendPush(service, token, options, tries = 0) {\n\tconst data = {\n\t\tdata: {\n\t\t\ttoken,\n\t\t\toptions,\n\t\t},\n\t};\n\n\treturn HTTP.post(`${ RocketChat.settings.get('Push_gateway') }/push/${ service }/send`, data, function(error, response) {\n\t\tif (response && response.statusCode === 406) {\n\t\t\tconsole.log('removing push token', token);\n\t\t\tPush.appCollection.remove({\n\t\t\t\t$or: [{\n\t\t\t\t\t'token.apn': token,\n\t\t\t\t}, {\n\t\t\t\t\t'token.gcm': token,\n\t\t\t\t}],\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif (!error) {\n\t\t\treturn;\n\t\t}\n\n\t\tSystemLogger.error(`Error sending push to gateway (${ tries } try) ->`, error);\n\n\t\tif (tries <= 6) {\n\t\t\tconst milli = Math.pow(10, tries + 2);\n\n\t\t\tSystemLogger.log('Trying sending push to gateway again in', milli, 'milliseconds');\n\n\t\t\treturn Meteor.setTimeout(function() {\n\t\t\t\treturn sendPush(service, token, options, tries + 1);\n\t\t\t}, milli);\n\t\t}\n\t});\n}\n\nfunction configurePush() {\n\tif (RocketChat.settings.get('Push_debug')) {\n\t\tPush.debug = true;\n\t\tconsole.log('Push: configuring...');\n\t}\n\n\tif (RocketChat.settings.get('Push_enable') === true) {\n\t\tPush.allow({\n\t\t\tsend(userId/* , notification*/) {\n\t\t\t\treturn RocketChat.authz.hasRole(userId, 'admin');\n\t\t\t},\n\t\t});\n\n\t\tlet apn;\n\t\tlet gcm;\n\n\t\tif (RocketChat.settings.get('Push_enable_gateway') === false) {\n\t\t\tgcm = {\n\t\t\t\tapiKey: RocketChat.settings.get('Push_gcm_api_key'),\n\t\t\t\tprojectNumber: RocketChat.settings.get('Push_gcm_project_number'),\n\t\t\t};\n\n\t\t\tapn = {\n\t\t\t\tpassphrase: RocketChat.settings.get('Push_apn_passphrase'),\n\t\t\t\tkeyData: RocketChat.settings.get('Push_apn_key'),\n\t\t\t\tcertData: RocketChat.settings.get('Push_apn_cert'),\n\t\t\t};\n\n\t\t\tif (RocketChat.settings.get('Push_production') !== true) {\n\t\t\t\tapn = {\n\t\t\t\t\tpassphrase: RocketChat.settings.get('Push_apn_dev_passphrase'),\n\t\t\t\t\tkeyData: RocketChat.settings.get('Push_apn_dev_key'),\n\t\t\t\t\tcertData: RocketChat.settings.get('Push_apn_dev_cert'),\n\t\t\t\t\tgateway: 'gateway.sandbox.push.apple.com',\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!apn.keyData || apn.keyData.trim() === '' || !apn.certData || apn.certData.trim() === '') {\n\t\t\t\tapn = undefined;\n\t\t\t}\n\n\t\t\tif (!gcm.apiKey || gcm.apiKey.trim() === '' || !gcm.projectNumber || gcm.projectNumber.trim() === '') {\n\t\t\t\tgcm = undefined;\n\t\t\t}\n\t\t}\n\n\t\tPush.Configure({\n\t\t\tapn,\n\t\t\tgcm,\n\t\t\tproduction: RocketChat.settings.get('Push_production'),\n\t\t\tsendInterval: 5000,\n\t\t\tsendBatchSize: 10,\n\t\t});\n\n\t\tif (RocketChat.settings.get('Push_enable_gateway') === true) {\n\t\t\tPush.serverSend = function(options = { badge: 0 }) {\n\t\t\t\tif (options.from !== String(options.from)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"from\" not a string');\n\t\t\t\t}\n\t\t\t\tif (options.title !== String(options.title)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"title\" not a string');\n\t\t\t\t}\n\t\t\t\tif (options.text !== String(options.text)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"text\" not a string');\n\t\t\t\t}\n\t\t\t\tif (RocketChat.settings.get('Push_debug')) {\n\t\t\t\t\tconsole.log(`Push: send message \"${ options.title }\" via query`, options.query);\n\t\t\t\t}\n\n\t\t\t\tconst query = {\n\t\t\t\t\t$and: [options.query, {\n\t\t\t\t\t\t$or: [{\n\t\t\t\t\t\t\t'token.apn': {\n\t\t\t\t\t\t\t\t$exists: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t'token.gcm': {\n\t\t\t\t\t\t\t\t$exists: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}],\n\t\t\t\t\t}],\n\t\t\t\t};\n\n\t\t\t\treturn Push.appCollection.find(query).forEach((app) => {\n\t\t\t\t\tif (RocketChat.settings.get('Push_debug')) {\n\t\t\t\t\t\tconsole.log('Push: send to token', app.token);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (app.token.apn) {\n\t\t\t\t\t\toptions.topic = app.appName;\n\t\t\t\t\t\treturn sendPush('apn', app.token.apn, options);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (app.token.gcm) {\n\t\t\t\t\t\treturn sendPush('gcm', app.token.gcm, options);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\n\t\tPush.enabled = true;\n\t}\n}\n\nMeteor.startup(configurePush);\n","export const roomFiles = (pub, { rid, searchText, limit = 50 }) => {\n\tif (!pub.userId) {\n\t\treturn pub.ready();\n\t}\n\n\tconst cursorFileListHandle = RocketChat.models.Uploads.findNotHiddenFilesOfRoom(rid, searchText, limit).observeChanges({\n\t\tadded(_id, record) {\n\t\t\tconst { username, name } = record.userId ? RocketChat.models.Users.findOneById(record.userId) : {};\n\t\t\treturn pub.added('room_files', _id, { ...record, user: { username, name } });\n\t\t},\n\t\tchanged(_id, recordChanges) {\n\t\t\tif (!recordChanges.hasOwnProperty('user') && recordChanges.userId) {\n\t\t\t\trecordChanges.user = RocketChat.models.Users.findOneById(recordChanges.userId);\n\t\t\t}\n\t\t\treturn pub.changed('room_files', _id, recordChanges);\n\t\t},\n\t\tremoved(_id) {\n\t\t\treturn pub.removed('room_files', _id);\n\t\t},\n\t});\n\n\tpub.ready();\n\n\treturn pub.onStop(function() {\n\t\treturn cursorFileListHandle.stop();\n\t});\n};\n","RocketChat.Migrations.add({\n\tversion: 1,\n\tup() {\n\t\treturn RocketChat.models.Users.find({\n\t\t\tusername: {\n\t\t\t\t$exists: false,\n\t\t\t},\n\t\t\tlastLogin: {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t}).forEach((user) => {\n\t\t\tconst username = RocketChat.generateUsernameSuggestion(user);\n\t\t\tif (username && username.trim() !== '') {\n\t\t\t\treturn RocketChat.models.Users.setUsername(user._id, username);\n\t\t\t} else {\n\t\t\t\treturn console.log('User without username', JSON.stringify(user, null, ' '));\n\t\t\t}\n\t\t});\n\t},\n});\n","/* globals getAvatarSuggestionForUser */\n\nRocketChat.Migrations.add({\n\tversion: 2,\n\tup() {\n\t\treturn RocketChat.models.Users.find({\n\t\t\tavatarOrigin: {\n\t\t\t\t$exists: false,\n\t\t\t},\n\t\t\tusername: {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t}).forEach((user) => {\n\t\t\tconst avatars = getAvatarSuggestionForUser(user);\n\t\t\tconst services = Object.keys(avatars);\n\n\t\t\tif (services.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst service = services[0];\n\n\t\t\tconsole.log(user.username, '->', service);\n\n\t\t\tconst dataURI = avatars[service].blob;\n\t\t\tconst { image, contentType } = RocketChatFile.dataURIParse(dataURI);\n\n\t\t\tconst rs = RocketChatFile.bufferToStream(new Buffer(image, 'base64'));\n\t\t\tconst fileStore = FileUpload.getStore('Avatars');\n\t\t\tfileStore.deleteByName(user.username);\n\n\t\t\tconst file = {\n\t\t\t\tuserId: user._id,\n\t\t\t\ttype: contentType,\n\t\t\t};\n\n\t\t\tfileStore.insert(file, rs, () => RocketChat.models.Users.setAvatarOrigin(user._id, service));\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 3,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex('uid_1');\n\t\tRocketChat.models.Subscriptions.tryDropIndex('rid_1_uid_1');\n\n\t\tconsole.log('Fixing ChatSubscription uid');\n\n\t\tRocketChat.models.Subscriptions.find({\n\t\t\tuid: {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t}, {\n\t\t\tnonreactive: true,\n\t\t}).forEach((sub) => {\n\t\t\tconst update = {};\n\t\t\tconst user = RocketChat.models.Users.findOneById(sub.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tif (!update.$set) {\n\t\t\t\t\tupdate.$set = {};\n\t\t\t\t}\n\n\t\t\t\tif (!update.$unset) {\n\t\t\t\t\tupdate.$unset = {};\n\t\t\t\t}\n\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (Object.keys(update).length > 0) {\n\t\t\t\treturn RocketChat.models.Subscriptions.update(sub._id, update);\n\t\t\t}\n\t\t});\n\n\t\tconsole.log('Fixing ChatRoom uids');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\t'uids.0': {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t}, {\n\t\t\tnonreactive: true,\n\t\t}).forEach(function(room) {\n\t\t\tconst update = {};\n\t\t\tconst users = RocketChat.models.Users.find({\n\t\t\t\t_id: {\n\t\t\t\t\t$in: room.uids,\n\t\t\t\t},\n\t\t\t\tusername: {\n\t\t\t\t\t$exists: true,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tconst usernames = users.map(function(user) {\n\t\t\t\treturn user.username;\n\t\t\t});\n\n\t\t\tif (!update.$set) {\n\t\t\t\tupdate.$set = {};\n\t\t\t}\n\n\t\t\tif (!update.$unset) {\n\t\t\t\tupdate.$unset = {};\n\t\t\t}\n\n\t\t\tupdate.$set.usernames = usernames;\n\t\t\tupdate.$unset.uids = 1;\n\n\t\t\tconst user = RocketChat.models.Users.findOneById(room.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (room.t === 'd' && usernames.length === 2) {\n\t\t\t\tfor (const k of Object.keys(update.$set)) {\n\t\t\t\t\tconst v = update.$set[k];\n\t\t\t\t\troom[k] = v;\n\t\t\t\t}\n\n\t\t\t\tfor (const k of Object.keys(update.$unset)) {\n\t\t\t\t\tdelete room[k];\n\t\t\t\t}\n\n\t\t\t\tconst oldId = room._id;\n\n\t\t\t\troom._id = usernames.sort().join(',');\n\n\t\t\t\tRocketChat.models.Rooms.insert(room);\n\t\t\t\tRocketChat.models.Rooms.removeById(oldId);\n\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: oldId,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: room._id,\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.models.Messages.update({\n\t\t\t\t\trid: oldId,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: room._id,\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn RocketChat.models.Rooms.update(room._id, update);\n\t\t\t}\n\t\t});\n\n\t\tconsole.log('Fixing ChatMessage uid');\n\n\t\tRocketChat.models.Messages.find({\n\t\t\tuid: {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t}, {\n\t\t\tnonreactive: true,\n\t\t}).forEach((message) => {\n\t\t\tconst update = {};\n\t\t\tconst user = RocketChat.models.Users.findOneById(message.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tif (!update.$set) {\n\t\t\t\t\tupdate.$set = {};\n\t\t\t\t}\n\n\t\t\t\tif (!update.$unset) {\n\t\t\t\t\tupdate.$unset = {};\n\t\t\t\t}\n\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (Object.keys(update).length > 0) {\n\t\t\t\treturn RocketChat.models.Messages.update(message._id, update);\n\t\t\t}\n\t\t});\n\n\t\treturn console.log('End');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 4,\n\tup() {\n\t\tRocketChat.models.Messages.tryDropIndex('rid_1');\n\t\tRocketChat.models.Subscriptions.tryDropIndex('u._id_1');\n\n\t\tconsole.log('Rename rn to name');\n\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\trn: {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t}, {\n\t\t\t$rename: {\n\t\t\t\trn: 'name',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\n\t\tconsole.log('Adding names to rooms without name');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\tname: '',\n\t\t}).forEach((item) => {\n\t\t\tconst name = Random.id().toLowerCase();\n\n\t\t\tRocketChat.models.Rooms.setNameById(item._id, name);\n\n\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\trid: item._id,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tmulti: true,\n\t\t\t});\n\t\t});\n\n\t\tconsole.log('Making room names unique');\n\n\t\tRocketChat.models.Rooms.find().forEach(function(room) {\n\n\t\t\treturn RocketChat.models.Rooms.find({\n\t\t\t\tname: room.name,\n\t\t\t\t_id: {\n\t\t\t\t\t$ne: room._id,\n\t\t\t\t},\n\t\t\t}).forEach((item) => {\n\t\t\t\tconst name = `${ room.name }-${ Random.id(2).toLowerCase() }`;\n\n\t\t\t\tRocketChat.models.Rooms.setNameById(item._id, name);\n\n\t\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: item._id,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tname,\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('End');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 5,\n\tup() {\n\t\tconsole.log('Dropping test rooms with less than 2 messages');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\tmsgs: {\n\t\t\t\t$lt: 2,\n\t\t\t},\n\t\t}).forEach((room) => {\n\t\t\tconsole.log('Dropped: ', room.name);\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\treturn RocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t});\n\n\t\tconsole.log('Dropping test rooms with less than 2 user');\n\t\tRocketChat.models.Rooms.find({\n\t\t\tusernames: {\n\t\t\t\t$size: 1,\n\t\t\t},\n\t\t}).forEach((room) => {\n\t\t\tconsole.log('Dropped: ', room.name);\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\treturn RocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t});\n\n\t\tconsole.log('Adding username to all users');\n\t\tRocketChat.models.Users.find({\n\t\t\tusername: {\n\t\t\t\t$exists: 0,\n\t\t\t},\n\t\t\temails: {\n\t\t\t\t$exists: 1,\n\t\t\t},\n\t\t}).forEach((user) => {\n\t\t\tlet newUserName = user.emails[0].address.split('@')[0];\n\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconsole.log(`Adding: username ${ newUserName } to all user ${ user._id }`);\n\t\t\treturn RocketChat.models.Users.setUsername(user._id, newUserName);\n\t\t});\n\n\t\tconsole.log('Fixing _id of direct messages rooms');\n\t\tRocketChat.models.Rooms.findByType('d').forEach(function(room) {\n\t\t\tlet newId = '';\n\t\t\tconst id0 = RocketChat.models.Users.findOneByUsername(room.usernames[0])._id;\n\t\t\tconst id1 = RocketChat.models.Users.findOneByUsername(room.usernames[1])._id;\n\t\t\tconst ids = [id0, id1];\n\n\t\t\tnewId = ids.sort().join('');\n\t\t\tif (newId !== room._id) {\n\t\t\t\tconsole.log(`Fixing: _id ${ room._id } to ${ newId }`);\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: room._id,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: newId,\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: 1,\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Messages.update({\n\t\t\t\t\trid: room._id,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: newId,\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: 1,\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\t\troom._id = newId;\n\t\t\t\tRocketChat.models.Rooms.insert(room);\n\t\t\t}\n\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id,\n\t\t\t\t'u._id': id0,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname: room.usernames[1],\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id,\n\t\t\t\t'u._id': id1,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname: room.usernames[0],\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\tconsole.log('Adding u.username to all documents');\n\t\tRocketChat.models.Users.find({}, {\n\t\t\tusername: 1,\n\t\t}).forEach((user) => {\n\t\t\tconsole.log(`Adding: u.username ${ user.username } to all document`);\n\t\t\tRocketChat.models.Rooms.update({\n\t\t\t\t'u._id': user._id,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tmulti: 1,\n\t\t\t});\n\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t'u._id': user._id,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tmulti: 1,\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\t'u._id': user._id,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tmulti: 1,\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tuid: user._id,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tu: user,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tmulti: 1,\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tby: user._id,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tu: user,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tmulti: 1,\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tuid: {\n\t\t\t\t\t$exists: 1,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\t$unset: {\n\t\t\t\t\tuid: 1,\n\t\t\t\t\tby: 1,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tmulti: 1,\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('End');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 6,\n\tup() {\n\t\tconsole.log('Changing _id of #general channel room from XXX to GENERAL');\n\n\t\tconst room = RocketChat.models.Rooms.findOneByName('general');\n\n\t\tif (room && room._id !== 'GENERAL') {\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: 'GENERAL',\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tmulti: 1,\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\trid: room._id,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: 'GENERAL',\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tmulti: 1,\n\t\t\t});\n\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\n\t\t\tdelete room._id;\n\n\t\t\tRocketChat.models.Rooms.upsert({\n\t\t\t\t_id: 'GENERAL',\n\t\t\t}, {\n\t\t\t\t$set: room,\n\t\t\t});\n\t\t}\n\n\t\treturn console.log('End');\n\t},\n});\n","/* globals OEmbed */\nimport _ from 'underscore';\n\nRocketChat.Migrations.add({\n\tversion: 7,\n\tup() {\n\t\tconsole.log('Populate urls in messages');\n\n\t\tconst query = RocketChat.models.Messages.find({\n\t\t\t'urls.0': {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t});\n\n\t\tconst count = query.count();\n\n\t\tquery.forEach((message, index) => {\n\t\t\tconsole.log(`${ index + 1 } / ${ count }`);\n\n\t\t\tmessage.urls = message.urls.map((url) => {\n\t\t\t\tif (_.isString(url)) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\turl,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn url;\n\t\t\t});\n\n\t\t\treturn OEmbed.rocketUrlParser(message);\n\t\t});\n\n\t\treturn console.log('End');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 8,\n\tup() {\n\t\tconsole.log('Load old settings record');\n\t\tconst settings = RocketChat.models.Settings.findOne({\n\t\t\t_id: 'settings',\n\t\t});\n\n\t\tif (settings) {\n\t\t\tif (settings.CDN_PREFIX) {\n\t\t\t\tRocketChat.models.Settings.insert({ _id: 'CDN_PREFIX', value: settings.CDN_PREFIX, type: 'string', group: 'General' });\n\t\t\t}\n\n\t\t\tif (settings.ENV && settings.ENV.MAIL_URL) {\n\t\t\t\tRocketChat.models.Settings.insert({ _id: 'MAIL_URL', value: settings.ENV.MAIL_URL, type: 'string', group: 'SMTP' });\n\t\t\t}\n\n\t\t\tif (settings.denyUnverifiedEmails) {\n\t\t\t\tRocketChat.models.Settings.insert({ _id: 'Accounts_denyUnverifiedEmails', value: settings.denyUnverifiedEmails, type: 'boolean', group: 'Accounts' });\n\t\t\t}\n\n\t\t\tif (settings.public && settings.public.avatarStore && settings.public.avatarStore.type) {\n\t\t\t\tRocketChat.models.Settings.insert({ _id: 'avatarStore_type', value: settings.public.avatarStore.type, type: 'string', group: 'API' });\n\t\t\t}\n\n\t\t\tif (settings.public && settings.public.avatarStore && settings.public.avatarStore.path) {\n\t\t\t\tRocketChat.models.Settings.insert({ _id: 'avatarStore_path', value: settings.public.avatarStore.path, type: 'string', group: 'API' });\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Settings.remove({\n\t\t\t\t_id: 'settings',\n\t\t\t});\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 9,\n\tup() {\n\t\t// Migrate existing source collection data to target collection\n\t\t// target collection is defined in collections.coffee using the new collection name\n\t\t// source collection is dropped after data migration\n\t\tconst toMigrate = [\n\t\t\t{\n\t\t\t\tsource: new Mongo.Collection('data.ChatRoom'),\n\t\t\t\ttarget: RocketChat.models.Rooms.model,\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('data.ChatSubscription'),\n\t\t\t\ttarget: RocketChat.models.Subscriptions.model,\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('data.ChatMessage'),\n\t\t\t\ttarget: RocketChat.models.Messages.model,\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('settings'),\n\t\t\t\ttarget: RocketChat.models.Settings.model,\n\t\t\t}, {\n\t\t\t\t// this collection may not exit\n\t\t\t\tsource: new Mongo.Collection('oembed_cache'),\n\t\t\t\ttarget: RocketChat.models.OEmbedCache.model,\n\t\t\t},\n\t\t];\n\n\t\treturn toMigrate.forEach((collection) => {\n\t\t\tconst { target, source } = collection;\n\n\t\t\t// rawCollection available as of Meteor 1.0.4\n\t\t\tconsole.log(`Migrating data from: ${ source.rawCollection().collectionName } to: ${ target.rawCollection().collectionName }`);\n\n\t\t\tsource.find().forEach((doc) =>\n\t\t\t\t// use upsert to account for GENERAL room created by initialData\n\t\t\t\ttarget.upsert({\n\t\t\t\t\t_id: doc._id,\n\t\t\t\t}, doc)\n\t\t\t);\n\n\t\t\tconst rawSource = source.rawCollection();\n\n\t\t\treturn Meteor.wrapAsync(rawSource.drop, rawSource)(function(err/* , res*/) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn console.log(`Error dropping ${ rawSource.collectionName } collection due to: ${ err.errmsg }`);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Note: the following would have been much easier, but didn't work.  The serverside\n\t\t\t// data was not published to the client for some reason.\n\t\t\t// newName = target.rawCollection().collectionName\n\t\t\t// Meteor.wrapAsync(rawSource.rename, rawSource )(newName, {dropTarget:true})\n\t\t});\n\t},\n});\n","import _ from 'underscore';\n\nRocketChat.Migrations.add({\n\tversion: 10,\n\tup() {\n\t\t/*\n\t\t * Remove duplicated usernames from rooms\n\t\t */\n\t\tlet count = 0;\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\t'usernames.0': {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tusernames: 1,\n\t\t\t},\n\t\t}).forEach((room) => {\n\t\t\tconst newUsernames = _.uniq(room.usernames);\n\t\t\tif (newUsernames.length !== room.usernames.length) {\n\t\t\t\tcount++;\n\t\t\t\treturn RocketChat.models.Rooms.update({\n\t\t\t\t\t_id: room._id,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tusernames: newUsernames,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn console.log(`Removed duplicated usernames from ${ count } rooms`);\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 11,\n\tup() {\n\t\t/*\n\t\t * Set GENERAL room to be default\n\t\t */\n\t\tRocketChat.models.Rooms.update({\n\t\t\t_id: 'GENERAL',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tdefault: true,\n\t\t\t},\n\t\t});\n\n\t\treturn console.log('Set GENERAL room to be default');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 12,\n\tup() {\n\t\t// Set oldest user as admin, if none exists yet\n\t\tconst admin = RocketChat.models.Users.findOneAdmin(true, {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t},\n\t\t});\n\n\t\tif (!admin) {\n\t\t\t// get oldest user\n\t\t\tconst oldestUser = RocketChat.models.Users.findOne({}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t},\n\t\t\t\tsort: {\n\t\t\t\t\tcreatedAt: 1,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (oldestUser) {\n\t\t\t\tMeteor.users.update({\n\t\t\t\t\t_id: oldestUser._id,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tadmin: true,\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\treturn console.log(`Set ${ oldestUser.username } as admin for being the oldest user`);\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 13,\n\tup() {\n\t\t// Set all current users as active\n\t\tRocketChat.models.Users.setAllUsersActive(true);\n\t\treturn console.log('Set all users as active');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 14,\n\tup() {\n\t\t// Remove unused settings\n\t\tRocketChat.models.Settings.remove({ _id: 'API_Piwik_URL' });\n\t\tRocketChat.models.Settings.remove({ _id: 'API_Piwik_ID' });\n\t\tRocketChat.models.Settings.remove({ _id: 'Message_Edit' });\n\t\tRocketChat.models.Settings.remove({ _id: 'Message_Delete' });\n\t\tRocketChat.models.Settings.remove({ _id: 'Message_KeepStatusHistory' });\n\n\t\tRocketChat.models.Settings.update({ _id: 'Message_ShowEditedStatus' }, {\n\t\t\t$set: {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tvalue: true,\n\t\t\t},\n\t\t});\n\n\t\tRocketChat.models.Settings.update({ _id: 'Message_ShowDeletedStatus' }, {\n\t\t\t$set: {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tvalue: false,\n\t\t\t},\n\t\t});\n\n\t\tconst metaKeys = [\n\t\t\t{\n\t\t\t\told: 'Meta:language',\n\t\t\t\tnew: 'Meta_language',\n\t\t\t}, {\n\t\t\t\told: 'Meta:fb:app_id',\n\t\t\t\tnew: 'Meta_fb_app_id',\n\t\t\t}, {\n\t\t\t\told: 'Meta:robots',\n\t\t\t\tnew: 'Meta_robots',\n\t\t\t}, {\n\t\t\t\told: 'Meta:google-site-verification',\n\t\t\t\tnew: 'Meta_google-site-verification',\n\t\t\t}, {\n\t\t\t\told: 'Meta:msvalidate.01',\n\t\t\t\tnew: 'Meta_msvalidate01',\n\t\t\t},\n\t\t];\n\n\t\tfor (const oldAndNew of metaKeys) {\n\t\t\tconst oldSetting = RocketChat.models.Settings.findOne({ _id: oldAndNew.old });\n\t\t\tconst oldValue = oldSetting && oldSetting.value;\n\n\t\t\tconst newSetting = RocketChat.models.Settings.findOne({ _id: oldAndNew.new });\n\t\t\tconst newValue = newSetting && newSetting.value;\n\n\t\t\tif (oldValue && newValue) {\n\t\t\t\tRocketChat.models.Settings.update({\n\t\t\t\t\t_id: oldAndNew.new,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: newValue,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: oldAndNew.old,\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({\n\t\t\t_id: 'SMTP_Security',\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 15,\n\tup() {\n\t\tconsole.log('Starting file migration');\n\t\tconst oldFilesCollection = new Mongo.Collection('cfs.Files.filerecord');\n\t\tconst oldGridFSCollection = new Mongo.Collection('cfs_gridfs.files.files');\n\t\tconst oldChunkCollection = new Mongo.Collection('cfs_gridfs.files.chunks');\n\t\tconst newFilesCollection = RocketChat.models.Uploads;\n\t\tconst newGridFSCollection = new Mongo.Collection('rocketchat_uploads.files');\n\t\tconst newChunkCollection = new Mongo.Collection('rocketchat_uploads.chunks');\n\n\t\toldFilesCollection.find({\n\t\t\t'copies.files.key': {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t}).forEach((cfsRecord) => {\n\t\t\tconst nameParts = cfsRecord.original.name && cfsRecord.original.name.split('.');\n\t\t\tlet extension = '';\n\t\t\tlet url = `ufs/rocketchat_uploads/${ cfsRecord._id }`;\n\n\t\t\tconsole.log('migrating file', url);\n\n\t\t\tif (nameParts && nameParts.length > 1) {\n\t\t\t\textension = nameParts.pop();\n\t\t\t\turl = `${ url }.${ extension }`;\n\t\t\t}\n\n\t\t\tconst record = {\n\t\t\t\t_id: cfsRecord._id,\n\t\t\t\tname: cfsRecord.original.name || '',\n\t\t\t\tsize: cfsRecord.original.size,\n\t\t\t\ttype: cfsRecord.original.type,\n\t\t\t\tcomplete: true,\n\t\t\t\tuploading: false,\n\t\t\t\tstore: 'rocketchat_uploads',\n\t\t\t\textension,\n\t\t\t\tuserId: cfsRecord.userId,\n\t\t\t\tuploadedAt: cfsRecord.updatedAt,\n\t\t\t\turl: Meteor.absoluteUrl() + url,\n\t\t\t};\n\n\t\t\tnewFilesCollection.insert(record);\n\n\t\t\tconst oldGridFsFile = oldGridFSCollection.findOne({\n\t\t\t\t_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key),\n\t\t\t});\n\n\t\t\tnewGridFSCollection.insert({\n\t\t\t\t_id: cfsRecord._id,\n\t\t\t\tfilename: cfsRecord._id,\n\t\t\t\tcontentType: oldGridFsFile.contentType,\n\t\t\t\tlength: oldGridFsFile.length,\n\t\t\t\tchunkSize: oldGridFsFile.chunkSize,\n\t\t\t\tuploadDate: oldGridFsFile.uploadDate,\n\t\t\t\taliases: null,\n\t\t\t\tmetadata: null,\n\t\t\t\tmd5: oldGridFsFile.md5,\n\t\t\t});\n\n\t\t\toldChunkCollection.find({\n\t\t\t\tfiles_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key),\n\t\t\t}).forEach((oldChunk) => {\n\t\t\t\tnewChunkCollection.insert({\n\t\t\t\t\t_id: oldChunk._id,\n\t\t\t\t\tfiles_id: cfsRecord._id,\n\t\t\t\t\tn: oldChunk.n,\n\t\t\t\t\tdata: oldChunk.data,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.find({\n\t\t\t\t$or: [{\n\t\t\t\t\t'urls.url': `https://open.rocket.chat/cfs/files/Files/${ cfsRecord._id }`,\n\t\t\t\t}, {\n\t\t\t\t\t'urls.url': `https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`,\n\t\t\t\t}],\n\t\t\t}).forEach((message) => {\n\t\t\t\tfor (const urlsItem of message.urls) {\n\t\t\t\t\tif (urlsItem.url === (`https://open.rocket.chat/cfs/files/Files/${ cfsRecord._id }`) || urlsItem.url === (`https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`)) {\n\t\t\t\t\t\turlsItem.url = Meteor.absoluteUrl() + url;\n\t\t\t\t\t\tif (urlsItem.parsedUrl && urlsItem.parsedUrl.pathname) {\n\t\t\t\t\t\t\turlsItem.parsedUrl.pathname = `/${ url }`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tmessage.msg = message.msg.replace(`https://open.rocket.chat/cfs/files/Files/${ cfsRecord._id }`, Meteor.absoluteUrl() + url);\n\t\t\t\t\t\tmessage.msg = message.msg.replace(`https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`, Meteor.absoluteUrl() + url);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tRocketChat.models.Messages.update({ _id: message._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\turls: message.urls,\n\t\t\t\t\t\tmsg: message.msg,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\n\t\t\toldFilesCollection.remove({ _id: cfsRecord._id });\n\t\t\toldGridFSCollection.remove({ _id: oldGridFsFile._id });\n\t\t\toldChunkCollection.remove({ files_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key) });\n\t\t});\n\n\t\treturn console.log('End of file migration');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 16,\n\tup() {\n\t\treturn RocketChat.models.Messages.tryDropIndex({\n\t\t\t_hidden: 1,\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 17,\n\tup() {\n\t\treturn RocketChat.models.Messages.tryDropIndex({\n\t\t\t_hidden: 1,\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 18,\n\tup() {\n\t\tconst changes = {\n\t\t\tAccounts_Facebook: 'Accounts_OAuth_Facebook',\n\t\t\tAccounts_Facebook_id: 'Accounts_OAuth_Facebook_id',\n\t\t\tAccounts_Facebook_secret: 'Accounts_OAuth_Facebook_secret',\n\t\t\tAccounts_Google: 'Accounts_OAuth_Google',\n\t\t\tAccounts_Google_id: 'Accounts_OAuth_Google_id',\n\t\t\tAccounts_Google_secret: 'Accounts_OAuth_Google_secret',\n\t\t\tAccounts_Github: 'Accounts_OAuth_Github',\n\t\t\tAccounts_Github_id: 'Accounts_OAuth_Github_id',\n\t\t\tAccounts_Github_secret: 'Accounts_OAuth_Github_secret',\n\t\t\tAccounts_Gitlab: 'Accounts_OAuth_Gitlab',\n\t\t\tAccounts_Gitlab_id: 'Accounts_OAuth_Gitlab_id',\n\t\t\tAccounts_Gitlab_secret: 'Accounts_OAuth_Gitlab_secret',\n\t\t\tAccounts_Linkedin: 'Accounts_OAuth_Linkedin',\n\t\t\tAccounts_Linkedin_id: 'Accounts_OAuth_Linkedin_id',\n\t\t\tAccounts_Linkedin_secret: 'Accounts_OAuth_Linkedin_secret',\n\t\t\tAccounts_Meteor: 'Accounts_OAuth_Meteor',\n\t\t\tAccounts_Meteor_id: 'Accounts_OAuth_Meteor_id',\n\t\t\tAccounts_Meteor_secret: 'Accounts_OAuth_Meteor_secret',\n\t\t\tAccounts_Twitter: 'Accounts_OAuth_Twitter',\n\t\t\tAccounts_Twitter_id: 'Accounts_OAuth_Twitter_id',\n\t\t\tAccounts_Twitter_secret: 'Accounts_OAuth_Twitter_secret',\n\t\t};\n\n\t\tfor (const from of Object.keys(changes)) {\n\t\t\tconst to = changes[from];\n\t\t\tconst record = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: from,\n\t\t\t});\n\n\t\t\tif (record) {\n\t\t\t\tdelete record._id;\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: to,\n\t\t\t\t}, record);\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: from,\n\t\t\t});\n\t\t}\n\n\t\treturn ServiceConfiguration.configurations.remove({});\n\t},\n});\n","import _ from 'underscore';\n\nRocketChat.Migrations.add({\n\tversion: 19,\n\tup() {\n\t\t/*\n\t\t * Migrate existing admin users to Role based admin functionality\n\t\t * 'admin' role applies to global scope\n\t\t */\n\n\t\tconst admins = Meteor.users.find({\n\t\t\tadmin: true,\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\tusername: 1,\n\t\t\t},\n\t\t}).fetch();\n\n\t\tadmins.forEach((admin) => {\n\t\t\tRocketChat.authz.addUserRoles(admin._id, ['admin']);\n\t\t});\n\n\t\tMeteor.users.update({}, {\n\t\t\t$unset: {\n\t\t\t\tadmin: '',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\n\t\tlet usernames = _.pluck(admins, 'username').join(', ');\n\n\t\tconsole.log((`Migrate ${ usernames } from admin field to 'admin' role`).green);\n\n\t\t// Add 'user' role to all users\n\t\tconst users = Meteor.users.find().fetch();\n\t\tusers.forEach((user) => {\n\t\t\tRocketChat.authz.addUserRoles(user._id, ['user']);\n\t\t});\n\n\t\tusernames = _.pluck(users, 'username').join(', ');\n\t\tconsole.log((`Add ${ usernames } to 'user' role`).green);\n\n\t\t// Add 'moderator' role to channel/group creators\n\t\tconst rooms = RocketChat.models.Rooms.findByTypes(['c', 'p']).fetch();\n\t\treturn rooms.forEach((room) => {\n\t\t\tconst creator = room && room.u && room.u._id;\n\n\t\t\tif (creator) {\n\t\t\t\tif (Meteor.users.findOne({\n\t\t\t\t\t_id: creator,\n\t\t\t\t})) {\n\t\t\t\t\treturn RocketChat.authz.addUserRoles(creator, ['moderator'], room._id);\n\t\t\t\t} else {\n\t\t\t\t\tRocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\t\t\treturn RocketChat.models.Rooms.removeById(room._id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 20,\n\tup() {\n\t\t/*\n\t\t * Migrate existing `rocketchat_uploads` documents to include the room Id\n\t\t * where the file was uploaded to. The room Id is retrieved from the message\n\t\t * document created after the file upload.\n\t\t */\n\n\t\t// list of channel messages which were created after uploading a file\n\t\tconst msgQuery = {\n\t\t\trid: {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t\t'file._id': {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t};\n\n\t\tconst msgOptions = {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\trid: 1,\n\t\t\t\t'file._id': 1,\n\t\t\t},\n\t\t};\n\n\t\tconst cursorFileMessages = RocketChat.models.Messages.find(msgQuery, msgOptions);\n\t\tif (!cursorFileMessages.count()) {\n\t\t\treturn;\n\t\t}\n\n\t\tcursorFileMessages.fetch().forEach((msg) => RocketChat.models.Uploads.update({\n\t\t\t_id: msg.file && msg.file._id,\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\trid: msg.rid,\n\t\t\t},\n\t\t}, {\n\t\t\t$multi: true,\n\t\t}));\n\n\t\treturn console.log('Updated rocketchat_uploads documents to include the room Id in which they were sent.');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 21,\n\tup() {\n\t\t/*\n\t\t * Remove any i18nLabel from rocketchat_settings\n\t\t * They will be added again where necessary on next restart\n\t\t */\n\t\tRocketChat.models.Settings.update({\n\t\t\ti18nLabel: {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\ti18nLabel: 1,\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\n\t\treturn console.log('Removed i18nLabel from Settings. New labels will be added on next restart! Please restart your server.');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 22,\n\tup() {\n\t\t/*\n\t\t * Update message edit field\n\t\t */\n\t\tRocketChat.models.Messages.upgradeEtsToEditAt();\n\n\t\treturn console.log('Updated old messages\\' ets edited timestamp to new editedAt timestamp.');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 23,\n\tup() {\n\t\tRocketChat.models.Settings.remove({\n\t\t\t_id: 'Accounts_denyUnverifiedEmails',\n\t\t});\n\n\t\treturn console.log('Deleting not used setting Accounts_denyUnverifiedEmails');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 24,\n\tup() {\n\t\treturn RocketChat.models.Permissions.remove({\n\t\t\t_id: 'access-rocket-permissions',\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 25,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: /Accounts_OAuth_Custom/,\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tpersistent: true,\n\t\t\t},\n\t\t\t$unset: {\n\t\t\t\thidden: true,\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 26,\n\tup() {\n\t\treturn RocketChat.models.Messages.update({\n\t\t\tt: 'rm',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tmentions: [],\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 27,\n\tup() {\n\n\t\tRocketChat.models.Users.update({}, {\n\t\t\t$rename: {\n\t\t\t\troles: '_roles',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\n\t\tRocketChat.models.Users.find({\n\t\t\t_roles: {\n\t\t\t\t$exists: 1,\n\t\t\t},\n\t\t}).forEach((user) => {\n\t\t\tfor (const scope of Object.keys(user._roles)) {\n\t\t\t\tconst roles = user._roles[scope];\n\t\t\t\tRocketChat.models.Roles.addUserRoles(user._id, roles, scope);\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.models.Users.update({}, {\n\t\t\t$unset: {\n\t\t\t\t_roles: 1,\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 28,\n\tup() {\n\t\treturn RocketChat.models.Permissions.addRole('view-c-room', 'bot');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 29,\n\tup() {\n\t\tlet LDAP_Url = (RocketChat.models.Settings.findOne('LDAP_Url') || {}).value;\n\t\tconst LDAP_TLS = (RocketChat.models.Settings.findOne('LDAP_TLS') || {}).value;\n\t\tconst LDAP_DN = (RocketChat.models.Settings.findOne('LDAP_DN') || {}).value;\n\t\tconst LDAP_Bind_Search = (RocketChat.models.Settings.findOne('LDAP_Bind_Search') || {}).value;\n\n\t\tif (LDAP_Url && LDAP_Url.trim() !== '') {\n\t\t\tLDAP_Url = LDAP_Url.replace(/ldaps?:\\/\\//i, '');\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'LDAP_Host' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_Url,\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_TLS === true) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'LDAP_Encryption' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: 'tls',\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_DN && LDAP_DN.trim() !== '') {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'LDAP_Domain_Base' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_DN,\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'LDAP_Username_Field' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: '',\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'LDAP_Unique_Identifier_Field' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: '',\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_Bind_Search && LDAP_Bind_Search.trim() !== '') {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'LDAP_Custom_Domain_Search' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_Bind_Search,\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'LDAP_Use_Custom_Domain_Search' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: true,\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Url' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_TLS' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_DN' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Bind_Search' });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 30,\n\tup() {\n\t\tconst WebRTC_STUN_Server = (RocketChat.models.Settings.findOne('WebRTC_STUN_Server') || {}).value;\n\t\tconst WebRTC_TURN_Server = (RocketChat.models.Settings.findOne('WebRTC_TURN_Server') || {}).value;\n\t\tconst WebRTC_TURN_Username = (RocketChat.models.Settings.findOne('WebRTC_TURN_Username') || {}).value;\n\t\tconst WebRTC_TURN_Password = (RocketChat.models.Settings.findOne('WebRTC_TURN_Password') || {}).value;\n\n\t\tRocketChat.models.Settings.remove({ _id: 'WebRTC_STUN_Server' });\n\t\tRocketChat.models.Settings.remove({ _id: 'WebRTC_TURN_Server' });\n\t\tRocketChat.models.Settings.remove({ _id: 'WebRTC_TURN_Username' });\n\t\tRocketChat.models.Settings.remove({ _id: 'WebRTC_TURN_Password' });\n\n\t\tif (WebRTC_STUN_Server === 'stun:stun.l.google.com:19302' && WebRTC_TURN_Server === 'turn:numb.viagenie.ca:3478' && WebRTC_TURN_Username === 'team@rocket.chat' && WebRTC_TURN_Password === 'demo') {\n\t\t\treturn;\n\t\t}\n\n\t\tlet servers = '';\n\t\tif (WebRTC_STUN_Server) {\n\t\t\tservers += WebRTC_STUN_Server;\n\t\t}\n\n\t\tif (WebRTC_TURN_Server) {\n\t\t\tservers += ', ';\n\t\t\tif (WebRTC_TURN_Username != null) {\n\t\t\t\tservers += `${ encodeURIComponent(WebRTC_TURN_Username) }:${ encodeURIComponent(WebRTC_TURN_Password) }@`;\n\t\t\t}\n\t\t\tservers += WebRTC_TURN_Server;\n\t\t}\n\n\t\tif (servers !== '') {\n\t\t\treturn RocketChat.models.Settings.upsert({ _id: 'WebRTC_Servers' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: servers,\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 31,\n\tup() {\n\t\tconst changes = {\n\t\t\tAPI_Analytics: 'GoogleTagManager_id',\n\t\t};\n\n\t\tfor (const from of Object.keys(changes)) {\n\t\t\tconst to = changes[from];\n\t\t\tconst record = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: from,\n\t\t\t});\n\n\t\t\tif (record) {\n\t\t\t\tdelete record._id;\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: to,\n\t\t\t\t}, record);\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: from,\n\t\t\t});\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 32,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: /Accounts_OAuth_Custom_/,\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tgroup: 'OAuth',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 33,\n\tup() {\n\t\tconst scriptAlert = '/**\\n * This script is out-of-date, convert to the new format\\n * (https://rocket.chat/docs/administrator-guides/integrations)\\n**/\\n\\n';\n\n\t\tconst integrations = RocketChat.models.Integrations.find({\n\t\t\t$or: [\n\t\t\t\t{\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false,\n\t\t\t\t\t},\n\t\t\t\t\tprocessIncomingRequestScript: {\n\t\t\t\t\t\t$exists: true,\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false,\n\t\t\t\t\t},\n\t\t\t\t\tprepareOutgoingRequestScript: {\n\t\t\t\t\t\t$exists: true,\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false,\n\t\t\t\t\t},\n\t\t\t\t\tprocessOutgoingResponseScript: {\n\t\t\t\t\t\t$exists: true,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t}).fetch();\n\n\t\tintegrations.forEach(function(integration) {\n\t\t\tlet script = '';\n\t\t\tif (integration.processIncomingRequestScript) {\n\t\t\t\tscript += `${ integration.processIncomingRequestScript }\\n\\n`;\n\t\t\t}\n\t\t\tif (integration.prepareOutgoingRequestScript) {\n\t\t\t\tscript += `${ integration.prepareOutgoingRequestScript }\\n\\n`;\n\t\t\t}\n\t\t\tif (integration.processOutgoingResponseScript) {\n\t\t\t\tscript += `${ integration.processOutgoingResponseScript }\\n\\n`;\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Integrations.update(integration._id, {\n\t\t\t\t$set: {\n\t\t\t\t\tscript: scriptAlert + script.replace(/^/gm, '// '),\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\tlet update = {\n\t\t\t$unset: {\n\t\t\t\tprocessIncomingRequestScript: 1,\n\t\t\t\tprepareOutgoingRequestScript: 1,\n\t\t\t\tprocessOutgoingResponseScript: 1,\n\t\t\t},\n\t\t};\n\n\t\tRocketChat.models.Integrations.update({}, update, {\n\t\t\tmulti: true,\n\t\t});\n\n\t\tupdate = {\n\t\t\t$set: {\n\t\t\t\tenabled: true,\n\t\t\t},\n\t\t};\n\n\t\tRocketChat.models.Integrations.update({\n\t\t\tenabled: {\n\t\t\t\t$exists: false,\n\t\t\t},\n\t\t}, update, {\n\t\t\tmulti: true,\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 34,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: 'Layout_Login_Header',\n\t\t\tvalue: '<a class=\"logo\" href=\"/\"><img src=\"/assets/logo/logo.svg?v=3\" /></a>',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tvalue: '<a class=\"logo\" href=\"/\"><img src=\"/assets/logo?v=3\" /></a>',\n\t\t\t},\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 35,\n\tup() {\n\t\treturn RocketChat.models.Messages.update({\n\t\t\t'file._id': {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t\t'attachments.title_link': {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t\t'attachments.title_link_download': {\n\t\t\t\t$exists: false,\n\t\t\t},\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'attachments.$.title_link_download': true,\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t},\n});\n","import url from 'url';\n\nRocketChat.Migrations.add({\n\tversion: 36,\n\tup() {\n\t\tconst loginHeader = RocketChat.models.Settings.findOne({\n\t\t\t_id: 'Layout_Login_Header',\n\t\t});\n\n\t\tif (!loginHeader || !loginHeader.value) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst match = loginHeader.value.match(/<img\\ssrc=['\"]([^'\"]+)/);\n\n\t\tif (match && match.length === 2) {\n\t\t\tlet requestUrl = match[1];\n\t\t\tif (requestUrl[0] === '/') {\n\t\t\t\trequestUrl = url.resolve(Meteor.absoluteUrl(), requestUrl);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tMeteor.startup(function() {\n\t\t\t\t\treturn Meteor.setTimeout(function() {\n\t\t\t\t\t\tconst result = HTTP.get(requestUrl, {\n\t\t\t\t\t\t\tnpmRequestOptions: {\n\t\t\t\t\t\t\t\tencoding: 'binary',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (result.statusCode === 200) {\n\t\t\t\t\t\t\treturn RocketChat.Assets.setAsset(result.content, result.headers['content-type'], 'logo');\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 30000);\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t}\n\n\t\treturn RocketChat.models.Settings.remove({\n\t\t\t_id: 'Layout_Login_Header',\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 37,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Find permission add-user (changed it to create-user)\n\t\t\tconst addUserPermission = RocketChat.models.Permissions.findOne('add-user');\n\n\t\t\tif (addUserPermission) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'create-user' }, { $set: { roles: addUserPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user' });\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 38,\n\tup() {\n\t\tif (RocketChat && RocketChat.settings && RocketChat.settings.get) {\n\t\t\tconst allowPinning = RocketChat.settings.get('Message_AllowPinningByAnyone');\n\n\t\t\t// If public pinning was allowed, add pinning permissions to 'users', else leave it to 'owners' and 'moderators'\n\t\t\tif (allowPinning) {\n\t\t\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\t\t\t\t\tRocketChat.models.Permissions.update({ _id: 'pin-message' }, { $addToSet: { roles: 'user' } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 39,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst footer = RocketChat.models.Settings.findOne({ _id: 'Layout_Sidenav_Footer' });\n\n\t\t\t// Replace footer octicons with icons\n\t\t\tif (footer && footer.value !== '') {\n\t\t\t\tlet footerValue = footer.value.replace('octicon octicon-pencil', 'icon-pencil');\n\t\t\t\tfooterValue = footerValue.replace('octicon octicon-heart', 'icon-heart');\n\t\t\t\tfooterValue = footerValue.replace('octicon octicon-mark-github', 'icon-github-circled');\n\t\t\t\tRocketChat.models.Settings.update({ _id: 'Layout_Sidenav_Footer' }, { $set: { value: footerValue, packageValue: footerValue } });\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 40,\n\tup() {\n\t\tRocketChat.models.Settings.find({ _id: /Accounts_OAuth_Custom_/, i18nLabel: 'Accounts_OAuth_Custom_Enable' }).forEach(function(customOauth) {\n\t\t\tconst parts = customOauth._id.split('_');\n\t\t\tconst name = parts[3];\n\t\t\tconst id = `Accounts_OAuth_Custom_${ name }_token_sent_via`;\n\t\t\tif (!RocketChat.models.Settings.findOne({ _id: id })) {\n\t\t\t\tRocketChat.models.Settings.insert({\n\t\t\t\t\t_id: id,\n\t\t\t\t\ttype: 'select',\n\t\t\t\t\tgroup: 'OAuth',\n\t\t\t\t\tsection: `Custom OAuth: ${ name }`,\n\t\t\t\t\ti18nLabel: 'Accounts_OAuth_Custom_Token_Sent_Via',\n\t\t\t\t\tpersistent: true,\n\t\t\t\t\tvalues: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: 'header',\n\t\t\t\t\t\t\ti18nLabel: 'Header',\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: 'payload',\n\t\t\t\t\t\t\ti18nLabel: 'Payload',\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tpackageValue: 'payload',\n\t\t\t\t\tvalueSource: 'packageValue',\n\t\t\t\t\tts: new Date(),\n\t\t\t\t\thidden: false,\n\t\t\t\t\tblocked: false,\n\t\t\t\t\tsorter: 255,\n\t\t\t\t\ti18nDescription: `Accounts_OAuth_Custom_${ name }_token_sent_via_Description`,\n\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\tvalue: 'payload',\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 41,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ bot: true }, { $set: { type: 'bot' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'profile.guest': true }, { $set: { type: 'visitor' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ type: { $exists: false } }, { $set: { type: 'user' } }, { multi: true });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 42,\n\tup() {\n\t\tconst files = RocketChat.__migration_assets_files = new Mongo.Collection('assets.files');\n\t\tconst chunks = RocketChat.__migration_assets_chunks = new Mongo.Collection('assets.chunks');\n\t\tconst list = {\n\t\t\t'favicon.ico': 'favicon_ico',\n\t\t\t'favicon.svg': 'favicon',\n\t\t\t'favicon_64.png': 'favicon_64',\n\t\t\t'favicon_96.png': 'favicon_96',\n\t\t\t'favicon_128.png': 'favicon_128',\n\t\t\t'favicon_192.png': 'favicon_192',\n\t\t\t'favicon_256.png': 'favicon_256',\n\t\t};\n\n\t\tfor (const from of Object.keys(list)) {\n\t\t\tconst to = list[from];\n\n\t\t\tconst query = {\n\t\t\t\t_id: to,\n\t\t\t};\n\n\t\t\tif (!files.findOne(query)) {\n\t\t\t\tconst oldFile = files.findOne({\n\t\t\t\t\t_id: from,\n\t\t\t\t});\n\n\t\t\t\tif (oldFile) {\n\t\t\t\t\tconst extension = RocketChat.Assets.mime.extension(oldFile.contentType);\n\t\t\t\t\tRocketChat.settings.removeById(`Assets_${ from }`);\n\t\t\t\t\tRocketChat.settings.updateById(`Assets_${ to }`, {\n\t\t\t\t\t\turl: `/assets/${ to }.${ extension }`,\n\t\t\t\t\t\tdefaultUrl: RocketChat.Assets.assets[to].defaultUrl,\n\t\t\t\t\t});\n\n\t\t\t\t\toldFile._id = to;\n\t\t\t\t\toldFile.filename = to;\n\t\t\t\t\tfiles.insert(oldFile);\n\t\t\t\t\tfiles.remove({\n\t\t\t\t\t\t_id: from,\n\t\t\t\t\t});\n\n\t\t\t\t\tchunks.update({\n\t\t\t\t\t\tfiles_id: from,\n\t\t\t\t\t}, {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\tfiles_id: to,\n\t\t\t\t\t\t},\n\t\t\t\t\t}, {\n\t\t\t\t\t\tmulti: true,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 43,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Permissions) {\n\t\t\tRocketChat.models.Permissions.update({ _id: 'pin-message' }, { $addToSet: { roles: 'admin' } });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 44,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.find({ $or: [{ 'settings.preferences.disableNewRoomNotification': { $exists: 1 } }, { 'settings.preferences.disableNewMessageNotification': { $exists: 1 } }] }).forEach(function(user) {\n\t\t\t\tconst newRoomNotification = !(user && user.settings && user.settings.preferences && user.settings.preferences.disableNewRoomNotification);\n\t\t\t\tconst newMessageNotification = !(user && user.settings && user.settings.preferences && user.settings.preferences.disableNewMessageNotification);\n\t\t\t\tRocketChat.models.Users.update({ _id: user._id }, { $unset: { 'settings.preferences.disableNewRoomNotification': 1, 'settings.preferences.disableNewMessageNotification': 1 }, $set: { 'settings.preferences.newRoomNotification': newRoomNotification, 'settings.preferences.newMessageNotification': newMessageNotification } });\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst optOut = RocketChat.models.Settings.findOne({ _id: 'Statistics_opt_out' });\n\t\t\tif (optOut) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Statistics_opt_out' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'Statistics_reporting' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !optOut.value,\n\t\t\t\t\t\ti18nDescription: 'Statistics_reporting_Description',\n\t\t\t\t\t\tpackageValue: true,\n\t\t\t\t\t\ti18nLabel: 'Statistics_reporting',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst favoriteRooms = RocketChat.models.Settings.findOne({ _id: 'Disable_Favorite_Rooms' });\n\t\t\tif (favoriteRooms) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Disable_Favorite_Rooms' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'Favorite_Rooms' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !favoriteRooms.value,\n\t\t\t\t\t\ti18nDescription: 'Favorite_Rooms_Description',\n\t\t\t\t\t\tpackageValue: true,\n\t\t\t\t\t\ti18nLabel: 'Favorite_Rooms',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 45,\n\tup() {\n\n\t\t// finds the latest created visitor\n\t\tconst lastVisitor = RocketChat.models.Users.find({ type: 'visitor' }, { fields: { username: 1 }, sort: { createdAt: -1 }, limit: 1 }).fetch();\n\n\t\tif (lastVisitor && lastVisitor.length > 0) {\n\t\t\tconst lastNumber = lastVisitor[0].username.replace(/^guest\\-/, '');\n\n\t\t\tRocketChat.settings.add('Livechat_guest_count', (parseInt(lastNumber) + 1), { type: 'int', group: 'Livechat' });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 46,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ type: { $exists: false } }, { $set: { type: 'user' } }, { multi: true });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 47,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst autolinkerUrls = RocketChat.models.Settings.findOne({ _id: 'AutoLinker_Urls' });\n\t\t\tif (autolinkerUrls) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'AutoLinker_Urls' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_Scheme' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !!autolinkerUrls.value,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_Scheme',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_www' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !!autolinkerUrls.value,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_www',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_TLD' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !!autolinkerUrls.value,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_TLD',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 48,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\tconst RocketBot_Enabled = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: 'RocketBot_Enabled',\n\t\t\t});\n\t\t\tif (RocketBot_Enabled) {\n\t\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t\t_id: 'RocketBot_Enabled',\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: 'InternalHubot_Enabled',\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: RocketBot_Enabled.value,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst RocketBot_Name = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: 'RocketBot_Name',\n\t\t\t});\n\t\t\tif (RocketBot_Name) {\n\t\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t\t_id: 'RocketBot_Name',\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: 'InternalHubot_Username',\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: RocketBot_Name.value,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 49,\n\tup() {\n\n\t\tlet count = 1;\n\n\t\tRocketChat.models.Rooms.find({ t: 'l' }, { sort: { ts: 1 }, fields: { _id: 1 } }).forEach(function(room) {\n\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, { $set: { code: count } });\n\t\t\tRocketChat.models.Subscriptions.update({ rid: room._id }, { $set: { code: count } }, { multi: true });\n\t\t\tcount++;\n\t\t});\n\n\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_Room_Count' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: count,\n\t\t\t\ttype: 'int',\n\t\t\t\tgroup: 'Livechat',\n\t\t\t},\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 50,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex('u._id_1_name_1_t_1');\n\t\tRocketChat.models.Subscriptions.tryEnsureIndex({ 'u._id': 1, name: 1, t: 1 });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 51,\n\tup() {\n\t\tRocketChat.models.Rooms.find({ t: 'l', 'v.token': { $exists: true }, label: { $exists: false } }).forEach(function(room) {\n\t\t\tconst user = RocketChat.models.Users.findOne({ 'profile.token': room.v.token });\n\t\t\tif (user) {\n\t\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tlabel: user.name || user.username,\n\t\t\t\t\t\t'v._id': user._id,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Subscriptions.update({ rid: room._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tname: user.name || user.username,\n\t\t\t\t\t},\n\t\t\t\t}, { multi: true });\n\t\t\t}\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 52,\n\tup() {\n\t\tRocketChat.models.Users.update({ _id: 'rocket.cat' }, { $addToSet: { roles: 'bot' } });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 53,\n\tup() {\n\t\tRocketChat.models.Settings.update({ _id: 'Email_Header', value: '' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: '<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" bgcolor=\"#f3f3f3\" style=\"color:#4a4a4a;font-family: Helvetica,Arial,sans-serif;font-size:14px;line-height:20px;border-collapse:callapse;border-spacing:0;margin:0 auto\"><tr><td style=\"padding:1em\"><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" width=\"100%\" style=\"width:100%;margin:0 auto;max-width:800px\"><tr><td bgcolor=\"#ffffff\" style=\"background-color:#ffffff; border: 1px solid #DDD; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\"><table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"background-color: #04436a;\"><h1 style=\"font-family: Helvetica,Arial,sans-serif; padding: 0 1em; margin: 0; line-height: 70px; color: #FFF;\">[Site_Name]</h1></td></tr><tr><td style=\"padding: 1em; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\">',\n\t\t\t},\n\t\t});\n\n\t\tRocketChat.models.Settings.update({ _id: 'Email_Footer', value: '' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: '</td></tr></table></td></tr><tr><td border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"font-family: Helvetica,Arial,sans-serif; max-width: 800px; margin: 0 auto; padding: 1.5em; text-align: center; font-size: 8pt; color: #999;\">Powered by <a href=\"https://rocket.chat\" target=\"_blank\">Rocket.Chat</a></td></tr></table></td></tr></table>',\n\t\t\t},\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 54,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\t// Set default message viewMode to 'normal' or 'cozy' depending on the users' current settings and remove the field 'compactView'\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.compactView': true }, { $set: { 'settings.preferences.viewMode': 1 }, $unset: { 'settings.preferences.compactView': 1 } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.viewMode': { $ne: 1 } }, { $set: { 'settings.preferences.viewMode': 0 } }, { multi: true });\n\t\t}\n\t},\n});\n","import s from 'underscore.string';\n\nRocketChat.Migrations.add({\n\tversion: 55,\n\tup() {\n\t\tRocketChat.models.Rooms.find({ topic: { $exists: 1, $ne: '' } }, { topic: 1 }).forEach(function(room) {\n\t\t\tconst topic = s.escapeHTML(room.topic);\n\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, { $set: { topic } });\n\t\t\tRocketChat.models.Messages.update({ t: 'room_changed_topic', rid: room._id }, { $set: { msg: topic } });\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 56,\n\tup() {\n\t\tRocketChat.models.Messages.find({ _id: /\\./ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/(.*)\\.S?(.*)/, 'slack-$1-$2');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 57,\n\tup() {\n\t\tRocketChat.models.Messages.find({ _id: /slack-([a-zA-Z0-9]+)S([0-9]+-[0-9]+)/ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/slack-([a-zA-Z0-9]+)S([0-9]+-[0-9]+)/, 'slack-$1-$2');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\n\t\tRocketChat.models.Messages.find({ _id: /slack-slack/ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace('slack-slack', 'slack');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\n\t\tRocketChat.models.Messages.find({ _id: /\\./ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/(.*)\\.?S(.*)/, 'slack-$1-$2');\n\t\t\tmessage._id = message._id.replace(/\\./g, '-');\n\t\t\tRocketChat.models.Messages.remove({ _id: message._id });\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 58,\n\tup() {\n\t\tRocketChat.models.Settings.update({ _id: 'Push_gateway', value: 'https://rocket.chat' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: 'https://gateway.rocket.chat',\n\t\t\t\tpackageValue: 'https://gateway.rocket.chat',\n\t\t\t},\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 59,\n\tup() {\n\t\tconst users = RocketChat.models.Users.find({}, { sort: { createdAt: 1 }, limit: 1 }).fetch();\n\t\tif (users && users.length > 0) {\n\t\t\tconst { createdAt } = users[0];\n\t\t\tRocketChat.models.Settings.update({ createdAt: { $exists: 0 } }, { $set: { createdAt } }, { multi: true });\n\t\t\tRocketChat.models.Statistics.update({ installedAt: { $exists: 0 } }, { $set: { installedAt: createdAt } }, { multi: true });\n\t\t}\n\t},\n});\n","import _ from 'underscore';\n\nRocketChat.Migrations.add({\n\tversion: 60,\n\tup() {\n\t\tlet subscriptions = RocketChat.models.Subscriptions.find({ $or: [{ name: { $exists: 0 } }, { name: { $not: { $type: 2 } } }] }).fetch();\n\t\tif (subscriptions && subscriptions.length > 0) {\n\t\t\tRocketChat.models.Subscriptions.remove({ _id: { $in: _.pluck(subscriptions, '_id') } });\n\t\t}\n\n\t\tsubscriptions = RocketChat.models.Subscriptions.find().forEach(function(subscription) {\n\t\t\tconst user = RocketChat.models.Users.findOne({ _id: subscription && subscription.u && subscription.u._id });\n\t\t\tif (!user) {\n\t\t\t\tRocketChat.models.Subscriptions.remove({ _id: subscription._id });\n\t\t\t}\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 61,\n\tup() {\n\t\tRocketChat.models.Users.find({ active: false }).forEach(function(user) {\n\t\t\tRocketChat.models.Subscriptions.setArchivedByUsername(user.username, true);\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 62,\n\tup() {\n\t\tRocketChat.models.Settings.remove({ _id: 'Atlassian Crowd', type: 'group' });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 63,\n\tup() {\n\t\tconst forward = RocketChat.models.Settings.findOne({ _id:'Livechat_forward_open_chats' });\n\t\tconst timeout = RocketChat.models.Settings.findOne({ _id:'Livechat_forward_open_chats_timeout' });\n\n\t\tif (forward && forward.value) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_agent_leave_action' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: 'forward',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tgroup: 'Livechat',\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tif (timeout && timeout.value !== 60) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_agent_leave_action_timeout' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: timeout.value,\n\t\t\t\t\ttype: 'int',\n\t\t\t\t\tgroup: 'Livechat',\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'Livechat_forward_open_chats' });\n\t\tRocketChat.models.Settings.remove({ _id: 'Livechat_forward_open_chats_timeout' });\n\t},\n});\n","import s from 'underscore.string';\n\nRocketChat.Migrations.add({\n\tversion: 64,\n\tup() {\n\t\tRocketChat.models.Messages.find({ t: 'room_changed_topic', msg: /</ }, { msg: 1 }).forEach(function(message) {\n\t\t\tconst msg = s.escapeHTML(message.msg);\n\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { msg } });\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 65,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\t// New color settings - start with old settings as defaults\n\t\t\tconst replace1 = RocketChat.models.Settings.findOne({ _id: 'theme-color-quaternary-font-color' });\n\t\t\tconst replace2 = RocketChat.models.Settings.findOne({ _id: 'theme-color-input-font-color' });\n\t\t\tconst replace3 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-online' });\n\t\t\tconst replace4 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-away' });\n\t\t\tconst replace5 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-busy' });\n\t\t\tconst replace6 = RocketChat.models.Settings.findOne({ _id: 'theme-color-info-active-font-color' });\n\t\t\tif (replace1) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-secondary-action-color' }, { $set: { value: replace1.value } });\n\t\t\t}\n\t\t\tif (replace2) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-component-color' }, { $set: { value: replace2.value } });\n\t\t\t}\n\t\t\tif (replace3) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-success-color' }, { $set: { value: replace3.value } });\n\t\t\t}\n\t\t\tif (replace4) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-pending-color' }, { $set: { value: replace4.value } });\n\t\t\t}\n\t\t\tif (replace5) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-error-color' }, { $set: { value: replace5.value } });\n\t\t\t}\n\t\t\tif (replace6) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-selection-color' }, { $set: { value: replace6.value } });\n\t\t\t}\n\n\t\t\t// Renamed color settings\n\t\t\tconst oldColor = RocketChat.models.Settings.findOne({ _id: 'theme-color-action-buttons-color' });\n\t\t\tif (oldColor) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-action-buttons-color' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-primary-action-color' }, { $set: { value: oldColor.value } });\n\t\t\t}\n\n\t\t\t// Removed color settings\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-quaternary-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-active-channel-background-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-active-channel-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-blockquote-background' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-clean-buttons-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-background' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-border' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-info-active-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-input-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-message-hover-background-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-smallprint-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-smallprint-hover-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-unread-notification-color' });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 66,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\t// New color settings - start with old settings as defaults\n\t\t\tconst replace1 = RocketChat.models.Settings.findOne({ _id: 'theme-color-tertiary-background-color' });\n\t\t\tif (replace1) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-component-color' }, { $set: { value: replace1.value } });\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 67,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.LivechatDepartment) {\n\t\t\tRocketChat.models.LivechatDepartment.model.update({}, {\n\t\t\t\t$set: {\n\t\t\t\t\tshowOnRegistration: true,\n\t\t\t\t},\n\t\t\t}, { multi: true });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 68,\n\tup() {\n\t\tconst GoogleSiteVerification_id = RocketChat.models.Settings.findOne({ _id: 'GoogleSiteVerification_id' });\n\n\t\tif (GoogleSiteVerification_id && GoogleSiteVerification_id.value) {\n\t\t\tRocketChat.models.Settings.update({ _id: 'Meta_google-site-verification' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: GoogleSiteVerification_id.value,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'GoogleSiteVerification_id' });\n\t},\n});\n\n","RocketChat.Migrations.add({\n\tversion: 69,\n\tup() {\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'theme-color-custom-scrollbar-color',\n\t\t\tvalue: 'rgba(255, 255, 255, 0.05)',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\teditor: 'expression',\n\t\t\t\tvalue: '@transparent-darker',\n\t\t\t},\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'theme-color-info-font-color',\n\t\t\tvalue: '#aaaaaa',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\teditor: 'expression',\n\t\t\t\tvalue: '@secondary-font-color',\n\t\t\t},\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'theme-color-link-font-color',\n\t\t\tvalue: '#008ce3',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\teditor: 'expression',\n\t\t\t\tvalue: '@primary-action-color',\n\t\t\t},\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'theme-color-status-away',\n\t\t\tvalue: '#fcb316',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\teditor: 'expression',\n\t\t\t\tvalue: '@pending-color',\n\t\t\t},\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'theme-color-status-busy',\n\t\t\tvalue: '#d30230',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\teditor: 'expression',\n\t\t\t\tvalue: '@error-color',\n\t\t\t},\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'theme-color-status-offline',\n\t\t\tvalue: 'rgba(150, 150, 150, 0.50)',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\teditor: 'expression',\n\t\t\t\tvalue: '@transparent-darker',\n\t\t\t},\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'theme-color-status-online',\n\t\t\tvalue: '#35ac19',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\teditor: 'expression',\n\t\t\t\tvalue: '@success-color',\n\t\t\t},\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'theme-color-tertiary-background-color',\n\t\t\tvalue: '#eaeaea',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\teditor: 'expression',\n\t\t\t\tvalue: '@component-color',\n\t\t\t},\n\t\t});\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: 'theme-color-tertiary-font-color',\n\t\t\tvalue: 'rgba(255, 255, 255, 0.6)',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\teditor: 'expression',\n\t\t\t\tvalue: '@transparent-lightest',\n\t\t\t},\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 70,\n\tup() {\n\t\tconst settings = RocketChat.models.Settings.find({ _id: /^Accounts_OAuth_Custom_.+/ }).fetch();\n\t\tfor (const setting of settings) {\n\t\t\tconst { _id } = setting;\n\t\t\tsetting._id = setting._id.replace(/Accounts_OAuth_Custom_([A-Za-z0-9]+)_(.+)/, 'Accounts_OAuth_Custom-$1-$2');\n\t\t\tsetting._id = setting._id.replace(/Accounts_OAuth_Custom_([A-Za-z0-9]+)/, 'Accounts_OAuth_Custom-$1');\n\n\t\t\tRocketChat.models.Settings.remove({ _id });\n\t\t\tRocketChat.models.Settings.insert(setting);\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 71,\n\tup() {\n\t\t// Removes the reactions on messages which are the system type \"rm\" ;)\n\t\tRocketChat.models.Messages.find({ t: 'rm', reactions: { $exists: true, $not: { $size: 0 } } }, { t: 1 }).forEach(function(message) {\n\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { reactions: [] } });\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 72,\n\tup() {\n\t\tRocketChat.models.Users.find({ type: 'visitor', 'emails.address': { $exists: true } }, { emails: 1 }).forEach(function(visitor) {\n\t\t\tRocketChat.models.Users.update({ _id: visitor._id }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvisitorEmails: visitor.emails,\n\t\t\t\t},\n\t\t\t\t$unset: {\n\t\t\t\t\temails: 1,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 73,\n\tup() {\n\t\tRocketChat.models.Users.find({ 'oauth.athorizedClients': { $exists: true } }, { oauth: 1 }).forEach(function(user) {\n\t\t\tRocketChat.models.Users.update({ _id: user._id }, {\n\t\t\t\t$set: {\n\t\t\t\t\t'oauth.authorizedClients': user.oauth.athorizedClients,\n\t\t\t\t},\n\t\t\t\t$unset: {\n\t\t\t\t\t'oauth.athorizedClients': 1,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 74,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.remove({ _id: 'Assets_favicon_64' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'Assets_favicon_96' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'Assets_favicon_128' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'Assets_favicon_256' });\n\t\t\tRocketChat.models.Settings.update({ _id: 'Assets_favicon_192' }, {\n\t\t\t\t$set: {\n\t\t\t\t\ti18nLabel: 'android-chrome 192x192 (png)',\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 71.1,\n\tup() {\n\t\tServiceConfiguration.configurations.remove({});\n\t},\n});\n\nRocketChat.Migrations.add({\n\tversion: 75,\n\tup() {\n\t\tServiceConfiguration.configurations.remove({});\n\t},\n});\n\n","RocketChat.Migrations.add({\n\tversion: 76,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.find({ section: 'Colors (alphas)' }).forEach((setting) => {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: setting._id });\n\t\t\t});\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 77,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Rooms) {\n\t\t\tRocketChat.models.Rooms.find({\n\t\t\t\tt: 'l',\n\t\t\t\t'v._id': { $exists: true },\n\t\t\t\t'v.username': { $exists: false },\n\t\t\t}, { fields: { 'v._id': 1 } }).forEach(function(room) {\n\t\t\t\tconst user = RocketChat.models.Users.findOne({ _id: room.v._id }, { username: 1 });\n\n\t\t\t\tif (user && user.username) {\n\t\t\t\t\tRocketChat.models.Rooms.update({\n\t\t\t\t\t\t_id: room._id,\n\t\t\t\t\t}, {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\t'v.username': user.username,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n});\n\n","RocketChat.Migrations.add({\n\tversion: 78,\n\tup() {\n\t\tRocketChat.models.Permissions.update({ _id: { $in: ['create-c', 'create-d', 'create-p'] } }, { $addToSet: { roles: 'bot' } }, { multi: true });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 79,\n\tup() {\n\t\tconst integrations = RocketChat.models.Integrations.find({ type: 'webhook-incoming' }).fetch();\n\n\t\tfor (const integration of integrations) {\n\t\t\tif (typeof integration.channel === 'string') {\n\t\t\t\tRocketChat.models.Integrations.update({ _id: integration._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tchannel: integration.channel.split(',').map((channel) => channel.trim()),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 80,\n\tup() {\n\t\tconst query = {\n\t\t\ttype: 'webhook-outgoing',\n\t\t\t$or: [{\n\t\t\t\tchannel: [],\n\t\t\t}, {\n\t\t\t\tchannel: '',\n\t\t\t}, {\n\t\t\t\tchannel: {\n\t\t\t\t\t$exists: false,\n\t\t\t\t},\n\t\t\t}],\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tchannel: ['all_public_channels'],\n\t\t\t},\n\t\t};\n\n\t\tRocketChat.models.Integrations.update(query, update, { multi: true });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 81,\n\tup() {\n\t\tRocketChat.models.OAuthApps.update({ _id: 'zapier' }, {\n\t\t\t$set: {\n\t\t\t\tactive: true,\n\t\t\t\tredirectUri: 'https://zapier.com/dashboard/auth/oauth/return/App32270API/',\n\t\t\t},\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 82,\n\tup() {\n\t\tconst admins = RocketChat.authz.getUsersInRole('admin').fetch();\n\t\tif (admins.length === 1 && admins[0]._id === 'rocket.cat') {\n\t\t\tRocketChat.authz.removeUserFromRoles('rocket.cat', 'admin');\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 83,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings && RocketChat.models.Users) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'InternalHubot_Username' });\n\t\t\tif (setting && setting.value) {\n\t\t\t\tconst username = setting.value;\n\t\t\t\tconst user = RocketChat.models.Users.findOne({ username });\n\t\t\t\tif (!user && setting.value === 'Rocket.Cat') {\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'InternalHubot_Username' }, { $set: { value: 'rocket.cat', packageValue: 'rocket.cat' } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 84,\n\tup() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Update permission name, copy values from old name\n\t\t\tconst oldPermission = RocketChat.models.Permissions.findOne('add-user-to-room');\n\t\t\tif (oldPermission && oldPermission.roles.length) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'add-user-to-joined-room' }, { $set: { roles: oldPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user-to-room' });\n\t\t\t}\n\t\t}\n\t},\n\n\tdown() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Revert permission name, copy values from updated name\n\t\t\tconst newPermission = RocketChat.models.Permissions.findOne('add-user-to-joined-room');\n\t\t\tif (newPermission && newPermission.roles.length) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'add-user-to-room' }, { $set: { roles: newPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user-to-joined-room' });\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 85,\n\tup() {\n\t\tconst query = {\n\t\t\tt: 'p',\n\t\t\tusernames: { $size: 2 },\n\t\t\tu: { $exists: false },\n\t\t\tname: { $exists: false },\n\t\t};\n\n\t\tconst rooms = RocketChat.models.Rooms.find(query).fetch();\n\n\t\tif (rooms.length > 0) {\n\t\t\tconst rids = rooms.map((room) => room._id);\n\t\t\tRocketChat.models.Rooms.update({ _id: { $in: rids } }, { $set: { t: 'd' } }, { multi: true });\n\t\t\tRocketChat.models.Subscriptions.update({ rid: { $in: rids } }, { $set: { t: 'd' } }, { multi: true });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 86,\n\tup() {\n\t\t// Disabled this migration for it was not updating any user\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 87,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newMessageNotification': false }, { $set: { 'settings.preferences.newMessageNotification': 'none' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newMessageNotification': true }, { $unset: { 'settings.preferences.newMessageNotification': 1 } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newRoomNotification': false }, { $set: { 'settings.preferences.newRoomNotification': 'none' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newRoomNotification': true }, { $unset: { 'settings.preferences.newRoomNotification': 1 } }, { multi: true });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 88,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Layout_Sidenav_Footer' });\n\t\t\tif (setting && setting.value && setting.packageValue) {\n\t\t\t\tif (setting.value === '<img style=\"left: 10px; position: absolute;\" src=\"/assets/logo.png\" />') {\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'Layout_Sidenav_Footer' }, { $set: { value: setting.packageValue } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 89,\n\tup() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing' }, { fields: { name: 1 } }).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { event: 'sendMessage', retryFailedCalls: true, retryCount: 6, retryDelay: 'powers-of-ten' } });\n\t\t});\n\t},\n\tdown() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing', event: { $ne: 'sendMessage' } }, { fields: { name: 1 } }).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { enabled: false } });\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 90,\n\tup() {\n\t\tRocketChat.models.Settings.remove({ _id: 'Piwik', type: 'group' });\n\n\t\tconst settings = RocketChat.models.Settings.find({ $or: [{ _id: 'PiwikAnalytics_url', value: { $ne: null } }, { _id: 'PiwikAnalytics_siteId', value: { $ne: null } }] }).fetch();\n\n\t\tif (settings && settings.length === 2) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'PiwikAnalytics_enabled' }, { $set: { value: true } });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 91,\n\tup() {\n\t\tconst query = {\n\t\t\t'services.linkedin': {\n\t\t\t\t$exists: 1,\n\t\t\t},\n\t\t\t$or: [{\n\t\t\t\tname: {\n\t\t\t\t\t$exists: 0,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tname: null,\n\t\t\t}],\n\t\t};\n\n\t\tRocketChat.models.Users.find(query, { 'services.linkedin.firstName': 1, username: 1 }).forEach((user) => {\n\t\t\tconst name = `${ user.services.linkedin.firstName } ${ user.services.linkedin.lastName }`;\n\n\t\t\tRocketChat.models.Users.setName(user._id, name);\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 92,\n\tup() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing', event: 'sendMessage' }, { fields: { name: 1 } }).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { runOnEdits: true } });\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 93,\n\tup() {\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Accounts_AllowAnonymousAccess' });\n\t\t\tif (setting && setting.value === true) {\n\t\t\t\tRocketChat.models.Settings.update({ _id: 'Accounts_AllowAnonymousRead' }, { $set: { value: setting.value } });\n\t\t\t}\n\t\t}\n\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: [\n\t\t\t\t\t'view-c-room',\n\t\t\t\t\t'view-history',\n\t\t\t\t\t'view-joined-room',\n\t\t\t\t\t'view-p-room',\n\t\t\t\t\t'preview-c-room',\n\t\t\t\t],\n\t\t\t},\n\t\t};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\troles: 'anonymous',\n\t\t\t},\n\t\t};\n\n\t\tRocketChat.models.Permissions.update(query, update, { multi: true });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 94,\n\tup() {\n\t\tconst query = {\n\t\t\t'emails.address.address': { $exists: true },\n\t\t};\n\n\t\tRocketChat.models.Users.find(query, { 'emails.address.address': 1 }).forEach((user) => {\n\t\t\tlet emailAddress;\n\t\t\tuser.emails.some((email) => {\n\t\t\t\tif (email.address && email.address.address) {\n\t\t\t\t\temailAddress = email.address.address;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\tconst existingUser = RocketChat.models.Users.findOne({ 'emails.address': emailAddress }, { fields: { _id: 1 } });\n\t\t\tif (existingUser) {\n\t\t\t\tRocketChat.models.Users.update({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\t'emails.address.address': emailAddress,\n\t\t\t\t}, {\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\t'emails.$': 1,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tRocketChat.models.Users.update({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\t'emails.address.address': emailAddress,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\t'emails.$.address': emailAddress,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 95,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst emailHeader = RocketChat.models.Settings.findOne({ _id: 'Email_Header' });\n\t\t\tconst emailFooter = RocketChat.models.Settings.findOne({ _id: 'Email_Footer' });\n\t\t\tconst startWithHTML = emailHeader.value.match(/^<html>/);\n\t\t\tconst endsWithHTML = emailFooter.value.match(/<\\/html>$/);\n\n\t\t\tif (!startWithHTML) {\n\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t{ _id: 'Email_Header' },\n\t\t\t\t\t{ $set: { value: `<html>${ emailHeader.value }` } }\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (!endsWithHTML) {\n\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t{ _id: 'Email_Footer' },\n\t\t\t\t\t{ $set: { value: `${ emailFooter.value }</html>` } }\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 96,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.update({ _id: 'InternalHubot_ScriptsToLoad' }, { $set: { value: '' } });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 97,\n\tup() {\n\t\t// Migration moved to 099.js to fix a bug\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 98,\n\tup() {\n\t\tRocketChat.models.OAuthApps.update({ _id: 'zapier' }, {\n\t\t\t$set: {\n\t\t\t\tredirectUri: 'https://zapier.com/dashboard/auth/oauth/return/RocketChatDevAPI/',\n\t\t\t},\n\t\t});\n\t},\n});\n","/* globals SystemLogger */\n\nimport fs from 'fs';\nimport path from 'path';\n\nfunction log(...args) {\n\tconsole.log('[AVATAR]', ...args);\n}\n\nfunction logError(...args) {\n\tconsole.error('[AVATAR]', ...args);\n}\n\nfunction insertAvatar({ details, avatarsFileStore, stream, callback = () => {} }) {\n\treturn new Promise((resolve) => {\n\t\tMeteor.defer(() => {\n\t\t\tMeteor.runAsUser('rocket.cat', () => {\n\t\t\t\tavatarsFileStore.insert(details, stream, (err) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tlogError({ err });\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tMeteor.setTimeout(() => {\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t}, 200);\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n}\n\nfunction batch(arr, limit, fn) {\n\tif (!arr.length) {\n\t\treturn Promise.resolve();\n\t}\n\treturn Promise.all(arr.splice(0, limit).map((item) => fn(item))).then(() => batch(arr, limit, fn));\n}\n\nRocketChat.Migrations.add({\n\tversion: 99,\n\tup() {\n\t\tlog('Migrating avatars. This might take a while.');\n\n\t\tconst query = {\n\t\t\t$or: [{\n\t\t\t\t's3.path': {\n\t\t\t\t\t$exists: true,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\t'googleCloudStorage.path': {\n\t\t\t\t\t$exists: true,\n\t\t\t\t},\n\t\t\t}],\n\t\t};\n\n\t\tRocketChat.models.Uploads.find(query).forEach((record) => {\n\t\t\tif (record.s3) {\n\t\t\t\tRocketChat.models.Uploads.model.direct.update({ _id: record._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tstore: 'AmazonS3:Uploads',\n\t\t\t\t\t\tAmazonS3: {\n\t\t\t\t\t\t\tpath: record.s3.path + record._id,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\ts3: 1,\n\t\t\t\t\t},\n\t\t\t\t}, { multi: true });\n\t\t\t} else {\n\t\t\t\tRocketChat.models.Uploads.model.direct.update({ _id: record._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tstore: 'GoogleCloudStorage:Uploads',\n\t\t\t\t\t\tGoogleStorage: {\n\t\t\t\t\t\t\tpath: record.googleCloudStorage.path + record._id,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\tgoogleCloudStorage: 1,\n\t\t\t\t\t},\n\t\t\t\t}, { multi: true });\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Uploads.model.direct.update({\n\t\t\tstore: 'fileSystem',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tstore: 'FileSystem:Uploads',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t\tRocketChat.models.Uploads.model.direct.update({\n\t\t\tstore: 'rocketchat_uploads',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tstore: 'GridFS:Uploads',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\n\t\tconst avatarOrigins = [\n\t\t\t'upload',\n\t\t\t'gravatar',\n\t\t\t'facebook',\n\t\t\t'twitter',\n\t\t\t'github',\n\t\t\t'google',\n\t\t\t'url',\n\t\t\t'gitlab',\n\t\t\t'linkedin',\n\t\t];\n\n\t\tconst avatarsPathRecord = RocketChat.models.Settings.findOne({ _id: 'Accounts_AvatarStorePath' });\n\t\tconst avatarStoreTypeRecord = RocketChat.models.Settings.findOne({ _id: 'Accounts_AvatarStoreType' });\n\n\t\tconst avatarsPath = avatarsPathRecord ? avatarsPathRecord.value : process.env.AVATARS_PATH;\n\t\tlet avatarStoreType = avatarStoreTypeRecord && avatarStoreTypeRecord.value;\n\n\t\tconst oldAvatarGridFS = new RocketChatFile.GridFS({\n\t\t\tname: 'avatars',\n\t\t});\n\n\t\tif (avatarStoreType == null) {\n\t\t\tconst count = oldAvatarGridFS.countSync();\n\t\t\tif (Match.test(count, Number) && count > 0) {\n\t\t\t\tavatarStoreType = 'GridFS';\n\t\t\t} else if (Match.test(avatarsPath, String) && avatarsPath.length > 0) {\n\t\t\t\tavatarStoreType = 'FileSystem';\n\t\t\t} else {\n\t\t\t\tSystemLogger.error_box('Can\\'t define the avatar\\'s storage type.\\nIf you have avatars missing and they was stored in your file system\\nrun the process including the following environment variables: \\n  AVATARS_PATH=\\'YOUR AVATAR\\'S DIRECTORY\\'\\n  MIGRATION_VERSION=99,rerun', 'WARNING');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tMeteor.startup(function() {\n\t\t\tMeteor.setTimeout(function() {\n\t\t\t\tconst avatarsFileStore = FileUpload.getStore('Avatars');\n\n\t\t\t\tconst users = RocketChat.models.Users.find({ avatarOrigin: { $in: avatarOrigins } }, { avatarOrigin: 1, username: 1 }).fetch();\n\n\t\t\t\tconst usersTotal = users.length;\n\n\t\t\t\tlog('Total users to migrate avatars ->', usersTotal);\n\n\t\t\t\tlet current = 0;\n\n\t\t\t\tbatch(users, 300, (user) => {\n\t\t\t\t\tconst id = `${ user.username }.jpg`;\n\n\t\t\t\t\tconst gridFSAvatar = oldAvatarGridFS.getFileWithReadStream(id);\n\n\t\t\t\t\tlog('Migrating', ++current, 'of', usersTotal);\n\n\t\t\t\t\tif (gridFSAvatar) {\n\t\t\t\t\t\tconst details = {\n\t\t\t\t\t\t\tuserId: user._id,\n\t\t\t\t\t\t\ttype: gridFSAvatar.contentType,\n\t\t\t\t\t\t\tsize: gridFSAvatar.length,\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\treturn insertAvatar({\n\t\t\t\t\t\t\tdetails,\n\t\t\t\t\t\t\tavatarsFileStore,\n\t\t\t\t\t\t\tstream: gridFSAvatar.readStream,\n\t\t\t\t\t\t\tcallback() {\n\t\t\t\t\t\t\t\toldAvatarGridFS.deleteFile(id);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (avatarStoreType === 'FileSystem' && avatarsPath && avatarsPath.trim()) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst filePath = path.join(avatarsPath, id);\n\t\t\t\t\t\t\tconst stat = fs.statSync(filePath);\n\t\t\t\t\t\t\tif (stat && stat.isFile()) {\n\t\t\t\t\t\t\t\tconst details = {\n\t\t\t\t\t\t\t\t\tuserId: user._id,\n\t\t\t\t\t\t\t\t\ttype: 'image/jpeg',\n\t\t\t\t\t\t\t\t\tsize: stat.size,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\treturn insertAvatar({\n\t\t\t\t\t\t\t\t\tdetails,\n\t\t\t\t\t\t\t\t\tavatarsFileStore,\n\t\t\t\t\t\t\t\t\tstream: fs.createReadStream(filePath),\n\t\t\t\t\t\t\t\t\tcallback() {\n\t\t\t\t\t\t\t\t\t\tfs.unlinkSync(filePath);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tlogError('Error migrating old avatar', e);\n\t\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).then(() => {\n\t\t\t\t\tconst avatarsFiles = new Mongo.Collection('avatars.files');\n\t\t\t\t\tconst avatarsChunks = new Mongo.Collection('avatars.chunks');\n\t\t\t\t\tavatarsFiles.rawCollection().drop();\n\t\t\t\t\tavatarsChunks.rawCollection().drop();\n\t\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Accounts_AvatarStoreType' });\n\t\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Accounts_AvatarStorePath' });\n\t\t\t\t});\n\t\t\t}, 1000);\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 100,\n\tup() {\n\t\tRocketChat.models.Subscriptions.update({ audioNotification:{ $exists:1 } }, { $rename: { audioNotification: 'audioNotifications' } });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 101,\n\tup() {\n\t\tRocketChat.models.Subscriptions.update({ lastActivity:{ $exists:1 } }, { $unset: { lastActivity: '' } }, { multi: true });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 102,\n\tup() {\n\t\tif (!RocketChat || !RocketChat.models || !RocketChat.models.Settings) {\n\t\t\treturn;\n\t\t}\n\n\t\tRocketChat.models.Settings.update(\n\t\t\t{ _id: 'LDAP_Connect_Timeout', value: 600000 },\n\t\t\t{ $set: { value: 1000 } }\n\t\t);\n\n\t\tRocketChat.models.Settings.update(\n\t\t\t{ _id: 'LDAP_Idle_Timeout', value: 600000 },\n\t\t\t{ $set: { value: 1000 } }\n\t\t);\n\n\t\tconst LDAP_Domain_Base = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Base' });\n\t\tif (LDAP_Domain_Base) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_BaseDN' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Base.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Base' });\n\n\t\tconst LDAP_Domain_Search_User_ID = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_User_ID' });\n\t\tif (LDAP_Domain_Search_User_ID) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_User_Search_Field' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_User_ID.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_User_ID' });\n\n\t\tconst LDAP_Use_Custom_Domain_Search = RocketChat.models.Settings.findOne({ _id: 'LDAP_Use_Custom_Domain_Search' });\n\t\tconst LDAP_Custom_Domain_Search = RocketChat.models.Settings.findOne({ _id: 'LDAP_Custom_Domain_Search' });\n\n\t\tconst LDAP_Domain_Search_User = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_User' });\n\t\tconst LDAP_Domain_Search_Password = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Password' });\n\t\tconst LDAP_Domain_Search_Filter = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Filter' });\n\n\t\tconst LDAP_Domain_Search_Object_Class = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Object_Class' });\n\t\tconst LDAP_Domain_Search_Object_Category = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Object_Category' });\n\n\t\tif (LDAP_Use_Custom_Domain_Search) {\n\t\t\tif (LDAP_Use_Custom_Domain_Search.value === true) {\n\t\t\t\tlet Custom_Domain_Search;\n\t\t\t\ttry {\n\t\t\t\t\tCustom_Domain_Search = JSON.parse(LDAP_Custom_Domain_Search.value);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthrow new Error('Invalid Custom Domain Search JSON');\n\t\t\t\t}\n\n\t\t\t\tLDAP_Domain_Search_User.value = Custom_Domain_Search.userDN || '';\n\t\t\t\tLDAP_Domain_Search_Password.value = Custom_Domain_Search.password || '';\n\t\t\t\tLDAP_Domain_Search_Filter.value = Custom_Domain_Search.filter;\n\t\t\t} else {\n\t\t\t\tconst filter = [];\n\n\t\t\t\tif (LDAP_Domain_Search_Object_Category.value !== '') {\n\t\t\t\t\tfilter.push(`(objectCategory=${ LDAP_Domain_Search_Object_Category.value })`);\n\t\t\t\t}\n\n\t\t\t\tif (LDAP_Domain_Search_Object_Class.value !== '') {\n\t\t\t\t\tfilter.push(`(objectclass=${ LDAP_Domain_Search_Object_Class.value })`);\n\t\t\t\t}\n\n\t\t\t\tif (LDAP_Domain_Search_Filter.value !== '') {\n\t\t\t\t\tfilter.push(`(${ LDAP_Domain_Search_Filter.value })`);\n\t\t\t\t}\n\n\t\t\t\tif (filter.length === 1) {\n\t\t\t\t\tLDAP_Domain_Search_Filter.value = filter[0];\n\t\t\t\t} else if (filter.length > 1) {\n\t\t\t\t\tLDAP_Domain_Search_Filter.value = `(&${ filter.join('') })`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (LDAP_Domain_Search_Filter && LDAP_Domain_Search_Filter.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_User_Search_Filter' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_Filter.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Filter' });\n\n\t\tif (LDAP_Domain_Search_User && LDAP_Domain_Search_User.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Authentication_UserDN' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_User.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_User' });\n\n\n\t\tif (LDAP_Domain_Search_Password && LDAP_Domain_Search_Password.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Authentication_Password' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_Password.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Password' });\n\n\t\tif (LDAP_Domain_Search_User && LDAP_Domain_Search_User.value && LDAP_Domain_Search_Password && LDAP_Domain_Search_Password.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Authentication' },\n\t\t\t\t{ $set: { value: true } }\n\t\t\t);\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Use_Custom_Domain_Search' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Custom_Domain_Search' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Object_Class' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Object_Category' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Sync_Users' }); // Button\n\n\t\tconst LDAP_Sync_User_Data = RocketChat.models.Settings.findOne({ _id: 'LDAP_Sync_User_Data' });\n\t\tif (LDAP_Sync_User_Data && LDAP_Sync_User_Data.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Background_Sync' },\n\t\t\t\t{ $set: { value: true } }\n\t\t\t);\n\t\t}\n\n\t\tconst LDAP_Import_Users = RocketChat.models.Settings.findOne({ _id: 'LDAP_Import_Users' });\n\t\tif (LDAP_Import_Users && LDAP_Import_Users.value === false) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Background_Sync_Import_New_Users' },\n\t\t\t\t{ $set: { value: false } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Import_Users' });\n\t},\n});\n","const majorColors = {\n\t'content-background-color': '#FFFFFF',\n\t'primary-background-color': '#04436A',\n\t'primary-font-color': '#444444',\n\t'primary-action-color': '#13679A', // was action-buttons-color\n\t'secondary-background-color': '#F4F4F4',\n\t'secondary-font-color': '#A0A0A0',\n\t'secondary-action-color': '#DDDDDD',\n\t'component-color': '#EAEAEA',\n\t'success-color': '#4dff4d',\n\t'pending-color': '#FCB316',\n\t'error-color': '#BC2031',\n\t'selection-color': '#02ACEC',\n\t'attention-color': '#9C27B0',\n};\n\n// Minor colours implement major colours by default, but can be overruled\n// const minorColors = {\n// \t'tertiary-background-color': '@component-color',\n// \t'tertiary-font-color': '@transparent-lightest',\n// \t'link-font-color': '@primary-action-color',\n// \t'info-font-color': '@secondary-font-color',\n// \t'custom-scrollbar-color': '@transparent-darker',\n// \t'status-online': '@success-color',\n// \t'status-away': '@pending-color',\n// \t'status-busy': '@error-color',\n// \t'status-offline': '@transparent-darker'\n// };\n\nconst newvariables = {\n\t'content-background-color': 'rc-color-primary-lightest',\n\t'primary-background-color': 'rc-color-primary',\n\t'success-color': 'rc-color-success',\n\t'pending-color': 'rc-color-alert',\n\t'error-color': 'rc-color-error',\n\t'status-online': 'rc-color-success',\n\t'status-away': 'rc-color-alert',\n\t'status-busy': 'rc-color-error',\n\t'status-offline': 'rc-color-primary-darkest',\n};\n\nfunction lightenDarkenColor(col, amt) {\n\tlet usePound = false;\n\tif (col[0] === '#') {\n\t\tcol = col.slice(1);\n\t\tusePound = true;\n\t}\n\n\tconst num = parseInt(col, 16);\n\tlet r = (num >> 16) + amt;\n\n\tif (r > 255) { r = 255; } else if (r < 0) { r = 0; }\n\n\tlet b = ((num >> 8) & 0x00FF) + amt;\n\n\tif (b > 255) { b = 255; } else if (b < 0) { b = 0; }\n\n\tlet g = (num & 0x0000FF) + amt;\n\n\tif (g > 255) { g = 255; } else if (g < 0) { g = 0; }\n\n\treturn (usePound ? '#' : '') + (g | (b << 8) | (r << 16)).toString(16);\n}\n\nRocketChat.Migrations.add({\n\tversion: 103,\n\tup() {\n\t\tObject.keys(majorColors).forEach(function(_id) {\n\t\t\tconst color = RocketChat.models.Settings.findOne({ _id: `theme-color-${ _id }` });\n\t\t\tconst key = newvariables[_id];\n\t\t\tif (color && color.value !== majorColors[_id] && key) {\n\t\t\t\tif (/^@.+/.test(color.value)) {\n\t\t\t\t\tcolor.value = newvariables[color.value.replace('@', '')];\n\t\t\t\t}\n\t\t\t\tconst id = `theme-color-${ key }`;\n\t\t\t\tRocketChat.models.Settings.update({ _id: id }, { $set: { value : color.value, editor: /^#.+/.test(color.value) ? 'color' : 'expression' } });\n\t\t\t\tif (key === 'rc-color-primary') {\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary-darkest' }, { $set: { editor: 'color', value: lightenDarkenColor(color.value, -16) } });\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary-dark' }, { $set: { editor: 'color', value: lightenDarkenColor(color.value, 18) } });\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary-light' }, { $set: { editor: 'color', value: lightenDarkenColor(color.value, 110) } });\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary-light-medium' }, { $set: { editor: 'color', value: lightenDarkenColor(color.value, 156) } });\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary-lightest' }, { $set: { editor: 'color', value: lightenDarkenColor(color.value, 200) } });\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n});\n","RocketChat.Migrations.add({\n\tversion: 104,\n\tup() {\n\t\tif ((RocketChat.models.Settings.findOne({ _id: 'theme-color-rc-color-primary' }) || {}).value === '#04436A' &&\n\t\t\t(RocketChat.models.Settings.findOne({ _id: 'theme-color-rc-color-primary-darkest' }) || {}).value === '#335a' &&\n\t\t\t(RocketChat.models.Settings.findOne({ _id: 'theme-color-rc-color-primary-dark' }) || {}).value === '#16557c' &&\n\t\t\t(RocketChat.models.Settings.findOne({ _id: 'theme-color-rc-color-primary-light' }) || {}).value === '#72b1d8' &&\n\t\t\t(RocketChat.models.Settings.findOne({ _id: 'theme-color-rc-color-primary-light-medium' }) || {}).value === '#a0dfff' &&\n\t\t\t(RocketChat.models.Settings.findOne({ _id: 'theme-color-rc-color-primary-lightest' }) || {}).value === '#ccffff'\n\t\t) {\n\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary' }, { $set: { editor: 'expression', value: 'color-dark' } });\n\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary-darkest' }, { $set: { editor: 'expression', value: 'color-darkest' } });\n\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary-dark' }, { $set: { editor: 'expression', value: 'color-dark-medium' } });\n\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary-light' }, { $set: { editor: 'expression', value: 'color-gray' } });\n\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary-light-medium' }, { $set: { editor: 'expression', value: 'color-gray-medium' } });\n\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary-lightest' }, { $set: { editor: 'expression', value: 'color-gray-lightest' } });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 105,\n\tup() {\n\t\tif (RocketChat && RocketChat.models) {\n\t\t\tif (RocketChat.models.Users) {\n\t\t\t\tRocketChat.models.Users.find({ 'settings.preferences.unreadRoomsMode': { $exists: 1 } }).forEach(function(user) {\n\t\t\t\t\tconst newPreference = user.settings.preferences.unreadRoomsMode ? 'unread' : 'category';\n\t\t\t\t\tRocketChat.models.Users.update({ _id: user._id }, { $unset: { 'settings.preferences.unreadRoomsMode': 1 }, $set: { 'settings.preferences.roomsListExhibitionMode': newPreference } });\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (RocketChat.models.Settings) {\n\t\t\t\tconst settingsMap = {\n\t\t\t\t\tDesktop_Notifications_Default_Alert: 'Accounts_Default_User_Preferences_desktopNotifications',\n\t\t\t\t\tMobile_Notifications_Default_Alert: 'Accounts_Default_User_Preferences_mobileNotifications',\n\t\t\t\t\tAudio_Notifications_Default_Alert: 'Accounts_Default_User_Preferences_audioNotifications',\n\t\t\t\t\tDesktop_Notifications_Duration: 'Accounts_Default_User_Preferences_desktopNotificationDuration',\n\t\t\t\t\tAudio_Notifications_Value: undefined,\n\t\t\t\t};\n\t\t\t\tRocketChat.models.Settings.find({ _id: { $in: Object.keys(settingsMap) } }).forEach((oldSetting) => {\n\t\t\t\t\tconst newSettingKey = settingsMap[oldSetting._id];\n\t\t\t\t\tconst newSetting = newSettingKey && RocketChat.models.Settings.findOne({ _id: newSettingKey });\n\n\t\t\t\t\tif (newSetting && newSetting.value !== oldSetting.value) {\n\t\t\t\t\t\tRocketChat.models.Settings.update({ _id: newSettingKey }, {\t$set: {\tvalue: oldSetting.value\t}\t});\n\t\t\t\t\t}\n\t\t\t\t\tRocketChat.models.Settings.remove({ _id: oldSetting._id });\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n});\n","import LivechatVisitors from 'meteor/rocketchat:livechat/server/models/LivechatVisitors';\n\nRocketChat.Migrations.add({\n\tversion: 106,\n\tup() {\n\t\tconst visitors = Meteor.users.find({ type: 'visitor' });\n\t\tconst total = visitors.count();\n\t\tlet current = 1;\n\n\t\tconsole.log('Migrating livechat visitors, this may take a while ...');\n\n\t\tMeteor.setTimeout(() => {\n\t\t\tvisitors.forEach((user) => {\n\t\t\t\tconsole.log(`Migrating visitor ${ current++ }/${ total }`);\n\n\t\t\t\tconst {\n\t\t\t\t\t_id,\n\t\t\t\t\tname,\n\t\t\t\t\tusername,\n\t\t\t\t\tdeparment,\n\t\t\t\t\tuserAgent,\n\t\t\t\t\tip,\n\t\t\t\t\thost,\n\t\t\t\t\tvisitorEmails,\n\t\t\t\t\tphone,\n\t\t\t\t} = user;\n\t\t\t\tLivechatVisitors.insert({\n\t\t\t\t\t_id,\n\t\t\t\t\tname,\n\t\t\t\t\tusername,\n\t\t\t\t\tdeparment,\n\t\t\t\t\tuserAgent,\n\t\t\t\t\tip,\n\t\t\t\t\thost,\n\t\t\t\t\tvisitorEmails,\n\t\t\t\t\tphone,\n\t\t\t\t\ttoken: user.profile.token,\n\t\t\t\t});\n\n\t\t\t\tMeteor.users.remove({ _id });\n\t\t\t});\n\n\t\t\tconsole.log('Livechat visitors migration finished.');\n\t\t}, 1000);\n\t},\n});\n","\n\nRocketChat.Migrations.add({\n\tversion: 107,\n\tup() {\n\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'preferences.roomsListExhibitionMode': 'activity',\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'preferences.roomsListExhibitionMode': 1,\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'preferences.sidebarSortby': 'activity',\n\t\t\t\t'preferences.sidebarShowFavorites': true,\n\t\t\t},\n\t\t});\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'preferences.roomsListExhibitionMode': 'unread',\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'preferences.roomsListExhibitionMode': 1,\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'preferences.sidebarSortby': 'alphabetical',\n\t\t\t\t'preferences.sidebarShowUnread' : true,\n\t\t\t\t'preferences.sidebarShowFavorites': true,\n\t\t\t},\n\t\t});\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'preferences.roomsListExhibitionMode': 'category',\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'preferences.roomsListExhibitionMode': 1,\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'preferences.sidebarSortby': 'alphabetical',\n\t\t\t\t'preferences.sidebarShowFavorites': true,\n\t\t\t},\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 108,\n\tup() {\n\t\tconst roles = RocketChat.models.Roles.find({\n\t\t\t_id: { $ne: 'guest' },\n\t\t\tscope: 'Users',\n\t\t}).fetch().map((role) => role._id);\n\t\tRocketChat.models.Permissions.createOrUpdate('leave-c', roles);\n\t\tRocketChat.models.Permissions.createOrUpdate('leave-d', roles);\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 109,\n\tup() {\n\t\tconst FileUpload_GoogleStorage_Proxy = (RocketChat.models.Settings.findOne({ _id: 'FileUpload_GoogleStorage_Proxy' }) || {}).value === true;\n\t\tconst FileUpload_S3_Proxy = (RocketChat.models.Settings.findOne({ _id: 'FileUpload_S3_Proxy' }) || {}).value === true;\n\n\t\tRocketChat.models.Settings.update({ _id: 'FileUpload_GoogleStorage_Proxy_Avatars' }, { $set: { value: FileUpload_GoogleStorage_Proxy } });\n\t\tRocketChat.models.Settings.update({ _id: 'FileUpload_GoogleStorage_Proxy_Uploads' }, { $set: { value: FileUpload_GoogleStorage_Proxy } });\n\n\t\tRocketChat.models.Settings.update({ _id: 'FileUpload_S3_Proxy_Avatars' }, { $set: { value: FileUpload_S3_Proxy } });\n\t\tRocketChat.models.Settings.update({ _id: 'FileUpload_S3_Proxy_Uploads' }, { $set: { value: FileUpload_S3_Proxy } });\n\n\t\tRocketChat.models.Settings.remove({ _id: 'FileUpload_GoogleStorage_Proxy' });\n\t\tRocketChat.models.Settings.remove({ _id: 'FileUpload_S3_Proxy' });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 110,\n\tup() {\n\t\tif (RocketChat && RocketChat.models) {\n\n\t\t\tif (RocketChat.models.Settings) {\n\t\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Accounts_Default_User_Preferences_viewMode' });\n\t\t\t\tif (setting && setting.value) {\n\t\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t\t{ _id: 'Accounts_Default_User_Preferences_messageViewMode' },\n\t\t\t\t\t\t{ $set: { value: setting.value } }\n\t\t\t\t\t);\n\n\t\t\t\t\tRocketChat.models.Settings.remove(\n\t\t\t\t\t\t{ _id: 'Accounts_Default_User_Preferences_viewMode' }\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (RocketChat.models.Users) {\n\t\t\t\tRocketChat.models.Users.update(\n\t\t\t\t\t{ 'settings.preferences.viewMode': { $exists: 1 } },\n\t\t\t\t\t{ $rename: { 'settings.preferences.viewMode': 'user.settings.preferences.messageViewMode' } },\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t},\n\tdown() {\n\t\tif (RocketChat && RocketChat.models) {\n\n\t\t\tif (RocketChat.models.Settings) {\n\t\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Accounts_Default_User_Preferences_messageViewMode' });\n\t\t\t\tif (setting && setting.value) {\n\t\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t\t{ _id: 'Accounts_Default_User_Preferences_viewMode' },\n\t\t\t\t\t\t{ $set: { value: setting.value } }\n\t\t\t\t\t);\n\n\t\t\t\t\tRocketChat.models.Settings.remove(\n\t\t\t\t\t\t{ _id: 'Accounts_Default_User_Preferences_messageViewMode' }\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (RocketChat.models.Users) {\n\t\t\t\tRocketChat.models.Users.update(\n\t\t\t\t\t{ 'settings.preferences.messageViewMode': { $exists: 1 } },\n\t\t\t\t\t{ $rename: { 'settings.preferences.messageViewMode': 'user.settings.preferences.viewMode' } },\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t},\n});\n","// Migration to give delete channel, delete group permissions to owner\nRocketChat.Migrations.add({\n\tversion: 111,\n\tup() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\t\t\tRocketChat.models.Permissions.update({ _id: 'delete-c' }, { $addToSet: { roles: 'owner' } });\n\t\t\tRocketChat.models.Permissions.update({ _id: 'delete-p' }, { $addToSet: { roles: 'owner' } });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 112,\n\tup() {\n\t\tif (RocketChat && RocketChat.models) {\n\t\t\tif (RocketChat.models.Settings) {\n\t\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Accounts_Default_User_Preferences_idleTimeoutLimit' });\n\t\t\t\tif (setting && setting.value) {\n\t\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t\t{ _id: 'Accounts_Default_User_Preferences_idleTimeoutLimit' },\n\t\t\t\t\t\t{ $set: { value: setting.value / 1000 } }\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (RocketChat.models.Users) {\n\t\t\t\tRocketChat.models.Users.find({ 'settings.preferences.idleTimeLimit': { $exists: 1 } }).forEach(function(user) {\n\t\t\t\t\tRocketChat.models.Users.update(\n\t\t\t\t\t\t{ _id: user._id },\n\t\t\t\t\t\t{ $set: { 'settings.preferences.idleTimeLimit': user.settings.preferences.idleTimeLimit / 1000 } }\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 113,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Uploads && RocketChat.models.Messages) {\n\t\t\tconst fileQuery = {\n\t\t\t\tuserId: null,\n\t\t\t};\n\n\t\t\tconst filesToUpdate = RocketChat.models.Uploads.find(fileQuery);\n\t\t\tfilesToUpdate.forEach((file) => {\n\t\t\t\tconst messageQuery = {\n\t\t\t\t\t'file._id' : file._id,\n\t\t\t\t};\n\t\t\t\tconst message = RocketChat.models.Messages.findOne(messageQuery);\n\t\t\t\tif (message) {\n\t\t\t\t\tconst filter = {\n\t\t\t\t\t\t_id: file._id,\n\t\t\t\t\t};\n\n\t\t\t\t\tconst update = {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\tuserId: message.u._id,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\n\t\t\t\t\tRocketChat.models.Uploads.model.direct.update(filter, update);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 114,\n\tup() {\n\t\tif (RocketChat && RocketChat.models) {\n\t\t\tif (RocketChat.models.Settings) {\n\t\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Message_GlobalSearch' });\n\t\t\t\tif (setting && setting.value) {\n\t\t\t\t\tRocketChat.models.Settings.upsert(\n\t\t\t\t\t\t{ _id: 'Search.defaultProvider.GlobalSearchEnabled' },\n\t\t\t\t\t\t{ $set: { value: setting.value } }\n\t\t\t\t\t);\n\n\t\t\t\t\tRocketChat.models.Settings.removeById('Message_GlobalSearch');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 115,\n\tup() {\n\t\tRocketChat.models.Rooms.update({\n\t\t\t'announcement.message': { $exists: true },\n\t\t}, {\n\t\t\t$unset: { announcement: 1 },\n\t\t}, { multi: true });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 116,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex({\n\t\t\tunread: 1,\n\t\t});\n\n\t\t// set pref origin to all existing preferences\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\tdesktopNotifications: { $exists: true },\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tdesktopPrefOrigin: 'subscription',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\tmobilePushNotifications: { $exists: true },\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tmobilePrefOrigin: 'subscription',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\temailNotifications: { $exists: true },\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\temailPrefOrigin: 'subscription',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\n\t\t// set user preferences on subscriptions\n\t\tRocketChat.models.Users.find({\n\t\t\t$or: [\n\t\t\t\t{ 'settings.preferences.desktopNotifications': { $exists: true } },\n\t\t\t\t{ 'settings.preferences.mobileNotifications': { $exists: true } },\n\t\t\t\t{ 'settings.preferences.emailNotificationMode': { $exists: true } },\n\t\t\t],\n\t\t}).forEach((user) => {\n\t\t\tif (user.settings.preferences.desktopNotifications && user.settings.preferences.desktopNotifications !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\tdesktopPrefOrigin: { $exists: false },\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tdesktopNotifications: user.settings.preferences.desktopNotifications,\n\t\t\t\t\t\tdesktopPrefOrigin: 'user',\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (user.settings.preferences.mobileNotifications && user.settings.preferences.mobileNotifications !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\tmobilePrefOrigin: { $exists: false },\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tmobileNotifications: user.settings.preferences.mobileNotifications,\n\t\t\t\t\t\tmobilePrefOrigin: 'user',\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (user.settings.preferences.emailNotificationMode && user.settings.preferences.emailNotificationMode !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\temailPrefOrigin: { $exists: false },\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\temailNotifications: user.settings.preferences.emailNotificationMode === 'disabled' || user.settings.preferences.emailNotificationMode === 'nothing' ? 'nothing' : 'mentions',\n\t\t\t\t\t\temailPrefOrigin: 'user',\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 117,\n\tup() {\n\t\tif (RocketChat.authz &&\n\t\tRocketChat.models &&\n\t\tRocketChat.models.Settings &&\n\t\tRocketChat.authz.getUsersInRole('admin').count()) {\n\t\t\tRocketChat.models.Settings.upsert(\n\t\t\t\t{\n\t\t\t\t\t_id: 'Show_Setup_Wizard',\n\t\t\t\t}, {\n\t\t\t\t\t$set: { value: 'completed' },\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 118,\n\tup() {\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\temailNotifications: 'all',\n\t\t\temailPrefOrigin: 'user',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\temailNotifications: 'mentions',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti:true,\n\t\t});\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.emailNotificationMode': 'disabled',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'settings.preferences.emailNotificationMode': 'nothing',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti:true,\n\t\t});\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.emailNotificationMode': 'all',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'settings.preferences.emailNotificationMode': 'mentions',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti:true,\n\t\t});\n\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'Accounts_Default_User_Preferences_emailNotificationMode',\n\t\t\tvalue: 'disabled',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tvalue: 'nothing',\n\t\t\t},\n\t\t});\n\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'Accounts_Default_User_Preferences_emailNotificationMode',\n\t\t\tvalue: 'all',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tvalue: 'mentions',\n\t\t\t},\n\t\t});\n\n\t\t// set user highlights on subscriptions\n\t\tRocketChat.models.Users.find({\n\t\t\t'settings.preferences.highlights.0': { $exists: true },\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t'settings.preferences.highlights': 1,\n\t\t\t},\n\t\t}).forEach((user) => {\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t'u._id': user._id,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tuserHighlights: user.settings.preferences.highlights,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tmulti: true,\n\t\t\t});\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 119,\n\tup() {\n\t\tif (RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.update({\n\t\t\t\t_id: 'Show_Setup_Wizard',\n\t\t\t\tvalue: true,\n\t\t\t}, {\n\t\t\t\t$set: { value: 'pending' },\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.update({\n\t\t\t\t_id: 'Show_Setup_Wizard',\n\t\t\t\tvalue: false,\n\t\t\t}, {\n\t\t\t\t$set: { value: 'completed' },\n\t\t\t});\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 120,\n\tup() {\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.roomsListExhibitionMode': 'activity',\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'settings.preferences.roomsListExhibitionMode': 1,\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'settings.preferences.sidebarSortby': 'activity',\n\t\t\t\t'settings.preferences.sidebarShowFavorites': true,\n\t\t\t},\n\t\t});\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.roomsListExhibitionMode': 'unread',\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'settings.preferences.roomsListExhibitionMode': 1,\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'settings.preferences.sidebarSortby': 'alphabetical',\n\t\t\t\t'settings.preferences.sidebarShowUnread' : true,\n\t\t\t\t'settings.preferences.sidebarShowFavorites': true,\n\t\t\t},\n\t\t});\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.roomsListExhibitionMode': 'category',\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'settings.preferences.roomsListExhibitionMode': 1,\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'settings.preferences.sidebarSortby': 'alphabetical',\n\t\t\t\t'settings.preferences.sidebarShowFavorites': true,\n\t\t\t},\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 121,\n\tup() {\n\n\t\t// set user preferences on subscriptions\n\t\tRocketChat.models.Users.find({\n\t\t\t$or: [\n\t\t\t\t{ 'settings.preferences.desktopNotifications': { $exists: true } },\n\t\t\t\t{ 'settings.preferences.mobileNotifications': { $exists: true } },\n\t\t\t\t{ 'settings.preferences.emailNotificationMode': { $exists: true } },\n\t\t\t],\n\t\t}).forEach((user) => {\n\t\t\tif (user.settings.preferences.desktopNotifications && user.settings.preferences.desktopNotifications !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\tdesktopPrefOrigin: { $exists: false },\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tdesktopNotifications: user.settings.preferences.desktopNotifications,\n\t\t\t\t\t\tdesktopPrefOrigin: 'user',\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (user.settings.preferences.mobileNotifications && user.settings.preferences.mobileNotifications !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\tmobilePrefOrigin: { $exists: false },\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tmobileNotifications: user.settings.preferences.mobileNotifications,\n\t\t\t\t\t\tmobilePrefOrigin: 'user',\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (user.settings.preferences.emailNotificationMode && user.settings.preferences.emailNotificationMode !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\temailPrefOrigin: { $exists: false },\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\temailNotifications: user.settings.preferences.emailNotificationMode === 'disabled' || user.settings.preferences.emailNotificationMode === 'nothing' ? 'nothing' : 'mentions',\n\t\t\t\t\t\temailPrefOrigin: 'user',\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 122,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex('u._id_1_name_1_t_1_code_1');\n\t\tconsole.log('Fixing ChatSubscription u._id_1_name_1_t_1_code_1');\n\t},\n});\n","let pageVisitedCollection;\nlet messageCollection;\nlet roomCollection;\n\nconst roomIdByToken = {};\n\nconst batchSize = 5000;\n\nasync function migrateHistory(total, current) {\n\tconsole.log(`Livechat history migration ${ current }/${ total }`);\n\n\tconst items = await pageVisitedCollection.find({}).limit(batchSize).toArray();\n\n\tconst tokens = items.filter((item) => item.token && !roomIdByToken[item.token]).map((item) => item.token);\n\tconst rooms = await roomCollection.find({\n\t\t'v.token': {\n\t\t\t$in: tokens,\n\t\t},\n\t}, {\n\t\tfields: {\n\t\t\t'v.token': 1,\n\t\t},\n\t}).toArray();\n\n\trooms.forEach((room) => {\n\t\troomIdByToken[room.v.token] = room._id;\n\t});\n\n\tconst actions = items.reduce((result, item) => {\n\t\tconst msg = {\n\t\t\tt: 'livechat_navigation_history',\n\t\t\trid: roomIdByToken[item.token] || null, // prevent from being `undefined`\n\t\t\tts: item.ts,\n\t\t\tmsg: `${ item.page.title } - ${ item.page.location.href }`,\n\t\t\tu: {\n\t\t\t\t_id : 'rocket.cat',\n\t\t\t\tusername : 'rocket.cat',\n\t\t\t},\n\t\t\tgroupable : false,\n\t\t\tnavigation : {\n\t\t\t\tpage: item.page,\n\t\t\t\ttoken: item.token,\n\t\t\t},\n\t\t};\n\t\tif (!roomIdByToken[item.token] && item.expireAt) {\n\t\t\tmsg.expireAt = item.expireAt;\n\t\t}\n\t\tresult.insert.push(msg);\n\t\tresult.remove.push(item._id);\n\n\t\treturn result;\n\t}, { insert: [], remove: [] });\n\n\tconst ops = [];\n\n\tif (actions.insert.length > 0) {\n\t\tops.push(messageCollection.insertMany(actions.insert));\n\t}\n\n\tif (actions.remove.length > 0) {\n\t\tops.push(pageVisitedCollection.removeMany({ _id: { $in: actions.remove } }));\n\t}\n\n\tconst batch = Promise.all(ops);\n\tif (actions.remove.length === batchSize) {\n\t\tawait batch;\n\t\treturn migrateHistory(total, current + batchSize);\n\t}\n\n\treturn batch;\n}\n\n\nRocketChat.Migrations.add({\n\tversion: 123,\n\tup() {\n\t\tpageVisitedCollection = RocketChat.models.LivechatPageVisited.model.rawCollection();\n\t\tmessageCollection = RocketChat.models.Messages.model.rawCollection();\n\t\troomCollection = RocketChat.models.Rooms.model.rawCollection();\n\n\t\t/*\n\t\t * Move visitor navigation history to messages\n\t\t */\n\t\tMeteor.setTimeout(async() => {\n\t\t\tconst pages = pageVisitedCollection.find({});\n\t\t\tconst total = await pages.count();\n\t\t\tawait pages.close();\n\n\t\t\tconsole.log('Migrating livechat visitors navigation history to livechat messages. This might take a long time ...');\n\n\t\t\tawait migrateHistory(total, 0);\n\n\t\t\tconsole.log('Livechat visitors navigation history migration finished.');\n\t\t}, 1000);\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 124,\n\tup() {\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.mergeChannels': true,\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'settings.preferences.mergeChannels': 1,\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'settings.preferences.groupByType': false,\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.mergeChannels': false,\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'settings.preferences.mergeChannels': 1,\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'settings.preferences.groupByType': true,\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 125,\n\tup() {\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.groupByType': { $exists: true },\n\t\t}, {\n\t\t\t$rename: {\n\t\t\t\t'settings.preferences.groupByType': 'settings.preferences.sidebarGroupByType',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 126,\n\tup() {\n\t\tif (!RocketChat.models || !RocketChat.models.Settings) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst query = {\n\t\t\t_id: 'Accounts_Default_User_Preferences_idleTimeoutLimit',\n\t\t};\n\t\tconst setting = RocketChat.models.Settings.findOne(query);\n\n\t\tif (setting) {\n\t\t\tdelete setting._id;\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'Accounts_Default_User_Preferences_idleTimeLimit' }, setting);\n\t\t\tRocketChat.models.Settings.remove(query);\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 127,\n\tup() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\tconst newPermission = RocketChat.models.Permissions.findOne('view-livechat-manager');\n\t\t\tif (newPermission && newPermission.roles.length) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'remove-closed-livechat-rooms' }, { $set: { roles: newPermission.roles } });\n\t\t\t}\n\t\t}\n\t},\n\n\tdown() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Revert permission\n\t\t\tRocketChat.models.Permissions.remove({ _id: 'remove-closed-livechat-rooms' });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 128,\n\tup() {\n\t\tconst _id = 'theme-font-body-font-family';\n\t\tconst oldValue = '-apple-system, BlinkMacSystemFont, Roboto, \\'Helvetica Neue\\', Arial, sans-serif, \\'Apple Color Emoji\\', \\'Segoe UI\\', \\'Segoe UI Emoji\\', \\'Segoe UI Symbol\\', \\'Meiryo UI\\'';\n\t\tconst newValue = '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, Oxygen, Ubuntu, Cantarell, \\'Helvetica Neue\\', \\'Apple Color Emoji\\', \\'Segoe UI Emoji\\', \\'Segoe UI Symbol\\', \\'Meiryo UI\\', Arial, sans-serif';\n\n\t\tRocketChat.models.Settings.update({ _id, value: oldValue }, {\n\t\t\t$set: {\n\t\t\t\tvalue: newValue,\n\t\t\t},\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 129,\n\tup() {\n\t\tRocketChat.models.Users.find({\n\t\t\t$or: [\n\t\t\t\t{ 'settings.preferences.desktopNotifications': { $exists: true, $ne: 'default' } },\n\t\t\t\t{ 'settings.preferences.mobileNotifications': { $exists: true, $ne: 'default' } },\n\t\t\t\t{ 'settings.preferences.emailNotificationMode': { $exists: true, $ne: 'default' } },\n\t\t\t],\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t'settings.preferences.desktopNotifications': 1,\n\t\t\t\t'settings.preferences.mobileNotifications': 1,\n\t\t\t\t'settings.preferences.emailNotificationMode': 1,\n\t\t\t},\n\t\t}).forEach((user) => {\n\t\t\tif (user.settings.preferences.desktopNotifications && user.settings.preferences.desktopNotifications !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\tdesktopPrefOrigin: 'user',\n\t\t\t\t\tdesktopNotifications: null,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tdesktopNotifications: user.settings.preferences.desktopNotifications,\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (user.settings.preferences.mobileNotifications && user.settings.preferences.mobileNotifications !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\tmobilePrefOrigin: 'user',\n\t\t\t\t\tmobilePushNotifications: null,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tmobilePushNotifications: user.settings.preferences.mobileNotifications,\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (user.settings.preferences.emailNotificationMode && user.settings.preferences.emailNotificationMode !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\temailPrefOrigin: 'user',\n\t\t\t\t\temailNotifications: null,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\temailNotifications: user.settings.preferences.emailNotificationMode === 'disabled' || user.settings.preferences.emailNotificationMode === 'nothing' ? 'nothing' : 'mentions',\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n});\n","import Future from 'fibers/future';\n\nRocketChat.Migrations.add({\n\tversion: 130,\n\tup() {\n\t\tRocketChat.models.Rooms._db.originals.update(\n\t\t\t{\n\t\t\t\tt: { $ne: 'd' },\n\t\t\t},\n\t\t\t{\n\t\t\t\t$unset: { usernames: 1 },\n\t\t\t},\n\t\t\t{\n\t\t\t\tmulti: true,\n\t\t\t}\n\t\t);\n\n\t\tRocketChat.models.Rooms.find(\n\t\t\t{\n\t\t\t\tusersCount: { $exists: false },\n\t\t\t},\n\t\t\t{\n\t\t\t\tfields: {\n\t\t\t\t\t_id: 1,\n\t\t\t\t},\n\t\t\t}\n\t\t).forEach(({ _id }) => {\n\t\t\tconst usersCount = RocketChat.models.Subscriptions.findByRoomId(\n\t\t\t\t_id\n\t\t\t).count();\n\n\t\t\tRocketChat.models.Rooms._db.originals.update(\n\t\t\t\t{\n\t\t\t\t\t_id,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tusersCount,\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\n\t\t// Getting all subscriptions and users to memory allow us to process in batches,\n\t\t// all other solutions takes hundreds or thousands times more to process.\n\t\tconst subscriptions = RocketChat.models.Subscriptions.find(\n\t\t\t{\n\t\t\t\tt: 'd',\n\t\t\t\tname: { $exists: true },\n\t\t\t\tfname: { $exists: false },\n\t\t\t},\n\t\t\t{\n\t\t\t\tfields: {\n\t\t\t\t\tname: 1,\n\t\t\t\t},\n\t\t\t}\n\t\t).fetch();\n\n\t\tconst users = RocketChat.models.Users.find(\n\t\t\t{ username: { $exists: true }, name: { $exists: true } },\n\t\t\t{ fields: { username: 1, name: 1 } }\n\t\t).fetch();\n\t\tconst usersByUsername = users.reduce((obj, user) => {\n\t\t\tobj[user.username] = user.name;\n\t\t\treturn obj;\n\t\t}, {});\n\n\t\tconst updateSubscription = (subscription) => new Promise((resolve) => {\n\t\t\tMeteor.defer(() => {\n\t\t\t\tconst name = usersByUsername[subscription.name];\n\n\t\t\t\tif (!name) {\n\t\t\t\t\treturn resolve();\n\t\t\t\t}\n\n\t\t\t\tRocketChat.models.Subscriptions._db.originals.update(\n\t\t\t\t\t{\n\t\t\t\t\t\t_id: subscription._id,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\tfname: name,\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\n\t\t// Use FUTURE to process itens in batchs and wait the final one\n\t\tconst fut = new Future();\n\n\t\tconst processBatch = () => {\n\t\t\tconst itens = subscriptions.splice(0, 1000);\n\n\t\t\tconsole.log(\n\t\t\t\t'Migrating',\n\t\t\t\titens.length,\n\t\t\t\t'of',\n\t\t\t\tsubscriptions.length,\n\t\t\t\t'subscriptions'\n\t\t\t);\n\n\t\t\tif (itens.length) {\n\t\t\t\tPromise.all(itens.map((s) => updateSubscription(s))).then(() => {\n\t\t\t\t\tprocessBatch();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tfut.return();\n\t\t\t}\n\t\t};\n\n\t\tprocessBatch();\n\n\t\tfut.wait();\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 131,\n\tup() {\n\t\tconst userOptions = {\n\t\t\tfields: {\n\t\t\t\t_id : 1,\n\t\t\t},\n\t\t};\n\n\t\tconst users = RocketChat.models.Users.model.find({}, userOptions).fetch();\n\t\tconst userIds = users.map((user) => user._id);\n\n\t\tconst subscriptionQuery = {\n\t\t\t'u._id' : {\n\t\t\t\t$nin : userIds,\n\t\t\t},\n\t\t};\n\n\t\tconst subscriptionOptions = {\n\t\t\tfields : {\n\t\t\t\t_id : 1,\n\t\t\t\trid : 1,\n\t\t\t\t'u._id' : 1,\n\t\t\t},\n\t\t};\n\n\t\tconst subscriptions = RocketChat.models.Subscriptions.find(subscriptionQuery, subscriptionOptions);\n\n\t\tsubscriptions.forEach((subscription) => {\n\t\t\tconst room = RocketChat.models.Rooms.findOneById(subscription.rid);\n\t\t\tif (room) {\n\t\t\t\t// Remove direct messages and also non-channel rooms with only 1 user (the one being deleted)\n\t\t\t\tif (room.t === 'd' || (room.t !== 'c' && RocketChat.models.Subscriptions.findByRoomId(room._id).count() === 1)) {\n\t\t\t\t\tRocketChat.models.Subscriptions.removeByRoomId(subscription.rid);\n\t\t\t\t\tRocketChat.models.Messages.removeFilesByRoomId(subscription.rid);\n\t\t\t\t\tRocketChat.models.Messages.removeByRoomId(subscription.rid);\n\t\t\t\t\tRocketChat.models.Rooms.removeById(subscription.rid);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tRocketChat.models.Subscriptions.model.remove({ _id: subscription._id.toString() });\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 132,\n\tup() {\n\t\tRocketChat.models.Rooms.find({ t: 'l', label: { $exists: true }, fname: { $exists: false } }).forEach(function(room) {\n\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, {\n\t\t\t\t$set: {\n\t\t\t\t\tfname: room.label,\n\t\t\t\t},\n\t\t\t});\n\t\t\tRocketChat.models.Subscriptions.update({ rid: room._id }, {\n\t\t\t\t$set: {\n\t\t\t\t\tfname: room.label,\n\t\t\t\t},\n\t\t\t}, { multi: true });\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 133,\n\tup() {\n\t\tconst subscriptions = RocketChat.models.Subscriptions.find({\n\t\t\tt: 'd',\n\t\t\t$or: [{\n\t\t\t\tts: { $gte: new Date('2018-07-09T00:00:00Z') },\n\t\t\t}, {\n\t\t\t\tts: null,\n\t\t\t}],\n\t\t});\n\n\t\tsubscriptions.forEach((subscription) => {\n\t\t\tif (subscription.name !== subscription.fname) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst user = RocketChat.models.Users.findOne({\n\t\t\t\tusername: subscription.name,\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\tname: 1,\n\t\t\t\t},\n\t\t\t});\n\t\t\tif (!user) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t_id: subscription._id,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tfname: user.name,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t},\n});\n","\nRocketChat.Migrations.add({\n\tversion: 134,\n\tup() {\n\t\tconst updateIfDefault = (customized, idEmail, idSubject) => {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: customized });\n\t\t\tconst newSettingEmail = RocketChat.models.Settings.findOne({ _id: idEmail });\n\t\t\tconst newSettingSubject = RocketChat.models.Settings.findOne({ _id: idSubject });\n\n\t\t\tdelete newSettingSubject._id;\n\t\t\tdelete newSettingSubject.enableQuery;\n\t\t\tdelete newSettingSubject.i18nDefaultQuery;\n\n\t\t\tdelete newSettingEmail._id;\n\t\t\tdelete newSettingEmail.enableQuery;\n\t\t\tdelete newSettingEmail.i18nDefaultQuery;\n\t\t\tif (setting && (setting.value === false || newSettingEmail.value === '')) {\n\t\t\t\tnewSettingEmail.value = newSettingEmail.packageValue;\n\t\t\t}\n\t\t\tif (setting && (setting.value === false || newSettingSubject.value === '')) {\n\t\t\t\tnewSettingSubject.value = newSettingSubject.packageValue;\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.upsert({ _id: idEmail }, newSettingEmail);\n\t\t\tRocketChat.models.Settings.upsert({ _id: idSubject }, newSettingSubject);\n\t\t\tRocketChat.models.Settings.remove({ _id: customized });\n\t\t};\n\t\tconst rename = (oldId, newId) => {\n\t\t\tconst oldSetting = RocketChat.models.Settings.findOne({ _id: oldId });\n\t\t\tconst newSetting = RocketChat.models.Settings.findOne({ _id: newId });\n\n\t\t\tdelete oldSetting._id;\n\t\t\tdelete oldSetting.enableQuery;\n\t\t\tdelete oldSetting.i18nDefaultQuery;\n\n\t\t\toldSetting.packageValue = newSetting.packageValue;\n\t\t\toldSetting.value = newSetting.value || newSetting.packageValue;\n\n\t\t\tRocketChat.models.Settings.upsert({ _id: newId }, oldSetting);\n\t\t\tRocketChat.models.Settings.removeById(oldId);\n\t\t};\n\n\t\tupdateIfDefault('Accounts_Enrollment_Customized', 'Accounts_Enrollment_Email', 'Accounts_Enrollment_Email_Subject');\n\t\tupdateIfDefault('Accounts_UserAddedEmail_Customized', 'Accounts_UserAddedEmail', 'Accounts_UserAddedEmailSubject');\n\t\tupdateIfDefault('Forgot_Password_Customized', 'Forgot_Password_Email', 'Forgot_Password_Email_Subject');\n\t\tupdateIfDefault('Verification_Customized', 'Verification_Email', 'Verification_Email_Subject');\n\t\tupdateIfDefault('Invitation_Customized', 'Invitation_HTML', 'Invitation_Subject');\n\n\t\trename('Accounts_UserAddedEmail', 'Accounts_UserAddedEmail_Email');\n\t\trename('Accounts_UserAddedEmailSubject', 'Accounts_UserAddedEmail_Subject');\n\t\trename('Invitation_HTML', 'Invitation_Email');\n\n\t\tObject.entries({\n\t\t\tEmail_Header: '<html><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" bgcolor=\"#f3f3f3\" style=\"color:#4a4a4a;font-family: Helvetica,Arial,sans-serif;font-size:14px;line-height:20px;border-collapse:collapse;border-spacing:0;margin:0 auto\"><tr><td style=\"padding:1em\"><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" width=\"100%\" style=\"width:100%;margin:0 auto;max-width:800px\"><tr><td bgcolor=\"#ffffff\" style=\"background-color:#ffffff; border: 1px solid #DDD; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\"><table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"background-color: #04436a;\"><h1 style=\"font-family: Helvetica,Arial,sans-serif; padding: 0 1em; margin: 0; line-height: 70px; color: #FFF;\">[Site_Name]</h1></td></tr><tr><td style=\"padding: 1em; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\">',\n\t\t\tEmail_Footer: '</td></tr></table></td></tr><tr><td border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"font-family: Helvetica,Arial,sans-serif; max-width: 800px; margin: 0 auto; padding: 1.5em; text-align: center; font-size: 8pt; color: #999;\">Powered by <a href=\"https://rocket.chat\" target=\"_blank\">Rocket.Chat</a></td></tr></table></td></tr></table></html>',\n\t\t\tEmail_Footer_Direct_Reply: '</td></tr></table></td></tr><tr><td border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"font-family: Helvetica,Arial,sans-serif; max-width: 800px; margin: 0 auto; padding: 1.5em; text-align: center; font-size: 8pt; color: #999;\">You can directly reply to this email.<br>Do not modify previous emails in the thread.<br>Powered by <a href=\"https://rocket.chat\" target=\"_blank\">Rocket.Chat</a></td></tr></table></td></tr></table></html>',\n\t\t}).forEach(([_id, oldValue]) => {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id });\n\t\t\tif (setting.value === oldValue) {\n\t\t\t\tRocketChat.models.Settings.updateValueById(_id, setting.packageValue);\n\t\t\t}\n\n\t\t});\n\n\t},\n});\n","const fixURLs = (text) => text.replace(/: \\/\\//g, '://');\n\nRocketChat.Migrations.add({\n\tversion: 135,\n\tup() {\n\t\tconst header = RocketChat.models.Settings.findOne({ _id: 'Email_Header' });\n\t\tconst footer = RocketChat.models.Settings.findOne({ _id: 'Email_Footer' });\n\n\t\tRocketChat.models.Settings.update({ _id: 'Email_Header' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: fixURLs(header.value)\n\t\t\t\t\t.replace('src=\"[Site_Url]/assets/logo\"', 'src=\"[Site_Url_Slash]assets/logo.png\"')\n\t\t\t\t\t.replace('alt=\"Rocket.chat-logo\"', 'alt=\"Rocket.chat\"'),\n\t\t\t},\n\t\t});\n\n\t\tRocketChat.models.Settings.update({ _id: 'Email_Footer' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: fixURLs(footer.value),\n\t\t\t},\n\t\t});\n\t},\n});\n","import _ from 'underscore';\n\nif (RocketChat.Migrations.getVersion() !== 0) {\n\tRocketChat.Migrations.migrateTo(process.env.MIGRATION_VERSION || 'latest');\n} else {\n\tconst control = RocketChat.Migrations._getControl();\n\tcontrol.version = _.last(RocketChat.Migrations._list).version;\n\tRocketChat.Migrations._setControl(control);\n}\n","if (Meteor.AppCache) {\n\tMeteor.AppCache.config({\n\t\tonlineOnly: ['/elements/', '/landing/', '/moment-locales/', '/scripts/'],\n\t});\n}\n","/* globals FileUpload */\nimport _ from 'underscore';\nimport sharp from 'sharp';\nimport { Cookies } from 'meteor/ostrio:cookies';\n\nconst cookie = new Cookies();\n\nfunction isUserAuthenticated(req) {\n\tconst headers = req.headers || {};\n\tconst query = req.query || {};\n\n\tlet { rc_uid, rc_token } = query;\n\n\tif (!rc_uid && headers.cookie) {\n\t\trc_uid = cookie.get('rc_uid', headers.cookie) ;\n\t\trc_token = cookie.get('rc_token', headers.cookie);\n\t}\n\n\tif (!rc_uid || !rc_token || !RocketChat.models.Users.findOneByIdAndLoginToken(rc_uid, rc_token)) {\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nconst warnUnauthenticatedAccess = _.debounce(() => {\n\tconsole.warn('The server detected an unauthenticated access to an user avatar. This type of request will soon be blocked by default.');\n}, 60000 * 30); // 30 minutes\n\nfunction userCanAccessAvatar(req) {\n\tif (RocketChat.settings.get('Accounts_AvatarBlockUnauthenticatedAccess') === true) {\n\t\treturn isUserAuthenticated(req);\n\t}\n\n\tif (!isUserAuthenticated(req)) {\n\t\twarnUnauthenticatedAccess();\n\t}\n\n\treturn true;\n}\n\nMeteor.startup(function() {\n\tWebApp.connectHandlers.use('/avatar/', Meteor.bindEnvironment(function(req, res/* , next*/) {\n\t\tconst params = {\n\t\t\tusername: decodeURIComponent(req.url.replace(/^\\//, '').replace(/\\?.*$/, '')),\n\t\t};\n\t\tconst cacheTime = req.query.cacheTime || RocketChat.settings.get('Accounts_AvatarCacheTime');\n\n\t\tif (_.isEmpty(params.username) || !userCanAccessAvatar(req)) {\n\t\t\tres.writeHead(403);\n\t\t\tres.write('Forbidden');\n\t\t\tres.end();\n\t\t\treturn;\n\t\t}\n\n\t\tconst match = /^\\/([^?]*)/.exec(req.url);\n\n\t\tif (match[1]) {\n\t\t\tlet username = decodeURIComponent(match[1]);\n\t\t\tlet file;\n\n\t\t\tusername = username.replace(/\\.jpg$/, '');\n\n\t\t\tif (username[0] !== '@') {\n\t\t\t\tif (Meteor.settings && Meteor.settings.public && Meteor.settings.public.sandstorm) {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneByUsername(username);\n\t\t\t\t\tif (user && user.services && user.services.sandstorm && user.services.sandstorm.picture) {\n\t\t\t\t\t\tres.setHeader('Location', user.services.sandstorm.picture);\n\t\t\t\t\t\tres.writeHead(302);\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfile = RocketChat.models.Avatars.findOneByName(username);\n\t\t\t}\n\n\t\t\tif (file) {\n\t\t\t\tres.setHeader('Content-Security-Policy', 'default-src \\'none\\'');\n\n\t\t\t\tconst reqModifiedHeader = req.headers['if-modified-since'];\n\t\t\t\tif (reqModifiedHeader && reqModifiedHeader === (file.uploadedAt && file.uploadedAt.toUTCString())) {\n\t\t\t\t\tres.setHeader('Last-Modified', reqModifiedHeader);\n\t\t\t\t\tres.writeHead(304);\n\t\t\t\t\tres.end();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tres.setHeader('Cache-Control', `public, max-age=${ cacheTime }`);\n\t\t\t\tres.setHeader('Expires', '-1');\n\t\t\t\tres.setHeader('Content-Disposition', 'inline');\n\t\t\t\tres.setHeader('Last-Modified', file.uploadedAt.toUTCString());\n\t\t\t\tres.setHeader('Content-Type', file.type);\n\t\t\t\tres.setHeader('Content-Length', file.size);\n\n\t\t\t\treturn FileUpload.get(file, req, res);\n\t\t\t} else {\n\t\t\t\tres.setHeader('Content-Type', 'image/svg+xml');\n\t\t\t\tres.setHeader('Cache-Control', `public, max-age=${ cacheTime }`);\n\t\t\t\tres.setHeader('Expires', '-1');\n\t\t\t\tres.setHeader('Last-Modified', 'Thu, 01 Jan 2015 00:00:00 GMT');\n\n\t\t\t\tconst reqModifiedHeader = req.headers['if-modified-since'];\n\n\t\t\t\tif (reqModifiedHeader) {\n\t\t\t\t\tif (reqModifiedHeader === 'Thu, 01 Jan 2015 00:00:00 GMT') {\n\t\t\t\t\t\tres.writeHead(304);\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (RocketChat.settings.get('UI_Use_Name_Avatar')) {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneByUsername(username, {\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tname: 1,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tif (user && user.name) {\n\t\t\t\t\t\tusername = user.name;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet color = '';\n\t\t\t\tlet initials = '';\n\n\t\t\t\tif (username === '?') {\n\t\t\t\t\tcolor = '#000';\n\t\t\t\t\tinitials = username;\n\t\t\t\t} else {\n\t\t\t\t\tcolor = RocketChat.getAvatarColor(username);\n\n\t\t\t\t\tinitials = username.replace(/[^A-Za-z0-9]/g, '').substr(0, 1).toUpperCase();\n\t\t\t\t}\n\n\t\t\t\tconst viewSize = parseInt(req.query.size) || 200;\n\t\t\t\tconst fontSize = viewSize / 1.6;\n\n\t\t\t\tconst svg = `<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 ${ viewSize } ${ viewSize }\\\">\\n<rect width=\\\"100%\\\" height=\\\"100%\\\" fill=\\\"${ color }\\\"/>\\n<text x=\\\"50%\\\" y=\\\"50%\\\" dy=\\\"0.36em\\\" text-anchor=\\\"middle\\\" pointer-events=\\\"none\\\" fill=\\\"#ffffff\\\" font-family=\\\"Helvetica, Arial, Lucida Grande, sans-serif\\\" font-size=\"${ fontSize }\">\\n${ initials }\\n</text>\\n</svg>`;\n\n\t\t\t\tif (['png', 'jpg', 'jpeg'].includes(req.query.format)) {\n\t\t\t\t\tres.setHeader('Content-Type', `image/${ req.query.format }`);\n\t\t\t\t\tsharp(new Buffer(svg))\n\t\t\t\t\t\t.toFormat(req.query.format)\n\t\t\t\t\t\t.pipe(res);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tres.write(svg);\n\t\t\t\tres.end();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tres.writeHead(404);\n\t\tres.end();\n\t\treturn;\n\t}));\n});\n","/* global SyncedCron */\n\nconst logger = new Logger('SyncedCron');\n\nSyncedCron.config({\n\tlogger(opts) {\n\t\treturn logger[opts.level].call(logger, opts.message);\n\t},\n\tcollectionName: 'rocketchat_cron_history',\n});\n\nfunction generateStatistics() {\n\tconst statistics = RocketChat.statistics.save();\n\n\tstatistics.host = Meteor.absoluteUrl();\n\n\tif (RocketChat.settings.get('Statistics_reporting')) {\n\t\ttry {\n\t\t\tHTTP.post('https://collector.rocket.chat/', {\n\t\t\t\tdata: statistics,\n\t\t\t});\n\t\t} catch (error) {\n\t\t\t/* error*/\n\t\t\tlogger.warn('Failed to send usage report');\n\t\t}\n\t}\n}\n\nfunction cleanupOEmbedCache() {\n\treturn Meteor.call('OEmbedCacheCleanup');\n}\n\nMeteor.startup(function() {\n\treturn Meteor.defer(function() {\n\t\tgenerateStatistics();\n\n\t\tSyncedCron.add({\n\t\t\tname: 'Generate and save statistics',\n\t\t\tschedule(parser) {\n\t\t\t\treturn parser.cron(`${ new Date().getMinutes() } * * * *`);\n\t\t\t},\n\t\t\tjob: generateStatistics,\n\t\t});\n\n\t\tSyncedCron.add({\n\t\t\tname: 'Cleanup OEmbed cache',\n\t\t\tschedule(parser) {\n\t\t\t\tconst now = new Date();\n\t\t\t\treturn parser.cron(`${ now.getMinutes() } ${ now.getHours() } * * *`);\n\t\t\t},\n\t\t\tjob: cleanupOEmbedCache,\n\t\t});\n\n\t\treturn SyncedCron.start();\n\t});\n});\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nfunction flat(obj, newObj = {}, path = '') {\n\tfor (const key of Object.keys(obj)) {\n\t\tconst value = obj[key];\n\n\t\tif (_.isObject(value)) {\n\t\t\tflat(value, newObj, `${ key }.`);\n\t\t} else {\n\t\t\tnewObj[path + key] = value;\n\t\t}\n\t}\n\n\treturn newObj;\n}\n\nRocketChat.i18nValidation = function i18nValidation() {\n\tconst l = {};\n\tconst keys = {};\n\tconst errors = [];\n\tconst langs = Object.keys(TAPi18next.options.resStore);\n\n\tfor (const lang of Object.keys(TAPi18next.options.resStore)) {\n\t\tconst value = TAPi18next.options.resStore[lang];\n\n\t\tl[lang] = flat(value);\n\n\t\tfor (const key of Object.keys(l[lang])) {\n\t\t\tif (keys[key] == null) {\n\t\t\t\tkeys[key] = [];\n\t\t\t}\n\t\t\tkeys[key].push(lang);\n\t\t}\n\t}\n\n\tlet len = 0;\n\tfor (const key of Object.keys(keys)) {\n\t\tconst present = keys[key];\n\n\t\tif (!(present.length !== langs.length)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst error = (`${ _.difference(langs, present).join(',') }: missing translation for `).red + key.white + (`. Present in [${ present.join(',') }]`).red;\n\n\t\terrors.push(error);\n\n\t\tif (error.length > len) {\n\t\t\tlen = error.length;\n\t\t}\n\t}\n\n\tif (errors.length > 0) {\n\t\tconsole.log('+'.red + s.rpad('', len - 28, '-').red + '+'.red);\n\n\t\tfor (const error of errors) {\n\t\t\tconsole.log('|'.red, s.rpad(`${ error }`, len).red, '|'.red);\n\t\t}\n\n\t\treturn console.log('+'.red + s.rpad('', len - 28, '-').red + '+'.red);\n\t}\n};\n\n// Meteor.startup(function() {\n// \tRocketChat.i18nValidation();\n// });\n","import _ from 'underscore';\n\nMeteor.startup(function() {\n\tMeteor.defer(() => {\n\t\tif (!RocketChat.models.Rooms.findOneById('GENERAL')) {\n\t\t\tRocketChat.models.Rooms.createWithIdTypeAndName('GENERAL', 'c', 'general', {\n\t\t\t\tdefault: true,\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.models.Users.findOneById('rocket.cat')) {\n\t\t\tRocketChat.models.Users.create({\n\t\t\t\t_id: 'rocket.cat',\n\t\t\t\tname: 'Rocket.Cat',\n\t\t\t\tusername: 'rocket.cat',\n\t\t\t\tstatus: 'online',\n\t\t\t\tstatusDefault: 'online',\n\t\t\t\tutcOffset: 0,\n\t\t\t\tactive: true,\n\t\t\t\ttype: 'bot',\n\t\t\t});\n\n\t\t\tRocketChat.authz.addUserRoles('rocket.cat', 'bot');\n\n\t\t\tconst rs = RocketChatFile.bufferToStream(new Buffer(Assets.getBinary('avatars/rocketcat.png'), 'utf8'));\n\t\t\tconst fileStore = FileUpload.getStore('Avatars');\n\t\t\tfileStore.deleteByName('rocket.cat');\n\n\t\t\tconst file = {\n\t\t\t\tuserId: 'rocket.cat',\n\t\t\t\ttype: 'image/png',\n\t\t\t};\n\n\t\t\tMeteor.runAsUser('rocket.cat', () => {\n\t\t\t\tfileStore.insert(file, rs, () => RocketChat.models.Users.setAvatarOrigin('rocket.cat', 'local'));\n\t\t\t});\n\t\t}\n\n\t\tif (process.env.ADMIN_PASS) {\n\t\t\tif (_.isEmpty(RocketChat.authz.getUsersInRole('admin').fetch())) {\n\t\t\t\tconsole.log('Inserting admin user:'.green);\n\t\t\t\tconst adminUser = {\n\t\t\t\t\tname: 'Administrator',\n\t\t\t\t\tusername: 'admin',\n\t\t\t\t\tstatus: 'offline',\n\t\t\t\t\tstatusDefault: 'online',\n\t\t\t\t\tutcOffset: 0,\n\t\t\t\t\tactive: true,\n\t\t\t\t};\n\n\t\t\t\tif (process.env.ADMIN_NAME) {\n\t\t\t\t\tadminUser.name = process.env.ADMIN_NAME;\n\t\t\t\t}\n\n\t\t\t\tconsole.log((`Name: ${ adminUser.name }`).green);\n\n\t\t\t\tif (process.env.ADMIN_EMAIL) {\n\t\t\t\t\tconst re = /^[^@].*@[^@]+$/i;\n\n\t\t\t\t\tif (re.test(process.env.ADMIN_EMAIL)) {\n\t\t\t\t\t\tif (!RocketChat.models.Users.findOneByEmailAddress(process.env.ADMIN_EMAIL)) {\n\t\t\t\t\t\t\tadminUser.emails = [{\n\t\t\t\t\t\t\t\taddress: process.env.ADMIN_EMAIL,\n\t\t\t\t\t\t\t\tverified: true,\n\t\t\t\t\t\t\t}];\n\n\t\t\t\t\t\t\tconsole.log((`Email: ${ process.env.ADMIN_EMAIL }`).green);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Email provided already exists; Ignoring environment variables ADMIN_EMAIL'.red);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('Email provided is invalid; Ignoring environment variables ADMIN_EMAIL'.red);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (process.env.ADMIN_USERNAME) {\n\t\t\t\t\tlet nameValidation;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tnameValidation = new RegExp(`^${ RocketChat.settings.get('UTF8_Names_Validation') }$`);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (nameValidation.test(process.env.ADMIN_USERNAME)) {\n\t\t\t\t\t\tif (RocketChat.checkUsernameAvailability(process.env.ADMIN_USERNAME)) {\n\t\t\t\t\t\t\tadminUser.username = process.env.ADMIN_USERNAME;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Username provided already exists; Ignoring environment variables ADMIN_USERNAME'.red);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('Username provided is invalid; Ignoring environment variables ADMIN_USERNAME'.red);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconsole.log((`Username: ${ adminUser.username }`).green);\n\n\t\t\t\tadminUser.type = 'user';\n\n\t\t\t\tconst id = RocketChat.models.Users.create(adminUser);\n\n\t\t\t\tAccounts.setPassword(id, process.env.ADMIN_PASS);\n\n\t\t\t\tconsole.log((`Password: ${ process.env.ADMIN_PASS }`).green);\n\n\t\t\t\tRocketChat.authz.addUserRoles(id, 'admin');\n\t\t\t} else {\n\t\t\t\tconsole.log('Users with admin role already exist; Ignoring environment variables ADMIN_PASS'.red);\n\t\t\t}\n\t\t}\n\n\t\tif (typeof process.env.INITIAL_USER === 'string' && process.env.INITIAL_USER.length > 0) {\n\t\t\ttry {\n\t\t\t\tconst initialUser = JSON.parse(process.env.INITIAL_USER);\n\n\t\t\t\tif (!initialUser._id) {\n\t\t\t\t\tconsole.log('No _id provided; Ignoring environment variable INITIAL_USER'.red);\n\t\t\t\t} else if (!RocketChat.models.Users.findOneById(initialUser._id)) {\n\t\t\t\t\tconsole.log('Inserting initial user:'.green);\n\t\t\t\t\tconsole.log(JSON.stringify(initialUser, null, 2).green);\n\t\t\t\t\tRocketChat.models.Users.create(initialUser);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('Error processing environment variable INITIAL_USER'.red, e);\n\t\t\t}\n\t\t}\n\n\t\tif (_.isEmpty(RocketChat.authz.getUsersInRole('admin').fetch())) {\n\t\t\tconst oldestUser = RocketChat.models.Users.getOldest({ _id: 1, username: 1, name: 1 });\n\n\t\t\tif (oldestUser) {\n\t\t\t\tRocketChat.authz.addUserRoles(oldestUser._id, 'admin');\n\t\t\t\tconsole.log(`No admins are found. Set ${ oldestUser.username || oldestUser.name } as admin for being the oldest user`);\n\t\t\t}\n\t\t}\n\n\t\tif (!_.isEmpty(RocketChat.authz.getUsersInRole('admin').fetch())) {\n\t\t\tif (RocketChat.settings.get('Show_Setup_Wizard') === 'pending') {\n\t\t\t\tconsole.log('Setting Setup Wizard to \"in_progress\" because, at least, one admin was found');\n\t\t\t\tRocketChat.models.Settings.updateValueById('Show_Setup_Wizard', 'in_progress');\n\t\t\t}\n\t\t}\n\n\t\tRocketChat.models.Users.removeById('rocketchat.internal.admin.test');\n\n\t\tif (process.env.TEST_MODE === 'true') {\n\t\t\tconsole.log('Inserting admin test user:'.green);\n\n\t\t\tconst adminUser = {\n\t\t\t\t_id: 'rocketchat.internal.admin.test',\n\t\t\t\tname: 'RocketChat Internal Admin Test',\n\t\t\t\tusername: 'rocketchat.internal.admin.test',\n\t\t\t\temails: [\n\t\t\t\t\t{\n\t\t\t\t\t\taddress: 'rocketchat.internal.admin.test@rocket.chat',\n\t\t\t\t\t\tverified: true,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tstatus: 'offline',\n\t\t\t\tstatusDefault: 'online',\n\t\t\t\tutcOffset: 0,\n\t\t\t\tactive: true,\n\t\t\t\ttype: 'user',\n\t\t\t};\n\n\t\t\tconsole.log((`Name: ${ adminUser.name }`).green);\n\t\t\tconsole.log((`Email: ${ adminUser.emails[0].address }`).green);\n\t\t\tconsole.log((`Username: ${ adminUser.username }`).green);\n\t\t\tconsole.log((`Password: ${ adminUser._id }`).green);\n\n\t\t\tif (RocketChat.models.Users.findOneByEmailAddress(adminUser.emails[0].address)) {\n\t\t\t\tthrow new Meteor.Error(`Email ${ adminUser.emails[0].address } already exists`, 'Rocket.Chat can\\'t run in test mode');\n\t\t\t}\n\n\t\t\tif (!RocketChat.checkUsernameAvailability(adminUser.username)) {\n\t\t\t\tthrow new Meteor.Error(`Username ${ adminUser.username } already exists`, 'Rocket.Chat can\\'t run in test mode');\n\t\t\t}\n\n\t\t\tRocketChat.models.Users.create(adminUser);\n\n\t\t\tAccounts.setPassword(adminUser._id, adminUser._id);\n\n\t\t\tRocketChat.authz.addUserRoles(adminUser._id, 'admin');\n\n\t\t\tif (RocketChat.settings.get('Show_Setup_Wizard') === 'pending') {\n\t\t\t\tRocketChat.models.Settings.updateValueById('Show_Setup_Wizard', 'in_progress');\n\t\t\t}\n\n\t\t\treturn RocketChat.addUserToDefaultChannels(adminUser, true);\n\t\t}\n\t});\n});\n","/* globals InstanceStatus, UserPresence, UserPresenceMonitor */\n\nMeteor.startup(function() {\n\tconst instance = {\n\t\thost: 'localhost',\n\t\tport: String(process.env.PORT).trim(),\n\t};\n\n\tif (process.env.INSTANCE_IP) {\n\t\tinstance.host = String(process.env.INSTANCE_IP).trim();\n\t}\n\n\tInstanceStatus.registerInstance('rocket.chat', instance);\n\n\tUserPresence.start();\n\n\treturn UserPresenceMonitor.start();\n});\n","/* globals MongoInternals, SystemLogger */\n\nimport fs from 'fs';\nimport path from 'path';\nimport semver from 'semver';\n\nMeteor.startup(function() {\n\tlet oplogState = 'Disabled';\n\tif (MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle && MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle.onOplogEntry) {\n\t\toplogState = 'Enabled';\n\t\tif (RocketChat.settings.get('Force_Disable_OpLog_For_Cache') === true) {\n\t\t\toplogState += ' (Disabled for Cache Sync)';\n\t\t}\n\t}\n\n\tconst desiredNodeVersion = semver.clean(fs.readFileSync(path.join(process.cwd(), '../../.node_version.txt')).toString());\n\tconst desiredNodeVersionMajor = String(semver.parse(desiredNodeVersion).major);\n\n\treturn Meteor.setTimeout(function() {\n\t\tlet msg = [\n\t\t\t`Rocket.Chat Version: ${ RocketChat.Info.version }`,\n\t\t\t`     NodeJS Version: ${ process.versions.node } - ${ process.arch }`,\n\t\t\t`           Platform: ${ process.platform }`,\n\t\t\t`       Process Port: ${ process.env.PORT }`,\n\t\t\t`           Site URL: ${ RocketChat.settings.get('Site_Url') }`,\n\t\t\t`   ReplicaSet OpLog: ${ oplogState }`,\n\t\t];\n\n\t\tif (RocketChat.Info.commit && RocketChat.Info.commit.hash) {\n\t\t\tmsg.push(`        Commit Hash: ${ RocketChat.Info.commit.hash.substr(0, 10) }`);\n\t\t}\n\n\t\tif (RocketChat.Info.commit && RocketChat.Info.commit.branch) {\n\t\t\tmsg.push(`      Commit Branch: ${ RocketChat.Info.commit.branch }`);\n\t\t}\n\n\t\tmsg = msg.join('\\n');\n\n\t\tif (semver.satisfies(process.versions.node, desiredNodeVersionMajor)) {\n\t\t\treturn SystemLogger.startup_box(msg, 'SERVER RUNNING');\n\t\t}\n\n\t\tmsg += ['', '', 'YOUR CURRENT NODEJS VERSION IS NOT SUPPORTED,', `PLEASE UPGRADE / DOWNGRADE TO VERSION ${ desiredNodeVersionMajor }.X.X`].join('\\n');\n\n\t\tSystemLogger.error_box(msg, 'SERVER ERROR');\n\n\t\treturn process.exit();\n\t}, 100);\n});\n","import _ from 'underscore';\n\nconst orig_updateOrCreateUserFromExternalService = Accounts.updateOrCreateUserFromExternalService;\n\nAccounts.updateOrCreateUserFromExternalService = function(serviceName, serviceData = {}, ...args /* , options*/) {\n\tconst services = [\n\t\t'facebook',\n\t\t'github',\n\t\t'gitlab',\n\t\t'google',\n\t\t'meteor-developer',\n\t\t'linkedin',\n\t\t'twitter',\n\t\t'sandstorm',\n\t];\n\n\tif (services.includes(serviceName) === false && serviceData._OAuthCustom !== true) {\n\t\treturn;\n\t}\n\n\tif (serviceName === 'meteor-developer') {\n\t\tif (Array.isArray(serviceData.emails)) {\n\t\t\tconst primaryEmail = serviceData.emails.sort((a) => a.primary !== true).filter((item) => item.verified === true)[0];\n\t\t\tserviceData.email = primaryEmail && primaryEmail.address;\n\t\t}\n\t}\n\n\tif (serviceName === 'linkedin') {\n\t\tserviceData.email = serviceData.emailAddress;\n\t}\n\n\tif (serviceData.email) {\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(serviceData.email);\n\t\tif (user != null) {\n\t\t\tconst findQuery = {\n\t\t\t\taddress: serviceData.email,\n\t\t\t\tverified: true,\n\t\t\t};\n\n\t\t\tif (!_.findWhere(user.emails, findQuery)) {\n\t\t\t\tRocketChat.models.Users.resetPasswordAndSetRequirePasswordChange(user._id, true, 'This_email_has_already_been_used_and_has_not_been_verified__Please_change_your_password');\n\t\t\t}\n\n\t\t\tRocketChat.models.Users.setServiceId(user._id, serviceName, serviceData.id);\n\t\t\tRocketChat.models.Users.setEmailVerified(user._id, serviceData.email);\n\t\t}\n\t}\n\n\treturn orig_updateOrCreateUserFromExternalService.apply(this, [serviceName, serviceData, ...args]);\n};\n","Meteor.methods({\n\tOEmbedCacheCleanup() {\n\t\tif (Meteor.userId() && !RocketChat.authz.hasRole(Meteor.userId(), 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'OEmbedCacheCleanup',\n\t\t\t});\n\t\t}\n\n\t\tconst date = new Date();\n\t\tconst expirationDays = RocketChat.settings.get('API_EmbedCacheExpirationDays');\n\t\tdate.setDate(date.getDate() - expirationDays);\n\t\tRocketChat.models.OEmbedCache.removeAfterDate(date);\n\t\treturn {\n\t\t\tmessage: 'cache_cleared',\n\t\t};\n\t},\n});\n","Meteor.methods({\n\taddAllUserToRoom(rid, activeUsersOnly = false) {\n\n\t\tcheck (rid, String);\n\t\tcheck (activeUsersOnly, Boolean);\n\n\t\tif (RocketChat.authz.hasRole(this.userId, 'admin') === true) {\n\t\t\tconst userCount = RocketChat.models.Users.find().count();\n\t\t\tif (userCount > RocketChat.settings.get('API_User_Limit')) {\n\t\t\t\tthrow new Meteor.Error('error-user-limit-exceeded', 'User Limit Exceeded', {\n\t\t\t\t\tmethod: 'addAllToRoom',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\t\tif (room == null) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\t\tmethod: 'addAllToRoom',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst userFilter = {};\n\t\t\tif (activeUsersOnly === true) {\n\t\t\t\tuserFilter.active = true;\n\t\t\t}\n\n\t\t\tconst users = RocketChat.models.Users.find(userFilter).fetch();\n\t\t\tconst now = new Date();\n\t\t\tusers.forEach(function(user) {\n\t\t\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\t\t\t\tif (subscription != null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tRocketChat.callbacks.run('beforeJoinRoom', user, room);\n\t\t\t\tRocketChat.models.Subscriptions.createWithRoomAndUser(room, user, {\n\t\t\t\t\tts: now,\n\t\t\t\t\topen: true,\n\t\t\t\t\talert: true,\n\t\t\t\t\tunread: 1,\n\t\t\t\t\tuserMentions: 1,\n\t\t\t\t\tgroupMentions: 0,\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Messages.createUserJoinWithRoomIdAndUser(rid, user, {\n\t\t\t\t\tts: now,\n\t\t\t\t});\n\t\t\t\tMeteor.defer(function() {});\n\t\t\t\treturn RocketChat.callbacks.run('afterJoinRoom', user, room);\n\t\t\t});\n\t\t\treturn true;\n\t\t} else {\n\t\t\tthrow (new Meteor.Error(403, 'Access to Method Forbidden', {\n\t\t\t\tmethod: 'addAllToRoom',\n\t\t\t}));\n\t\t}\n\t},\n});\n","Meteor.methods({\n\taddRoomLeader(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomLeader',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-leader', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomLeader',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomLeader',\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomLeader',\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('leader') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-leader', 'User is already a leader', {\n\t\t\t\tmethod: 'addRoomLeader',\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'leader');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username,\n\t\t\t},\n\t\t\trole: 'leader',\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'leader',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name,\n\t\t\t\t},\n\t\t\t\tscope: rid,\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t},\n});\n","Meteor.methods({\n\taddRoomModerator(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomModerator',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-moderator', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomModerator',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomModerator',\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomModerator',\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('moderator') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-moderator', 'User is already a moderator', {\n\t\t\t\tmethod: 'addRoomModerator',\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'moderator');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username,\n\t\t\t},\n\t\t\trole: 'moderator',\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'moderator',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: fromUser.name,\n\t\t\t\t},\n\t\t\t\tscope: rid,\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t},\n});\n","Meteor.methods({\n\taddRoomOwner(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-owner', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('owner') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-owner', 'User is already an owner', {\n\t\t\t\tmethod: 'addRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'owner');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username,\n\t\t\t},\n\t\t\trole: 'owner',\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'owner',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name,\n\t\t\t\t},\n\t\t\t\tscope: rid,\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t},\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tafterVerifyEmail() {\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'afterVerifyEmail',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tconst verifiedEmail = _.find(user.emails, (email) => email.verified);\n\n\t\tif (verifiedEmail) {\n\t\t\tRocketChat.models.Roles.addUserRoles(user._id, 'user');\n\t\t\tRocketChat.models.Roles.removeUserRoles(user._id, 'anonymous');\n\t\t}\n\t},\n});\n","import s from 'underscore.string';\n\nconst sortChannels = function(field, direction) {\n\tswitch (field) {\n\t\tcase 'createdAt':\n\t\t\treturn {\n\t\t\t\tts: direction === 'asc' ? 1 : -1,\n\t\t\t};\n\t\tdefault:\n\t\t\treturn {\n\t\t\t\t[field]: direction === 'asc' ? 1 : -1,\n\t\t\t};\n\t}\n};\n\nconst sortUsers = function(field, direction) {\n\tswitch (field) {\n\t\tdefault:\n\t\t\treturn {\n\t\t\t\t[field]: direction === 'asc' ? 1 : -1,\n\t\t\t};\n\t}\n};\n\nMeteor.methods({\n\tbrowseChannels({ text = '', type = 'channels', sortBy = 'name', sortDirection = 'asc', page, offset, limit = 10 }) {\n\t\tconst regex = new RegExp(s.trim(s.escapeRegExp(text)), 'i');\n\n\t\tif (!['channels', 'users'].includes(type)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!['asc', 'desc'].includes(sortDirection)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ((!page && page !== 0) && (!offset && offset !== 0)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!['name', 'createdAt', 'usersCount', ...type === 'channels' ? ['usernames'] : [], ...type === 'users' ? ['username'] : []].includes(sortBy)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst skip = Math.max(0, offset || (page > -1 ? limit * page : 0));\n\n\t\tlimit = limit > 0 ? limit : 10;\n\n\t\tconst options = {\n\t\t\tskip,\n\t\t\tlimit,\n\t\t};\n\n\t\tconst user = Meteor.user();\n\t\tif (type === 'channels') {\n\n\t\t\tconst sort = sortChannels(sortBy, sortDirection);\n\t\t\tif (!RocketChat.authz.hasPermission(user._id, 'view-c-room')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tresults: RocketChat.models.Rooms.findByNameAndType(regex, 'c', {\n\t\t\t\t\t...options,\n\t\t\t\t\tsort,\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tdescription: 1,\n\t\t\t\t\t\ttopic: 1,\n\t\t\t\t\t\tname: 1,\n\t\t\t\t\t\tlastMessage: 1,\n\t\t\t\t\t\tts: 1,\n\t\t\t\t\t\tarchived: 1,\n\t\t\t\t\t\tusersCount: 1,\n\t\t\t\t\t},\n\t\t\t\t}).fetch(),\n\t\t\t\ttotal: RocketChat.models.Rooms.findByNameAndType(regex, 'c').count(),\n\t\t\t};\n\t\t}\n\n\t\t// type === users\n\t\tif (!RocketChat.authz.hasPermission(user._id, 'view-outside-room') || !RocketChat.authz.hasPermission(user._id, 'view-d-room')) {\n\t\t\treturn;\n\t\t}\n\t\tconst sort = sortUsers(sortBy, sortDirection);\n\t\treturn {\n\t\t\tresults: RocketChat.models.Users.findByActiveUsersExcept(text, [user.username], {\n\t\t\t\t...options,\n\t\t\t\tsort,\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t\tname: 1,\n\t\t\t\t\tcreatedAt: 1,\n\t\t\t\t\temails: 1,\n\t\t\t\t},\n\t\t\t}).fetch(),\n\t\t\ttotal: RocketChat.models.Users.findByActiveUsersExcept(text, [user.username]).count(),\n\t\t};\n\t},\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'browseChannels',\n\tuserId(/* userId*/) {\n\t\treturn true;\n\t},\n}, 100, 100000);\n","Meteor.methods({\n\tcanAccessRoom(rid, userId, extraData) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, Match.Maybe(String));\n\n\t\tlet user;\n\n\t\tif (userId) {\n\t\t\tuser = RocketChat.models.Users.findOneById(userId, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (!user || !user.username) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\t\tmethod: 'canAccessRoom',\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (!rid) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'canAccessRoom',\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\tif (room) {\n\t\t\tif (RocketChat.authz.canAccessRoom.call(this, room, user, extraData)) {\n\t\t\t\tif (user) {\n\t\t\t\t\troom.username = user.username;\n\t\t\t\t}\n\t\t\t\treturn room;\n\t\t\t}\n\n\t\t\tif (!userId && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\t\tmethod: 'canAccessRoom',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn false;\n\t\t} else {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'canAccessRoom',\n\t\t\t});\n\t\t}\n\t},\n});\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nMeteor.methods({\n\tchannelsList(filter, channelType, limit, sort) {\n\t\tthis.unblock();\n\n\t\tcheck(filter, String);\n\t\tcheck(channelType, String);\n\t\tcheck(limit, Match.Optional(Number));\n\t\tcheck(sort, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'channelsList',\n\t\t\t});\n\t\t}\n\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t},\n\t\t\tsort: {\n\t\t\t\tmsgs: -1,\n\t\t\t},\n\t\t};\n\n\t\tif (_.isNumber(limit)) {\n\t\t\toptions.limit = limit;\n\t\t}\n\n\t\tif (s.trim(sort)) {\n\t\t\tswitch (sort) {\n\t\t\t\tcase 'name':\n\t\t\t\t\toptions.sort = {\n\t\t\t\t\t\tname: 1,\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'msgs':\n\t\t\t\t\toptions.sort = {\n\t\t\t\t\t\tmsgs: -1,\n\t\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tlet channels = [];\n\n\t\tconst userId = Meteor.userId();\n\n\t\tif (channelType !== 'private') {\n\t\t\tif (RocketChat.authz.hasPermission(userId, 'view-c-room')) {\n\t\t\t\tif (filter) {\n\t\t\t\t\tchannels = channels.concat(RocketChat.models.Rooms.findByType('c', options).fetch());\n\t\t\t\t} else {\n\t\t\t\t\tchannels = channels.concat(RocketChat.models.Rooms.findByTypeAndNameContaining('c', filter, options).fetch());\n\t\t\t\t}\n\t\t\t} else if (RocketChat.authz.hasPermission(userId, 'view-joined-room')) {\n\t\t\t\tconst roomIds = RocketChat.models.Subscriptions.findByTypeAndUserId('c', userId, { fields: { rid: 1 } }).fetch().map((s) => s.rid);\n\t\t\t\tif (filter) {\n\t\t\t\t\tchannels = channels.concat(RocketChat.models.Rooms.findByTypeInIds('c', roomIds, options).fetch());\n\t\t\t\t} else {\n\t\t\t\t\tchannels = channels.concat(RocketChat.models.Rooms.findByTypeInIdsAndNameContaining('c', roomIds, filter, options).fetch());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (channelType !== 'public' && RocketChat.authz.hasPermission(userId, 'view-p-room')) {\n\t\t\tconst user = RocketChat.models.Users.findOne(userId, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t\t'settings.preferences.sidebarGroupByType': 1,\n\t\t\t\t},\n\t\t\t});\n\t\t\tconst userPref = RocketChat.getUserPreference(user, 'sidebarGroupByType');\n\t\t\t// needs to negate globalPref because userPref represents its opposite\n\t\t\tconst groupByType = userPref !== undefined ? userPref : RocketChat.settings.get('UI_Group_Channels_By_Type');\n\n\t\t\tif (!groupByType) {\n\t\t\t\tconst roomIds = RocketChat.models.Subscriptions.findByTypeAndUserId('p', userId, { fields: { rid: 1 } }).fetch().map((s) => s.rid);\n\t\t\t\tif (filter) {\n\t\t\t\t\tchannels = channels.concat(RocketChat.models.Rooms.findByTypeInIds('p', roomIds, options).fetch());\n\t\t\t\t} else {\n\t\t\t\t\tchannels = channels.concat(RocketChat.models.Rooms.findByTypeInIdsAndNameContaining('p', roomIds, filter, options).fetch());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tchannels,\n\t\t};\n\t},\n});\n","Meteor.methods({\n\tcreateDirectMessage(username) {\n\t\tcheck(username, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage',\n\t\t\t});\n\t\t}\n\n\t\tconst me = Meteor.user();\n\n\t\tif (!me.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage',\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.settings.get('Message_AllowDirectMessagesToYourself') === false && me.username === username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'create-d')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'createDirectMessage',\n\t\t\t});\n\t\t}\n\n\t\tconst to = RocketChat.models.Users.findOneByUsername(username);\n\n\t\tif (!to) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(to._id, 'view-d-room')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Target user not allowed to receive messages', {\n\t\t\t\tmethod: 'createDirectMessage',\n\t\t\t});\n\t\t}\n\n\t\tconst rid = [me._id, to._id].sort().join('');\n\n\t\tconst now = new Date();\n\n\t\t// Make sure we have a room\n\t\tRocketChat.models.Rooms.upsert({\n\t\t\t_id: rid,\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tusernames: [me.username, to.username],\n\t\t\t},\n\t\t\t$setOnInsert: {\n\t\t\t\tt: 'd',\n\t\t\t\tmsgs: 0,\n\t\t\t\tts: now,\n\t\t\t\tusersCount: 2,\n\t\t\t},\n\t\t});\n\n\t\tconst myNotificationPref = RocketChat.getDefaultSubscriptionPref(me);\n\n\t\t// Make user I have a subcription to this room\n\t\tconst upsertSubscription = {\n\t\t\t$set: {\n\t\t\t\tls: now,\n\t\t\t\topen: true,\n\t\t\t},\n\t\t\t$setOnInsert: {\n\t\t\t\tfname: to.name,\n\t\t\t\tname: to.username,\n\t\t\t\tt: 'd',\n\t\t\t\talert: false,\n\t\t\t\tunread: 0,\n\t\t\t\tuserMentions: 0,\n\t\t\t\tgroupMentions: 0,\n\t\t\t\tcustomFields: me.customFields,\n\t\t\t\tu: {\n\t\t\t\t\t_id: me._id,\n\t\t\t\t\tusername: me.username,\n\t\t\t\t},\n\t\t\t\tts: now,\n\t\t\t\t...myNotificationPref,\n\t\t\t},\n\t\t};\n\n\t\tif (to.active === false) {\n\t\t\tupsertSubscription.$set.archived = true;\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.upsert({\n\t\t\trid,\n\t\t\t$and: [{ 'u._id': me._id }], // work around to solve problems with upsert and dot\n\t\t}, upsertSubscription);\n\n\t\tconst toNotificationPref = RocketChat.getDefaultSubscriptionPref(to);\n\n\t\tRocketChat.models.Subscriptions.upsert({\n\t\t\trid,\n\t\t\t$and: [{ 'u._id': to._id }], // work around to solve problems with upsert and dot\n\t\t}, {\n\t\t\t$setOnInsert: {\n\t\t\t\tfname: me.name,\n\t\t\t\tname: me.username,\n\t\t\t\tt: 'd',\n\t\t\t\topen: false,\n\t\t\t\talert: false,\n\t\t\t\tunread: 0,\n\t\t\t\tuserMentions: 0,\n\t\t\t\tgroupMentions: 0,\n\t\t\t\tcustomFields: to.customFields,\n\t\t\t\tu: {\n\t\t\t\t\t_id: to._id,\n\t\t\t\t\tusername: to.username,\n\t\t\t\t},\n\t\t\t\tts: now,\n\t\t\t\t...toNotificationPref,\n\t\t\t},\n\t\t});\n\n\t\treturn {\n\t\t\trid,\n\t\t};\n\t},\n});\n\nRocketChat.RateLimiter.limitMethod('createDirectMessage', 10, 60000, {\n\tuserId(userId) {\n\t\treturn !RocketChat.authz.hasPermission(userId, 'send-many-messages');\n\t},\n});\n","/* global FileUpload */\nMeteor.methods({\n\tdeleteFileMessage(fileID) {\n\t\tcheck(fileID, String);\n\n\t\tconst msg = RocketChat.models.Messages.getMessageByFileId(fileID);\n\n\t\tif (msg) {\n\t\t\treturn Meteor.call('deleteMessage', msg);\n\t\t}\n\n\t\treturn FileUpload.getStore('Uploads').deleteById(fileID);\n\t},\n});\n","Meteor.methods({\n\tdeleteUser(userId) {\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'deleteUser',\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'delete-user') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'deleteUser',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'deleteUser',\n\t\t\t});\n\t\t}\n\n\t\tconst adminCount = Meteor.users.find({ roles: 'admin' }).count();\n\n\t\tconst userIsAdmin = user.roles.indexOf('admin') > -1;\n\n\t\tif (adminCount === 1 && userIsAdmin) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Leaving the app without admins is not allowed', {\n\t\t\t\tmethod: 'deleteUser',\n\t\t\t\taction: 'Remove_last_admin',\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.deleteUser(userId);\n\n\t\treturn true;\n\t},\n});\n","/* globals RocketChat */\n\nMeteor.methods({\n\teraseRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'eraseRoom',\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'eraseRoom',\n\t\t\t});\n\t\t}\n\n\t\tif (Apps && Apps.isLoaded()) {\n\t\t\tconst prevent = Promise.await(Apps.getBridges().getListenerBridge().roomEvent('IPreRoomDeletePrevent', room));\n\t\t\tif (prevent) {\n\t\t\t\tthrow new Meteor.Error('error-app-prevented-deleting', 'A Rocket.Chat App prevented the room erasing.');\n\t\t\t}\n\t\t}\n\n\t\tif (!RocketChat.roomTypes.roomTypes[room.t].canBeDeleted(room)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'eraseRoom',\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Messages.removeFilesByRoomId(rid);\n\t\tRocketChat.models.Messages.removeByRoomId(rid);\n\t\tRocketChat.models.Subscriptions.removeByRoomId(rid);\n\t\tconst result = RocketChat.models.Rooms.removeById(rid);\n\n\t\tif (Apps && Apps.isLoaded()) {\n\t\t\tApps.getBridges().getListenerBridge().roomEvent('IPostRoomDeleted', room);\n\t\t}\n\n\t\treturn result;\n\t},\n});\n","/* global Gravatar */\n\nfunction getAvatarSuggestionForUser(user) {\n\tcheck(user, Object);\n\n\tconst avatars = [];\n\n\tif (user.services.facebook && user.services.facebook.id && RocketChat.settings.get('Accounts_OAuth_Facebook')) {\n\t\tavatars.push({\n\t\t\tservice: 'facebook',\n\t\t\turl: `https://graph.facebook.com/${ user.services.facebook.id }/picture?type=large`,\n\t\t});\n\t}\n\n\tif (user.services.google && user.services.google.picture && user.services.google.picture !== 'https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg' && RocketChat.settings.get('Accounts_OAuth_Google')) {\n\t\tavatars.push({\n\t\t\tservice: 'google',\n\t\t\turl: user.services.google.picture,\n\t\t});\n\t}\n\n\tif (user.services.github && user.services.github.username && RocketChat.settings.get('Accounts_OAuth_Github')) {\n\t\tavatars.push({\n\t\t\tservice: 'github',\n\t\t\turl: `https://avatars.githubusercontent.com/${ user.services.github.username }?s=200`,\n\t\t});\n\t}\n\n\tif (user.services.linkedin && user.services.linkedin.pictureUrl && RocketChat.settings.get('Accounts_OAuth_Linkedin')) {\n\t\tavatars.push({\n\t\t\tservice: 'linkedin',\n\t\t\turl: user.services.linkedin.pictureUrl,\n\t\t});\n\t}\n\n\tif (user.services.twitter && user.services.twitter.profile_image_url_https && RocketChat.settings.get('Accounts_OAuth_Twitter')) {\n\t\tavatars.push({\n\t\t\tservice: 'twitter',\n\t\t\turl: user.services.twitter.profile_image_url_https.replace(/_normal|_bigger/, ''),\n\t\t});\n\t}\n\n\tif (user.services.gitlab && user.services.gitlab.avatar_url && RocketChat.settings.get('Accounts_OAuth_Gitlab')) {\n\t\tavatars.push({\n\t\t\tservice: 'gitlab',\n\t\t\turl: user.services.gitlab.avatar_url,\n\t\t});\n\t}\n\n\tif (user.services.sandstorm && user.services.sandstorm.picture && Meteor.settings.public.sandstorm) {\n\t\tavatars.push({\n\t\t\tservice: 'sandstorm',\n\t\t\turl: user.services.sandstorm.picture,\n\t\t});\n\t}\n\n\tif (user.services.blockstack && user.services.blockstack.image && RocketChat.settings.get('Blockstack_Enable')) {\n\t\tavatars.push({\n\t\t\tservice: 'blockstack',\n\t\t\turl: user.services.blockstack.image,\n\t\t});\n\t}\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tfor (const email of user.emails) {\n\t\t\tif (email.verified === true) {\n\t\t\t\tavatars.push({\n\t\t\t\t\tservice: 'gravatar',\n\t\t\t\t\turl: Gravatar.imageUrl(email.address, {\n\t\t\t\t\t\tdefault: '404',\n\t\t\t\t\t\tsize: 200,\n\t\t\t\t\t\tsecure: true,\n\t\t\t\t\t}),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (email.verified !== true) {\n\t\t\t\tavatars.push({\n\t\t\t\t\tservice: 'gravatar',\n\t\t\t\t\turl: Gravatar.imageUrl(email.address, {\n\t\t\t\t\t\tdefault: '404',\n\t\t\t\t\t\tsize: 200,\n\t\t\t\t\t\tsecure: true,\n\t\t\t\t\t}),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tconst validAvatars = {};\n\tfor (const avatar of avatars) {\n\t\ttry {\n\t\t\tconst result = HTTP.get(avatar.url, {\n\t\t\t\tnpmRequestOptions: {\n\t\t\t\t\tencoding: 'binary',\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (result.statusCode === 200) {\n\t\t\t\tlet blob = `data:${ result.headers['content-type'] };base64,`;\n\t\t\t\tblob += Buffer.from(result.content, 'binary').toString('base64');\n\t\t\t\tavatar.blob = blob;\n\t\t\t\tavatar.contentType = result.headers['content-type'];\n\t\t\t\tvalidAvatars[avatar.service] = avatar;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t// error;\n\t\t}\n\t}\n\treturn validAvatars;\n}\n\nthis.getAvatarSuggestionForUser = getAvatarSuggestionForUser;\n\nMeteor.methods({\n\tgetAvatarSuggestion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getAvatarSuggestion',\n\t\t\t});\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tconst user = Meteor.user();\n\n\t\treturn getAvatarSuggestionForUser(user);\n\t},\n});\n","// DEPRECATE\nMeteor.methods({\n\tgetRoomIdByNameOrId(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId',\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid) || RocketChat.models.Rooms.findOneByName(rid);\n\n\t\tif (room == null) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.canAccessRoom(room, Meteor.user())) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId',\n\t\t\t});\n\t\t}\n\n\t\treturn room._id;\n\t},\n});\n","Meteor.methods({\n\tgetRoomNameById(rid) {\n\t\tcheck(rid, String);\n\t\tconst userId = Meteor.userId();\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getRoomNameById',\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (room == null) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomNameById',\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, userId, { fields: { _id: 1 } });\n\t\tif (subscription) {\n\t\t\treturn room.name;\n\t\t}\n\n\t\tif (room.t !== 'c' || RocketChat.authz.hasPermission(userId, 'view-c-room') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomNameById',\n\t\t\t});\n\t\t}\n\n\t\treturn room.name;\n\t},\n});\n","Meteor.methods({\n\tgetTotalChannels() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getTotalChannels',\n\t\t\t});\n\t\t}\n\n\t\tconst query = {\n\t\t\tt: 'c',\n\t\t};\n\t\treturn RocketChat.models.Rooms.find(query).count();\n\t},\n});\n","/* global slugify */\nimport _ from 'underscore';\n\nfunction slug(text) {\n\ttext = slugify(text, '.');\n\treturn text.replace(/[^0-9a-z-_.]/g, '');\n}\n\nfunction usernameIsAvaliable(username) {\n\tif (username.length < 1) {\n\t\treturn false;\n\t}\n\n\tif (username === 'all') {\n\t\treturn false;\n\t}\n\n\treturn !RocketChat.models.Users.findOneByUsername(username);\n}\n\nfunction generateSuggestion(user) {\n\tlet usernames = [];\n\tlet username = undefined;\n\n\tif (Meteor.settings.public.sandstorm) {\n\t\tusernames.push(user.services.sandstorm.preferredHandle);\n\t}\n\n\tif (Match.test(user && user.name, String)) {\n\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\tusernames.push(slug(user.name));\n\t\t} else {\n\t\t\tusernames.push(user.name);\n\t\t}\n\n\t\tconst nameParts = user.name.split(' ');\n\n\t\tif (nameParts.length > 1) {\n\t\t\tconst first = nameParts[0];\n\t\t\tconst last = nameParts[nameParts.length - 1];\n\n\t\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\t\tusernames.push(slug(first[0] + last));\n\t\t\t\tusernames.push(slug(first + last[0]));\n\t\t\t} else {\n\t\t\t\tusernames.push(first[0] + last);\n\t\t\t\tusernames.push(first + last[0]);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.profile && user.profile.name) {\n\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\tusernames.push(slug(user.profile.name));\n\t\t} else {\n\t\t\tusernames.push(user.profile.name);\n\t\t}\n\t}\n\n\tif (Array.isArray(user.services)) {\n\t\tlet services = user.services.map((service) => _.values(_.pick(service, 'name', 'username', 'firstName', 'lastName')));\n\n\t\tservices = _.uniq(_.flatten(services));\n\n\t\tfor (const service of services) {\n\t\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\t\tusernames.push(slug(service));\n\t\t\t} else {\n\t\t\t\tusernames.push(service);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tfor (const email of user.emails) {\n\t\t\tif (email.address && email.verified === true) {\n\t\t\t\tusernames.push(slug(email.address.replace(/@.+$/, '')));\n\t\t\t\tusernames.push(slug(email.address.replace(/(.+)@(\\w+).+/, '$1.$2')));\n\t\t\t}\n\t\t}\n\t}\n\n\tusernames = _.compact(usernames);\n\n\tfor (const item of usernames) {\n\t\tif (usernameIsAvaliable(item)) {\n\t\t\treturn item;\n\t\t}\n\t}\n\n\tif (usernames.length === 0 || usernames[0].length === 0) {\n\t\tusernames.push(RocketChat.settings.get('Accounts_DefaultUsernamePrefixSuggestion'));\n\t}\n\n\tlet index = 0;\n\twhile (!username) {\n\t\tindex++;\n\t\tif (usernameIsAvaliable(`${ usernames[0] }-${ index }`)) {\n\t\t\tusername = `${ usernames[0] }-${ index }`;\n\t\t}\n\t}\n\n\tif (usernameIsAvaliable(username)) {\n\t\treturn username;\n\t}\n}\n\nRocketChat.generateUsernameSuggestion = generateSuggestion;\n\nMeteor.methods({\n\tgetUsernameSuggestion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getUsernameSuggestion',\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\treturn generateSuggestion(user);\n\t},\n});\n","Meteor.methods({\n\tgetUsersOfRoom(rid, showAll) {\n\t\tconst userId = Meteor.userId();\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getUsersOfRoom' });\n\t\t}\n\n\t\tconst room = Meteor.call('canAccessRoom', rid, userId);\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getUsersOfRoom' });\n\t\t}\n\n\t\tif (room.broadcast && !RocketChat.authz.hasPermission(userId, 'view-broadcast-member-list', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'getUsersOfRoom' });\n\t\t}\n\n\t\tconst subscriptions = RocketChat.models.Subscriptions.findByRoomIdWhenUsernameExists(rid, { fields: { 'u._id': 1 } }).fetch();\n\t\tconst userIds = subscriptions.map((s) => s.u._id); // TODO: CACHE: expensive\n\t\tconst options = { fields: { username: 1, name: 1 } };\n\n\t\tconst users = showAll === true\n\t\t\t? RocketChat.models.Users.findUsersWithUsernameByIds(userIds, options).fetch()\n\t\t\t: RocketChat.models.Users.findUsersWithUsernameByIdsNotOffline(userIds, options).fetch();\n\n\t\treturn {\n\t\t\ttotal: userIds.length,\n\t\t\trecords: users,\n\t\t};\n\t},\n});\n","Meteor.methods({\n\thideRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'hideRoom',\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.hideByRoomIdAndUserId(rid, Meteor.userId());\n\t},\n});\n","/* globals RocketChat */\n\nMeteor.methods({\n\tignoreUser({ rid, userId: ignoredUser, ignore = true }) {\n\t\tcheck(ignoredUser, String);\n\t\tcheck(rid, String);\n\t\tcheck(ignore, Boolean);\n\n\t\tconst userId = Meteor.userId();\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'ignoreUser',\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, userId);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-subscription', 'Invalid subscription', { method: 'ignoreUser' });\n\t\t}\n\n\t\tconst subscriptionIgnoredUser = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, ignoredUser);\n\n\t\tif (!subscriptionIgnoredUser) {\n\t\t\tthrow new Meteor.Error('error-invalid-subscription', 'Invalid subscription', { method: 'ignoreUser' });\n\t\t}\n\n\t\treturn !!RocketChat.models.Subscriptions.ignoreUser({ _id: subscription._id, ignoredUser, ignore });\n\t},\n});\n","const hideMessagesOfType = [];\n\nRocketChat.settings.get(/Message_HideType_.+/, function(key, value) {\n\tconst type = key.replace('Message_HideType_', '');\n\tconst types = type === 'mute_unmute' ? ['user-muted', 'user-unmuted'] : [type];\n\n\treturn types.forEach((type) => {\n\t\tconst index = hideMessagesOfType.indexOf(type);\n\n\t\tif (value === true && index === -1) {\n\t\t\treturn hideMessagesOfType.push(type);\n\t\t}\n\n\t\tif (index > -1) {\n\t\t\treturn hideMessagesOfType.splice(index, 1);\n\t\t}\n\t});\n});\n\nMeteor.methods({\n\tloadHistory(rid, end, limit = 20, ls) {\n\t\tthis.unblock();\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId() && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadHistory',\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tconst room = Meteor.call('canAccessRoom', rid, fromId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst canAnonymous = RocketChat.settings.get('Accounts_AllowAnonymousRead');\n\t\tconst canPreview = RocketChat.authz.hasPermission(fromId, 'preview-c-room');\n\n\t\tif (room.t === 'c' && !canAnonymous && !canPreview && !RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, fromId, { fields: { _id: 1 } })) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn RocketChat.loadMessageHistory({ userId: fromId, rid, end, limit, ls });\n\t},\n});\n","Meteor.methods({\n\tloadLocale(locale) {\n\t\tcheck(locale, String);\n\n\t\ttry {\n\t\t\treturn Assets.getText(`moment-locales/${ locale.toLowerCase() }.js`);\n\t\t} catch (error) {\n\t\t\ttry {\n\t\t\t\treturn Assets.getText(`moment-locales/${ locale.split('-').shift().toLowerCase() }.js`);\n\t\t\t} catch (error) {\n\t\t\t\treturn console.log(error);\n\t\t\t}\n\t\t}\n\t},\n});\n","Meteor.methods({\n\tloadMissedMessages(rid, start) {\n\t\tcheck(rid, String);\n\t\tcheck(start, Date);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadMissedMessages',\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1,\n\t\t\t},\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0,\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(rid, start, options).fetch();\n\t},\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tloadNextMessages(rid, end, limit = 20) {\n\t\tcheck(rid, String);\n\t\tcheck(limit, Number);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadNextMessages',\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: 1,\n\t\t\t},\n\t\t\tlimit,\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0,\n\t\t\t};\n\t\t}\n\n\t\tlet records;\n\t\tif (end) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(rid, end, options).fetch();\n\t\t} else {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomId(rid, options).fetch();\n\t\t}\n\n\t\tconst messages = records.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId,\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\treturn {\n\t\t\tmessages,\n\t\t};\n\t},\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tloadSurroundingMessages(message, limit = 50) {\n\t\tcheck(message, Object);\n\t\tcheck(limit, Number);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadSurroundingMessages',\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!message._id) {\n\t\t\treturn false;\n\t\t}\n\n\t\tmessage = RocketChat.models.Messages.findOneById(message._id);\n\n\t\tif (!message || !message.rid) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', message.rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlimit = limit - 1;\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1,\n\t\t\t},\n\t\t\tlimit: Math.ceil(limit / 2),\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0,\n\t\t\t};\n\t\t}\n\n\t\tconst recordsBefore = RocketChat.models.Messages.findVisibleByRoomIdBeforeTimestamp(message.rid, message.ts, options).fetch();\n\n\t\tconst messages = recordsBefore.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId,\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\tconst moreBefore = messages.length === options.limit;\n\n\t\tmessages.push(message);\n\n\t\toptions.sort = {\n\t\t\tts: 1,\n\t\t};\n\n\t\toptions.limit = Math.floor(limit / 2);\n\n\t\tconst recordsAfter = RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(message.rid, message.ts, options).fetch();\n\t\tconst afterMessages = recordsAfter.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId,\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\tconst moreAfter = afterMessages.length === options.limit;\n\n\t\treturn {\n\t\t\tmessages: messages.concat(afterMessages),\n\t\t\tmoreBefore,\n\t\t\tmoreAfter,\n\t\t};\n\t},\n});\n","Meteor.methods({\n\tlogoutCleanUp(user) {\n\t\tcheck(user, Object);\n\n\t\tMeteor.defer(function() {\n\t\t\tRocketChat.callbacks.run('afterLogoutCleanUp', user);\n\t\t});\n\t},\n});\n","import s from 'underscore.string';\n\nMeteor.methods({\n\tmessageSearch(text, rid, limit) {\n\t\tcheck(text, String);\n\t\tcheck(rid, Match.Maybe(String));\n\t\tcheck(limit, Match.Optional(Number));\n\n\t\t// TODO: Evaluate why we are returning `users` and `channels`, as the only thing that gets set is the `messages`.\n\t\tconst result = {\n\t\t\tmessage: {\n\t\t\t\tdocs:[],\n\t\t\t},\n\t\t};\n\n\t\tconst currentUserId = Meteor.userId();\n\t\tif (!currentUserId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'messageSearch',\n\t\t\t});\n\t\t}\n\n\t\t// Don't process anything else if the user can't access the room\n\t\tif (rid) {\n\t\t\tif (!Meteor.call('canAccessRoom', rid, currentUserId)) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t} else if (RocketChat.settings.get('Search.defaultProvider.GlobalSearchEnabled') !== true) {\n\t\t\treturn result;\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tconst currentUserName = user.username;\n\t\tconst currentUserTimezoneOffset = user.utcOffset;\n\n\t\tconst query = {};\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1,\n\t\t\t},\n\t\t\tlimit: limit || 20,\n\t\t};\n\n\t\t// I would place these methods at the bottom of the file for clarity but travis doesn't appreciate that.\n\t\t// (no-use-before-define)\n\n\t\tfunction filterStarred() {\n\t\t\tquery['starred._id'] = currentUserId;\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterUrl() {\n\t\t\tquery['urls.0'] = {\n\t\t\t\t$exists: true,\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterPinned() {\n\t\t\tquery.pinned = true;\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterLocation() {\n\t\t\tquery.location = {\n\t\t\t\t$exist: true,\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterBeforeDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tconst beforeDate = new Date(year, month, day);\n\t\t\tbeforeDate.setHours(beforeDate.getUTCHours() + beforeDate.getTimezoneOffset() / 60 + currentUserTimezoneOffset);\n\t\t\tquery.ts = {\n\t\t\t\t$lte: beforeDate,\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterAfterDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tday++;\n\t\t\tconst afterDate = new Date(year, month, day);\n\t\t\tafterDate.setUTCHours(afterDate.getUTCHours() + afterDate.getTimezoneOffset() / 60 + currentUserTimezoneOffset);\n\t\t\tif (query.ts) {\n\t\t\t\tquery.ts.$gte = afterDate;\n\t\t\t} else {\n\t\t\t\tquery.ts = {\n\t\t\t\t\t$gte: afterDate,\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterOnDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tconst date = new Date(year, month, day);\n\t\t\tdate.setUTCHours(date.getUTCHours() + date.getTimezoneOffset() / 60 + currentUserTimezoneOffset);\n\t\t\tconst dayAfter = new Date(date);\n\t\t\tdayAfter.setDate(dayAfter.getDate() + 1);\n\t\t\tdelete query.ts;\n\t\t\tquery.ts = {\n\t\t\t\t$gte: date,\n\t\t\t\t$lt: dayAfter,\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterLabel(_, tag) {\n\t\t\tquery['attachments.0.labels'] = new RegExp(s.escapeRegExp(tag), 'i');\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction sortByTimestamp(_, direction) {\n\t\t\tif (direction.startsWith('asc')) {\n\t\t\t\toptions.sort.ts = 1;\n\t\t\t} else if (direction.startsWith('desc')) {\n\t\t\t\toptions.sort.ts = -1;\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\n\t\t/*\n\t\t text = 'from:rodrigo mention:gabriel chat'\n\t\t */\n\n\t\t// Query for senders\n\t\tconst from = [];\n\t\ttext = text.replace(/from:([a-z0-9.-_]+)/ig, function(match, username) {\n\t\t\tif (username === 'me' && !from.includes(currentUserName)) {\n\t\t\t\tusername = currentUserName;\n\t\t\t}\n\t\t\tfrom.push(username);\n\t\t\treturn '';\n\t\t});\n\n\t\tif (from.length > 0) {\n\t\t\tquery['u.username'] = {\n\t\t\t\t$regex: from.join('|'),\n\t\t\t\t$options: 'i',\n\t\t\t};\n\t\t}\n\n\t\t// Query for senders\n\t\tconst mention = [];\n\t\ttext = text.replace(/mention:([a-z0-9.-_]+)/ig, function(match, username) {\n\t\t\tmention.push(username);\n\t\t\treturn '';\n\t\t});\n\n\t\tif (mention.length > 0) {\n\t\t\tquery['mentions.username'] = {\n\t\t\t\t$regex: mention.join('|'),\n\t\t\t\t$options: 'i',\n\t\t\t};\n\t\t}\n\n\t\t// Filter on messages that are starred by the current user.\n\t\ttext = text.replace(/has:star/g, filterStarred);\n\t\t// Filter on messages that have an url.\n\t\ttext = text.replace(/has:url|has:link/g, filterUrl);\n\t\t// Filter on pinned messages.\n\t\ttext = text.replace(/is:pinned|has:pin/g, filterPinned);\n\t\t// Filter on messages which have a location attached.\n\t\ttext = text.replace(/has:location|has:map/g, filterLocation);\n\t\t// Filter image tags\n\t\ttext = text.replace(/label:(\\w+)/g, filterLabel);\n\t\t// Filtering before/after/on a date\n\t\t// matches dd-MM-yyyy, dd/MM/yyyy, dd-MM-yyyy, prefixed by before:, after: and on: respectively.\n\t\t// Example: before:15/09/2016 after: 10-08-2016\n\t\t// if \"on:\" is set, \"before:\" and \"after:\" are ignored.\n\t\ttext = text.replace(/before:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterBeforeDate);\n\t\ttext = text.replace(/after:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterAfterDate);\n\t\ttext = text.replace(/on:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterOnDate);\n\t\t// Sort order\n\t\ttext = text.replace(/(?:order|sort):(asc|ascend|ascending|desc|descend|descending)/g, sortByTimestamp);\n\n\t\t// Query in message text\n\t\ttext = text.trim().replace(/\\s\\s/g, ' ');\n\t\tif (text !== '') {\n\t\t\tif (/^\\/.+\\/[imxs]*$/.test(text)) {\n\t\t\t\tconst r = text.split('/');\n\t\t\t\tquery.msg = {\n\t\t\t\t\t$regex: r[1],\n\t\t\t\t\t$options: r[2],\n\t\t\t\t};\n\t\t\t} else if (RocketChat.settings.get('Message_AlwaysSearchRegExp')) {\n\t\t\t\tquery.msg = {\n\t\t\t\t\t$regex: text,\n\t\t\t\t\t$options: 'i',\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tquery.$text = {\n\t\t\t\t\t$search: text,\n\t\t\t\t};\n\t\t\t\toptions.fields = {\n\t\t\t\t\tscore: {\n\t\t\t\t\t\t$meta: 'textScore',\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (Object.keys(query).length > 0) {\n\t\t\tquery.t = {\n\t\t\t\t$ne: 'rm', // hide removed messages (useful when searching for user messages)\n\t\t\t};\n\t\t\tquery._hidden = {\n\t\t\t\t$ne: true, // don't return _hidden messages\n\t\t\t};\n\n\t\t\tif (rid) {\n\t\t\t\tquery.rid = rid;\n\t\t\t} else {\n\t\t\t\tquery.rid = {\n\t\t\t\t\t$in: RocketChat.models.Subscriptions.findByUserId(user._id)\n\t\t\t\t\t\t.fetch()\n\t\t\t\t\t\t.map((subscription) => subscription.rid),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\t\toptions.fields = {\n\t\t\t\t\teditedAt: 0,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tresult.message.docs = RocketChat.models.Messages.find(query, options).fetch();\n\t\t}\n\n\t\treturn result;\n\t},\n});\n","Meteor.methods({\n\tmigrateTo(version) {\n\t\tcheck(version, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'migrateTo',\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\tif (!user || RocketChat.authz.hasPermission(user._id, 'run-migration') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'migrateTo',\n\t\t\t});\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tRocketChat.Migrations.migrateTo(version);\n\n\t\treturn version;\n\t},\n\n\tgetMigrationVersion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getMigrationVersion',\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.Migrations.getVersion();\n\t},\n});\n","Meteor.methods({\n\tmuteUserInRoom(data) {\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String,\n\t\t}));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'muteUserInRoom',\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'mute-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'muteUserInRoom',\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'muteUserInRoom',\n\t\t\t});\n\t\t}\n\n\t\tif (['c', 'p'].includes(room.t) === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-room-type', `${ room.t } is not a valid room type`, {\n\t\t\t\tmethod: 'muteUserInRoom',\n\t\t\t\ttype: room.t,\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUsername(data.rid, data.username, { fields: { _id: 1 } });\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'muteUserInRoom',\n\t\t\t});\n\t\t}\n\n\t\tconst mutedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tRocketChat.models.Rooms.muteUsernameByRoomId(data.rid, mutedUser.username);\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserMutedWithRoomIdAndUser(data.rid, mutedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username,\n\t\t\t},\n\t\t});\n\n\t\treturn true;\n\t},\n});\n","Meteor.methods({\n\topenRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'openRoom',\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.openByRoomIdAndUserId(rid, Meteor.userId());\n\t},\n});\n","import { ReadReceipt } from '../../imports/message-read-receipt/server/lib/ReadReceipt';\n\nMeteor.methods({\n\treadMessages(rid) {\n\t\tcheck(rid, String);\n\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'readMessages',\n\t\t\t});\n\t\t}\n\n\t\t// this prevents cache from updating object reference/pointer\n\t\tconst userSubscription = Object.assign({}, RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, userId));\n\n\t\tRocketChat.models.Subscriptions.setAsReadByRoomIdAndUserId(rid, userId);\n\n\t\tMeteor.defer(() => {\n\t\t\tReadReceipt.markMessagesAsRead(rid, userId, userSubscription.ls);\n\t\t});\n\t},\n});\n","import s from 'underscore.string';\nimport * as Mailer from 'meteor/rocketchat:mailer';\nlet verifyEmailTemplate = '';\nMeteor.startup(() => {\n\tMailer.getTemplateWrapped('Verification_Email', (value) => {\n\t\tverifyEmailTemplate = value;\n\t});\n});\nMeteor.methods({\n\tregisterUser(formData) {\n\t\tconst AllowAnonymousRead = RocketChat.settings.get('Accounts_AllowAnonymousRead');\n\t\tconst AllowAnonymousWrite = RocketChat.settings.get('Accounts_AllowAnonymousWrite');\n\t\tconst manuallyApproveNewUsers = RocketChat.settings.get('Accounts_ManuallyApproveNewUsers');\n\t\tif (AllowAnonymousRead === true && AllowAnonymousWrite === true && formData.email == null) {\n\t\t\tconst userId = Accounts.insertUserDoc({}, {\n\t\t\t\tglobalRoles: [\n\t\t\t\t\t'anonymous',\n\t\t\t\t],\n\t\t\t});\n\n\t\t\tconst { id, token } = Accounts._loginUser(this, userId);\n\n\t\t\treturn { id, token };\n\t\t} else {\n\t\t\tcheck(formData, Match.ObjectIncluding({\n\t\t\t\temail: String,\n\t\t\t\tpass: String,\n\t\t\t\tname: String,\n\t\t\t\tsecretURL: Match.Optional(String),\n\t\t\t\treason: Match.Optional(String),\n\t\t\t}));\n\t\t}\n\n\t\tif (RocketChat.settings.get('Accounts_RegistrationForm') === 'Disabled') {\n\t\t\tthrow new Meteor.Error('error-user-registration-disabled', 'User registration is disabled', { method: 'registerUser' });\n\t\t} else if (RocketChat.settings.get('Accounts_RegistrationForm') === 'Secret URL' && (!formData.secretURL || formData.secretURL !== RocketChat.settings.get('Accounts_RegistrationForm_SecretURL'))) {\n\t\t\tthrow new Meteor.Error ('error-user-registration-secret', 'User registration is only allowed via Secret URL', { method: 'registerUser' });\n\t\t}\n\n\t\tRocketChat.passwordPolicy.validate(formData.pass);\n\n\t\tRocketChat.validateEmailDomain(formData.email);\n\n\t\tconst userData = {\n\t\t\temail: s.trim(formData.email.toLowerCase()),\n\t\t\tpassword: formData.pass,\n\t\t\tname: formData.name,\n\t\t\treason: formData.reason,\n\t\t};\n\n\t\t// Check if user has already been imported and never logged in. If so, set password and let it through\n\t\tconst importedUser = RocketChat.models.Users.findOneByEmailAddress(s.trim(formData.email.toLowerCase()));\n\t\tlet userId;\n\t\tif (importedUser && importedUser.importIds && importedUser.importIds.length && !importedUser.lastLogin) {\n\t\t\tAccounts.setPassword(importedUser._id, userData.password);\n\t\t\tuserId = importedUser._id;\n\t\t} else {\n\t\t\tuserId = Accounts.createUser(userData);\n\t\t}\n\n\t\tRocketChat.models.Users.setName(userId, s.trim(formData.name));\n\n\t\tconst reason = s.trim(formData.reason);\n\t\tif (manuallyApproveNewUsers && reason) {\n\t\t\tRocketChat.models.Users.setReason(userId, reason);\n\t\t}\n\n\t\tRocketChat.saveCustomFields(userId, formData);\n\n\t\ttry {\n\n\t\t\tconst subject = Mailer.replace(RocketChat.settings.get('Verification_Email_Subject'));\n\n\t\t\tAccounts.emailTemplates.verifyEmail.subject = () => subject;\n\t\t\tAccounts.emailTemplates.verifyEmail.html = (userModel, url) => Mailer.replace(Mailer.replacekey(verifyEmailTemplate, 'Verification_Url', url), userModel);\n\n\t\t\tAccounts.sendVerificationEmail(userId, userData.email);\n\t\t} catch (error) {\n\t\t\t// throw new Meteor.Error 'error-email-send-failed', 'Error trying to send email: ' + error.message, { method: 'registerUser', message: error.message }\n\t\t}\n\n\t\treturn userId;\n\t},\n});\n","Meteor.methods({\n\tremoveRoomLeader(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomLeader',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-leader', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomLeader',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomLeader',\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'removeRoomLeader',\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('leader') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-leader', 'User is not a leader', {\n\t\t\t\tmethod: 'removeRoomLeader',\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'leader');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username,\n\t\t\t},\n\t\t\trole: 'leader',\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'leader',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name,\n\t\t\t\t},\n\t\t\t\tscope: rid,\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t},\n});\n","Meteor.methods({\n\tremoveRoomModerator(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomModerator',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-moderator', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomModerator',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomModerator',\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'removeRoomModerator',\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === false || subscription.roles.includes('moderator') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-moderator', 'User is not a moderator', {\n\t\t\t\tmethod: 'removeRoomModerator',\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'moderator');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username,\n\t\t\t},\n\t\t\trole: 'moderator',\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'moderator',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name,\n\t\t\t\t},\n\t\t\t\tscope: rid,\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t},\n});\n","Meteor.methods({\n\tremoveRoomOwner(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-owner', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'removeRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === false || subscription.roles.includes('owner') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-owner', 'User is not an owner', {\n\t\t\t\tmethod: 'removeRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tconst numOwners = RocketChat.authz.getUsersInRole('owner', rid).count();\n\n\t\tif (numOwners === 1) {\n\t\t\tthrow new Meteor.Error('error-remove-last-owner', 'This is the last owner. Please set a new owner before removing this one.', {\n\t\t\t\tmethod: 'removeRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'owner');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username,\n\t\t\t},\n\t\t\trole: 'owner',\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'owner',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name,\n\t\t\t\t},\n\t\t\t\tscope: rid,\n\t\t\t});\n\t\t}\n\t\treturn true;\n\t},\n});\n","Meteor.methods({\n\tremoveUserFromRoom(data) {\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String,\n\t\t}));\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!fromId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeUserFromRoom',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'remove-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeUserFromRoom',\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room || room.t === 'd') {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeUserFromRoom',\n\t\t\t});\n\t\t}\n\n\t\tconst removedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(data.rid, removedUser._id, { fields: { _id: 1 } });\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'removeUserFromRoom',\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasRole(removedUser._id, 'owner', room._id)) {\n\t\t\tconst numOwners = RocketChat.authz.getUsersInRole('owner', room._id).fetch().length;\n\n\t\t\tif (numOwners === 1) {\n\t\t\t\tthrow new Meteor.Error('error-you-are-last-owner', 'You are the last owner. Please set new owner before leaving the room.', {\n\t\t\t\t\tmethod: 'removeUserFromRoom',\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeByRoomIdAndUserId(data.rid, removedUser._id);\n\n\t\tif (['c', 'p'].includes(room.t) === true) {\n\t\t\tRocketChat.authz.removeUserFromRoles(removedUser._id, ['moderator', 'owner'], data.rid);\n\t\t}\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserRemovedWithRoomIdAndUser(data.rid, removedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username,\n\t\t\t},\n\t\t});\n\n\t\treturn true;\n\t},\n});\n","Meteor.methods({\n\treportMessage(messageId, description) {\n\t\tcheck(messageId, String);\n\t\tcheck(description, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'reportMessage',\n\t\t\t});\n\t\t}\n\n\t\tif ((description == null) || description.trim() === '') {\n\t\t\tthrow new Meteor.Error('error-invalid-description', 'Invalid description', {\n\t\t\t\tmethod: 'reportMessage',\n\t\t\t});\n\t\t}\n\n\t\tconst message = RocketChat.models.Messages.findOneById(messageId);\n\t\tif (!message) {\n\t\t\tthrow new Meteor.Error('error-invalid-message_id', 'Invalid message id', {\n\t\t\t\tmethod: 'reportMessage',\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Reports.createWithMessageDescriptionAndUserId(message, description, Meteor.userId());\n\t},\n});\n","import fs from 'fs';\nimport path from 'path';\n\nlet tempFolder = '/tmp/userData';\nif (RocketChat.settings.get('UserData_FileSystemPath') != null) {\n\tif (RocketChat.settings.get('UserData_FileSystemPath').trim() !== '') {\n\t\ttempFolder = RocketChat.settings.get('UserData_FileSystemPath');\n\t}\n}\n\nMeteor.methods({\n\trequestDataDownload({ fullExport = false }) {\n\t\tconst currentUserData = Meteor.user();\n\t\tconst userId = currentUserData._id;\n\n\t\tconst lastOperation = RocketChat.models.ExportOperations.findLastOperationByUser(userId, fullExport);\n\n\t\tif (lastOperation) {\n\t\t\tconst yesterday = new Date();\n\t\t\tyesterday.setUTCDate(yesterday.getUTCDate() - 1);\n\n\t\t\tif (lastOperation.createdAt > yesterday) {\n\t\t\t\treturn {\n\t\t\t\t\trequested: false,\n\t\t\t\t\texportOperation: lastOperation,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (!fs.existsSync(tempFolder)) {\n\t\t\tfs.mkdirSync(tempFolder);\n\t\t}\n\n\t\tconst subFolderName = fullExport ? 'full' : 'partial';\n\t\tconst baseFolder = path.join(tempFolder, userId);\n\t\tif (!fs.existsSync(baseFolder)) {\n\t\t\tfs.mkdirSync(baseFolder);\n\t\t}\n\n\t\tconst folderName = path.join(baseFolder, subFolderName);\n\t\tif (!fs.existsSync(folderName)) {\n\t\t\tfs.mkdirSync(folderName);\n\t\t}\n\t\tconst assetsFolder = path.join(folderName, 'assets');\n\t\tif (!fs.existsSync(assetsFolder)) {\n\t\t\tfs.mkdirSync(assetsFolder);\n\t\t}\n\n\t\tconst exportOperation = {\n\t\t\tuserId : currentUserData._id,\n\t\t\troomList: null,\n\t\t\tstatus: 'pending',\n\t\t\texportPath: folderName,\n\t\t\tassetsPath: assetsFolder,\n\t\t\tfileList: [],\n\t\t\tgeneratedFile: null,\n\t\t\tfullExport,\n\t\t};\n\n\t\tRocketChat.models.ExportOperations.create(exportOperation);\n\n\t\treturn {\n\t\t\trequested: true,\n\t\t\texportOperation,\n\t\t};\n\t},\n});\n","Meteor.methods({\n\tresetAvatar() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'resetAvatar',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserAvatarChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'resetAvatar',\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tFileUpload.getStore('Avatars').deleteByName(user.username);\n\t\tRocketChat.models.Users.unsetAvatarOrigin(user._id);\n\t\tRocketChat.Notifications.notifyLogged('updateAvatar', {\n\t\t\tusername: user.username,\n\t\t});\n\t},\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'resetAvatar',\n\tuserId() {\n\t\treturn true;\n\t},\n}, 1, 60000);\n","Meteor.methods({\n\troomNameExists(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'roomExists',\n\t\t\t});\n\t\t}\n\t\tconst room = RocketChat.models.Rooms.findOneByName(rid);\n\t\treturn !!room;\n\t},\n});\n","Meteor.methods({\n\tsaveUserPreferences(settings) {\n\t\tconst keys = {\n\t\t\tlanguage: Match.Optional(String),\n\t\t\tnewRoomNotification: Match.Optional(String),\n\t\t\tnewMessageNotification: Match.Optional(String),\n\t\t\tclockMode: Match.Optional(Number),\n\t\t\tuseEmojis: Match.Optional(Boolean),\n\t\t\tconvertAsciiEmoji: Match.Optional(Boolean),\n\t\t\tsaveMobileBandwidth: Match.Optional(Boolean),\n\t\t\tcollapseMediaByDefault: Match.Optional(Boolean),\n\t\t\tautoImageLoad: Match.Optional(Boolean),\n\t\t\temailNotificationMode: Match.Optional(String),\n\t\t\tunreadAlert: Match.Optional(Boolean),\n\t\t\tnotificationsSoundVolume: Match.Optional(Number),\n\t\t\tdesktopNotifications: Match.Optional(String),\n\t\t\tmobileNotifications: Match.Optional(String),\n\t\t\tenableAutoAway: Match.Optional(Boolean),\n\t\t\thighlights: Match.Optional([String]),\n\t\t\tdesktopNotificationDuration: Match.Optional(Number),\n\t\t\tmessageViewMode: Match.Optional(Number),\n\t\t\thideUsernames: Match.Optional(Boolean),\n\t\t\thideRoles: Match.Optional(Boolean),\n\t\t\thideAvatars: Match.Optional(Boolean),\n\t\t\thideFlexTab: Match.Optional(Boolean),\n\t\t\tsendOnEnter: Match.Optional(String),\n\t\t\troomCounterSidebar: Match.Optional(Boolean),\n\t\t\tidleTimeLimit: Match.Optional(Number),\n\t\t\tsidebarShowFavorites: Match.Optional(Boolean),\n\t\t\tsidebarShowUnread: Match.Optional(Boolean),\n\t\t\tsidebarSortby: Match.Optional(String),\n\t\t\tsidebarViewMode: Match.Optional(String),\n\t\t\tsidebarHideAvatar: Match.Optional(Boolean),\n\t\t\tsidebarGroupByType: Match.Optional(Boolean),\n\t\t\tmuteFocusedConversations: Match.Optional(Boolean),\n\t\t};\n\t\tcheck(settings, Match.ObjectIncluding(keys));\n\t\tconst user = Meteor.user();\n\n\t\tif (!user) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst {\n\t\t\tdesktopNotifications: oldDesktopNotifications,\n\t\t\tmobileNotifications: oldMobileNotifications,\n\t\t\temailNotificationMode: oldEmailNotifications,\n\t\t} = (user.settings && user.settings.preferences) || {};\n\n\t\tif (user.settings == null) {\n\t\t\tRocketChat.models.Users.clearSettings(user._id);\n\t\t}\n\n\t\tif (settings.language != null) {\n\t\t\tRocketChat.models.Users.setLanguage(user._id, settings.language);\n\t\t}\n\n\t\t// Keep compatibility with old values\n\t\tif (settings.emailNotificationMode === 'all') {\n\t\t\tsettings.emailNotificationMode = 'mentions';\n\t\t} else if (settings.emailNotificationMode === 'disabled') {\n\t\t\tsettings.emailNotificationMode = 'nothing';\n\t\t}\n\n\t\tif (settings.idleTimeLimit != null && settings.idleTimeLimit < 60) {\n\t\t\tthrow new Meteor.Error('invalid-idle-time-limit-value', 'Invalid idleTimeLimit');\n\t\t}\n\n\t\tRocketChat.models.Users.setPreferences(user._id, settings);\n\n\t\t// propagate changed notification preferences\n\t\tMeteor.defer(() => {\n\t\t\tif (settings.desktopNotifications && oldDesktopNotifications !== settings.desktopNotifications) {\n\t\t\t\tif (settings.desktopNotifications === 'default') {\n\t\t\t\t\tRocketChat.models.Subscriptions.clearDesktopNotificationUserPreferences(user._id);\n\t\t\t\t} else {\n\t\t\t\t\tRocketChat.models.Subscriptions.updateDesktopNotificationUserPreferences(user._id, settings.desktopNotifications);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (settings.mobileNotifications && oldMobileNotifications !== settings.mobileNotifications) {\n\t\t\t\tif (settings.mobileNotifications === 'default') {\n\t\t\t\t\tRocketChat.models.Subscriptions.clearMobileNotificationUserPreferences(user._id);\n\t\t\t\t} else {\n\t\t\t\t\tRocketChat.models.Subscriptions.updateMobileNotificationUserPreferences(user._id, settings.mobileNotifications);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (settings.emailNotificationMode && oldEmailNotifications !== settings.emailNotificationMode) {\n\t\t\t\tif (settings.emailNotificationMode === 'default') {\n\t\t\t\t\tRocketChat.models.Subscriptions.clearEmailNotificationUserPreferences(user._id);\n\t\t\t\t} else {\n\t\t\t\t\tRocketChat.models.Subscriptions.updateEmailNotificationUserPreferences(user._id, settings.emailNotificationMode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (Array.isArray(settings.highlights)) {\n\t\t\t\tRocketChat.models.Subscriptions.updateUserHighlights(user._id, settings.highlights);\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t},\n});\n","Meteor.methods({\n\tsaveUserProfile(settings, customFields) {\n\t\tcheck(settings, Object);\n\t\tcheck(customFields, Match.Maybe(Object));\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserProfileChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'saveUserProfile',\n\t\t\t});\n\t\t}\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'saveUserProfile',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tfunction checkPassword(user = {}, typedPassword) {\n\t\t\tif (!(user.services && user.services.password && user.services.password.bcrypt && user.services.password.bcrypt.trim())) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst passCheck = Accounts._checkPassword(user, {\n\t\t\t\tdigest: typedPassword,\n\t\t\t\talgorithm: 'sha-256',\n\t\t\t});\n\n\t\t\tif (passCheck.error) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tif (settings.realname) {\n\t\t\tMeteor.call('setRealName', settings.realname);\n\t\t}\n\n\t\tif (settings.username) {\n\t\t\tMeteor.call('setUsername', settings.username);\n\t\t}\n\n\t\tif (settings.email) {\n\t\t\tif (!checkPassword(user, settings.typedPassword)) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', {\n\t\t\t\t\tmethod: 'saveUserProfile',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tMeteor.call('setEmail', settings.email);\n\t\t}\n\n\t\t// Should be the last check to prevent error when trying to check password for users without password\n\t\tif ((settings.newPassword) && RocketChat.settings.get('Accounts_AllowPasswordChange') === true) {\n\t\t\tif (!checkPassword(user, settings.typedPassword)) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', {\n\t\t\t\t\tmethod: 'saveUserProfile',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tRocketChat.passwordPolicy.validate(settings.newPassword);\n\n\t\t\tAccounts.setPassword(Meteor.userId(), settings.newPassword, {\n\t\t\t\tlogout: false,\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Users.setProfile(Meteor.userId(), {});\n\n\t\tif (customFields && Object.keys(customFields).length) {\n\t\t\tRocketChat.saveCustomFields(Meteor.userId(), customFields);\n\t\t}\n\n\t\treturn true;\n\t},\n});\n","import * as Mailer from 'meteor/rocketchat:mailer';\n\nlet subject = '';\nlet html = '';\n\nMeteor.startup(() => {\n\tRocketChat.settings.get('Verification_Email_Subject', function(key, value) {\n\t\tsubject = Mailer.replace(value || '');\n\t});\n\n\tMailer.getTemplateWrapped('Verification_Email', function(value) {\n\t\thtml = value;\n\t});\n});\n\nMeteor.methods({\n\tsendConfirmationEmail(to) {\n\t\tcheck(to, String);\n\t\tconst email = to.trim();\n\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(email);\n\n\t\tif (!user) {\n\t\t\treturn false;\n\t\t}\n\n\t\tAccounts.emailTemplates.verifyEmail.subject = function(/* userModel*/) {\n\t\t\treturn subject;\n\t\t};\n\n\t\tAccounts.emailTemplates.verifyEmail.html = function(userModel, url) {\n\t\t\treturn Mailer.replace(html, { Verification_Url:url, name: user.name });\n\t\t};\n\n\t\ttry {\n\t\t\treturn Accounts.sendVerificationEmail(user._id, email);\n\t\t} catch (error) {\n\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ error.message }`, {\n\t\t\t\tmethod: 'registerUser',\n\t\t\t\tmessage: error.message,\n\t\t\t});\n\t\t}\n\n\t},\n});\n","import s from 'underscore.string';\nimport * as Mailer from 'meteor/rocketchat:mailer';\n\nlet template = '';\n\nMeteor.startup(() => {\n\tMailer.getTemplateWrapped('Forgot_Password_Email', (value) => {\n\t\ttemplate = value;\n\t});\n});\n\nMeteor.methods({\n\tsendForgotPasswordEmail(to) {\n\t\tcheck(to, String);\n\n\t\tlet email = to.trim();\n\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(email);\n\n\t\tif (!user) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst regex = new RegExp(`^${ s.escapeRegExp(email) }$`, 'i');\n\t\temail = (user.emails || []).map((item) => item.address).find((userEmail) => regex.test(userEmail));\n\n\t\tconst subject = Mailer.replace(RocketChat.settings.get('Forgot_Password_Email_Subject') || '', {\n\t\t\tname: user.name,\n\t\t\temail,\n\t\t});\n\n\t\tconst html = Mailer.replace(template, {\n\t\t\tname: user.name,\n\t\t\temail,\n\t\t});\n\n\t\tAccounts.emailTemplates.from = `${ RocketChat.settings.get('Site_Name') } <${ RocketChat.settings.get('From_Email') }>`;\n\n\t\ttry {\n\n\t\t\tAccounts.emailTemplates.resetPassword.subject = function(/* userModel*/) {\n\t\t\t\treturn subject; // TODO check a better way to do this\n\t\t\t};\n\n\t\t\tAccounts.emailTemplates.resetPassword.html = function(userModel, url) {\n\t\t\t\treturn Mailer.replacekey(html, 'Forgot_Password_Url', url);\n\t\t\t};\n\t\t\treturn Accounts.sendResetPasswordEmail(user._id, email);\n\t\t} catch (error) {\n\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ error.message }`, {\n\t\t\t\tmethod: 'registerUser',\n\t\t\t\tmessage: error.message,\n\t\t\t});\n\t\t}\n\t},\n});\n","Meteor.methods({\n\tsetAvatarFromService(dataURI, contentType, service) {\n\t\tcheck(dataURI, String);\n\t\tcheck(contentType, Match.Optional(String));\n\t\tcheck(service, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setAvatarFromService',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserAvatarChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setAvatarFromService',\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\treturn RocketChat.setUserAvatar(user, dataURI, contentType, service);\n\t},\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'setAvatarFromService',\n\tuserId() {\n\t\treturn true;\n\t},\n}, 1, 5000);\n","import * as Mailer from 'meteor/rocketchat:mailer';\n\nMeteor.methods({\n\tsetUserActiveStatus(userId, active) {\n\t\tcheck(userId, String);\n\t\tcheck(active, Boolean);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setUserActiveStatus',\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'edit-other-user-active-status') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setUserActiveStatus',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user) {\n\t\t\treturn false;\n\t\t}\n\n\t\tRocketChat.models.Users.setUserActive(userId, active);\n\n\t\tif (user.username) {\n\t\t\tRocketChat.models.Subscriptions.setArchivedByUsername(user.username, !active);\n\t\t}\n\n\t\tif (active === false) {\n\t\t\tRocketChat.models.Users.unsetLoginTokens(userId);\n\t\t} else {\n\t\t\tRocketChat.models.Users.unsetReason(userId);\n\t\t}\n\n\t\tconst destinations = Array.isArray(user.emails) && user.emails.map((email) => `${ user.name || user.username }<${ email.address }>`);\n\n\n\t\tconst email = {\n\t\t\tto: destinations,\n\t\t\tfrom: RocketChat.settings.get('From_Email'),\n\t\t\tsubject: Accounts.emailTemplates.userActivated.subject({ active }),\n\t\t\thtml: Accounts.emailTemplates.userActivated.html({ active, name: user.name, username: user.username }),\n\t\t};\n\n\t\tMailer.sendNoWrap(email);\n\n\n\t\treturn true;\n\n\t},\n});\n","Meteor.methods({\n\tsetUserPassword(password) {\n\t\tcheck(password, String);\n\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setUserPassword',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (user && user.requirePasswordChange !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setUserPassword',\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.passwordPolicy.validate(password);\n\n\t\tAccounts.setPassword(userId, password, {\n\t\t\tlogout: false,\n\t\t});\n\n\t\treturn RocketChat.models.Users.unsetRequirePasswordChange(userId);\n\t},\n});\n","Meteor.methods({\n\ttoggleFavorite(rid, f) {\n\t\tcheck(rid, String);\n\n\t\tcheck(f, Match.Optional(Boolean));\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'toggleFavorite',\n\t\t\t});\n\t\t}\n\n\t\tconst userSubscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, Meteor.userId());\n\t\tif (!userSubscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-subscription',\n\t\t\t\t'You must be part of a room to favorite it',\n\t\t\t\t{ method: 'toggleFavorite' }\n\t\t\t);\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.setFavoriteByRoomIdAndUserId(rid, Meteor.userId(), f);\n\t},\n});\n","Meteor.methods({\n\tunmuteUserInRoom(data) {\n\t\tconst fromId = Meteor.userId();\n\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String,\n\t\t}));\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'mute-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'unmuteUserInRoom',\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'unmuteUserInRoom',\n\t\t\t});\n\t\t}\n\n\t\tif (['c', 'p'].includes(room.t) === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-room-type', `${ room.t } is not a valid room type`, {\n\t\t\t\tmethod: 'unmuteUserInRoom',\n\t\t\t\ttype: room.t,\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUsername(data.rid, data.username, { fields: { _id: 1 } });\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'unmuteUserInRoom',\n\t\t\t});\n\t\t}\n\n\t\tconst unmutedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tRocketChat.models.Rooms.unmuteUsernameByRoomId(data.rid, unmutedUser.username);\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserUnmutedWithRoomIdAndUser(data.rid, unmutedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username,\n\t\t\t},\n\t\t});\n\n\t\treturn true;\n\t},\n});\n","Meteor.methods({\n\tuserSetUtcOffset(utcOffset) {\n\t\tcheck(utcOffset, Number);\n\n\t\tif (this.userId == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.unblock();\n\n\t\treturn RocketChat.models.Users.setUtcOffset(this.userId, utcOffset);\n\t},\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'userSetUtcOffset',\n\tuserId() {\n\t\treturn true;\n\t},\n}, 1, 60000);\n","Meteor.publish('activeUsers', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Users.findUsersNotOffline({\n\t\tfields: {\n\t\t\tusername: 1,\n\t\t\tname: 1,\n\t\t\tstatus: 1,\n\t\t\tutcOffset: 1,\n\t\t},\n\t});\n});\n","Meteor.publish('channelAndPrivateAutocomplete', function(selector) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\tconst pub = this;\n\tconst options = {\n\t\tfields: {\n\t\t\t_id: 1,\n\t\t\tname: 1,\n\t\t},\n\t\tlimit: 10,\n\t\tsort: {\n\t\t\tname: 1,\n\t\t},\n\t};\n\n\tconst cursorHandle = RocketChat.models.Rooms.findChannelAndPrivateByNameStarting(selector.name, options).observeChanges({\n\t\tadded(_id, record) {\n\t\t\treturn pub.added('autocompleteRecords', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\treturn pub.changed('autocompleteRecords', _id, record);\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('autocompleteRecords', _id, record);\n\t\t},\n\t});\n\n\tthis.ready();\n\n\tthis.onStop(function() {\n\t\treturn cursorHandle.stop();\n\t});\n});\n","Meteor.publish('fullUserData', function(filter, limit) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst result = RocketChat.getFullUserData({\n\t\tuserId: this.userId,\n\t\tfilter,\n\t\tlimit,\n\t});\n\n\tif (!result) {\n\t\treturn this.ready();\n\t}\n\n\treturn result;\n});\n","import _ from 'underscore';\n\nMeteor.publish('messages', function(rid/* , start*/) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst publication = this;\n\n\tif (typeof rid !== 'string') {\n\t\treturn this.ready();\n\t}\n\n\tif (!Meteor.call('canAccessRoom', rid, this.userId)) {\n\t\treturn this.ready();\n\t}\n\n\tconst cursor = RocketChat.models.Messages.findVisibleByRoomId(rid, {\n\t\tsort: {\n\t\t\tts: -1,\n\t\t},\n\t\tlimit: 50,\n\t});\n\n\tconst cursorHandle = cursor.observeChanges({\n\t\tadded(_id, record) {\n\t\t\trecord.starred = _.findWhere(record.starred, {\n\t\t\t\t_id: publication.userId,\n\t\t\t});\n\t\t\treturn publication.added('rocketchat_message', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\trecord.starred = _.findWhere(record.starred, {\n\t\t\t\t_id: publication.userId,\n\t\t\t});\n\t\t\treturn publication.changed('rocketchat_message', _id, record);\n\t\t},\n\t});\n\n\tconst cursorDelete = RocketChat.models.Messages.findInvisibleByRoomId(rid, {\n\t\tfields: {\n\t\t\t_id: 1,\n\t\t},\n\t});\n\n\tconst cursorDeleteHandle = cursorDelete.observeChanges({\n\t\tadded(_id/* , record*/) {\n\t\t\treturn publication.added('rocketchat_message', _id, {\n\t\t\t\t_hidden: true,\n\t\t\t});\n\t\t},\n\t\tchanged(_id/* , record*/) {\n\t\t\treturn publication.added('rocketchat_message', _id, {\n\t\t\t\t_hidden: true,\n\t\t\t});\n\t\t},\n\t});\n\n\tthis.ready();\n\n\treturn this.onStop(function() {\n\t\tcursorHandle.stop();\n\t\treturn cursorDeleteHandle.stop();\n\t});\n});\n\nMeteor.methods({\n\t'messages/get'(rid, { lastUpdate, latestDate = new Date(), oldestDate, inclusive = false, count = 20, unreads = false }) {\n\t\tcheck(rid, String);\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!fromId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'messages/get',\n\t\t\t});\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'messages/get',\n\t\t\t});\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1,\n\t\t\t},\n\t\t};\n\n\t\tif (lastUpdate instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdated: RocketChat.models.Messages.findForUpdates(rid, lastUpdate, options).fetch(),\n\t\t\t\tdeleted: RocketChat.models.Messages.trashFindDeletedAfter(lastUpdate, { rid }, { ...options, fields: { _id: 1, _deletedAt: 1 } }).fetch(),\n\t\t\t};\n\t\t}\n\n\t\treturn Meteor.call('getChannelHistory', { rid, latest: latestDate, oldest: oldestDate, inclusive, count, unreads });\n\n\t},\n});\n","import _ from 'underscore';\n\nconst fields = {\n\t_id: 1,\n\tname: 1,\n\tfname: 1,\n\tt: 1,\n\tcl: 1,\n\tu: 1,\n\t// usernames: 1,\n\ttopic: 1,\n\tannouncement: 1,\n\tannouncementDetails: 1,\n\tmuted: 1,\n\t_updatedAt: 1,\n\tarchived: 1,\n\tjitsiTimeout: 1,\n\tdescription: 1,\n\tdefault: 1,\n\tcustomFields: 1,\n\tlastMessage: 1,\n\tretention: 1,\n\n\t// @TODO create an API to register this fields based on room type\n\tlivechatData: 1,\n\ttags: 1,\n\tsms: 1,\n\tfacebook: 1,\n\tcode: 1,\n\tjoinCodeRequired: 1,\n\topen: 1,\n\tv: 1,\n\tlabel: 1,\n\tro: 1,\n\treactWhenReadOnly: 1,\n\tsysMes: 1,\n\tsentiment: 1,\n\ttokenpass: 1,\n\tstreamingOptions: 1,\n\tbroadcast: 1,\n\tencrypted: 1,\n\te2eKeyId: 1,\n};\n\nconst roomMap = (record) => {\n\tif (record) {\n\t\treturn _.pick(record, ...Object.keys(fields));\n\t}\n\treturn {};\n};\n\nMeteor.methods({\n\t'rooms/get'(updatedAt) {\n\t\tlet options = { fields };\n\n\t\tif (!Meteor.userId()) {\n\t\t\tif (RocketChat.settings.get('Accounts_AllowAnonymousRead') === true) {\n\t\t\t\treturn RocketChat.models.Rooms.findByDefaultAndTypes(true, ['c'], options).fetch();\n\t\t\t}\n\t\t\treturn [];\n\t\t}\n\n\t\tthis.unblock();\n\n\t\toptions = {\n\t\t\tfields,\n\t\t};\n\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: RocketChat.models.Rooms.findBySubscriptionUserIdUpdatedAfter(Meteor.userId(), updatedAt, options).fetch(),\n\t\t\t\tremove: RocketChat.models.Rooms.trashFindDeletedAfter(updatedAt, {}, { fields: { _id: 1, _deletedAt: 1 } }).fetch(),\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.models.Rooms.findBySubscriptionUserId(Meteor.userId(), options).fetch();\n\t},\n\n\tgetRoomByTypeAndName(type, name) {\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\tconst roomFind = RocketChat.roomTypes.getRoomFind(type);\n\n\t\tlet room;\n\n\t\tif (roomFind) {\n\t\t\troom = roomFind.call(this, name);\n\t\t} else {\n\t\t\troom = RocketChat.models.Rooms.findByTypeAndName(type, name).fetch();\n\t\t}\n\n\t\tif (!room || room.length === 0) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\troom = room[0];\n\n\t\tif (!Meteor.call('canAccessRoom', room._id, userId)) {\n\t\t\tthrow new Meteor.Error('error-no-permission', 'No permission', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\tif (RocketChat.settings.get('Store_Last_Message') && !RocketChat.authz.hasPermission(userId, 'preview-c-room')) {\n\t\t\tdelete room.lastMessage;\n\t\t}\n\n\t\treturn roomMap(room);\n\t},\n});\n\nRocketChat.models.Rooms.on('change', ({ clientAction, id, data }) => {\n\tswitch (clientAction) {\n\t\tcase 'updated':\n\t\tcase 'inserted':\n\t\t\t// Override data cuz we do not publish all fields\n\t\t\tdata = RocketChat.models.Rooms.findOneById(id, { fields });\n\t\t\tbreak;\n\n\t\tcase 'removed':\n\t\t\tdata = { _id: id };\n\t\t\tbreak;\n\t}\n\n\tif (data) {\n\t\tRocketChat.models.Subscriptions.findByRoomId(id, { fields: { 'u._id': 1 } }).forEach(({ u }) => {\n\t\t\tRocketChat.Notifications.notifyUserInThisInstance(u._id, 'rooms-changed', clientAction, data);\n\t\t});\n\t}\n});\n","import { roomFiles } from '../lib/roomFiles';\n\nMeteor.publish('roomFiles', function(rid, limit = 50) {\n\treturn roomFiles(this, { rid, limit });\n});\n","import { roomFiles } from '../lib/roomFiles';\n\nMeteor.publish('roomFilesWithSearchText', function(rid, searchText, limit = 50) {\n\treturn roomFiles(this, { rid, searchText, limit });\n});\n","Meteor.publish('roomSubscriptionsByRole', function(rid, role) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Subscriptions.findByRoomIdAndRoles(rid, role, {\n\t\tfields: {\n\t\t\trid: 1,\n\t\t\tname: 1,\n\t\t\troles: 1,\n\t\t\tu: 1,\n\t\t},\n\t\tsort: {\n\t\t\tname: 1,\n\t\t},\n\t});\n});\n","import s from 'underscore.string';\n\nfunction fetchRooms(userId, rooms) {\n\tif (!RocketChat.settings.get('Store_Last_Message') || RocketChat.authz.hasPermission(userId, 'preview-c-room')) {\n\t\treturn rooms;\n\t}\n\n\treturn rooms.map((room) => {\n\t\tdelete room.lastMessage;\n\t\treturn room;\n\t});\n}\n\nMeteor.methods({\n\tspotlight(text, usernames, type = { users: true, rooms: true }, rid) {\n\t\tconst searchForChannels = text[0] === '#';\n\t\tconst searchForDMs = text[0] === '@';\n\t\tif (searchForChannels) {\n\t\t\ttype.users = false;\n\t\t\ttext = text.slice(1);\n\t\t}\n\t\tif (searchForDMs) {\n\t\t\ttype.rooms = false;\n\t\t\ttext = text.slice(1);\n\t\t}\n\t\tconst regex = new RegExp(s.trim(s.escapeRegExp(text)), 'i');\n\t\tconst result = {\n\t\t\tusers: [],\n\t\t\trooms: [],\n\t\t};\n\t\tconst roomOptions = {\n\t\t\tlimit: 5,\n\t\t\tfields: {\n\t\t\t\tt: 1,\n\t\t\t\tname: 1,\n\t\t\t\tlastMessage: 1,\n\t\t\t},\n\t\t\tsort: {\n\t\t\t\tname: 1,\n\t\t\t},\n\t\t};\n\t\tconst { userId } = this;\n\t\tif (userId == null) {\n\t\t\tif (RocketChat.settings.get('Accounts_AllowAnonymousRead') === true) {\n\t\t\t\tresult.rooms = fetchRooms(userId, RocketChat.models.Rooms.findByNameAndTypeNotDefault(regex, 'c', roomOptions).fetch());\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\tconst userOptions = {\n\t\t\tlimit: 5,\n\t\t\tfields: {\n\t\t\t\tusername: 1,\n\t\t\t\tname: 1,\n\t\t\t\tstatus: 1,\n\t\t\t},\n\t\t\tsort: {},\n\t\t};\n\t\tif (RocketChat.settings.get('UI_Use_Real_Name')) {\n\t\t\tuserOptions.sort.name = 1;\n\t\t} else {\n\t\t\tuserOptions.sort.username = 1;\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(userId, 'view-outside-room')) {\n\t\t\tif (type.users === true && RocketChat.authz.hasPermission(userId, 'view-d-room')) {\n\t\t\t\tresult.users = RocketChat.models.Users.findByActiveUsersExcept(text, usernames, userOptions).fetch();\n\t\t\t}\n\n\t\t\tif (type.rooms === true && RocketChat.authz.hasPermission(userId, 'view-c-room')) {\n\t\t\t\tconst searchableRoomTypes = Object.entries(RocketChat.roomTypes.roomTypes)\n\t\t\t\t\t.filter((roomType) => roomType[1].includeInRoomSearch())\n\t\t\t\t\t.map((roomType) => roomType[0]);\n\n\t\t\t\tconst roomIds = RocketChat.models.Subscriptions.findByUserIdAndTypes(userId, searchableRoomTypes, { fields: { rid: 1 } }).fetch().map((s) => s.rid);\n\t\t\t\tresult.rooms = fetchRooms(userId, RocketChat.models.Rooms.findByNameAndTypesNotInIds(regex, searchableRoomTypes, roomIds, roomOptions).fetch());\n\t\t\t}\n\t\t} else if (type.users === true && rid) {\n\t\t\tconst subscriptions = RocketChat.models.Subscriptions.find({\n\t\t\t\trid, 'u.username': {\n\t\t\t\t\t$regex: regex,\n\t\t\t\t\t$nin: [...usernames, Meteor.user().username],\n\t\t\t\t},\n\t\t\t}, { limit: userOptions.limit }).fetch().map(({ u }) => u._id);\n\t\t\tresult.users = RocketChat.models.Users.find({ _id: { $in: subscriptions } }, {\n\t\t\t\tfields: userOptions.fields,\n\t\t\t\tsort: userOptions.sort,\n\t\t\t}).fetch();\n\t\t}\n\n\t\treturn result;\n\t},\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'spotlight',\n\tuserId(/* userId*/) {\n\t\treturn true;\n\t},\n}, 100, 100000);\n","const fields = {\n\tt: 1,\n\tts: 1,\n\tls: 1,\n\tname: 1,\n\tfname: 1,\n\trid: 1,\n\tcode: 1,\n\tf: 1,\n\tu: 1,\n\topen: 1,\n\talert: 1,\n\troles: 1,\n\tunread: 1,\n\tuserMentions: 1,\n\tgroupMentions: 1,\n\tarchived: 1,\n\taudioNotifications: 1,\n\taudioNotificationValue: 1,\n\tdesktopNotifications: 1,\n\tdesktopNotificationDuration: 1,\n\tmobilePushNotifications: 1,\n\temailNotifications: 1,\n\tunreadAlert: 1,\n\t_updatedAt: 1,\n\tblocked: 1,\n\tblocker: 1,\n\tautoTranslate: 1,\n\tautoTranslateLanguage: 1,\n\tdisableNotifications: 1,\n\thideUnreadStatus: 1,\n\tmuteGroupMentions: 1,\n\tignored: 1,\n\tE2EKey: 1,\n};\n\nMeteor.methods({\n\t'subscriptions/get'(updatedAt) {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn [];\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tconst options = { fields };\n\n\t\tconst records = RocketChat.models.Subscriptions.findByUserId(Meteor.userId(), options).fetch();\n\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: records.filter(function(record) {\n\t\t\t\t\treturn record._updatedAt > updatedAt;\n\t\t\t\t}),\n\t\t\t\tremove: RocketChat.models.Subscriptions.trashFindDeletedAfter(updatedAt, {\n\t\t\t\t\t'u._id': Meteor.userId(),\n\t\t\t\t}, {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\t_id: 1,\n\t\t\t\t\t\t_deletedAt: 1,\n\t\t\t\t\t},\n\t\t\t\t}).fetch(),\n\t\t\t};\n\t\t}\n\n\t\treturn records;\n\t},\n});\n\nRocketChat.models.Subscriptions.on('change', ({ clientAction, id, data }) => {\n\tswitch (clientAction) {\n\t\tcase 'updated':\n\t\tcase 'inserted':\n\t\t\t// Override data cuz we do not publish all fields\n\t\t\tdata = RocketChat.models.Subscriptions.findOneById(id, { fields });\n\t\t\tbreak;\n\n\t\tcase 'removed':\n\t\t\tdata = RocketChat.models.Subscriptions.trashFindOneById(id, { fields: { u: 1 } });\n\t\t\tbreak;\n\t}\n\n\tRocketChat.Notifications.notifyUserInThisInstance(data.u._id, 'subscriptions-changed', clientAction, data);\n});\n","import _ from 'underscore';\n\nMeteor.publish('userAutocomplete', function(selector) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (!_.isObject(selector)) {\n\t\treturn this.ready();\n\t}\n\n\tconst options = {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tusername: 1,\n\t\t\tstatus: 1,\n\t\t},\n\t\tsort: {\n\t\t\tusername: 1,\n\t\t},\n\t\tlimit: 10,\n\t};\n\n\tconst pub = this;\n\tconst exceptions = selector.exceptions || [];\n\n\tconst cursorHandle = RocketChat.models.Users.findActiveByUsernameOrNameRegexWithExceptions(selector.term, exceptions, options).observeChanges({\n\t\tadded(_id, record) {\n\t\t\treturn pub.added('autocompleteRecords', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\treturn pub.changed('autocompleteRecords', _id, record);\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('autocompleteRecords', _id, record);\n\t\t},\n\t});\n\n\tthis.ready();\n\n\tthis.onStop(function() {\n\t\treturn cursorHandle.stop();\n\t});\n});\n","Meteor.publish('userChannels', function(userId) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Subscriptions.findByUserId(userId, {\n\t\tfields: {\n\t\t\trid: 1,\n\t\t\tname: 1,\n\t\t\tt: 1,\n\t\t\tu: 1,\n\t\t},\n\t\tsort: {\n\t\t\tt: 1,\n\t\t\tname: 1,\n\t\t},\n\t});\n});\n","Meteor.publish('userData', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Users.find(this.userId, {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tusername: 1,\n\t\t\tstatus: 1,\n\t\t\tstatusDefault: 1,\n\t\t\tstatusConnection: 1,\n\t\t\tavatarOrigin: 1,\n\t\t\tutcOffset: 1,\n\t\t\tlanguage: 1,\n\t\t\tsettings: 1,\n\t\t\tenableAutoAway: 1,\n\t\t\tidleTimeLimit: 1,\n\t\t\troles: 1,\n\t\t\tactive: 1,\n\t\t\tdefaultRoom: 1,\n\t\t\tcustomFields: 1,\n\t\t\t'services.github': 1,\n\t\t\t'services.gitlab': 1,\n\t\t\t'services.tokenpass': 1,\n\t\t\t'services.blockstack': 1,\n\t\t\trequirePasswordChange: 1,\n\t\t\trequirePasswordChangeReason: 1,\n\t\t\t'services.password.bcrypt': 1,\n\t\t\t'services.totp.enabled': 1,\n\t\t\tstatusLivechat: 1,\n\t\t\tbanners: 1,\n\t\t},\n\t});\n});\n","const msgStream = new Meteor.Streamer('room-messages');\nthis.msgStream = msgStream;\n\nmsgStream.allowWrite('none');\n\nmsgStream.allowRead(function(eventName, args) {\n\ttry {\n\t\tconst room = Meteor.call('canAccessRoom', eventName, this.userId, args);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (room.t === 'c' && !RocketChat.authz.hasPermission(this.userId, 'preview-c-room') && !RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(room._id, this.userId, { fields: { _id: 1 } })) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (error) {\n\t\t/* error*/\n\t\treturn false;\n\t}\n});\n\nmsgStream.allowRead('__my_messages__', 'all');\n\nmsgStream.allowEmit('__my_messages__', function(eventName, msg, options) {\n\ttry {\n\t\tconst room = Meteor.call('canAccessRoom', msg.rid, this.userId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\toptions.roomParticipant = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(room._id, this.userId, { fields: { _id: 1 } }) != null;\n\t\toptions.roomType = room.t;\n\t\toptions.roomName = room.name;\n\n\t\treturn true;\n\t} catch (error) {\n\t\t/* error*/\n\t\treturn false;\n\t}\n});\n\nMeteor.startup(function() {\n\tfunction publishMessage(type, record) {\n\t\tif (record._hidden !== true && (record.imported == null)) {\n\t\t\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\n\t\t\tif (record.u && record.u._id && UI_Use_Real_Name) {\n\t\t\t\tconst user = RocketChat.models.Users.findOneById(record.u._id);\n\t\t\t\trecord.u.name = user && user.name;\n\t\t\t}\n\n\t\t\tif (record.mentions && record.mentions.length && UI_Use_Real_Name) {\n\t\t\t\trecord.mentions.forEach((mention) => {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneById(mention._id);\n\t\t\t\t\tmention.name = user && user.name;\n\t\t\t\t});\n\t\t\t}\n\t\t\tmsgStream.emitWithoutBroadcast('__my_messages__', record, {});\n\t\t\treturn msgStream.emitWithoutBroadcast(record.rid, record);\n\t\t}\n\t}\n\n\treturn RocketChat.models.Messages.on('change', function({ clientAction, id, data/* , oplog*/ }) {\n\t\tswitch (clientAction) {\n\t\t\tcase 'inserted':\n\t\t\tcase 'updated':\n\t\t\t\tconst message = data || RocketChat.models.Messages.findOne({ _id: id });\n\t\t\t\tpublishMessage(clientAction, message);\n\t\t\t\tbreak;\n\t\t}\n\t});\n});\n","/* global InstanceStatus, DDP, LoggerManager */\n\nimport _ from 'underscore';\nimport { DDPCommon } from 'meteor/ddp-common';\n\nprocess.env.PORT = String(process.env.PORT).trim();\nprocess.env.INSTANCE_IP = String(process.env.INSTANCE_IP).trim();\n\nconst connections = {};\nthis.connections = connections;\n\nconst logger = new Logger('StreamBroadcast', {\n\tsections: {\n\t\tconnection: 'Connection',\n\t\tauth: 'Auth',\n\t\tstream: 'Stream',\n\t},\n});\n\nfunction _authorizeConnection(instance) {\n\tlogger.auth.info(`Authorizing with ${ instance }`);\n\n\treturn connections[instance].call('broadcastAuth', InstanceStatus.id(), connections[instance].instanceId, function(err, ok) {\n\t\tif (err != null) {\n\t\t\treturn logger.auth.error(`broadcastAuth error ${ instance } ${ InstanceStatus.id() } ${ connections[instance].instanceId }`, err);\n\t\t}\n\n\t\tconnections[instance].broadcastAuth = ok;\n\t\treturn logger.auth.info(`broadcastAuth with ${ instance }`, ok);\n\t});\n}\n\nfunction authorizeConnection(instance) {\n\tconst query = {\n\t\t_id: InstanceStatus.id(),\n\t};\n\n\tif (!InstanceStatus.getCollection().findOne(query)) {\n\t\treturn Meteor.setTimeout(function() {\n\t\t\treturn authorizeConnection(instance);\n\t\t}, 500);\n\t}\n\n\treturn _authorizeConnection(instance);\n}\n\nfunction startMatrixBroadcast() {\n\tconst query = {\n\t\t'extraInformation.port': {\n\t\t\t$exists: true,\n\t\t},\n\t};\n\n\tconst options = {\n\t\tsort: {\n\t\t\t_createdAt: -1,\n\t\t},\n\t};\n\n\treturn InstanceStatus.getCollection().find(query, options).observe({\n\t\tadded(record) {\n\t\t\tlet instance = `${ record.extraInformation.host }:${ record.extraInformation.port }`;\n\n\t\t\tif (record.extraInformation.port === process.env.PORT && record.extraInformation.host === process.env.INSTANCE_IP) {\n\t\t\t\tlogger.auth.info('prevent self connect', instance);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (record.extraInformation.host === process.env.INSTANCE_IP && RocketChat.isDocker() === false) {\n\t\t\t\tinstance = `localhost:${ record.extraInformation.port }`;\n\t\t\t}\n\n\t\t\tif (connections[instance] && connections[instance].instanceRecord) {\n\t\t\t\tif (connections[instance].instanceRecord._createdAt < record._createdAt) {\n\t\t\t\t\tconnections[instance].disconnect();\n\t\t\t\t\tdelete connections[instance];\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlogger.connection.info('connecting in', instance);\n\n\t\t\tconnections[instance] = DDP.connect(instance, {\n\t\t\t\t_dontPrintErrors: LoggerManager.logLevel < 2,\n\t\t\t});\n\n\t\t\tconnections[instance].instanceRecord = record;\n\t\t\tconnections[instance].instanceId = record._id;\n\n\t\t\treturn connections[instance].onReconnect = function() {\n\t\t\t\treturn authorizeConnection(instance);\n\t\t\t};\n\t\t},\n\n\t\tremoved(record) {\n\t\t\tlet instance = `${ record.extraInformation.host }:${ record.extraInformation.port }`;\n\n\t\t\tif (record.extraInformation.host === process.env.INSTANCE_IP && RocketChat.isDocker() === false) {\n\t\t\t\tinstance = `localhost:${ record.extraInformation.port }`;\n\t\t\t}\n\n\t\t\tconst query = {\n\t\t\t\t'extraInformation.host': record.extraInformation.host,\n\t\t\t\t'extraInformation.port': record.extraInformation.port,\n\t\t\t};\n\n\t\t\tif (connections[instance] && !InstanceStatus.getCollection().findOne(query)) {\n\t\t\t\tlogger.connection.info('disconnecting from', instance);\n\t\t\t\tconnections[instance].disconnect();\n\t\t\t\treturn delete connections[instance];\n\t\t\t}\n\t\t},\n\t});\n}\n\nMeteor.methods({\n\tbroadcastAuth(remoteId, selfId) {\n\t\tcheck(selfId, String);\n\t\tcheck(remoteId, String);\n\n\t\tthis.unblock();\n\n\t\tconst query = {\n\t\t\t_id: remoteId,\n\t\t};\n\n\t\tif (selfId === InstanceStatus.id() && remoteId !== InstanceStatus.id() && (InstanceStatus.getCollection().findOne(query))) {\n\t\t\tthis.connection.broadcastAuth = true;\n\t\t}\n\n\t\treturn this.connection.broadcastAuth === true;\n\t},\n\n\tstream(streamName, eventName, args) {\n\t\tif (!this.connection) {\n\t\t\treturn 'self-not-authorized';\n\t\t}\n\n\t\tif (this.connection.broadcastAuth !== true) {\n\t\t\treturn 'not-authorized';\n\t\t}\n\n\t\tconst instance = Meteor.StreamerCentral.instances[streamName];\n\t\tif (!instance) {\n\t\t\treturn 'stream-not-exists';\n\t\t}\n\n\t\tif (instance.serverOnly) {\n\t\t\tconst scope = {};\n\t\t\tinstance.emitWithScope(eventName, scope, ...args);\n\t\t} else {\n\t\t\tMeteor.StreamerCentral.instances[streamName]._emit(eventName, args);\n\t\t}\n\t},\n});\n\nfunction startStreamCastBroadcast(value) {\n\tconst instance = 'StreamCast';\n\n\tlogger.connection.info('connecting in', instance, value);\n\n\tconst connection = DDP.connect(value, {\n\t\t_dontPrintErrors: LoggerManager.logLevel < 2,\n\t});\n\n\tconnections[instance] = connection;\n\tconnection.instanceId = instance;\n\tconnection.onReconnect = function() {\n\t\treturn authorizeConnection(instance);\n\t};\n\n\tconnection._stream.on('message', function(raw_msg) {\n\t\tconst msg = DDPCommon.parseDDP(raw_msg);\n\t\tif (!msg || msg.msg !== 'changed' || !msg.collection || !msg.fields) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { streamName, eventName, args } = msg.fields;\n\n\t\tif (!streamName || !eventName || !args) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (connection.broadcastAuth !== true) {\n\t\t\treturn 'not-authorized';\n\t\t}\n\n\t\tif (!Meteor.StreamerCentral.instances[streamName]) {\n\t\t\treturn 'stream-not-exists';\n\t\t}\n\n\t\treturn Meteor.StreamerCentral.instances[streamName]._emit(eventName, args);\n\t});\n\n\treturn connection.subscribe('stream');\n}\n\nfunction startStreamBroadcast() {\n\tif (!process.env.INSTANCE_IP) {\n\t\tprocess.env.INSTANCE_IP = 'localhost';\n\t}\n\n\tlogger.info('startStreamBroadcast');\n\n\tRocketChat.settings.get('Stream_Cast_Address', function(key, value) {\n\t\t// var connection, fn, instance;\n\t\tconst fn = function(instance, connection) {\n\t\t\tconnection.disconnect();\n\t\t\treturn delete connections[instance];\n\t\t};\n\n\t\tfor (const instance of Object.keys(connections)) {\n\t\t\tconst connection = connections[instance];\n\t\t\tfn(instance, connection);\n\t\t}\n\n\t\tif (value && value.trim() !== '') {\n\t\t\treturn startStreamCastBroadcast(value);\n\t\t} else {\n\t\t\treturn startMatrixBroadcast();\n\t\t}\n\t});\n\n\tfunction broadcast(streamName, eventName, args/* , userId*/) {\n\t\tconst fromInstance = `${ process.env.INSTANCE_IP }:${ process.env.PORT }`;\n\t\tconst results = [];\n\n\t\tfor (const instance of Object.keys(connections)) {\n\t\t\tconst connection = connections[instance];\n\n\t\t\tif (connection.status().connected === true) {\n\t\t\t\tconnection.call('stream', streamName, eventName, args, function(error, response) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tlogger.error('Stream broadcast error', error);\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch (response) {\n\t\t\t\t\t\tcase 'self-not-authorized':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } to self is not authorized`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\treturn logger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t\tcase 'not-authorized':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } not authorized`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\tlogger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t\t\treturn authorizeConnection(instance);\n\t\t\t\t\t\tcase 'stream-not-exists':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } does not exist`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\treturn logger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\treturn Meteor.StreamerCentral.on('broadcast', function(streamName, eventName, args) {\n\t\treturn broadcast(streamName, eventName, args);\n\t});\n}\n\nMeteor.startup(function() {\n\treturn startStreamBroadcast();\n});\n\nMeteor.methods({\n\t'instances/get'() {\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'view-statistics')) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'List instances is not allowed', {\n\t\t\t\tmethod: 'instances/get',\n\t\t\t});\n\t\t}\n\n\t\treturn Object.keys(connections).map((address) => {\n\t\t\tconst conn = connections[address];\n\t\t\treturn Object.assign({ address, currentStatus: conn._stream.currentStatus }, _.pick(conn, 'instanceRecord', 'broadcastAuth'));\n\t\t});\n\t},\n});\n","import '/imports/startup/server';\n","RegExp.escape = function(s) {\n\treturn s.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n};\n","this.i18n_status_func = function(key, options) {\n\treturn TAPi18n.__(key, options);\n};\n"]}