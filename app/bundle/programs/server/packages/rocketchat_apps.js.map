{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:apps/lib/Apps.js","meteor://ðŸ’»app/packages/rocketchat:apps/lib/misc/Utilities.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/storage/apps-logs-model.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/storage/apps-model.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/storage/apps-persistence-model.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/storage/storage.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/storage/index.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/storage/logs-storage.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/bridges/activation.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/bridges/bridges.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/bridges/commands.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/bridges/environmental.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/bridges/messages.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/bridges/persistence.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/bridges/rooms.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/bridges/settings.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/bridges/users.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/bridges/index.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/bridges/api.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/bridges/details.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/bridges/http.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/bridges/listeners.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/communication/methods.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/communication/rest.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/communication/websockets.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/communication/index.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/converters/messages.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/converters/rooms.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/converters/settings.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/converters/users.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/converters/index.js","meteor://ðŸ’»app/packages/rocketchat:apps/server/orchestrator.js"],"names":["Apps","module","export","Utilities","getI18nKeyForApp","key","appId","curl","method","params","auth","headers","url","query","content","opts","newLine","cmd","verbose","push","toUpperCase","u","Object","entries","forEach","value","replace","queryString","map","join","headerKeys","val","toLowerCase","includes","JSON","stringify","AppsLogsModel","RocketChat","models","_Base","constructor","AppsModel","AppsPersistenceModel","AppRealStorage","AppStorage","watch","require","v","data","db","create","item","Promise","resolve","reject","createdAt","Date","updatedAt","doc","findOne","$or","id","info","nameSlug","e","Error","insert","_id","retrieveOne","retrieveAll","docs","find","fetch","items","Map","i","set","update","then","updated","catch","err","remove","success","AppRealLogsStorage","AppConsole","AppLogStorage","model","args","storeEntries","logger","toStorageEntry","findOneById","getEntriesFor","removeEntriesFor","AppActivationBridge","orch","appAdded","app","getNotifier","getID","appUpdated","appRemoved","appStatusChanged","status","appStatusUpdated","RealAppBridges","AppBridges","AppDetailChangesBridge","AppCommandsBridge","AppApisBridge","AppEnvironmentalVariableBridge","AppHttpBridge","AppListenerBridge","AppMessageBridge","AppPersistenceBridge","AppRoomBridge","AppSettingBridge","AppUserBridge","_actBridge","_cmdBridge","_apiBridge","_detBridge","_envBridge","_httpBridge","_lisnBridge","_msgBridge","_persistBridge","_roomBridge","_setsBridge","_userBridge","getCommandBridge","getApiBridge","getEnvironmentalVariableBridge","getHttpBridge","getListenerBridge","getMessageBridge","getPersistenceBridge","getAppActivationBridge","getAppDetailChangesBridge","getRoomBridge","getServerSettingBridge","getUserBridge","SlashCommandContext","disabledCommands","doesCommandExist","command","console","log","length","slashCommands","commands","has","enableCommand","trim","get","delete","commandUpdated","disableCommand","commandDisabled","modifyCommand","_verifyCommand","paramsExample","description","i18nDescription","callback","_appCommandExecutor","bind","providesPreview","previewer","_appCommandPreviewer","previewCallback","executePreviewItem","_appCommandPreviewExecutor","registerCommand","i18nParamsExample","undefined","commandAdded","unregisterCommand","commandRemoved","executor","parameters","message","user","getConverters","convertById","Meteor","userId","room","rid","split","context","freeze","await","getManager","getCommandManager","executeCommand","getPreviews","preview","executePreview","allowed","getValueByName","envVarName","isReadable","process","env","isSet","msg","convertAppMessage","runAsUser","call","getById","messageId","editor","Messages","Users","updateMessage","notifyUser","Notifications","assign","Random","ts","notifyRoom","rmsg","users","Subscriptions","findByRoomIdWhenUserIdExists","fields","s","findByIds","purge","getPersistenceModel","createWithAssociations","associations","readById","record","readByAssociations","records","$all","Array","isArray","r","removeByAssociations","upsert","RoomType","rcRoom","convertAppRoom","type","CHANNEL","PRIVATE_GROUP","creator","members","roomId","getByName","roomName","convertByName","getCreatorById","Rooms","getCreatorByName","findOneByName","rm","allowedGroups","disallowedSettings","getAll","Settings","$nin","convertToApp","getOneById","isReadableById","hideGroup","name","hideSetting","updateOne","setting","getByUsername","username","convertByUsername","express","default","WebApp","apiServer","connectHandlers","use","appRouters","req","res","notFound","send","router","_privateHash","hash","registerApi","api","computedPath","endpoint","path","_verifyApi","Router","routePath","startsWith","bindEnvironment","_appApiExecutor","unregisterApis","request","body","privateHash","getApiManager","executeApi","reason","onAppSettingsChange","appSettingsChange","warn","HTTP","response","messageEvent","inte","convertMessage","result","getListenerManager","executeListener","roomEvent","convertRoom","AppMethods","waitToLoad","setInterval","isEnabled","isLoaded","clearInterval","waitToUnload","_orch","_addMethods","instance","methods","authz","hasPermission","settings","AppsRestApi","Busboy","manager","_manager","API","ApiClass","version","useDefaultAuth","prettyJson","enableCors","getUserAuth","addManagementRoutes","_handleFile","fileField","busboy","wrapAsync","on","fieldname","file","fileData","Buffer","concat","pipe","orchestrator","fileHandler","addRoute","authRequired","apps","prl","getInfo","languages","getStorageItem","languageContent","getStatus","v1","post","buff","bodyParams","npmRequestOptions","encoding","statusCode","failure","error","from","aff","add","toString","getAppInfo","getApp","implemented","getImplementedInferfaces","compilerErrors","getCompilerErrors","urlParams","iconFileContent","offset","count","getPaginationItems","sort","parseJsonQuery","ourQuery","options","_updatedAt","skip","limit","logs","getLogStorage","keys","k","hidden","getSettingsManager","updateAppSetting","settingId","getAppSetting","apis","apiManager","listApis","changeStatus","AppEvents","AppServerListener","AppServerNotifier","AppStatus","AppStatusUtils","APP_ADDED","APP_REMOVED","APP_UPDATED","APP_STATUS_CHANGE","APP_SETTING_UPDATED","COMMAND_ADDED","COMMAND_DISABLED","COMMAND_UPDATED","COMMAND_REMOVED","engineStreamer","clientStreamer","received","onAppAdded","onAppStatusUpdated","onAppSettingUpdated","onAppRemoved","onAppUpdated","onCommandAdded","onCommandDisabled","onCommandUpdated","onCommandRemoved","loadOne","emit","when","enable","isDisabled","disable","MANUALLY_DISABLED","storageItem","getStorage","zip","Streamer","retransmit","serverOnly","allowRead","allowEmit","allowWrite","listener","details","AppMessagesConverter","msgId","msgObj","sender","editedBy","attachments","_convertAttachmentsToApp","text","editedAt","emoji","avatarUrl","avatar","alias","customFields","groupable","reactions","_convertAppAttachments","attachment","collapsed","color","timestamp","message_link","timestampLink","thumb_url","thumbnailUrl","author_name","author","author_link","link","author_icon","icon","title","title_link","title_link_download","displayDownloadLink","image_url","imageUrl","audio_url","audioUrl","video_url","videoUrl","actions","a","AppRoomsConverter","fname","displayName","slugifiedName","t","isDefault","ro","isReadOnly","sysMes","displaySystemMessages","msgs","messageCount","lm","lastModifiedAt","_convertTypeToApp","typeChar","DIRECT_MESSAGE","LIVE_CHAT","AppSettingsConverter","SettingType","findOneNotHiddenById","packageValue","values","public","group","i18nLabel","BOOLEAN","CODE","COLOR","FONT","NUMBER","SELECT","STRING","AppUsersConverter","UserStatusConnection","UserType","findOneByUsername","_convertUserTypeToEnum","statusConnection","_convertStatusConnectionToEnum","emails","active","roles","utcOffset","lastLoginAt","lastLogin","USER","BOT","UNKNOWN","OFFLINE","ONLINE","AWAY","BUSY","UNDEFINED","AppManager","AppServerOrchestrator","Permissions","createOrUpdate","_model","_logModel","_persistModel","_storage","_logStorage","_converters","_bridges","_communicators","getModel","getBridges","areAppsLoaded","load","affs","unload","addGroup","section","global","startup","_appServerOrchestrator"],"mappings":"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","file":"/packages/rocketchat_apps.js","sourcesContent":["// Please see both server and client's repsective \"orchestrator\" file for the contents\nApps = {};\n","export class Utilities {\n\tstatic getI18nKeyForApp(key, appId) {\n\t\treturn key && `apps-${ appId }-${ key }`;\n\t}\n\n\tstatic curl({ method, params, auth, headers = {}, url, query, content }, opts = {}) {\n\t\tconst newLine = '\\\\\\n   ';\n\n\t\tconst cmd = ['curl'];\n\n\t\t// curl options\n\t\tif (opts.verbose) {\n\t\t\tcmd.push('-v');\n\t\t}\n\t\tif (opts.headers) {\n\t\t\tcmd.push('-i');\n\t\t}\n\n\t\t// method\n\t\tcmd.push('-X');\n\t\tcmd.push((method || 'GET').toUpperCase());\n\n\t\t// URL\n\t\tlet u = url;\n\n\t\tif (typeof params === 'object') {\n\t\t\tObject.entries(params).forEach(([key, value]) => {\n\t\t\t\tu = u.replace(`:${ key }`, value);\n\t\t\t});\n\t\t}\n\n\t\tif (typeof query === 'object') {\n\t\t\tconst queryString = Object.entries(query).map(([key, value]) => `${ key }=${ value }`).join('&');\n\t\t\tu += `?${ queryString }`;\n\t\t}\n\t\tcmd.push(u);\n\n\t\t// username\n\t\tif (auth) {\n\t\t\tcmd.push(newLine);\n\t\t\tcmd.push('-u');\n\t\t\tcmd.push(auth);\n\t\t}\n\n\t\t// headers\n\t\tconst headerKeys = [];\n\t\tObject.entries(headers).forEach(([key, val]) => {\n\t\t\tkey = key.toLowerCase();\n\t\t\theaderKeys.push(key);\n\t\t\tcmd.push(newLine);\n\t\t\tcmd.push('-H');\n\t\t\tcmd.push(`\"${ key }${ val ? ': ' : ';' }${ val || '' }\"`);\n\t\t});\n\n\t\tif (content) {\n\t\t\tif (typeof content === 'object') {\n\t\t\t\tif (!headerKeys.includes('content-type')) {\n\t\t\t\t\tcmd.push(newLine);\n\t\t\t\t\tcmd.push('-H');\n\t\t\t\t\tcmd.push('\"content-type: application/json\"');\n\t\t\t\t}\n\t\t\t\tcontent = JSON.stringify(content);\n\t\t\t}\n\n\t\t\tcmd.push(newLine);\n\t\t\tcmd.push('--data-binary');\n\t\t\tcmd.push(`'${ content }'`);\n\t\t}\n\n\t\treturn cmd.join(' ');\n\t}\n}\n","export class AppsLogsModel extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper('apps_logs');\n\t}\n}\n","export class AppsModel extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper('apps');\n\t}\n}\n","export class AppsPersistenceModel extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper('apps_persistence');\n\t}\n}\n","import { AppStorage } from '@rocket.chat/apps-engine/server/storage';\n\nexport class AppRealStorage extends AppStorage {\n\tconstructor(data) {\n\t\tsuper('mongodb');\n\t\tthis.db = data;\n\t}\n\n\tcreate(item) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\titem.createdAt = new Date();\n\t\t\titem.updatedAt = new Date();\n\n\t\t\tlet doc;\n\n\t\t\ttry {\n\t\t\t\tdoc = this.db.findOne({ $or: [{ id: item.id }, { 'info.nameSlug': item.info.nameSlug }] });\n\t\t\t} catch (e) {\n\t\t\t\treturn reject(e);\n\t\t\t}\n\n\t\t\tif (doc) {\n\t\t\t\treturn reject(new Error('App already exists.'));\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst id = this.db.insert(item);\n\t\t\t\titem._id = id;\n\n\t\t\t\tresolve(item);\n\t\t\t} catch (e) {\n\t\t\t\treject(e);\n\t\t\t}\n\t\t});\n\t}\n\n\tretrieveOne(id) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet doc;\n\n\t\t\ttry {\n\t\t\t\tdoc = this.db.findOne({ $or: [{ _id: id }, { id }] });\n\t\t\t} catch (e) {\n\t\t\t\treturn reject(e);\n\t\t\t}\n\n\t\t\tif (doc) {\n\t\t\t\tresolve(doc);\n\t\t\t} else {\n\t\t\t\treject(new Error(`No App found by the id: ${ id }`));\n\t\t\t}\n\t\t});\n\t}\n\n\tretrieveAll() {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet docs;\n\n\t\t\ttry {\n\t\t\t\tdocs = this.db.find({}).fetch();\n\t\t\t} catch (e) {\n\t\t\t\treturn reject(e);\n\t\t\t}\n\n\t\t\tconst items = new Map();\n\n\t\t\tdocs.forEach((i) => items.set(i.id, i));\n\n\t\t\tresolve(items);\n\t\t});\n\t}\n\n\tupdate(item) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\ttry {\n\t\t\t\tthis.db.update({ id: item.id }, item);\n\t\t\t} catch (e) {\n\t\t\t\treturn reject(e);\n\t\t\t}\n\n\t\t\tthis.retrieveOne(item.id).then((updated) => resolve(updated)).catch((err) => reject(err));\n\t\t});\n\t}\n\n\tremove(id) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\ttry {\n\t\t\t\tthis.db.remove({ id });\n\t\t\t} catch (e) {\n\t\t\t\treturn reject(e);\n\t\t\t}\n\n\t\t\tresolve({ success: true });\n\t\t});\n\t}\n}\n","import { AppsLogsModel } from './apps-logs-model';\nimport { AppsModel } from './apps-model';\nimport { AppsPersistenceModel } from './apps-persistence-model';\nimport { AppRealLogsStorage } from './logs-storage';\nimport { AppRealStorage } from './storage';\n\nexport { AppsLogsModel, AppsModel, AppsPersistenceModel, AppRealLogsStorage, AppRealStorage };\n","import { AppConsole } from '@rocket.chat/apps-engine/server/logging';\nimport { AppLogStorage } from '@rocket.chat/apps-engine/server/storage';\n\nexport class AppRealLogsStorage extends AppLogStorage {\n\tconstructor(model) {\n\t\tsuper('mongodb');\n\t\tthis.db = model;\n\t}\n\n\tfind(...args) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet docs;\n\n\t\t\ttry {\n\t\t\t\tdocs = this.db.find(...args).fetch();\n\t\t\t} catch (e) {\n\t\t\t\treturn reject(e);\n\t\t\t}\n\n\t\t\tresolve(docs);\n\t\t});\n\t}\n\n\tstoreEntries(appId, logger) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst item = AppConsole.toStorageEntry(appId, logger);\n\n\t\t\ttry {\n\t\t\t\tconst id = this.db.insert(item);\n\n\t\t\t\tresolve(this.db.findOneById(id));\n\t\t\t} catch (e) {\n\t\t\t\treject(e);\n\t\t\t}\n\t\t});\n\t}\n\n\tgetEntriesFor(appId) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet docs;\n\n\t\t\ttry {\n\t\t\t\tdocs = this.db.find({ appId }).fetch();\n\t\t\t} catch (e) {\n\t\t\t\treturn reject(e);\n\t\t\t}\n\n\t\t\tresolve(docs);\n\t\t});\n\t}\n\n\tremoveEntriesFor(appId) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\ttry {\n\t\t\t\tthis.db.remove({ appId });\n\t\t\t} catch (e) {\n\t\t\t\treturn reject(e);\n\t\t\t}\n\n\t\t\tresolve();\n\t\t});\n\t}\n}\n","export class AppActivationBridge {\n\tconstructor(orch) {\n\t\tthis.orch = orch;\n\t}\n\n\tasync appAdded(app) {\n\t\tawait this.orch.getNotifier().appAdded(app.getID());\n\t}\n\n\tasync appUpdated(app) {\n\t\tawait this.orch.getNotifier().appUpdated(app.getID());\n\t}\n\n\tasync appRemoved(app) {\n\t\tawait this.orch.getNotifier().appRemoved(app.getID());\n\t}\n\n\tasync appStatusChanged(app, status) {\n\t\tawait this.orch.getNotifier().appStatusUpdated(app.getID(), status);\n\t}\n}\n","import { AppBridges } from '@rocket.chat/apps-engine/server/bridges';\n\nimport { AppActivationBridge } from './activation';\nimport { AppDetailChangesBridge } from './details';\nimport { AppCommandsBridge } from './commands';\nimport { AppApisBridge } from './api';\nimport { AppEnvironmentalVariableBridge } from './environmental';\nimport { AppHttpBridge } from './http';\nimport { AppListenerBridge } from './listeners';\nimport { AppMessageBridge } from './messages';\nimport { AppPersistenceBridge } from './persistence';\nimport { AppRoomBridge } from './rooms';\nimport { AppSettingBridge } from './settings';\nimport { AppUserBridge } from './users';\n\nexport class RealAppBridges extends AppBridges {\n\tconstructor(orch) {\n\t\tsuper();\n\n\t\tthis._actBridge = new AppActivationBridge(orch);\n\t\tthis._cmdBridge = new AppCommandsBridge(orch);\n\t\tthis._apiBridge = new AppApisBridge(orch);\n\t\tthis._detBridge = new AppDetailChangesBridge(orch);\n\t\tthis._envBridge = new AppEnvironmentalVariableBridge(orch);\n\t\tthis._httpBridge = new AppHttpBridge();\n\t\tthis._lisnBridge = new AppListenerBridge(orch);\n\t\tthis._msgBridge = new AppMessageBridge(orch);\n\t\tthis._persistBridge = new AppPersistenceBridge(orch);\n\t\tthis._roomBridge = new AppRoomBridge(orch);\n\t\tthis._setsBridge = new AppSettingBridge(orch);\n\t\tthis._userBridge = new AppUserBridge(orch);\n\t}\n\n\tgetCommandBridge() {\n\t\treturn this._cmdBridge;\n\t}\n\n\tgetApiBridge() {\n\t\treturn this._apiBridge;\n\t}\n\n\tgetEnvironmentalVariableBridge() {\n\t\treturn this._envBridge;\n\t}\n\n\tgetHttpBridge() {\n\t\treturn this._httpBridge;\n\t}\n\n\tgetListenerBridge() {\n\t\treturn this._lisnBridge;\n\t}\n\n\tgetMessageBridge() {\n\t\treturn this._msgBridge;\n\t}\n\n\tgetPersistenceBridge() {\n\t\treturn this._persistBridge;\n\t}\n\n\tgetAppActivationBridge() {\n\t\treturn this._actBridge;\n\t}\n\n\tgetAppDetailChangesBridge() {\n\t\treturn this._detBridge;\n\t}\n\n\tgetRoomBridge() {\n\t\treturn this._roomBridge;\n\t}\n\n\tgetServerSettingBridge() {\n\t\treturn this._setsBridge;\n\t}\n\n\tgetUserBridge() {\n\t\treturn this._userBridge;\n\t}\n}\n","import { SlashCommandContext } from '@rocket.chat/apps-engine/definition/slashcommands';\nimport { Utilities } from '../../lib/misc/Utilities';\n\nexport class AppCommandsBridge {\n\tconstructor(orch) {\n\t\tthis.orch = orch;\n\t\tthis.disabledCommands = new Map();\n\t}\n\n\tdoesCommandExist(command, appId) {\n\t\tconsole.log(`The App ${ appId } is checking if \"${ command }\" command exists.`);\n\n\t\tif (typeof command !== 'string' || command.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\t\treturn typeof RocketChat.slashCommands.commands[cmd] === 'object' || this.disabledCommands.has(cmd);\n\t}\n\n\tenableCommand(command, appId) {\n\t\tconsole.log(`The App ${ appId } is attempting to enable the command: \"${ command }\"`);\n\n\t\tif (typeof command !== 'string' || command.trim().length === 0) {\n\t\t\tthrow new Error('Invalid command parameter provided, must be a string.');\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\t\tif (!this.disabledCommands.has(cmd)) {\n\t\t\tthrow new Error(`The command is not currently disabled: \"${ cmd }\"`);\n\t\t}\n\n\t\tRocketChat.slashCommands.commands[cmd] = this.disabledCommands.get(cmd);\n\t\tthis.disabledCommands.delete(cmd);\n\n\t\tthis.orch.getNotifier().commandUpdated(cmd);\n\t}\n\n\tdisableCommand(command, appId) {\n\t\tconsole.log(`The App ${ appId } is attempting to disable the command: \"${ command }\"`);\n\n\t\tif (typeof command !== 'string' || command.trim().length === 0) {\n\t\t\tthrow new Error('Invalid command parameter provided, must be a string.');\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\t\tif (this.disabledCommands.has(cmd)) {\n\t\t\t// The command is already disabled, no need to disable it yet again\n\t\t\treturn;\n\t\t}\n\n\t\tif (typeof RocketChat.slashCommands.commands[cmd] === 'undefined') {\n\t\t\tthrow new Error(`Command does not exist in the system currently: \"${ cmd }\"`);\n\t\t}\n\n\t\tthis.disabledCommands.set(cmd, RocketChat.slashCommands.commands[cmd]);\n\t\tdelete RocketChat.slashCommands.commands[cmd];\n\n\t\tthis.orch.getNotifier().commandDisabled(cmd);\n\t}\n\n\t// command: { command, paramsExample, i18nDescription, executor: function }\n\tmodifyCommand(command, appId) {\n\t\tconsole.log(`The App ${ appId } is attempting to modify the command: \"${ command }\"`);\n\n\t\tthis._verifyCommand(command);\n\n\t\tconst cmd = command.toLowerCase();\n\t\tif (typeof RocketChat.slashCommands.commands[cmd] === 'undefined') {\n\t\t\tthrow new Error(`Command does not exist in the system currently (or it is disabled): \"${ cmd }\"`);\n\t\t}\n\n\t\tconst item = RocketChat.slashCommands.commands[cmd];\n\t\titem.params = command.paramsExample ? command.paramsExample : item.params;\n\t\titem.description = command.i18nDescription ? command.i18nDescription : item.params;\n\t\titem.callback = this._appCommandExecutor.bind(this);\n\t\titem.providesPreview = command.providesPreview;\n\t\titem.previewer = command.previewer ? this._appCommandPreviewer.bind(this) : item.previewer;\n\t\titem.previewCallback = command.executePreviewItem ? this._appCommandPreviewExecutor.bind(this) : item.previewCallback;\n\n\t\tRocketChat.slashCommands.commands[cmd] = item;\n\t\tthis.orch.getNotifier().commandUpdated(cmd);\n\t}\n\n\tregisterCommand(command, appId) {\n\t\tconsole.log(`The App ${ appId } is registering the command: \"${ command.command }\"`);\n\n\t\tthis._verifyCommand(command);\n\n\t\tconst item = {\n\t\t\tcommand: command.command.toLowerCase(),\n\t\t\tparams: Utilities.getI18nKeyForApp(command.i18nParamsExample, appId),\n\t\t\tdescription: Utilities.getI18nKeyForApp(command.i18nDescription, appId),\n\t\t\tcallback: this._appCommandExecutor.bind(this),\n\t\t\tprovidesPreview: command.providesPreview,\n\t\t\tpreviewer: !command.previewer ? undefined : this._appCommandPreviewer.bind(this),\n\t\t\tpreviewCallback: !command.executePreviewItem ? undefined : this._appCommandPreviewExecutor.bind(this),\n\t\t};\n\n\t\tRocketChat.slashCommands.commands[command.command.toLowerCase()] = item;\n\t\tthis.orch.getNotifier().commandAdded(command.command.toLowerCase());\n\t}\n\n\tunregisterCommand(command, appId) {\n\t\tconsole.log(`The App ${ appId } is unregistering the command: \"${ command }\"`);\n\n\t\tif (typeof command !== 'string' || command.trim().length === 0) {\n\t\t\tthrow new Error('Invalid command parameter provided, must be a string.');\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\t\tthis.disabledCommands.delete(cmd);\n\t\tdelete RocketChat.slashCommands.commands[cmd];\n\n\t\tthis.orch.getNotifier().commandRemoved(cmd);\n\t}\n\n\t_verifyCommand(command) {\n\t\tif (typeof command !== 'object') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (typeof command.command !== 'string') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (command.i18nParamsExample && typeof command.i18nParamsExample !== 'string') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (command.i18nDescription && typeof command.i18nDescription !== 'string') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (typeof command.providesPreview !== 'boolean') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (typeof command.executor !== 'function') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\t}\n\n\t_appCommandExecutor(command, parameters, message) {\n\t\tconst user = this.orch.getConverters().get('users').convertById(Meteor.userId());\n\t\tconst room = this.orch.getConverters().get('rooms').convertById(message.rid);\n\t\tconst params = parameters.length === 0 || parameters === ' ' ? [] : parameters.split(' ');\n\n\t\tconst context = new SlashCommandContext(Object.freeze(user), Object.freeze(room), Object.freeze(params));\n\t\tPromise.await(this.orch.getManager().getCommandManager().executeCommand(command, context));\n\t}\n\n\t_appCommandPreviewer(command, parameters, message) {\n\t\tconst user = this.orch.getConverters().get('users').convertById(Meteor.userId());\n\t\tconst room = this.orch.getConverters().get('rooms').convertById(message.rid);\n\t\tconst params = parameters.length === 0 || parameters === ' ' ? [] : parameters.split(' ');\n\n\t\tconst context = new SlashCommandContext(Object.freeze(user), Object.freeze(room), Object.freeze(params));\n\t\treturn Promise.await(this.orch.getManager().getCommandManager().getPreviews(command, context));\n\t}\n\n\t_appCommandPreviewExecutor(command, parameters, message, preview) {\n\t\tconst user = this.orch.getConverters().get('users').convertById(Meteor.userId());\n\t\tconst room = this.orch.getConverters().get('rooms').convertById(message.rid);\n\t\tconst params = parameters.length === 0 || parameters === ' ' ? [] : parameters.split(' ');\n\n\t\tconst context = new SlashCommandContext(Object.freeze(user), Object.freeze(room), Object.freeze(params));\n\t\tPromise.await(this.orch.getManager().getCommandManager().executePreview(command, preview, context));\n\t}\n}\n","export class AppEnvironmentalVariableBridge {\n\tconstructor(orch) {\n\t\tthis.orch = orch;\n\t\tthis.allowed = ['NODE_ENV', 'ROOT_URL', 'INSTANCE_IP'];\n\t}\n\n\tasync getValueByName(envVarName, appId) {\n\t\tconsole.log(`The App ${ appId } is getting the environmental variable value ${ envVarName }.`);\n\n\t\tif (this.isReadable(envVarName, appId)) {\n\t\t\treturn process.env[envVarName];\n\t\t}\n\n\t\tthrow new Error(`The environmental variable \"${ envVarName }\" is not readable.`);\n\t}\n\n\tasync isReadable(envVarName, appId) {\n\t\tconsole.log(`The App ${ appId } is checking if the environmental variable is readable ${ envVarName }.`);\n\n\t\treturn this.allowed.includes(envVarName.toUpperCase());\n\t}\n\n\tasync isSet(envVarName, appId) {\n\t\tconsole.log(`The App ${ appId } is checking if the environmental variable is set ${ envVarName }.`);\n\n\t\tif (this.isReadable(envVarName, appId)) {\n\t\t\treturn typeof process.env[envVarName] !== 'undefined';\n\t\t}\n\n\t\tthrow new Error(`The environmental variable \"${ envVarName }\" is not readable.`);\n\t}\n}\n","export class AppMessageBridge {\n\tconstructor(orch) {\n\t\tthis.orch = orch;\n\t}\n\n\tasync create(message, appId) {\n\t\tconsole.log(`The App ${ appId } is creating a new message.`);\n\n\t\tlet msg = this.orch.getConverters().get('messages').convertAppMessage(message);\n\n\t\tMeteor.runAsUser(msg.u._id, () => {\n\t\t\tmsg = Meteor.call('sendMessage', msg);\n\t\t});\n\n\t\treturn msg._id;\n\t}\n\n\tasync getById(messageId, appId) {\n\t\tconsole.log(`The App ${ appId } is getting the message: \"${ messageId }\"`);\n\n\t\treturn this.orch.getConverters().get('messages').convertById(messageId);\n\t}\n\n\tasync update(message, appId) {\n\t\tconsole.log(`The App ${ appId } is updating a message.`);\n\n\t\tif (!message.editor) {\n\t\t\tthrow new Error('Invalid editor assigned to the message for the update.');\n\t\t}\n\n\t\tif (!message.id || !RocketChat.models.Messages.findOneById(message.id)) {\n\t\t\tthrow new Error('A message must exist to update.');\n\t\t}\n\n\t\tconst msg = this.orch.getConverters().get('messages').convertAppMessage(message);\n\t\tconst editor = RocketChat.models.Users.findOneById(message.editor.id);\n\n\t\tRocketChat.updateMessage(msg, editor);\n\t}\n\n\tasync notifyUser(user, message, appId) {\n\t\tconsole.log(`The App ${ appId } is notifying a user.`);\n\n\t\tconst msg = this.orch.getConverters().get('messages').convertAppMessage(message);\n\n\t\tRocketChat.Notifications.notifyUser(user.id, 'message', Object.assign(msg, {\n\t\t\t_id: Random.id(),\n\t\t\tts: new Date(),\n\t\t\tu: undefined,\n\t\t\teditor: undefined,\n\t\t}));\n\t}\n\n\tasync notifyRoom(room, message, appId) {\n\t\tconsole.log(`The App ${ appId } is notifying a room's users.`);\n\n\t\tif (room) {\n\t\t\tconst msg = this.orch.getConverters().get('messages').convertAppMessage(message);\n\t\t\tconst rmsg = Object.assign(msg, {\n\t\t\t\t_id: Random.id(),\n\t\t\t\trid: room.id,\n\t\t\t\tts: new Date(),\n\t\t\t\tu: undefined,\n\t\t\t\teditor: undefined,\n\t\t\t});\n\n\t\t\tconst users = RocketChat.models.Subscriptions.findByRoomIdWhenUserIdExists(room._id, { fields: { 'u._id': 1 } })\n\t\t\t\t.fetch()\n\t\t\t\t.map((s) => s.u._id);\n\t\t\tRocketChat.models.Users.findByIds(users, { fields: { _id: 1 } })\n\t\t\t\t.fetch()\n\t\t\t\t.forEach(({ _id }) =>\n\t\t\t\t\tRocketChat.Notifications.notifyUser(_id, 'message', rmsg)\n\t\t\t\t);\n\t\t}\n\t}\n}\n","export class AppPersistenceBridge {\n\tconstructor(orch) {\n\t\tthis.orch = orch;\n\t}\n\n\tasync purge(appId) {\n\t\tconsole.log(`The App's persistent storage is being purged: ${ appId }`);\n\n\t\tthis.orch.getPersistenceModel().remove({ appId });\n\t}\n\n\tasync create(data, appId) {\n\t\tconsole.log(`The App ${ appId } is storing a new object in their persistence.`, data);\n\n\t\tif (typeof data !== 'object') {\n\t\t\tthrow new Error('Attempted to store an invalid data type, it must be an object.');\n\t\t}\n\n\t\treturn this.orch.getPersistenceModel().insert({ appId, data });\n\t}\n\n\tasync createWithAssociations(data, associations, appId) {\n\t\tconsole.log(`The App ${ appId } is storing a new object in their persistence that is associated with some models.`, data, associations);\n\n\t\tif (typeof data !== 'object') {\n\t\t\tthrow new Error('Attempted to store an invalid data type, it must be an object.');\n\t\t}\n\n\t\treturn this.orch.getPersistenceModel().insert({ appId, associations, data });\n\t}\n\n\tasync readById(id, appId) {\n\t\tconsole.log(`The App ${ appId } is reading their data in their persistence with the id: \"${ id }\"`);\n\n\t\tconst record = this.orch.getPersistenceModel().findOneById(id);\n\n\t\treturn record.data;\n\t}\n\n\tasync readByAssociations(associations, appId) {\n\t\tconsole.log(`The App ${ appId } is searching for records that are associated with the following:`, associations);\n\n\t\tconst records = this.orch.getPersistenceModel().find({\n\t\t\tappId,\n\t\t\tassociations: { $all: associations },\n\t\t}).fetch();\n\n\t\treturn Array.isArray(records) ? records.map((r) => r.data) : [];\n\t}\n\n\tasync remove(id, appId) {\n\t\tconsole.log(`The App ${ appId } is removing one of their records by the id: \"${ id }\"`);\n\n\t\tconst record = this.orch.getPersistenceModel().findOne({ _id: id, appId });\n\n\t\tif (!record) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tthis.orch.getPersistenceModel().remove({ _id: id, appId });\n\n\t\treturn record.data;\n\t}\n\n\tasync removeByAssociations(associations, appId) {\n\t\tconsole.log(`The App ${ appId } is removing records with the following associations:`, associations);\n\n\t\tconst query = {\n\t\t\tappId,\n\t\t\tassociations: {\n\t\t\t\t$all: associations,\n\t\t\t},\n\t\t};\n\n\t\tconst records = this.orch.getPersistenceModel().find(query).fetch();\n\n\t\tif (!records) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tthis.orch.getPersistenceModel().remove(query);\n\n\t\treturn Array.isArray(records) ? records.map((r) => r.data) : [];\n\t}\n\n\tasync update(id, data, upsert, appId) {\n\t\tconsole.log(`The App ${ appId } is updating the record \"${ id }\" to:`, data);\n\n\t\tif (typeof data !== 'object') {\n\t\t\tthrow new Error('Attempted to store an invalid data type, it must be an object.');\n\t\t}\n\n\t\tthrow new Error('Not implemented.');\n\t}\n}\n","import { RoomType } from '@rocket.chat/apps-engine/definition/rooms';\n\nexport class AppRoomBridge {\n\tconstructor(orch) {\n\t\tthis.orch = orch;\n\t}\n\n\tasync create(room, appId) {\n\t\tconsole.log(`The App ${ appId } is creating a new room.`, room);\n\n\t\tconst rcRoom = this.orch.getConverters().get('rooms').convertAppRoom(room);\n\t\tlet method;\n\n\t\tswitch (room.type) {\n\t\t\tcase RoomType.CHANNEL:\n\t\t\t\tmethod = 'createChannel';\n\t\t\t\tbreak;\n\t\t\tcase RoomType.PRIVATE_GROUP:\n\t\t\t\tmethod = 'createPrivateGroup';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new Error('Only channels and private groups can be created.');\n\t\t}\n\n\t\tlet rid;\n\t\tMeteor.runAsUser(room.creator.id, () => {\n\t\t\tconst info = Meteor.call(method, rcRoom.members);\n\t\t\trid = info.rid;\n\t\t});\n\n\t\treturn rid;\n\t}\n\n\tasync getById(roomId, appId) {\n\t\tconsole.log(`The App ${ appId } is getting the roomById: \"${ roomId }\"`);\n\n\t\treturn this.orch.getConverters().get('rooms').convertById(roomId);\n\t}\n\n\tasync getByName(roomName, appId) {\n\t\tconsole.log(`The App ${ appId } is getting the roomByName: \"${ roomName }\"`);\n\n\t\treturn this.orch.getConverters().get('rooms').convertByName(roomName);\n\t}\n\n\tasync getCreatorById(roomId, appId) {\n\t\tconsole.log(`The App ${ appId } is getting the room's creator by id: \"${ roomId }\"`);\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(roomId);\n\n\t\tif (!room || !room.u || !room.u._id) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn this.orch.getConverters().get('users').convertById(room.u._id);\n\t}\n\n\tasync getCreatorByName(roomName, appId) {\n\t\tconsole.log(`The App ${ appId } is getting the room's creator by name: \"${ roomName }\"`);\n\n\t\tconst room = RocketChat.models.Rooms.findOneByName(roomName);\n\n\t\tif (!room || !room.u || !room.u._id) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn this.orch.getConverters().get('users').convertById(room.u._id);\n\t}\n\n\tasync update(room, appId) {\n\t\tconsole.log(`The App ${ appId } is updating a room.`);\n\n\t\tif (!room.id || RocketChat.models.Rooms.findOneById(room.id)) {\n\t\t\tthrow new Error('A room must exist to update.');\n\t\t}\n\n\t\tconst rm = this.orch.getConverters().get('rooms').convertAppRoom(room);\n\n\t\tRocketChat.models.Rooms.update(rm._id, rm);\n\t}\n}\n","export class AppSettingBridge {\n\tconstructor(orch) {\n\t\tthis.orch = orch;\n\t\tthis.allowedGroups = [];\n\t\tthis.disallowedSettings = [\n\t\t\t'Accounts_RegistrationForm_SecretURL', 'CROWD_APP_USERNAME', 'CROWD_APP_PASSWORD', 'Direct_Reply_Username',\n\t\t\t'Direct_Reply_Password', 'SMTP_Username', 'SMTP_Password', 'FileUpload_S3_AWSAccessKeyId', 'FileUpload_S3_AWSSecretAccessKey',\n\t\t\t'FileUpload_S3_BucketURL', 'FileUpload_GoogleStorage_Bucket', 'FileUpload_GoogleStorage_AccessId',\n\t\t\t'FileUpload_GoogleStorage_Secret', 'GoogleVision_ServiceAccount', 'Allow_Invalid_SelfSigned_Certs', 'GoogleTagManager_id',\n\t\t\t'Bugsnag_api_key', 'LDAP_CA_Cert', 'LDAP_Reject_Unauthorized', 'LDAP_Domain_Search_User', 'LDAP_Domain_Search_Password',\n\t\t\t'Livechat_secret_token', 'Livechat_Knowledge_Apiai_Key', 'AutoTranslate_GoogleAPIKey', 'MapView_GMapsAPIKey',\n\t\t\t'Meta_fb_app_id', 'Meta_google-site-verification', 'Meta_msvalidate01', 'Accounts_OAuth_Dolphin_secret',\n\t\t\t'Accounts_OAuth_Drupal_secret', 'Accounts_OAuth_Facebook_secret', 'Accounts_OAuth_Github_secret', 'API_GitHub_Enterprise_URL',\n\t\t\t'Accounts_OAuth_GitHub_Enterprise_secret', 'API_Gitlab_URL', 'Accounts_OAuth_Gitlab_secret', 'Accounts_OAuth_Google_secret',\n\t\t\t'Accounts_OAuth_Linkedin_secret', 'Accounts_OAuth_Meteor_secret', 'Accounts_OAuth_Twitter_secret', 'API_Wordpress_URL',\n\t\t\t'Accounts_OAuth_Wordpress_secret', 'Push_apn_passphrase', 'Push_apn_key', 'Push_apn_cert', 'Push_apn_dev_passphrase',\n\t\t\t'Push_apn_dev_key', 'Push_apn_dev_cert', 'Push_gcm_api_key', 'Push_gcm_project_number', 'SAML_Custom_Default_cert',\n\t\t\t'SAML_Custom_Default_private_key', 'SlackBridge_APIToken', 'Smarsh_Email', 'SMS_Twilio_Account_SID', 'SMS_Twilio_authToken',\n\t\t];\n\t}\n\n\tasync getAll(appId) {\n\t\tconsole.log(`The App ${ appId } is getting all the settings.`);\n\n\t\treturn RocketChat.models.Settings.find({ _id: { $nin: this.disallowedSettings } })\n\t\t\t.fetch()\n\t\t\t.map((s) => this.orch.getConverters().get('settings').convertToApp(s));\n\t}\n\n\tasync getOneById(id, appId) {\n\t\tconsole.log(`The App ${ appId } is getting the setting by id ${ id }.`);\n\n\t\tif (!this.isReadableById(id, appId)) {\n\t\t\tthrow new Error(`The setting \"${ id }\" is not readable.`);\n\t\t}\n\n\t\treturn this.orch.getConverters().get('settings').convertById(id);\n\t}\n\n\tasync hideGroup(name, appId) {\n\t\tconsole.log(`The App ${ appId } is hidding the group ${ name }.`);\n\n\t\tthrow new Error('Method not implemented.');\n\t}\n\n\tasync hideSetting(id, appId) {\n\t\tconsole.log(`The App ${ appId } is hidding the setting ${ id }.`);\n\n\t\tif (!this.isReadableById(id, appId)) {\n\t\t\tthrow new Error(`The setting \"${ id }\" is not readable.`);\n\t\t}\n\n\t\tthrow new Error('Method not implemented.');\n\t}\n\n\tasync isReadableById(id, appId) {\n\t\tconsole.log(`The App ${ appId } is checking if they can read the setting ${ id }.`);\n\n\t\treturn !this.disallowedSettings.includes(id);\n\t}\n\n\tasync updateOne(setting, appId) {\n\t\tconsole.log(`The App ${ appId } is updating the setting ${ setting.id } .`);\n\n\t\tif (!this.isReadableById(setting.id, appId)) {\n\t\t\tthrow new Error(`The setting \"${ setting.id }\" is not readable.`);\n\t\t}\n\n\t\tthrow new Error('Method not implemented.');\n\t}\n}\n","export class AppUserBridge {\n\tconstructor(orch) {\n\t\tthis.orch = orch;\n\t}\n\n\tasync getById(userId, appId) {\n\t\tconsole.log(`The App ${ appId } is getting the userId: \"${ userId }\"`);\n\n\t\treturn this.orch.getConverters().get('users').convertById(userId);\n\t}\n\n\tasync getByUsername(username, appId) {\n\t\tconsole.log(`The App ${ appId } is getting the username: \"${ username }\"`);\n\n\t\treturn this.orch.getConverters().get('users').convertByUsername(username);\n\t}\n}\n","import { RealAppBridges } from './bridges';\nimport { AppActivationBridge } from './activation';\nimport { AppCommandsBridge } from './commands';\nimport { AppEnvironmentalVariableBridge } from './environmental';\nimport { AppHttpBridge } from './http';\nimport { AppListenerBridge } from './listeners';\nimport { AppMessageBridge } from './messages';\nimport { AppPersistenceBridge } from './persistence';\nimport { AppRoomBridge } from './rooms';\nimport { AppSettingBridge } from './settings';\nimport { AppUserBridge } from './users';\n\nexport {\n\tRealAppBridges,\n\tAppActivationBridge,\n\tAppCommandsBridge,\n\tAppEnvironmentalVariableBridge,\n\tAppHttpBridge,\n\tAppListenerBridge,\n\tAppMessageBridge,\n\tAppPersistenceBridge,\n\tAppRoomBridge,\n\tAppSettingBridge,\n\tAppUserBridge,\n};\n","import express from 'express';\nimport { WebApp } from 'meteor/webapp';\n\nconst apiServer = express();\nWebApp.connectHandlers.use(apiServer);\n\nexport class AppApisBridge {\n\tconstructor(orch) {\n\t\tthis.orch = orch;\n\t\tthis.appRouters = new Map();\n\n\t\t// apiServer.use('/api/apps', (req, res, next) => {\n\t\t// \tconsole.log({\n\t\t// \t\tmethod: req.method.toLowerCase(),\n\t\t// \t\turl: req.url,\n\t\t// \t\tquery: req.query,\n\t\t// \t\tbody: req.body,\n\t\t// \t});\n\t\t// \tnext();\n\t\t// });\n\n\t\tapiServer.use('/api/apps/private/:appId/:hash', (req, res) => {\n\t\t\tconst notFound = () => res.send(404);\n\n\t\t\tconst router = this.appRouters.get(req.params.appId);\n\n\t\t\tif (router) {\n\t\t\t\treq._privateHash = req.params.hash;\n\t\t\t\treturn router(req, res, notFound);\n\t\t\t}\n\n\t\t\tnotFound();\n\t\t});\n\n\t\tapiServer.use('/api/apps/public/:appId', (req, res) => {\n\t\t\tconst notFound = () => res.send(404);\n\n\t\t\tconst router = this.appRouters.get(req.params.appId);\n\n\t\t\tif (router) {\n\t\t\t\treturn router(req, res, notFound);\n\t\t\t}\n\n\t\t\tnotFound();\n\t\t});\n\t}\n\n\tregisterApi({ api, computedPath, endpoint }, appId) {\n\t\tconsole.log(`The App ${ appId } is registering the api: \"${ endpoint.path }\" (${ computedPath })`);\n\n\t\tthis._verifyApi(api, endpoint);\n\n\t\tif (!this.appRouters.get(appId)) {\n\t\t\tthis.appRouters.set(appId, express.Router()); // eslint-disable-line\n\t\t}\n\n\t\tconst router = this.appRouters.get(appId);\n\n\t\tconst method = api.method || 'all';\n\n\t\tlet routePath = endpoint.path.trim();\n\t\tif (!routePath.startsWith('/')) {\n\t\t\troutePath = `/${ routePath }`;\n\t\t}\n\n\t\trouter[method](routePath, Meteor.bindEnvironment(this._appApiExecutor(api, endpoint, appId)));\n\t}\n\n\tunregisterApis(appId) {\n\t\tconsole.log(`The App ${ appId } is unregistering all apis`);\n\n\t\tif (this.appRouters.get(appId)) {\n\t\t\tthis.appRouters.delete(appId);\n\t\t}\n\t}\n\n\t_verifyApi(api, endpoint) {\n\t\tif (typeof api !== 'object') {\n\t\t\tthrow new Error('Invalid Api parameter provided, it must be a valid IApi object.');\n\t\t}\n\n\t\tif (typeof endpoint.path !== 'string') {\n\t\t\tthrow new Error('Invalid Api parameter provided, it must be a valid IApi object.');\n\t\t}\n\t}\n\n\t_appApiExecutor(api, endpoint, appId) {\n\t\treturn (req, res) => {\n\t\t\tconst request = {\n\t\t\t\tmethod: req.method.toLowerCase(),\n\t\t\t\theaders: req.headers,\n\t\t\t\tquery: req.query || {},\n\t\t\t\tparams: req.params || {},\n\t\t\t\tcontent: req.body,\n\t\t\t\tprivateHash: req._privateHash,\n\t\t\t};\n\n\t\t\tthis.orch.getManager().getApiManager().executeApi(appId, endpoint.path, request)\n\t\t\t\t.then(({ status, headers = {}, content }) => {\n\t\t\t\t\tres.set(headers);\n\t\t\t\t\tres.status(status);\n\t\t\t\t\tres.send(content);\n\t\t\t\t})\n\t\t\t\t.catch((reason) => {\n\t\t\t\t\t// Should we handle this as an error?\n\t\t\t\t\tres.status(500).send(reason.message);\n\t\t\t\t});\n\t\t};\n\t}\n}\n","export class AppDetailChangesBridge {\n\tconstructor(orch) {\n\t\tthis.orch = orch;\n\t}\n\n\tonAppSettingsChange(appId, setting) {\n\t\ttry {\n\t\t\tthis.orch.getNotifier().appSettingsChange(appId, setting);\n\t\t} catch (e) {\n\t\t\tconsole.warn('failed to notify about the setting change.', appId);\n\t\t}\n\t}\n}\n","export class AppHttpBridge {\n\tasync call(info) {\n\t\tif (!info.request.content && typeof info.request.data === 'object') {\n\t\t\tinfo.request.content = JSON.stringify(info.request.data);\n\t\t}\n\n\t\tconsole.log(`The App ${ info.appId } is requesting from the outter webs:`, info);\n\n\t\ttry {\n\t\t\treturn HTTP.call(info.method, info.url, info.request);\n\t\t} catch (e) {\n\t\t\treturn e.response;\n\t\t}\n\t}\n}\n","export class AppListenerBridge {\n\tconstructor(orch) {\n\t\tthis.orch = orch;\n\t}\n\n\tasync messageEvent(inte, message) {\n\t\tconst msg = this.orch.getConverters().get('messages').convertMessage(message);\n\t\tconst result = await this.orch.getManager().getListenerManager().executeListener(inte, msg);\n\n\t\tif (typeof result === 'boolean') {\n\t\t\treturn result;\n\t\t} else {\n\t\t\treturn this.orch.getConverters().get('messages').convertAppMessage(result);\n\t\t}\n\t\t// try {\n\n\t\t// } catch (e) {\n\t\t// \tconsole.log(`${ e.name }: ${ e.message }`);\n\t\t// \tconsole.log(e.stack);\n\t\t// }\n\t}\n\n\tasync roomEvent(inte, room) {\n\t\tconst rm = this.orch.getConverters().get('rooms').convertRoom(room);\n\t\tconst result = await this.orch.getManager().getListenerManager().executeListener(inte, rm);\n\n\t\tif (typeof result === 'boolean') {\n\t\t\treturn result;\n\t\t} else {\n\t\t\treturn this.orch.getConverters().get('rooms').convertAppRoom(result);\n\t\t}\n\t\t// try {\n\n\t\t// } catch (e) {\n\t\t// \tconsole.log(`${ e.name }: ${ e.message }`);\n\t\t// \tconsole.log(e.stack);\n\t\t// }\n\t}\n}\n","const waitToLoad = function(orch) {\n\treturn new Promise((resolve) => {\n\t\tlet id = setInterval(() => {\n\t\t\tif (orch.isEnabled() && orch.isLoaded()) {\n\t\t\t\tclearInterval(id);\n\t\t\t\tid = -1;\n\t\t\t\tresolve();\n\t\t\t}\n\t\t}, 100);\n\t});\n};\n\nconst waitToUnload = function(orch) {\n\treturn new Promise((resolve) => {\n\t\tlet id = setInterval(() => {\n\t\t\tif (!orch.isEnabled() && !orch.isLoaded()) {\n\t\t\t\tclearInterval(id);\n\t\t\t\tid = -1;\n\t\t\t\tresolve();\n\t\t\t}\n\t\t}, 100);\n\t});\n};\n\nexport class AppMethods {\n\tconstructor(orch) {\n\t\tthis._orch = orch;\n\n\t\tthis._addMethods();\n\t}\n\n\tisEnabled() {\n\t\treturn typeof this._orch !== 'undefined' && this._orch.isEnabled();\n\t}\n\n\tisLoaded() {\n\t\treturn typeof this._orch !== 'undefined' && this._orch.isEnabled() && this._orch.isLoaded();\n\t}\n\n\t_addMethods() {\n\t\tconst instance = this;\n\n\t\tMeteor.methods({\n\t\t\t'apps/is-enabled'() {\n\t\t\t\treturn instance.isEnabled();\n\t\t\t},\n\n\t\t\t'apps/is-loaded'() {\n\t\t\t\treturn instance.isLoaded();\n\t\t\t},\n\n\t\t\t'apps/go-enable'() {\n\t\t\t\tif (!Meteor.userId()) {\n\t\t\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\t\t\tmethod: 'apps/go-enable',\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'manage-apps')) {\n\t\t\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Not allowed', {\n\t\t\t\t\t\tmethod: 'apps/go-enable',\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tRocketChat.settings.set('Apps_Framework_enabled', true);\n\n\t\t\t\tPromise.await(waitToLoad(instance._orch));\n\t\t\t},\n\n\t\t\t'apps/go-disable'() {\n\t\t\t\tif (!Meteor.userId()) {\n\t\t\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\t\t\tmethod: 'apps/go-enable',\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'manage-apps')) {\n\t\t\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Not allowed', {\n\t\t\t\t\t\tmethod: 'apps/go-enable',\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tRocketChat.settings.set('Apps_Framework_enabled', false);\n\n\t\t\t\tPromise.await(waitToUnload(instance._orch));\n\t\t\t},\n\t\t});\n\t}\n}\n","import Busboy from 'busboy';\n\nexport class AppsRestApi {\n\tconstructor(orch, manager) {\n\t\tthis._orch = orch;\n\t\tthis._manager = manager;\n\t\tthis.api = new RocketChat.API.ApiClass({\n\t\t\tversion: 'apps',\n\t\t\tuseDefaultAuth: true,\n\t\t\tprettyJson: false,\n\t\t\tenableCors: false,\n\t\t\tauth: RocketChat.API.getUserAuth(),\n\t\t});\n\n\t\tthis.addManagementRoutes();\n\t}\n\n\t_handleFile(request, fileField) {\n\t\tconst busboy = new Busboy({ headers: request.headers });\n\n\t\treturn Meteor.wrapAsync((callback) => {\n\t\t\tbusboy.on('file', Meteor.bindEnvironment((fieldname, file) => {\n\t\t\t\tif (fieldname !== fileField) {\n\t\t\t\t\treturn callback(new Meteor.Error('invalid-field', `Expected the field \"${ fileField }\" but got \"${ fieldname }\" instead.`));\n\t\t\t\t}\n\n\t\t\t\tconst fileData = [];\n\t\t\t\tfile.on('data', Meteor.bindEnvironment((data) => {\n\t\t\t\t\tfileData.push(data);\n\t\t\t\t}));\n\n\t\t\t\tfile.on('end', Meteor.bindEnvironment(() => callback(undefined, Buffer.concat(fileData))));\n\t\t\t}));\n\n\t\t\trequest.pipe(busboy);\n\t\t})();\n\t}\n\n\taddManagementRoutes() {\n\t\tconst orchestrator = this._orch;\n\t\tconst manager = this._manager;\n\t\tconst fileHandler = this._handleFile;\n\n\t\tthis.api.addRoute('', { authRequired: true }, {\n\t\t\tget() {\n\t\t\t\tconst apps = manager.get().map((prl) => {\n\t\t\t\t\tconst info = prl.getInfo();\n\t\t\t\t\tinfo.languages = prl.getStorageItem().languageContent;\n\t\t\t\t\tinfo.status = prl.getStatus();\n\n\t\t\t\t\treturn info;\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.API.v1.success({ apps });\n\t\t\t},\n\t\t\tpost() {\n\t\t\t\tlet buff;\n\n\t\t\t\tif (this.bodyParams.url) {\n\t\t\t\t\tconst result = HTTP.call('GET', this.bodyParams.url, { npmRequestOptions: { encoding: 'base64' } });\n\n\t\t\t\t\tif (result.statusCode !== 200 || !result.headers['content-type'] || result.headers['content-type'] !== 'application/zip') {\n\t\t\t\t\t\treturn RocketChat.API.v1.failure({ error: 'Invalid url. It doesn\\'t exist or is not \"application/zip\".' });\n\t\t\t\t\t}\n\n\t\t\t\t\tbuff = Buffer.from(result.content, 'base64');\n\t\t\t\t} else {\n\t\t\t\t\tbuff = fileHandler(this.request, 'app');\n\t\t\t\t}\n\n\t\t\t\tif (!buff) {\n\t\t\t\t\treturn RocketChat.API.v1.failure({ error: 'Failed to get a file to install for the App. ' });\n\t\t\t\t}\n\n\t\t\t\tconst aff = Promise.await(manager.add(buff.toString('base64'), false));\n\t\t\t\tconst info = aff.getAppInfo();\n\n\t\t\t\t// If there are compiler errors, there won't be an App to get the status of\n\t\t\t\tif (aff.getApp()) {\n\t\t\t\t\tinfo.status = aff.getApp().getStatus();\n\t\t\t\t} else {\n\t\t\t\t\tinfo.status = 'compiler_error';\n\t\t\t\t}\n\n\t\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\t\tapp: info,\n\t\t\t\t\timplemented: aff.getImplementedInferfaces(),\n\t\t\t\t\tcompilerErrors: aff.getCompilerErrors(),\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\n\t\tthis.api.addRoute('languages', { authRequired: false }, {\n\t\t\tget() {\n\t\t\t\tconst apps = manager.get().map((prl) => ({\n\t\t\t\t\tid: prl.getID(),\n\t\t\t\t\tlanguages: prl.getStorageItem().languageContent,\n\t\t\t\t}));\n\n\t\t\t\treturn RocketChat.API.v1.success({ apps });\n\t\t\t},\n\t\t});\n\n\t\tthis.api.addRoute(':id', { authRequired: true }, {\n\t\t\tget() {\n\t\t\t\tconsole.log('Getting:', this.urlParams.id);\n\t\t\t\tconst prl = manager.getOneById(this.urlParams.id);\n\n\t\t\t\tif (prl) {\n\t\t\t\t\tconst info = prl.getInfo();\n\t\t\t\t\tinfo.status = prl.getStatus();\n\n\t\t\t\t\treturn RocketChat.API.v1.success({ app: info });\n\t\t\t\t} else {\n\t\t\t\t\treturn RocketChat.API.v1.notFound(`No App found by the id of: ${ this.urlParams.id }`);\n\t\t\t\t}\n\t\t\t},\n\t\t\tpost() {\n\t\t\t\tconsole.log('Updating:', this.urlParams.id);\n\t\t\t\t// TODO: Verify permissions\n\n\t\t\t\tlet buff;\n\n\t\t\t\tif (this.bodyParams.url) {\n\t\t\t\t\tconst result = HTTP.call('GET', this.bodyParams.url, { npmRequestOptions: { encoding: 'base64' } });\n\n\t\t\t\t\tif (result.statusCode !== 200 || !result.headers['content-type'] || result.headers['content-type'] !== 'application/zip') {\n\t\t\t\t\t\treturn RocketChat.API.v1.failure({ error: 'Invalid url. It doesn\\'t exist or is not \"application/zip\".' });\n\t\t\t\t\t}\n\n\t\t\t\t\tbuff = Buffer.from(result.content, 'base64');\n\t\t\t\t} else {\n\t\t\t\t\tbuff = fileHandler(this.request, 'app');\n\t\t\t\t}\n\n\t\t\t\tif (!buff) {\n\t\t\t\t\treturn RocketChat.API.v1.failure({ error: 'Failed to get a file to install for the App. ' });\n\t\t\t\t}\n\n\t\t\t\tconst aff = Promise.await(manager.update(buff.toString('base64')));\n\t\t\t\tconst info = aff.getAppInfo();\n\n\t\t\t\t// Should the updated version have compiler errors, no App will be returned\n\t\t\t\tif (aff.getApp()) {\n\t\t\t\t\tinfo.status = aff.getApp().getStatus();\n\t\t\t\t} else {\n\t\t\t\t\tinfo.status = 'compiler_error';\n\t\t\t\t}\n\n\t\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\t\tapp: info,\n\t\t\t\t\timplemented: aff.getImplementedInferfaces(),\n\t\t\t\t\tcompilerErrors: aff.getCompilerErrors(),\n\t\t\t\t});\n\t\t\t},\n\t\t\tdelete() {\n\t\t\t\tconsole.log('Uninstalling:', this.urlParams.id);\n\t\t\t\tconst prl = manager.getOneById(this.urlParams.id);\n\n\t\t\t\tif (prl) {\n\t\t\t\t\tPromise.await(manager.remove(prl.getID()));\n\n\t\t\t\t\tconst info = prl.getInfo();\n\t\t\t\t\tinfo.status = prl.getStatus();\n\n\t\t\t\t\treturn RocketChat.API.v1.success({ app: info });\n\t\t\t\t} else {\n\t\t\t\t\treturn RocketChat.API.v1.notFound(`No App found by the id of: ${ this.urlParams.id }`);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tthis.api.addRoute(':id/icon', { authRequired: true }, {\n\t\t\tget() {\n\t\t\t\tconsole.log('Getting the App\\'s Icon:', this.urlParams.id);\n\t\t\t\tconst prl = manager.getOneById(this.urlParams.id);\n\n\t\t\t\tif (prl) {\n\t\t\t\t\tconst info = prl.getInfo();\n\n\t\t\t\t\treturn RocketChat.API.v1.success({ iconFileContent: info.iconFileContent });\n\t\t\t\t} else {\n\t\t\t\t\treturn RocketChat.API.v1.notFound(`No App found by the id of: ${ this.urlParams.id }`);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tthis.api.addRoute(':id/languages', { authRequired: false }, {\n\t\t\tget() {\n\t\t\t\tconsole.log(`Getting ${ this.urlParams.id }'s languages..`);\n\t\t\t\tconst prl = manager.getOneById(this.urlParams.id);\n\n\t\t\t\tif (prl) {\n\t\t\t\t\tconst languages = prl.getStorageItem().languageContent || {};\n\n\t\t\t\t\treturn RocketChat.API.v1.success({ languages });\n\t\t\t\t} else {\n\t\t\t\t\treturn RocketChat.API.v1.notFound(`No App found by the id of: ${ this.urlParams.id }`);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tthis.api.addRoute(':id/logs', { authRequired: true }, {\n\t\t\tget() {\n\t\t\t\tconsole.log(`Getting ${ this.urlParams.id }'s logs..`);\n\t\t\t\tconst prl = manager.getOneById(this.urlParams.id);\n\n\t\t\t\tif (prl) {\n\t\t\t\t\tconst { offset, count } = this.getPaginationItems();\n\t\t\t\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\t\t\t\tconst ourQuery = Object.assign({}, query, { appId: prl.getID() });\n\t\t\t\t\tconst options = {\n\t\t\t\t\t\tsort: sort ? sort : { _updatedAt: -1 },\n\t\t\t\t\t\tskip: offset,\n\t\t\t\t\t\tlimit: count,\n\t\t\t\t\t\tfields,\n\t\t\t\t\t};\n\n\t\t\t\t\tconst logs = Promise.await(orchestrator.getLogStorage().find(ourQuery, options));\n\n\t\t\t\t\treturn RocketChat.API.v1.success({ logs });\n\t\t\t\t} else {\n\t\t\t\t\treturn RocketChat.API.v1.notFound(`No App found by the id of: ${ this.urlParams.id }`);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tthis.api.addRoute(':id/settings', { authRequired: true }, {\n\t\t\tget() {\n\t\t\t\tconsole.log(`Getting ${ this.urlParams.id }'s settings..`);\n\t\t\t\tconst prl = manager.getOneById(this.urlParams.id);\n\n\t\t\t\tif (prl) {\n\t\t\t\t\tconst settings = Object.assign({}, prl.getStorageItem().settings);\n\n\t\t\t\t\tObject.keys(settings).forEach((k) => {\n\t\t\t\t\t\tif (settings[k].hidden) {\n\t\t\t\t\t\t\tdelete settings[k];\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\treturn RocketChat.API.v1.success({ settings });\n\t\t\t\t} else {\n\t\t\t\t\treturn RocketChat.API.v1.notFound(`No App found by the id of: ${ this.urlParams.id }`);\n\t\t\t\t}\n\t\t\t},\n\t\t\tpost() {\n\t\t\t\tconsole.log(`Updating ${ this.urlParams.id }'s settings..`);\n\t\t\t\tif (!this.bodyParams || !this.bodyParams.settings) {\n\t\t\t\t\treturn RocketChat.API.v1.failure('The settings to update must be present.');\n\t\t\t\t}\n\n\t\t\t\tconst prl = manager.getOneById(this.urlParams.id);\n\n\t\t\t\tif (!prl) {\n\t\t\t\t\treturn RocketChat.API.v1.notFound(`No App found by the id of: ${ this.urlParams.id }`);\n\t\t\t\t}\n\n\t\t\t\tconst { settings } = prl.getStorageItem();\n\n\t\t\t\tconst updated = [];\n\t\t\t\tthis.bodyParams.settings.forEach((s) => {\n\t\t\t\t\tif (settings[s.id]) {\n\t\t\t\t\t\tPromise.await(manager.getSettingsManager().updateAppSetting(this.urlParams.id, s));\n\t\t\t\t\t\t// Updating?\n\t\t\t\t\t\tupdated.push(s);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.API.v1.success({ updated });\n\t\t\t},\n\t\t});\n\n\t\tthis.api.addRoute(':id/settings/:settingId', { authRequired: true }, {\n\t\t\tget() {\n\t\t\t\tconsole.log(`Getting the App ${ this.urlParams.id }'s setting ${ this.urlParams.settingId }`);\n\n\t\t\t\ttry {\n\t\t\t\t\tconst setting = manager.getSettingsManager().getAppSetting(this.urlParams.id, this.urlParams.settingId);\n\n\t\t\t\t\tRocketChat.API.v1.success({ setting });\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (e.message.includes('No setting found')) {\n\t\t\t\t\t\treturn RocketChat.API.v1.notFound(`No Setting found on the App by the id of: \"${ this.urlParams.settingId }\"`);\n\t\t\t\t\t} else if (e.message.includes('No App found')) {\n\t\t\t\t\t\treturn RocketChat.API.v1.notFound(`No App found by the id of: ${ this.urlParams.id }`);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn RocketChat.API.v1.failure(e.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tpost() {\n\t\t\t\tconsole.log(`Updating the App ${ this.urlParams.id }'s setting ${ this.urlParams.settingId }`);\n\n\t\t\t\tif (!this.bodyParams.setting) {\n\t\t\t\t\treturn RocketChat.API.v1.failure('Setting to update to must be present on the posted body.');\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tPromise.await(manager.getSettingsManager().updateAppSetting(this.urlParams.id, this.bodyParams.setting));\n\n\t\t\t\t\treturn RocketChat.API.v1.success();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (e.message.includes('No setting found')) {\n\t\t\t\t\t\treturn RocketChat.API.v1.notFound(`No Setting found on the App by the id of: \"${ this.urlParams.settingId }\"`);\n\t\t\t\t\t} else if (e.message.includes('No App found')) {\n\t\t\t\t\t\treturn RocketChat.API.v1.notFound(`No App found by the id of: ${ this.urlParams.id }`);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn RocketChat.API.v1.failure(e.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tthis.api.addRoute(':id/apis', { authRequired: true }, {\n\t\t\tget() {\n\t\t\t\tconsole.log(`Getting ${ this.urlParams.id }'s apis..`);\n\t\t\t\tconst prl = manager.getOneById(this.urlParams.id);\n\n\t\t\t\tif (prl) {\n\t\t\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\t\t\tapis: manager.apiManager.listApis(this.urlParams.id),\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturn RocketChat.API.v1.notFound(`No App found by the id of: ${ this.urlParams.id }`);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tthis.api.addRoute(':id/status', { authRequired: true }, {\n\t\t\tget() {\n\t\t\t\tconsole.log(`Getting ${ this.urlParams.id }'s status..`);\n\t\t\t\tconst prl = manager.getOneById(this.urlParams.id);\n\n\t\t\t\tif (prl) {\n\t\t\t\t\treturn RocketChat.API.v1.success({ status: prl.getStatus() });\n\t\t\t\t} else {\n\t\t\t\t\treturn RocketChat.API.v1.notFound(`No App found by the id of: ${ this.urlParams.id }`);\n\t\t\t\t}\n\t\t\t},\n\t\t\tpost() {\n\t\t\t\tif (!this.bodyParams.status || typeof this.bodyParams.status !== 'string') {\n\t\t\t\t\treturn RocketChat.API.v1.failure('Invalid status provided, it must be \"status\" field and a string.');\n\t\t\t\t}\n\n\t\t\t\tconsole.log(`Updating ${ this.urlParams.id }'s status...`, this.bodyParams.status);\n\t\t\t\tconst prl = manager.getOneById(this.urlParams.id);\n\n\t\t\t\tif (prl) {\n\t\t\t\t\tconst result = Promise.await(manager.changeStatus(prl.getID(), this.bodyParams.status));\n\n\t\t\t\t\treturn RocketChat.API.v1.success({ status: result.getStatus() });\n\t\t\t\t} else {\n\t\t\t\t\treturn RocketChat.API.v1.notFound(`No App found by the id of: ${ this.urlParams.id }`);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n}\n","import { AppStatus, AppStatusUtils } from '@rocket.chat/apps-engine/definition/AppStatus';\n\nexport const AppEvents = Object.freeze({\n\tAPP_ADDED: 'app/added',\n\tAPP_REMOVED: 'app/removed',\n\tAPP_UPDATED: 'app/updated',\n\tAPP_STATUS_CHANGE: 'app/statusUpdate',\n\tAPP_SETTING_UPDATED: 'app/settingUpdated',\n\tCOMMAND_ADDED: 'command/added',\n\tCOMMAND_DISABLED: 'command/disabled',\n\tCOMMAND_UPDATED: 'command/updated',\n\tCOMMAND_REMOVED: 'command/removed',\n});\n\nexport class AppServerListener {\n\tconstructor(orch, engineStreamer, clientStreamer, received) {\n\t\tthis.orch = orch;\n\t\tthis.engineStreamer = engineStreamer;\n\t\tthis.clientStreamer = clientStreamer;\n\t\tthis.received = received;\n\n\t\tthis.engineStreamer.on(AppEvents.APP_ADDED, this.onAppAdded.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.APP_STATUS_CHANGE, this.onAppStatusUpdated.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.APP_SETTING_UPDATED, this.onAppSettingUpdated.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.APP_REMOVED, this.onAppRemoved.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.APP_UPDATED, this.onAppUpdated.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.COMMAND_ADDED, this.onCommandAdded.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.COMMAND_DISABLED, this.onCommandDisabled.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.COMMAND_UPDATED, this.onCommandUpdated.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.COMMAND_REMOVED, this.onCommandRemoved.bind(this));\n\t}\n\n\tasync onAppAdded(appId) {\n\t\tawait this.orch.getManager().loadOne(appId);\n\t\tthis.clientStreamer.emit(AppEvents.APP_ADDED, appId);\n\t}\n\n\tasync onAppStatusUpdated({ appId, status }) {\n\t\tthis.received.set(`${ AppEvents.APP_STATUS_CHANGE }_${ appId }`, { appId, status, when: new Date() });\n\n\t\tif (AppStatusUtils.isEnabled(status)) {\n\t\t\tawait this.orch.getManager().enable(appId);\n\t\t\tthis.clientStreamer.emit(AppEvents.APP_STATUS_CHANGE, { appId, status });\n\t\t} else if (AppStatusUtils.isDisabled(status)) {\n\t\t\tawait this.orch.getManager().disable(appId, AppStatus.MANUALLY_DISABLED === status);\n\t\t\tthis.clientStreamer.emit(AppEvents.APP_STATUS_CHANGE, { appId, status });\n\t\t}\n\t}\n\n\tasync onAppSettingUpdated({ appId, setting }) {\n\t\tthis.received.set(`${ AppEvents.APP_SETTING_UPDATED }_${ appId }_${ setting.id }`, { appId, setting, when: new Date() });\n\n\t\tawait this.orch.getManager().getSettingsManager().updateAppSetting(appId, setting);\n\t\tthis.clientStreamer.emit(AppEvents.APP_SETTING_UPDATED, { appId });\n\t}\n\n\tasync onAppUpdated(appId) {\n\t\tthis.received.set(`${ AppEvents.APP_UPDATED }_${ appId }`, { appId, when: new Date() });\n\n\t\tconst storageItem = await this.orch.getStorage().retrieveOne(appId);\n\n\t\tawait this.orch.getManager().update(storageItem.zip);\n\t\tthis.clientStreamer.emit(AppEvents.APP_UPDATED, appId);\n\t}\n\n\tasync onAppRemoved(appId) {\n\t\tawait this.orch.getManager().remove(appId);\n\t\tthis.clientStreamer.emit(AppEvents.APP_REMOVED, appId);\n\t}\n\n\tasync onCommandAdded(command) {\n\t\tthis.clientStreamer.emit(AppEvents.COMMAND_ADDED, command);\n\t}\n\n\tasync onCommandDisabled(command) {\n\t\tthis.clientStreamer.emit(AppEvents.COMMAND_DISABLED, command);\n\t}\n\n\tasync onCommandUpdated(command) {\n\t\tthis.clientStreamer.emit(AppEvents.COMMAND_UPDATED, command);\n\t}\n\n\tasync onCommandRemoved(command) {\n\t\tthis.clientStreamer.emit(AppEvents.COMMAND_REMOVED, command);\n\t}\n}\n\nexport class AppServerNotifier {\n\tconstructor(orch) {\n\t\tthis.engineStreamer = new Meteor.Streamer('apps-engine', { retransmit: false });\n\t\tthis.engineStreamer.serverOnly = true;\n\t\tthis.engineStreamer.allowRead('none');\n\t\tthis.engineStreamer.allowEmit('all');\n\t\tthis.engineStreamer.allowWrite('none');\n\n\t\t// This is used to broadcast to the web clients\n\t\tthis.clientStreamer = new Meteor.Streamer('apps', { retransmit: false });\n\t\tthis.clientStreamer.serverOnly = true;\n\t\tthis.clientStreamer.allowRead('all');\n\t\tthis.clientStreamer.allowEmit('all');\n\t\tthis.clientStreamer.allowWrite('none');\n\n\t\tthis.received = new Map();\n\t\tthis.listener = new AppServerListener(orch, this.engineStreamer, this.clientStreamer, this.received);\n\t}\n\n\tasync appAdded(appId) {\n\t\tthis.engineStreamer.emit(AppEvents.APP_ADDED, appId);\n\t\tthis.clientStreamer.emit(AppEvents.APP_ADDED, appId);\n\t}\n\n\tasync appRemoved(appId) {\n\t\tthis.engineStreamer.emit(AppEvents.APP_REMOVED, appId);\n\t\tthis.clientStreamer.emit(AppEvents.APP_REMOVED, appId);\n\t}\n\n\tasync appUpdated(appId) {\n\t\tif (this.received.has(`${ AppEvents.APP_UPDATED }_${ appId }`)) {\n\t\t\tthis.received.delete(`${ AppEvents.APP_UPDATED }_${ appId }`);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.engineStreamer.emit(AppEvents.APP_UPDATED, appId);\n\t\tthis.clientStreamer.emit(AppEvents.APP_UPDATED, appId);\n\t}\n\n\tasync appStatusUpdated(appId, status) {\n\t\tif (this.received.has(`${ AppEvents.APP_STATUS_CHANGE }_${ appId }`)) {\n\t\t\tconst details = this.received.get(`${ AppEvents.APP_STATUS_CHANGE }_${ appId }`);\n\t\t\tif (details.status === status) {\n\t\t\t\tthis.received.delete(`${ AppEvents.APP_STATUS_CHANGE }_${ appId }`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.engineStreamer.emit(AppEvents.APP_STATUS_CHANGE, { appId, status });\n\t\tthis.clientStreamer.emit(AppEvents.APP_STATUS_CHANGE, { appId, status });\n\t}\n\n\tasync appSettingsChange(appId, setting) {\n\t\tif (this.received.has(`${ AppEvents.APP_SETTING_UPDATED }_${ appId }_${ setting.id }`)) {\n\t\t\tthis.received.delete(`${ AppEvents.APP_SETTING_UPDATED }_${ appId }_${ setting.id }`);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.engineStreamer.emit(AppEvents.APP_SETTING_UPDATED, { appId, setting });\n\t\tthis.clientStreamer.emit(AppEvents.APP_SETTING_UPDATED, { appId });\n\t}\n\n\tasync commandAdded(command) {\n\t\tthis.engineStreamer.emit(AppEvents.COMMAND_ADDED, command);\n\t\tthis.clientStreamer.emit(AppEvents.COMMAND_ADDED, command);\n\t}\n\n\tasync commandDisabled(command) {\n\t\tthis.engineStreamer.emit(AppEvents.COMMAND_DISABLED, command);\n\t\tthis.clientStreamer.emit(AppEvents.COMMAND_DISABLED, command);\n\t}\n\n\tasync commandUpdated(command) {\n\t\tthis.engineStreamer.emit(AppEvents.COMMAND_UPDATED, command);\n\t\tthis.clientStreamer.emit(AppEvents.COMMAND_UPDATED, command);\n\t}\n\n\tasync commandRemoved(command) {\n\t\tthis.engineStreamer.emit(AppEvents.COMMAND_REMOVED, command);\n\t\tthis.clientStreamer.emit(AppEvents.COMMAND_REMOVED, command);\n\t}\n}\n","import { AppMethods } from './methods';\nimport { AppsRestApi } from './rest';\nimport { AppEvents, AppServerNotifier, AppServerListener } from './websockets';\n\nexport {\n\tAppMethods,\n\tAppsRestApi,\n\tAppEvents,\n\tAppServerNotifier,\n\tAppServerListener,\n};\n","export class AppMessagesConverter {\n\tconstructor(orch) {\n\t\tthis.orch = orch;\n\t}\n\n\tconvertById(msgId) {\n\t\tconst msg = RocketChat.models.Messages.getOneById(msgId);\n\n\t\treturn this.convertMessage(msg);\n\t}\n\n\tconvertMessage(msgObj) {\n\t\tif (!msgObj) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst room = this.orch.getConverters().get('rooms').convertById(msgObj.rid);\n\n\t\tlet sender;\n\t\tif (msgObj.u && msgObj.u._id) {\n\t\t\tsender = this.orch.getConverters().get('users').convertById(msgObj.u._id);\n\n\t\t\tif (!sender) {\n\t\t\t\tsender = this.orch.getConverters().get('users').convertToApp(msgObj.u);\n\t\t\t}\n\t\t}\n\n\t\tlet editor;\n\t\tif (msgObj.editedBy) {\n\t\t\teditor = this.orch.getConverters().get('users').convertById(msgObj.editedBy._id);\n\t\t}\n\n\t\tconst attachments = this._convertAttachmentsToApp(msgObj.attachments);\n\n\t\treturn {\n\t\t\tid: msgObj._id,\n\t\t\troom,\n\t\t\tsender,\n\t\t\ttext: msgObj.msg,\n\t\t\tcreatedAt: msgObj.ts,\n\t\t\tupdatedAt: msgObj._updatedAt,\n\t\t\teditor,\n\t\t\teditedAt: msgObj.editedAt,\n\t\t\temoji: msgObj.emoji,\n\t\t\tavatarUrl: msgObj.avatar,\n\t\t\talias: msgObj.alias,\n\t\t\tcustomFields: msgObj.customFields,\n\t\t\tgroupable: msgObj.groupable,\n\t\t\tattachments,\n\t\t\treactions: msgObj.reactions,\n\t\t};\n\t}\n\n\tconvertAppMessage(message) {\n\t\tif (!message) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(message.room.id);\n\n\t\tif (!room) {\n\t\t\tthrow new Error('Invalid room provided on the message.');\n\t\t}\n\n\t\tlet u;\n\t\tif (message.sender && message.sender.id) {\n\t\t\tconst user = RocketChat.models.Users.findOneById(message.sender.id);\n\n\t\t\tif (user) {\n\t\t\t\tu = {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tu = {\n\t\t\t\t\t_id: message.sender.id,\n\t\t\t\t\tusername: message.sender.username,\n\t\t\t\t\tname: message.sender.name,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tlet editedBy;\n\t\tif (message.editor) {\n\t\t\tconst editor = RocketChat.models.Users.findOneById(message.editor.id);\n\t\t\teditedBy = {\n\t\t\t\t_id: editor._id,\n\t\t\t\tusername: editor.username,\n\t\t\t};\n\t\t}\n\n\t\tconst attachments = this._convertAppAttachments(message.attachments);\n\n\t\treturn {\n\t\t\t_id: message.id || Random.id(),\n\t\t\trid: room._id,\n\t\t\tu,\n\t\t\tmsg: message.text,\n\t\t\tts: message.createdAt || new Date(),\n\t\t\t_updatedAt: message.updatedAt || new Date(),\n\t\t\teditedBy,\n\t\t\teditedAt: message.editedAt,\n\t\t\temoji: message.emoji,\n\t\t\tavatar: message.avatarUrl,\n\t\t\talias: message.alias,\n\t\t\tcustomFields: message.customFields,\n\t\t\tgroupable: message.groupable,\n\t\t\tattachments,\n\t\t\treactions: message.reactions,\n\t\t};\n\t}\n\n\t_convertAppAttachments(attachments) {\n\t\tif (typeof attachments === 'undefined' || !Array.isArray(attachments)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn attachments.map((attachment) => ({\n\t\t\tcollapsed: attachment.collapsed,\n\t\t\tcolor: attachment.color,\n\t\t\ttext: attachment.text,\n\t\t\tts: attachment.timestamp,\n\t\t\tmessage_link: attachment.timestampLink,\n\t\t\tthumb_url: attachment.thumbnailUrl,\n\t\t\tauthor_name: attachment.author ? attachment.author.name : undefined,\n\t\t\tauthor_link: attachment.author ? attachment.author.link : undefined,\n\t\t\tauthor_icon: attachment.author ? attachment.author.icon : undefined,\n\t\t\ttitle: attachment.title ? attachment.title.value : undefined,\n\t\t\ttitle_link: attachment.title ? attachment.title.link : undefined,\n\t\t\ttitle_link_download: attachment.title ? attachment.title.displayDownloadLink : undefined,\n\t\t\timage_url: attachment.imageUrl,\n\t\t\taudio_url: attachment.audioUrl,\n\t\t\tvideo_url: attachment.videoUrl,\n\t\t\tfields: attachment.fields,\n\t\t\tactions: attachment.actions,\n\t\t\ttype: attachment.type,\n\t\t\tdescription: attachment.description,\n\t\t})).map((a) => {\n\t\t\tObject.keys(a).forEach((k) => {\n\t\t\t\tif (typeof a[k] === 'undefined') {\n\t\t\t\t\tdelete a[k];\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn a;\n\t\t});\n\t}\n\n\t_convertAttachmentsToApp(attachments) {\n\t\tif (typeof attachments === 'undefined' || !Array.isArray(attachments)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn attachments.map((attachment) => {\n\t\t\tlet author;\n\t\t\tif (attachment.author_name || attachment.author_link || attachment.author_icon) {\n\t\t\t\tauthor = {\n\t\t\t\t\tname: attachment.author_name,\n\t\t\t\t\tlink: attachment.author_link,\n\t\t\t\t\ticon: attachment.author_icon,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tlet title;\n\t\t\tif (attachment.title || attachment.title_link || attachment.title_link_download) {\n\t\t\t\ttitle = {\n\t\t\t\t\tvalue: attachment.title,\n\t\t\t\t\tlink: attachment.title_link,\n\t\t\t\t\tdisplayDownloadLink: attachment.title_link_download,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tcollapsed: attachment.collapsed,\n\t\t\t\tcolor: attachment.color,\n\t\t\t\ttext: attachment.text,\n\t\t\t\ttimestamp: attachment.ts,\n\t\t\t\ttimestampLink: attachment.message_link,\n\t\t\t\tthumbnailUrl: attachment.thumb_url,\n\t\t\t\tauthor,\n\t\t\t\ttitle,\n\t\t\t\timageUrl: attachment.image_url,\n\t\t\t\taudioUrl: attachment.audio_url,\n\t\t\t\tvideoUrl: attachment.video_url,\n\t\t\t\tfields: attachment.fields,\n\t\t\t\tactions: attachment.actions,\n\t\t\t\ttype: attachment.type,\n\t\t\t\tdescription: attachment.description,\n\t\t\t};\n\t\t});\n\t}\n}\n","import { RoomType } from '@rocket.chat/apps-engine/definition/rooms';\n\nexport class AppRoomsConverter {\n\tconstructor(orch) {\n\t\tthis.orch = orch;\n\t}\n\n\tconvertById(roomId) {\n\t\tconst room = RocketChat.models.Rooms.findOneById(roomId);\n\n\t\treturn this.convertRoom(room);\n\t}\n\n\tconvertByName(roomName) {\n\t\tconst room = RocketChat.models.Rooms.findOneByName(roomName);\n\n\t\treturn this.convertRoom(room);\n\t}\n\n\tconvertAppRoom(room) {\n\t\tif (!room) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tlet u;\n\t\tif (room.creator) {\n\t\t\tconst creator = RocketChat.models.Users.findOneById(room.creator.id);\n\t\t\tu = {\n\t\t\t\t_id: creator._id,\n\t\t\t\tusername: creator.username,\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\t_id: room.id,\n\t\t\tfname: room.displayName,\n\t\t\tname: room.slugifiedName,\n\t\t\tt: room.type,\n\t\t\tu,\n\t\t\tmembers: room.members,\n\t\t\tdefault: typeof room.isDefault === 'undefined' ? false : room.isDefault,\n\t\t\tro: typeof room.isReadOnly === 'undefined' ? false : room.isReadOnly,\n\t\t\tsysMes: typeof room.displaySystemMessages === 'undefined' ? true : room.displaySystemMessages,\n\t\t\tmsgs: room.messageCount || 0,\n\t\t\tts: room.createdAt,\n\t\t\t_updatedAt: room.updatedAt,\n\t\t\tlm: room.lastModifiedAt,\n\t\t};\n\t}\n\n\tconvertRoom(room) {\n\t\tif (!room) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tlet creator;\n\t\tif (room.u) {\n\t\t\tcreator = this.orch.getConverters().get('users').convertById(room.u._id);\n\t\t}\n\n\t\treturn {\n\t\t\tid: room._id,\n\t\t\tdisplayName: room.fname,\n\t\t\tslugifiedName: room.name,\n\t\t\ttype: this._convertTypeToApp(room.t),\n\t\t\tcreator,\n\t\t\tmembers: room.members,\n\t\t\tisDefault: typeof room.default === 'undefined' ? false : room.default,\n\t\t\tisReadOnly: typeof room.ro === 'undefined' ? false : room.ro,\n\t\t\tdisplaySystemMessages: typeof room.sysMes === 'undefined' ? true : room.sysMes,\n\t\t\tmessageCount: room.msgs,\n\t\t\tcreatedAt: room.ts,\n\t\t\tupdatedAt: room._updatedAt,\n\t\t\tlastModifiedAt: room.lm,\n\t\t\tcustomFields: {},\n\t\t};\n\t}\n\n\t_convertTypeToApp(typeChar) {\n\t\tswitch (typeChar) {\n\t\t\tcase 'c':\n\t\t\t\treturn RoomType.CHANNEL;\n\t\t\tcase 'p':\n\t\t\t\treturn RoomType.PRIVATE_GROUP;\n\t\t\tcase 'd':\n\t\t\t\treturn RoomType.DIRECT_MESSAGE;\n\t\t\tcase 'lc':\n\t\t\t\treturn RoomType.LIVE_CHAT;\n\t\t\tdefault:\n\t\t\t\treturn typeChar;\n\t\t}\n\t}\n}\n","import { SettingType } from '@rocket.chat/apps-engine/definition/settings';\n\nexport class AppSettingsConverter {\n\tconstructor(orch) {\n\t\tthis.orch = orch;\n\t}\n\n\tconvertById(settingId) {\n\t\tconst setting = RocketChat.models.Settings.findOneNotHiddenById(settingId);\n\n\t\treturn this.convertToApp(setting);\n\t}\n\n\tconvertToApp(setting) {\n\t\treturn {\n\t\t\tid: setting._id,\n\t\t\ttype: this._convertTypeToApp(setting.type),\n\t\t\tpackageValue: setting.packageValue,\n\t\t\tvalues: setting.values,\n\t\t\tvalue: setting.value,\n\t\t\tpublic: setting.public,\n\t\t\thidden: setting.hidden,\n\t\t\tgroup: setting.group,\n\t\t\ti18nLabel: setting.i18nLabel,\n\t\t\ti18nDescription: setting.i18nDescription,\n\t\t\tcreatedAt: setting.ts,\n\t\t\tupdatedAt: setting._updatedAt,\n\t\t};\n\t}\n\n\t_convertTypeToApp(type) {\n\t\tswitch (type) {\n\t\t\tcase 'boolean':\n\t\t\t\treturn SettingType.BOOLEAN;\n\t\t\tcase 'code':\n\t\t\t\treturn SettingType.CODE;\n\t\t\tcase 'color':\n\t\t\t\treturn SettingType.COLOR;\n\t\t\tcase 'font':\n\t\t\t\treturn SettingType.FONT;\n\t\t\tcase 'int':\n\t\t\t\treturn SettingType.NUMBER;\n\t\t\tcase 'select':\n\t\t\t\treturn SettingType.SELECT;\n\t\t\tcase 'string':\n\t\t\t\treturn SettingType.STRING;\n\t\t\tdefault:\n\t\t\t\treturn type;\n\t\t}\n\t}\n}\n","import { UserStatusConnection, UserType } from '@rocket.chat/apps-engine/definition/users';\n\nexport class AppUsersConverter {\n\tconstructor(orch) {\n\t\tthis.orch = orch;\n\t}\n\n\tconvertById(userId) {\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\treturn this.convertToApp(user);\n\t}\n\n\tconvertByUsername(username) {\n\t\tconst user = RocketChat.models.Users.findOneByUsername(username);\n\n\t\treturn this.convertToApp(user);\n\t}\n\n\tconvertToApp(user) {\n\t\tif (!user) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst type = this._convertUserTypeToEnum(user.type);\n\t\tconst statusConnection = this._convertStatusConnectionToEnum(user.username, user._id, user.statusConnection);\n\n\t\treturn {\n\t\t\tid: user._id,\n\t\t\tusername: user.username,\n\t\t\temails: user.emails,\n\t\t\ttype,\n\t\t\tisEnabled: user.active,\n\t\t\tname: user.name,\n\t\t\troles: user.roles,\n\t\t\tstatus: user.status,\n\t\t\tstatusConnection,\n\t\t\tutcOffset: user.utcOffset,\n\t\t\tcreatedAt: user.createdAt,\n\t\t\tupdatedAt: user._updatedAt,\n\t\t\tlastLoginAt: user.lastLogin,\n\t\t};\n\t}\n\n\t_convertUserTypeToEnum(type) {\n\t\tswitch (type) {\n\t\t\tcase 'user':\n\t\t\t\treturn UserType.USER;\n\t\t\tcase 'bot':\n\t\t\t\treturn UserType.BOT;\n\t\t\tcase '':\n\t\t\tcase undefined:\n\t\t\t\treturn UserType.UNKNOWN;\n\t\t\tdefault:\n\t\t\t\tconsole.warn(`A new user type has been added that the Apps don't know about? \"${ type }\"`);\n\t\t\t\treturn type.toUpperCase();\n\t\t}\n\t}\n\n\t_convertStatusConnectionToEnum(username, userId, status) {\n\t\tswitch (status) {\n\t\t\tcase 'offline':\n\t\t\t\treturn UserStatusConnection.OFFLINE;\n\t\t\tcase 'online':\n\t\t\t\treturn UserStatusConnection.ONLINE;\n\t\t\tcase 'away':\n\t\t\t\treturn UserStatusConnection.AWAY;\n\t\t\tcase 'busy':\n\t\t\t\treturn UserStatusConnection.BUSY;\n\t\t\tcase undefined:\n\t\t\t\t// This is needed for Livechat guests and Rocket.Cat user.\n\t\t\t\treturn UserStatusConnection.UNDEFINED;\n\t\t\tdefault:\n\t\t\t\tconsole.warn(`The user ${ username } (${ userId }) does not have a valid status (offline, online, away, or busy). It is currently: \"${ status }\"`);\n\t\t\t\treturn !status ? UserStatusConnection.OFFLINE : status.toUpperCase();\n\t\t}\n\t}\n}\n","import { AppMessagesConverter } from './messages';\nimport { AppRoomsConverter } from './rooms';\nimport { AppSettingsConverter } from './settings';\nimport { AppUsersConverter } from './users';\n\nexport {\n\tAppMessagesConverter,\n\tAppRoomsConverter,\n\tAppSettingsConverter,\n\tAppUsersConverter,\n};\n","import { RealAppBridges } from './bridges';\nimport { AppMethods, AppsRestApi, AppServerNotifier } from './communication';\nimport { AppMessagesConverter, AppRoomsConverter, AppSettingsConverter, AppUsersConverter } from './converters';\nimport { AppsLogsModel, AppsModel, AppsPersistenceModel, AppRealStorage, AppRealLogsStorage } from './storage';\n\nimport { AppManager } from '@rocket.chat/apps-engine/server/AppManager';\n\nclass AppServerOrchestrator {\n\tconstructor() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\t\t\tRocketChat.models.Permissions.createOrUpdate('manage-apps', ['admin']);\n\t\t}\n\n\t\tthis._model = new AppsModel();\n\t\tthis._logModel = new AppsLogsModel();\n\t\tthis._persistModel = new AppsPersistenceModel();\n\t\tthis._storage = new AppRealStorage(this._model);\n\t\tthis._logStorage = new AppRealLogsStorage(this._logModel);\n\n\t\tthis._converters = new Map();\n\t\tthis._converters.set('messages', new AppMessagesConverter(this));\n\t\tthis._converters.set('rooms', new AppRoomsConverter(this));\n\t\tthis._converters.set('settings', new AppSettingsConverter(this));\n\t\tthis._converters.set('users', new AppUsersConverter(this));\n\n\t\tthis._bridges = new RealAppBridges(this);\n\n\t\tthis._manager = new AppManager(this._storage, this._logStorage, this._bridges);\n\n\t\tthis._communicators = new Map();\n\t\tthis._communicators.set('methods', new AppMethods(this));\n\t\tthis._communicators.set('notifier', new AppServerNotifier(this));\n\t\tthis._communicators.set('restapi', new AppsRestApi(this, this._manager));\n\t}\n\n\tgetModel() {\n\t\treturn this._model;\n\t}\n\n\tgetPersistenceModel() {\n\t\treturn this._persistModel;\n\t}\n\n\tgetStorage() {\n\t\treturn this._storage;\n\t}\n\n\tgetLogStorage() {\n\t\treturn this._logStorage;\n\t}\n\n\tgetConverters() {\n\t\treturn this._converters;\n\t}\n\n\tgetBridges() {\n\t\treturn this._bridges;\n\t}\n\n\tgetNotifier() {\n\t\treturn this._communicators.get('notifier');\n\t}\n\n\tgetManager() {\n\t\treturn this._manager;\n\t}\n\n\tisEnabled() {\n\t\treturn RocketChat.settings.get('Apps_Framework_enabled');\n\t}\n\n\tisLoaded() {\n\t\treturn this.getManager().areAppsLoaded();\n\t}\n\n\tload() {\n\t\t// Don't try to load it again if it has\n\t\t// already been loaded\n\t\tif (this.isLoaded()) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._manager.load()\n\t\t\t.then((affs) => console.log(`Loaded the Apps Framework and loaded a total of ${ affs.length } Apps!`))\n\t\t\t.catch((err) => console.warn('Failed to load the Apps Framework and Apps!', err));\n\t}\n\n\tunload() {\n\t\t// Don't try to unload it if it's already been\n\t\t// unlaoded or wasn't unloaded to start with\n\t\tif (!this.isLoaded()) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._manager.unload()\n\t\t\t.then(() => console.log('Unloaded the Apps Framework.'))\n\t\t\t.catch((err) => console.warn('Failed to unload the Apps Framework!', err));\n\t}\n}\n\nRocketChat.settings.addGroup('General', function() {\n\tthis.section('Apps', function() {\n\t\tthis.add('Apps_Framework_enabled', true, {\n\t\t\ttype: 'boolean',\n\t\t\thidden: false,\n\t\t});\n\t});\n});\n\nRocketChat.settings.get('Apps_Framework_enabled', (key, isEnabled) => {\n\t// In case this gets called before `Meteor.startup`\n\tif (!global.Apps) {\n\t\treturn;\n\t}\n\n\tif (isEnabled) {\n\t\tglobal.Apps.load();\n\t} else {\n\t\tglobal.Apps.unload();\n\t}\n});\n\nMeteor.startup(function _appServerOrchestrator() {\n\tglobal.Apps = new AppServerOrchestrator();\n\n\tif (global.Apps.isEnabled()) {\n\t\tglobal.Apps.load();\n\t}\n});\n"]}