{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:e2e/server/index.js","meteor://ðŸ’»app/packages/rocketchat:e2e/server/settings.js","meteor://ðŸ’»app/packages/rocketchat:e2e/server/methods/fetchMyKeys.js","meteor://ðŸ’»app/packages/rocketchat:e2e/server/methods/getUsersOfRoomWithoutKey.js","meteor://ðŸ’»app/packages/rocketchat:e2e/server/methods/setRoomKeyID.js","meteor://ðŸ’»app/packages/rocketchat:e2e/server/methods/setUserPublicAndPivateKeys.js","meteor://ðŸ’»app/packages/rocketchat:e2e/server/methods/updateGroupKey.js","meteor://ðŸ’»app/packages/rocketchat:e2e/server/models/Rooms.js","meteor://ðŸ’»app/packages/rocketchat:e2e/server/models/Subscriptions.js","meteor://ðŸ’»app/packages/rocketchat:e2e/server/models/Users.js"],"names":["RocketChat","module","watch","require","v","callbacks","add","user","room","Notifications","notifyRoom","_id","e2eKeyId","settings","addGroup","type","i18nLabel","i18nDescription","public","alert","Meteor","methods","userId","Error","method","models","Users","fetchKeysByUserId","rid","call","subscriptions","Subscriptions","findByRidWithoutE2EKey","fields","fetch","userIds","map","s","u","options","users","findByIdsWithPublicE2EKey","keyID","Rooms","setE2eKeyId","public_key","private_key","setE2EPublicAndPivateKeysByUserId","uid","key","mySub","findOneByRoomIdAndUserId","userSub","updateGroupE2EKey","query","update","$set","E2EKey","findOne","$exists","find","e2e","ids","$in"],"mappings":"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","file":"/packages/rocketchat_e2e.js","sourcesContent":["import { RocketChat } from 'meteor/rocketchat:lib';\n\nimport './settings';\nimport './models/Users';\nimport './models/Rooms';\nimport './models/Subscriptions';\nimport './methods/setUserPublicAndPivateKeys';\nimport './methods/getUsersOfRoomWithoutKey';\nimport './methods/updateGroupKey';\nimport './methods/setRoomKeyID';\nimport './methods/fetchMyKeys';\n\nRocketChat.callbacks.add('afterJoinRoom', (user, room) => {\n\tRocketChat.Notifications.notifyRoom('e2e.keyRequest', room._id, room.e2eKeyId);\n});\n","import { RocketChat } from 'meteor/rocketchat:lib';\n\nRocketChat.settings.addGroup('E2E Encryption', function() {\n\tthis.add('E2E_Enable', false, {\n\t\ttype: 'boolean',\n\t\ti18nLabel: 'Enabled',\n\t\ti18nDescription: 'E2E_Enable_description',\n\t\tpublic: true,\n\t\talert: 'E2E_Enable_alert',\n\t});\n});\n","import { Meteor } from 'meteor/meteor';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nMeteor.methods({\n\t'e2e.fetchMyKeys'() {\n\t\tconst userId = Meteor.userId();\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'e2e.fetchMyKeys' });\n\t\t}\n\t\treturn RocketChat.models.Users.fetchKeysByUserId(userId);\n\t},\n});\n","import { Meteor } from 'meteor/meteor';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nMeteor.methods({\n\t'e2e.getUsersOfRoomWithoutKey'(rid) {\n\t\tconst userId = Meteor.userId();\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'e2e.getUsersOfRoomWithoutKey' });\n\t\t}\n\n\t\tconst room = Meteor.call('canAccessRoom', rid, userId);\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'e2e.getUsersOfRoomWithoutKey' });\n\t\t}\n\n\t\tconst subscriptions = RocketChat.models.Subscriptions.findByRidWithoutE2EKey(rid, { fields: { 'u._id': 1 } }).fetch();\n\t\tconst userIds = subscriptions.map((s) => s.u._id);\n\t\tconst options = { fields: { 'e2e.public_key': 1 } };\n\n\t\tconst users = RocketChat.models.Users.findByIdsWithPublicE2EKey(userIds, options).fetch();\n\n\t\treturn {\n\t\t\tusers,\n\t\t};\n\t},\n});\n","import { Meteor } from 'meteor/meteor';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nMeteor.methods({\n\t'e2e.setRoomKeyID'(rid, keyID) {\n\t\tconst userId = Meteor.userId();\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'e2e.setRoomKeyID' });\n\t\t}\n\n\t\tconst room = Meteor.call('canAccessRoom', rid, userId);\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'e2e.setRoomKeyID' });\n\t\t}\n\n\t\tif (room.e2eKeyId) {\n\t\t\tthrow new Meteor.Error('error-room-e2e-key-already-exists', 'E2E Key ID already exists', { method: 'e2e.setRoomKeyID' });\n\t\t}\n\n\t\treturn RocketChat.models.Rooms.setE2eKeyId(room._id, keyID);\n\t},\n});\n","import { Meteor } from 'meteor/meteor';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nMeteor.methods({\n\t'e2e.setUserPublicAndPivateKeys'({ public_key, private_key }) {\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'e2e.setUserPublicAndPivateKeys' });\n\t\t}\n\n\t\treturn RocketChat.models.Users.setE2EPublicAndPivateKeysByUserId(userId, { public_key, private_key });\n\t},\n});\n","import { Meteor } from 'meteor/meteor';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nMeteor.methods({\n\t'e2e.updateGroupKey'(rid, uid, key) {\n\t\tconst mySub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, Meteor.userId());\n\t\tif (mySub) { // I have a subscription to this room\n\t\t\tconst userSub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, uid);\n\t\t\tif (userSub) { // uid also has subscription to this room\n\t\t\t\treturn RocketChat.models.Subscriptions.updateGroupE2EKey(userSub._id, key);\n\t\t\t}\n\t\t}\n\t},\n});\n","import { RocketChat } from 'meteor/rocketchat:lib';\n\nRocketChat.models.Rooms.setE2eKeyId = function(_id, e2eKeyId, options) {\n\tconst query = {\n\t\t_id,\n\t};\n\n\tconst update = {\n\t\t$set: {\n\t\t\te2eKeyId,\n\t\t},\n\t};\n\n\treturn this.update(query, update, options);\n};\n","import { RocketChat } from 'meteor/rocketchat:lib';\n\nRocketChat.models.Subscriptions.updateGroupE2EKey = function(_id, key) {\n\tconst query = { _id };\n\tconst update = { $set: { E2EKey: key } };\n\tthis.update(query, update);\n\treturn this.findOne({ _id });\n};\n\nRocketChat.models.Subscriptions.findByRidWithoutE2EKey = function(rid, options) {\n\tconst query = {\n\t\trid,\n\t\tE2EKey: {\n\t\t\t$exists: false,\n\t\t},\n\t};\n\n\treturn this.find(query, options);\n};\n","import { RocketChat } from 'meteor/rocketchat:lib';\n\nRocketChat.models.Users.setE2EPublicAndPivateKeysByUserId = function(userId, { public_key, private_key }) {\n\tthis.update({ _id: userId }, {\n\t\t$set: {\n\t\t\t'e2e.public_key': public_key,\n\t\t\t'e2e.private_key': private_key,\n\t\t},\n\t});\n};\n\nRocketChat.models.Users.fetchKeysByUserId = function(userId) {\n\tconst user = this.findOne({ _id: userId }, { fields: { e2e: 1 } });\n\n\tif (!user || !user.e2e || !user.e2e.public_key) {\n\t\treturn {};\n\t}\n\n\treturn {\n\t\tpublic_key: user.e2e.public_key,\n\t\tprivate_key: user.e2e.private_key,\n\t};\n};\n\nRocketChat.models.Users.findByIdsWithPublicE2EKey = function(ids, options) {\n\tconst query = {\n\t\t_id: {\n\t\t\t$in: ids,\n\t\t},\n\t\t'e2e.public_key': {\n\t\t\t$exists: 1,\n\t\t},\n\t};\n\n\treturn this.find(query, options);\n};\n"]}