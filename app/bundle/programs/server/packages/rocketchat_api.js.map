{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:api/server/api.js","meteor://ðŸ’»app/packages/rocketchat:api/server/settings.js","meteor://ðŸ’»app/packages/rocketchat:api/server/helpers/requestParams.js","meteor://ðŸ’»app/packages/rocketchat:api/server/helpers/getPaginationItems.js","meteor://ðŸ’»app/packages/rocketchat:api/server/helpers/getUserFromParams.js","meteor://ðŸ’»app/packages/rocketchat:api/server/helpers/getUserInfo.js","meteor://ðŸ’»app/packages/rocketchat:api/server/helpers/isUserFromParams.js","meteor://ðŸ’»app/packages/rocketchat:api/server/helpers/parseJsonQuery.js","meteor://ðŸ’»app/packages/rocketchat:api/server/helpers/deprecationWarning.js","meteor://ðŸ’»app/packages/rocketchat:api/server/helpers/getLoggedInUser.js","meteor://ðŸ’»app/packages/rocketchat:api/server/helpers/insertUserObject.js","meteor://ðŸ’»app/packages/rocketchat:api/server/default/info.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/channels.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/roles.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/rooms.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/subscriptions.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/chat.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/commands.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/emoji-custom.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/groups.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/im.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/integrations.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/misc.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/permissions.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/push.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/settings.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/stats.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/users.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/assets.js"],"names":["_","module","watch","require","default","v","logger","Logger","API","Restivus","constructor","properties","authMethods","fieldSeparator","defaultFieldsToExclude","joinCode","members","importIds","limitedUserFieldsToExclude","avatarOrigin","emails","phone","statusConnection","createdAt","lastLogin","services","requirePasswordChange","requirePasswordChangeReason","roles","statusDefault","_updatedAt","customFields","settings","limitedUserFieldsToExcludeIfIsPrivilegedUser","hasHelperMethods","RocketChat","helperMethods","size","getHelperMethods","getHelperMethod","name","get","addAuthMethod","method","push","success","result","isObject","statusCode","body","debug","failure","errorType","stack","error","notFound","msg","unauthorized","addRoute","routes","options","endpoints","isArray","version","_config","forEach","route","Object","keys","action","originalAction","_internalRouteActionHandler","rocketchatRestApiEnd","metrics","rocketchatRestApi","startTimer","user_agent","request","headers","entrypoint","toUpperCase","url","apply","e","v1","message","status","helperMethod","_initAuth","loginCompatibility","bodyParams","user","username","email","password","code","without","length","auth","includes","hashed","digest","algorithm","totp","login","self","authRequired","post","args","getUserInfo","invocation","DDPCommon","MethodInvocation","connection","close","DDP","_CurrentInvocation","withValue","Meteor","call","reason","users","findOne","_id","id","userId","update","Accounts","_hashLoginToken","token","$unset","response","data","authToken","me","extraData","onLoggedIn","extend","extra","logout","hashedToken","tokenLocation","index","lastIndexOf","tokenPath","substring","tokenFieldName","tokenToRemove","tokenRemovalQuery","$pull","onLoggedOut","console","warn","getUserAuth","_getUserAuth","invalidResults","undefined","payload","JSON","parse","i","Map","ApiClass","defaultOptionsEndpoint","_defaultOptionsEndpoint","writeHead","write","done","createApi","_createApi","enableCors","useDefaultAuth","prettyJson","process","env","NODE_ENV","key","value","addGroup","section","add","type","public","enableQuery","set","_requestParams","queryParams","_getPaginationItems","hardUpperLimit","defaultCount","offset","parseInt","count","_getUserFromParams","doesntExist","_doesntExist","params","requestParams","trim","models","Users","findOneById","findOneByUsername","Error","getInfoFromUserObject","utcOffset","active","language","_getUserInfo","isVerifiedEmail","Array","find","verified","getUserPreferences","defaultUserSettingPrefix","allDefaultUserSettings","RegExp","reduce","accumulator","setting","settingWithoutPrefix","replace","getUserPreference","verifiedEmail","address","preferences","_isUserFromParams","_parseJsonQuery","sort","fields","nonSelectableFields","getFields","authz","hasPermission","concat","k","split","assign","query","nonQueryableFields","_deprecationWarning","endpoint","versionWillBeRemove","warningMessage","warning","_getLoggedInUser","_addUserToObject","object","getLoggedInUser","hasRole","info","Info","findChannelByIdOrName","checkedArchived","roomId","roomName","room","Rooms","findOneByName","t","archived","findResult","runAsUser","activeUsersOnly","channel","getUserFromParams","sub","Subscriptions","findOneByRoomIdAndUserId","open","access","unreads","userMentions","unreadsFrom","joined","msgs","latest","returnUsernames","subscription","lm","Messages","countVisibleByRoomIdBetweenTimestampsInclusive","rid","ls","ts","usersCount","createChannelValidator","createChannel","readOnly","channels","create","validate","execute","addUserObjectToEveryObject","file","insertUserObject","getPaginationItems","parseJsonQuery","ourQuery","files","Uploads","skip","limit","fetch","map","total","includeAllPublicChannels","$in","integrations","Integrations","_createdAt","latestDate","Date","oldestDate","oldest","inclusive","hasPermissionToSeeAllPublicChannels","roomIds","findByUserIdAndType","s","cursor","rooms","findBySubscriptionTypeAndUserId","totalCount","broadcast","subscriptions","findByRoomId","u","messages","online","findUsersNotOffline","onlineInRoom","toString","description","purpose","ro","topic","announcement","mentions","allMentions","moderators","findByRoomIdAndRoles","Roles","check","String","scope","Match","Maybe","roleData","role","findOneByIdOrName","roleName","Busboy","findRoomByIdOrName","updatedSince","updatedSinceDate","isNaN","remove","urlParams","busboy","wrapAsync","callback","on","fieldname","filename","encoding","mimetype","fileDate","fileBuffer","Buffer","bindEnvironment","pipe","fileStore","FileUpload","getStore","details","uploadedFile","insert","bind","saveNotifications","notifications","notificationKey","favorite","hasOwnProperty","excludePinned","filesOnly","fromUsers","firstUnreadMessage","ObjectIncluding","msgId","asUser","Boolean","now","lastUpdate","messageId","pinnedMessage","messageReturn","processWebhookMessage","searchText","docs","starred","text","emoji","reaction","shouldReact","messageReadReceipts","receipts","ignore","test","command","cmd","slashCommands","commands","toLowerCase","values","filter","processQueryOptionsOnResult","run","Random","preview","previewItem","emojis","findPrivateGroupByIdOrName","roomSub","findOneByRoomNameAndUserId","group","includeAllPrivateGroups","channelsToSearch","idOrName","groups","findDirectMessageRoom","getRoomByNameOrIdWithOptionToJoin","currentUserId","nameOrId","ruserId","rs","dm","unread","ims","enabled","urls","event","triggerWords","alias","avatar","scriptEnabled","script","targetChannel","integration","history","IntegrationHistory","items","target_url","integrationId","onlineCache","onlineCacheDate","cacheInvalid","icon","types","hideIcon","backgroundColor","TAPi18n","__","iconSize","leftSize","rightSize","width","height","sortBy","sortDirection","Math","max","results","permissions","permissionNotFound","roleNotFound","element","Permissions","subelement","createOrUpdate","appName","delete","affectedRecords","Push","appCollection","$or","hidden","$ne","Settings","mountOAuthServices","oAuthServicesEnabled","ServiceConfiguration","configurations","secret","service","custom","clientId","appId","consumerKey","buttonLabelText","buttonColor","buttonLabelColor","pick","findOneNotHiddenById","editor","updateOptionsById","updateValueNotHiddenById","Any","Package","refresh","stats","statistics","Statistics","joinDefaultChannels","sendWelcomeEmail","validateCustomFields","newUserId","saveUser","saveCustomFieldsWithoutValidation","getURL","cdn","full","setHeader","isUserFromParams","presence","connectionStatus","avatarUrl","setUserAvatar","imageData","userData","saveCustomFields","currentPassword","newPassword","realname","typedPassword","newRoomNotification","newMessageNotification","clockMode","Number","useEmojis","convertAsciiEmoji","saveMobileBandwidth","collapseMediaByDefault","autoImageLoad","emailNotificationMode","unreadAlert","notificationsSoundVolume","desktopNotifications","mobileNotifications","enableAutoAway","highlights","desktopNotificationDuration","messageViewMode","hideUsernames","hideRoles","hideAvatars","hideFlexTab","sendOnEnter","roomCounterSidebar","sidebarShowFavorites","Optional","sidebarShowUnread","sidebarSortby","sidebarViewMode","sidebarHideAvatar","sidebarGroupByType","muteFocusedConversations","emailSent","tokenName","loginTokens","getLoginTokensByUserId","getPersonalAccessTokens","resume","loginToken","lastTokenPart","tokens","asset","isValidAsset","Assets","assets","assetData","buffer","refreshAllClients","assetName"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAIA,CAAJ;;AAAMC,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACL,QAAEK,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAEN,MAAMC,SAAS,IAAIC,MAAJ,CAAW,KAAX,EAAkB,EAAlB,CAAf;;AAEA,MAAMC,GAAN,SAAkBC,QAAlB,CAA2B;AAC1BC,cAAYC,UAAZ,EAAwB;AACvB,UAAMA,UAAN;AACA,SAAKC,WAAL,GAAmB,EAAnB;AACA,SAAKC,cAAL,GAAsB,GAAtB;AACA,SAAKC,sBAAL,GAA8B;AAC7BC,gBAAU,CADmB;AAE7BC,eAAS,CAFoB;AAG7BC,iBAAW;AAHkB,KAA9B;AAKA,SAAKC,0BAAL,GAAkC;AACjCC,oBAAc,CADmB;AAEjCC,cAAQ,CAFyB;AAGjCC,aAAO,CAH0B;AAIjCC,wBAAkB,CAJe;AAKjCC,iBAAW,CALsB;AAMjCC,iBAAW,CANsB;AAOjCC,gBAAU,CAPuB;AAQjCC,6BAAuB,CARU;AASjCC,mCAA6B,CATI;AAUjCC,aAAO,CAV0B;AAWjCC,qBAAe,CAXkB;AAYjCC,kBAAY,CAZqB;AAajCC,oBAAc,CAbmB;AAcjCC,gBAAU;AAduB,KAAlC;AAgBA,SAAKC,4CAAL,GAAoD;AACnDR,gBAAU;AADyC,KAApD;AAGA;;AAEDS,qBAAmB;AAClB,WAAOC,WAAW3B,GAAX,CAAe4B,aAAf,CAA6BC,IAA7B,KAAsC,CAA7C;AACA;;AAEDC,qBAAmB;AAClB,WAAOH,WAAW3B,GAAX,CAAe4B,aAAtB;AACA;;AAEDG,kBAAgBC,IAAhB,EAAsB;AACrB,WAAOL,WAAW3B,GAAX,CAAe4B,aAAf,CAA6BK,GAA7B,CAAiCD,IAAjC,CAAP;AACA;;AAEDE,gBAAcC,MAAd,EAAsB;AACrB,SAAK/B,WAAL,CAAiBgC,IAAjB,CAAsBD,MAAtB;AACA;;AAEDE,UAAQC,SAAS,EAAjB,EAAqB;AACpB,QAAI9C,EAAE+C,QAAF,CAAWD,MAAX,CAAJ,EAAwB;AACvBA,aAAOD,OAAP,GAAiB,IAAjB;AACA;;AAEDC,aAAS;AACRE,kBAAY,GADJ;AAERC,YAAMH;AAFE,KAAT;AAKAxC,WAAO4C,KAAP,CAAa,SAAb,EAAwBJ,MAAxB;AAEA,WAAOA,MAAP;AACA;;AAEDK,UAAQL,MAAR,EAAgBM,SAAhB,EAA2BC,KAA3B,EAAkC;AACjC,QAAIrD,EAAE+C,QAAF,CAAWD,MAAX,CAAJ,EAAwB;AACvBA,aAAOD,OAAP,GAAiB,KAAjB;AACA,KAFD,MAEO;AACNC,eAAS;AACRD,iBAAS,KADD;AAERS,eAAOR,MAFC;AAGRO;AAHQ,OAAT;;AAMA,UAAID,SAAJ,EAAe;AACdN,eAAOM,SAAP,GAAmBA,SAAnB;AACA;AACD;;AAEDN,aAAS;AACRE,kBAAY,GADJ;AAERC,YAAMH;AAFE,KAAT;AAKAxC,WAAO4C,KAAP,CAAa,SAAb,EAAwBJ,MAAxB;AAEA,WAAOA,MAAP;AACA;;AAEDS,WAASC,GAAT,EAAc;AACb,WAAO;AACNR,kBAAY,GADN;AAENC,YAAM;AACLJ,iBAAS,KADJ;AAELS,eAAOE,MAAMA,GAAN,GAAY;AAFd;AAFA,KAAP;AAOA;;AAEDC,eAAaD,GAAb,EAAkB;AACjB,WAAO;AACNR,kBAAY,GADN;AAENC,YAAM;AACLJ,iBAAS,KADJ;AAELS,eAAOE,MAAMA,GAAN,GAAY;AAFd;AAFA,KAAP;AAOA;;AAEDE,WAASC,MAAT,EAAiBC,OAAjB,EAA0BC,SAA1B,EAAqC;AACpC;AACA,QAAI,OAAOA,SAAP,KAAqB,WAAzB,EAAsC;AACrCA,kBAAYD,OAAZ;AACAA,gBAAU,EAAV;AACA,KALmC,CAOpC;;;AACA,QAAI,CAAC5D,EAAE8D,OAAF,CAAUH,MAAV,CAAL,EAAwB;AACvBA,eAAS,CAACA,MAAD,CAAT;AACA;;AAED,UAAM;AAAEI;AAAF,QAAc,KAAKC,OAAzB;AAEAL,WAAOM,OAAP,CAAgBC,KAAD,IAAW;AACzB;AACAC,aAAOC,IAAP,CAAYP,SAAZ,EAAuBI,OAAvB,CAAgCtB,MAAD,IAAY;AAC1C,YAAI,OAAOkB,UAAUlB,MAAV,CAAP,KAA6B,UAAjC,EAA6C;AAC5CkB,oBAAUlB,MAAV,IAAoB;AAAE0B,oBAAQR,UAAUlB,MAAV;AAAV,WAApB;AACA,SAHyC,CAK1C;;;AACA,cAAM2B,iBAAiBT,UAAUlB,MAAV,EAAkB0B,MAAzC;;AACAR,kBAAUlB,MAAV,EAAkB0B,MAAlB,GAA2B,SAASE,2BAAT,GAAuC;AACjE,gBAAMC,uBAAuBrC,WAAWsC,OAAX,CAAmBC,iBAAnB,CAAqCC,UAArC,CAAgD;AAC5EhC,kBAD4E;AAE5EoB,mBAF4E;AAG5Ea,wBAAY,KAAKC,OAAL,CAAaC,OAAb,CAAqB,YAArB,CAHgE;AAI5EC,wBAAYb;AAJgE,WAAhD,CAA7B;AAOA5D,iBAAO4C,KAAP,CAAc,GAAG,KAAK2B,OAAL,CAAalC,MAAb,CAAoBqC,WAApB,EAAmC,KAAK,KAAKH,OAAL,CAAaI,GAAK,EAA3E;AACA,cAAInC,MAAJ;;AACA,cAAI;AACHA,qBAASwB,eAAeY,KAAf,CAAqB,IAArB,CAAT;AACA,WAFD,CAEE,OAAOC,CAAP,EAAU;AACX7E,mBAAO4C,KAAP,CAAc,GAAGP,MAAQ,IAAIuB,KAAO,kBAApC,EAAuDiB,EAAE9B,KAAzD;AACAP,qBAASX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0BgC,EAAEE,OAA5B,EAAqCF,EAAE7B,KAAvC,CAAT;AACA;;AAEDR,mBAASA,UAAUX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAnB;AAEA2B,+BAAqB;AACpBc,oBAAQxC,OAAOE;AADK,WAArB;AAIA,iBAAOF,MAAP;AACA,SAxBD;;AA0BA,YAAI,KAAKZ,gBAAL,EAAJ,EAA6B;AAC5B,eAAK,MAAM,CAACM,IAAD,EAAO+C,YAAP,CAAX,IAAmC,KAAKjD,gBAAL,EAAnC,EAA4D;AAC3DuB,sBAAUlB,MAAV,EAAkBH,IAAlB,IAA0B+C,YAA1B;AACA;AACD,SArCyC,CAuC1C;;;AACA1B,kBAAUlB,MAAV,EAAkBrC,MAAlB,GAA2BA,MAA3B;AACA,OAzCD;AA2CA,YAAMoD,QAAN,CAAeQ,KAAf,EAAsBN,OAAtB,EAA+BC,SAA/B;AACA,KA9CD;AA+CA;;AAED2B,cAAY;AACX,UAAMC,qBAAsBC,UAAD,IAAgB;AAC1C;AACA,YAAM;AAAEC,YAAF;AAAQC,gBAAR;AAAkBC,aAAlB;AAAyBC,gBAAzB;AAAmCC;AAAnC,UAA4CL,UAAlD;;AAEA,UAAII,YAAY,IAAhB,EAAsB;AACrB,eAAOJ,UAAP;AACA;;AAED,UAAI1F,EAAEgG,OAAF,CAAU7B,OAAOC,IAAP,CAAYsB,UAAZ,CAAV,EAAmC,MAAnC,EAA2C,UAA3C,EAAuD,OAAvD,EAAgE,UAAhE,EAA4E,MAA5E,EAAoFO,MAApF,GAA6F,CAAjG,EAAoG;AACnG,eAAOP,UAAP;AACA;;AAED,YAAMQ,OAAO;AACZJ;AADY,OAAb;;AAIA,UAAI,OAAOH,IAAP,KAAgB,QAApB,EAA8B;AAC7BO,aAAKP,IAAL,GAAYA,KAAKQ,QAAL,CAAc,GAAd,IAAqB;AAAEN,iBAAOF;AAAT,SAArB,GAAuC;AAAEC,oBAAUD;AAAZ,SAAnD;AACA,OAFD,MAEO,IAAIC,QAAJ,EAAc;AACpBM,aAAKP,IAAL,GAAY;AAAEC;AAAF,SAAZ;AACA,OAFM,MAEA,IAAIC,KAAJ,EAAW;AACjBK,aAAKP,IAAL,GAAY;AAAEE;AAAF,SAAZ;AACA;;AAED,UAAIK,KAAKP,IAAL,IAAa,IAAjB,EAAuB;AACtB,eAAOD,UAAP;AACA;;AAED,UAAIQ,KAAKJ,QAAL,CAAcM,MAAlB,EAA0B;AACzBF,aAAKJ,QAAL,GAAgB;AACfO,kBAAQH,KAAKJ,QADE;AAEfQ,qBAAW;AAFI,SAAhB;AAIA;;AAED,UAAIP,IAAJ,EAAU;AACT,eAAO;AACNQ,gBAAM;AACLR,gBADK;AAELS,mBAAON;AAFF;AADA,SAAP;AAMA;;AAED,aAAOA,IAAP;AACA,KA7CD;;AA+CA,UAAMO,OAAO,IAAb;AAEA,SAAK/C,QAAL,CAAc,OAAd,EAAuB;AAAEgD,oBAAc;AAAhB,KAAvB,EAAgD;AAC/CC,aAAO;AACN,cAAMC,OAAOnB,mBAAmB,KAAKC,UAAxB,CAAb;AACA,cAAMmB,cAAcJ,KAAKlE,eAAL,CAAqB,aAArB,CAApB;AAEA,cAAMuE,aAAa,IAAIC,UAAUC,gBAAd,CAA+B;AACjDC,sBAAY;AACXC,oBAAQ,CAAE;;AADC;AADqC,SAA/B,CAAnB;AAMA,YAAIhB,IAAJ;;AACA,YAAI;AACHA,iBAAOiB,IAAIC,kBAAJ,CAAuBC,SAAvB,CAAiCP,UAAjC,EAA6C,MAAMQ,OAAOC,IAAP,CAAY,OAAZ,EAAqBX,IAArB,CAAnD,CAAP;AACA,SAFD,CAEE,OAAOtD,KAAP,EAAc;AACf,cAAI6B,IAAI7B,KAAR;;AACA,cAAIA,MAAMkE,MAAN,KAAiB,gBAArB,EAAuC;AACtCrC,gBAAI;AACH7B,qBAAO,cADJ;AAEHkE,sBAAQ;AAFL,aAAJ;AAIA;;AAED,iBAAO;AACNxE,wBAAY,GADN;AAENC,kBAAM;AACLqC,sBAAQ,OADH;AAELhC,qBAAO6B,EAAE7B,KAFJ;AAGL+B,uBAASF,EAAEqC,MAAF,IAAYrC,EAAEE;AAHlB;AAFA,WAAP;AAQA;;AAED,aAAKM,IAAL,GAAY2B,OAAOG,KAAP,CAAaC,OAAb,CAAqB;AAChCC,eAAKzB,KAAK0B;AADsB,SAArB,CAAZ;AAIA,aAAKC,MAAL,GAAc,KAAKlC,IAAL,CAAUgC,GAAxB,CApCM,CAsCN;;AACAL,eAAOG,KAAP,CAAaK,MAAb,CAAoB;AACnBH,eAAK,KAAKhC,IAAL,CAAUgC,GADI;AAEnB,qDAA2CI,SAASC,eAAT,CAAyB9B,KAAK+B,KAA9B;AAFxB,SAApB,EAGG;AACFC,kBAAQ;AACP,kDAAsC;AAD/B;AADN,SAHH;AASA,cAAMC,WAAW;AAChB7C,kBAAQ,SADQ;AAEhB8C,gBAAM;AACLP,oBAAQ,KAAKA,MADR;AAELQ,uBAAWnC,KAAK+B,KAFX;AAGLK,gBAAIzB,YAAY,KAAKlB,IAAjB;AAHC;AAFU,SAAjB;;AASA,cAAM4C,YAAY9B,KAAKzC,OAAL,CAAawE,UAAb,IAA2B/B,KAAKzC,OAAL,CAAawE,UAAb,CAAwBjB,IAAxB,CAA6B,IAA7B,CAA7C;;AAEA,YAAIgB,aAAa,IAAjB,EAAuB;AACtBvI,YAAEyI,MAAF,CAASN,SAASC,IAAlB,EAAwB;AACvBM,mBAAOH;AADgB,WAAxB;AAGA;;AAED,eAAOJ,QAAP;AACA;;AAnE8C,KAAhD;;AAsEA,UAAMQ,SAAS,YAAW;AACzB;AACA,YAAMN,YAAY,KAAKxD,OAAL,CAAaC,OAAb,CAAqB,cAArB,CAAlB;;AACA,YAAM8D,cAAcb,SAASC,eAAT,CAAyBK,SAAzB,CAApB;;AACA,YAAMQ,gBAAgBpC,KAAKzC,OAAL,CAAakC,IAAb,CAAkB+B,KAAxC;AACA,YAAMa,QAAQD,cAAcE,WAAd,CAA0B,GAA1B,CAAd;AACA,YAAMC,YAAYH,cAAcI,SAAd,CAAwB,CAAxB,EAA2BH,KAA3B,CAAlB;AACA,YAAMI,iBAAiBL,cAAcI,SAAd,CAAwBH,QAAQ,CAAhC,CAAvB;AACA,YAAMK,gBAAgB,EAAtB;AACAA,oBAAcD,cAAd,IAAgCN,WAAhC;AACA,YAAMQ,oBAAoB,EAA1B;AACAA,wBAAkBJ,SAAlB,IAA+BG,aAA/B;AAEA7B,aAAOG,KAAP,CAAaK,MAAb,CAAoB,KAAKnC,IAAL,CAAUgC,GAA9B,EAAmC;AAClC0B,eAAOD;AAD2B,OAAnC;AAIA,YAAMjB,WAAW;AAChB7C,gBAAQ,SADQ;AAEhB8C,cAAM;AACL/C,mBAAS;AADJ;AAFU,OAAjB,CAjByB,CAwBzB;;AACA,YAAMkD,YAAY9B,KAAKzC,OAAL,CAAasF,WAAb,IAA4B7C,KAAKzC,OAAL,CAAasF,WAAb,CAAyB/B,IAAzB,CAA8B,IAA9B,CAA9C;;AACA,UAAIgB,aAAa,IAAjB,EAAuB;AACtBvI,UAAEyI,MAAF,CAASN,SAASC,IAAlB,EAAwB;AACvBM,iBAAOH;AADgB,SAAxB;AAGA;;AACD,aAAOJ,QAAP;AACA,KAhCD;AAkCA;;;;;;;AAKA,WAAO,KAAKzE,QAAL,CAAc,QAAd,EAAwB;AAC9BgD,oBAAc;AADgB,KAAxB,EAEJ;AACFjE,YAAM;AACL8G,gBAAQC,IAAR,CAAa,qFAAb;AACAD,gBAAQC,IAAR,CAAa,+DAAb;AACA,eAAOb,OAAOpB,IAAP,CAAY,IAAZ,CAAP;AACA,OALC;;AAMFZ,YAAMgC;AANJ,KAFI,CAAP;AAUA;;AAnVyB;;AAsV3B,MAAMc,cAAc,SAASC,YAAT,CAAsB,GAAG9C,IAAzB,EAA+B;AAClD,QAAM+C,iBAAiB,CAACC,SAAD,EAAY,IAAZ,EAAkB,KAAlB,CAAvB;AACA,SAAO;AACN3B,WAAO,yCADD;;AAENtC,WAAO;AACN,UAAI,KAAKD,UAAL,IAAmB,KAAKA,UAAL,CAAgBmE,OAAvC,EAAgD;AAC/C,aAAKnE,UAAL,GAAkBoE,KAAKC,KAAL,CAAW,KAAKrE,UAAL,CAAgBmE,OAA3B,CAAlB;AACA;;AAED,WAAK,IAAIG,IAAI,CAAb,EAAgBA,IAAI7H,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBxE,WAAlB,CAA8BqF,MAAlD,EAA0D+D,GAA1D,EAA+D;AAC9D,cAAMrH,SAASR,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBxE,WAAlB,CAA8BoJ,CAA9B,CAAf;;AAEA,YAAI,OAAOrH,MAAP,KAAkB,UAAtB,EAAkC;AACjC,gBAAMG,SAASH,OAAOuC,KAAP,CAAa,IAAb,EAAmB0B,IAAnB,CAAf;;AACA,cAAI,CAAC+C,eAAexD,QAAf,CAAwBrD,MAAxB,CAAL,EAAsC;AACrC,mBAAOA,MAAP;AACA;AACD;AACD;;AAED,UAAImF,KAAJ;;AACA,UAAI,KAAKpD,OAAL,CAAaC,OAAb,CAAqB,cAArB,CAAJ,EAA0C;AACzCmD,gBAAQF,SAASC,eAAT,CAAyB,KAAKnD,OAAL,CAAaC,OAAb,CAAqB,cAArB,CAAzB,CAAR;AACA;;AAED,aAAO;AACN+C,gBAAQ,KAAKhD,OAAL,CAAaC,OAAb,CAAqB,WAArB,CADF;AAENmD;AAFM,OAAP;AAIA;;AA3BK,GAAP;AA6BA,CA/BD;;AAiCA9F,WAAW3B,GAAX,GAAiB;AAChB4B,iBAAe,IAAI6H,GAAJ,EADC;AAEhBR,aAFgB;AAGhBS,YAAU1J;AAHM,CAAjB;;AAMA,MAAM2J,yBAAyB,SAASC,uBAAT,GAAmC;AACjE,MAAI,KAAKvF,OAAL,CAAalC,MAAb,KAAwB,SAAxB,IAAqC,KAAKkC,OAAL,CAAaC,OAAb,CAAqB,+BAArB,CAAzC,EAAgG;AAC/F,QAAI3C,WAAWH,QAAX,CAAoBS,GAApB,CAAwB,iBAAxB,MAA+C,IAAnD,EAAyD;AACxD,WAAK0F,QAAL,CAAckC,SAAd,CAAwB,GAAxB,EAA6B;AAC5B,uCAA+BlI,WAAWH,QAAX,CAAoBS,GAApB,CAAwB,iBAAxB,CADH;AAE5B,wCAAgC;AAFJ,OAA7B;AAIA,KALD,MAKO;AACN,WAAK0F,QAAL,CAAckC,SAAd,CAAwB,GAAxB;AACA,WAAKlC,QAAL,CAAcmC,KAAd,CAAoB,oEAApB;AACA;AACD,GAVD,MAUO;AACN,SAAKnC,QAAL,CAAckC,SAAd,CAAwB,GAAxB;AACA;;AACD,OAAKE,IAAL;AACA,CAfD;;AAiBA,MAAMC,YAAY,SAASC,UAAT,CAAoBC,UAApB,EAAgC;AACjD,MAAI,CAACvI,WAAW3B,GAAX,CAAe4E,EAAhB,IAAsBjD,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBpB,OAAlB,CAA0B0G,UAA1B,KAAyCA,UAAnE,EAA+E;AAC9EvI,eAAW3B,GAAX,CAAe4E,EAAf,GAAoB,IAAI5E,GAAJ,CAAQ;AAC3BuD,eAAS,IADkB;AAE3B4G,sBAAgB,IAFW;AAG3BC,kBAAYC,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,aAHV;AAI3BL,gBAJ2B;AAK3BP,4BAL2B;AAM3BjE,YAAMuD;AANqB,KAAR,CAApB;AAQA;;AAED,MAAI,CAACtH,WAAW3B,GAAX,CAAeJ,OAAhB,IAA2B+B,WAAW3B,GAAX,CAAeJ,OAAf,CAAuB4D,OAAvB,CAA+B0G,UAA/B,KAA8CA,UAA7E,EAAyF;AACxFvI,eAAW3B,GAAX,CAAeJ,OAAf,GAAyB,IAAII,GAAJ,CAAQ;AAChCmK,sBAAgB,IADgB;AAEhCC,kBAAYC,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,aAFL;AAGhCL,gBAHgC;AAIhCP,4BAJgC;AAKhCjE,YAAMuD;AAL0B,KAAR,CAAzB;AAOA;AACD,CArBD,C,CAuBA;;;AACAtH,WAAWH,QAAX,CAAoBS,GAApB,CAAwB,iBAAxB,EAA2C,CAACuI,GAAD,EAAMC,KAAN,KAAgB;AAC1DT,YAAUS,KAAV;AACA,CAFD,E,CAIA;;AACAT,UAAU,CAAC,CAACrI,WAAWH,QAAX,CAAoBS,GAApB,CAAwB,iBAAxB,CAAZ,E;;;;;;;;;;;AC/aAN,WAAWH,QAAX,CAAoBkJ,QAApB,CAA6B,SAA7B,EAAwC,YAAW;AAClD,OAAKC,OAAL,CAAa,UAAb,EAAyB,YAAW;AACnC,SAAKC,GAAL,CAAS,uBAAT,EAAkC,GAAlC,EAAuC;AAAEC,YAAM,KAAR;AAAeC,cAAQ;AAAvB,KAAvC;AACA,SAAKF,GAAL,CAAS,mBAAT,EAA8B,EAA9B,EAAkC;AAAEC,YAAM,KAAR;AAAeC,cAAQ;AAAvB,KAAlC;AACA,SAAKF,GAAL,CAAS,0BAAT,EAAqC,IAArC,EAA2C;AAAEC,YAAM,SAAR;AAAmBC,cAAQ;AAA3B,KAA3C;AACA,SAAKF,GAAL,CAAS,4CAAT,EAAuD,KAAvD,EAA8D;AAAEC,YAAM,SAAR;AAAmBC,cAAQ;AAA3B,KAA9D;AACA,SAAKF,GAAL,CAAS,oBAAT,EAA+B,IAA/B,EAAqC;AAAEC,YAAM,SAAR;AAAmBC,cAAQ;AAA3B,KAArC;AACA,SAAKF,GAAL,CAAS,kBAAT,EAA6B,GAA7B,EAAkC;AAAEC,YAAM,QAAR;AAAkBC,cAAQ,KAA1B;AAAiCC,mBAAa;AAAE5D,aAAK,oBAAP;AAA6BsD,eAAO;AAApC;AAA9C,KAAlC;AACA,SAAKG,GAAL,CAAS,iBAAT,EAA4B,KAA5B,EAAmC;AAAEC,YAAM,SAAR;AAAmBC,cAAQ;AAA3B,KAAnC;AACA,SAAKF,GAAL,CAAS,iBAAT,EAA4B,GAA5B,EAAiC;AAAEC,YAAM,QAAR;AAAkBC,cAAQ,KAA1B;AAAiCC,mBAAa;AAAE5D,aAAK,iBAAP;AAA0BsD,eAAO;AAAjC;AAA9C,KAAjC;AACA,GATD;AAUA,CAXD,E;;;;;;;;;;;ACAA9I,WAAW3B,GAAX,CAAe4B,aAAf,CAA6BoJ,GAA7B,CAAiC,eAAjC,EAAkD,SAASC,cAAT,GAA0B;AAC3E,SAAO,CAAC,MAAD,EAAS,KAAT,EAAgBtF,QAAhB,CAAyB,KAAKtB,OAAL,CAAalC,MAAtC,IAAgD,KAAK+C,UAArD,GAAkE,KAAKgG,WAA9E;AACA,CAFD,E;;;;;;;;;;;ACAA;AACA;AACA;AAEAvJ,WAAW3B,GAAX,CAAe4B,aAAf,CAA6BoJ,GAA7B,CAAiC,oBAAjC,EAAuD,SAASG,mBAAT,GAA+B;AACrF,QAAMC,iBAAiBzJ,WAAWH,QAAX,CAAoBS,GAApB,CAAwB,uBAAxB,KAAoD,CAApD,GAAwD,GAAxD,GAA8DN,WAAWH,QAAX,CAAoBS,GAApB,CAAwB,uBAAxB,CAArF;AACA,QAAMoJ,eAAe1J,WAAWH,QAAX,CAAoBS,GAApB,CAAwB,mBAAxB,KAAgD,CAAhD,GAAoD,EAApD,GAAyDN,WAAWH,QAAX,CAAoBS,GAApB,CAAwB,mBAAxB,CAA9E;AACA,QAAMqJ,SAAS,KAAKJ,WAAL,CAAiBI,MAAjB,GAA0BC,SAAS,KAAKL,WAAL,CAAiBI,MAA1B,CAA1B,GAA8D,CAA7E;AACA,MAAIE,QAAQH,YAAZ,CAJqF,CAMrF;;AACA,MAAI,OAAO,KAAKH,WAAL,CAAiBM,KAAxB,KAAkC,WAAtC,EAAmD;AAClDA,YAAQD,SAAS,KAAKL,WAAL,CAAiBM,KAA1B,CAAR;AACA,GAFD,MAEO;AACNA,YAAQH,YAAR;AACA;;AAED,MAAIG,QAAQJ,cAAZ,EAA4B;AAC3BI,YAAQJ,cAAR;AACA;;AAED,MAAII,UAAU,CAAV,IAAe,CAAC7J,WAAWH,QAAX,CAAoBS,GAApB,CAAwB,0BAAxB,CAApB,EAAyE;AACxEuJ,YAAQH,YAAR;AACA;;AAED,SAAO;AACNC,UADM;AAENE;AAFM,GAAP;AAIA,CAzBD,E;;;;;;;;;;;ACJA;AACA7J,WAAW3B,GAAX,CAAe4B,aAAf,CAA6BoJ,GAA7B,CAAiC,mBAAjC,EAAsD,SAASS,kBAAT,GAA8B;AACnF,QAAMC,cAAc;AAAEC,kBAAc;AAAhB,GAApB;AACA,MAAIxG,IAAJ;AACA,QAAMyG,SAAS,KAAKC,aAAL,EAAf;;AAEA,MAAID,OAAOvE,MAAP,IAAiBuE,OAAOvE,MAAP,CAAcyE,IAAd,EAArB,EAA2C;AAC1C3G,WAAOxD,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwBC,WAAxB,CAAoCL,OAAOvE,MAA3C,KAAsDqE,WAA7D;AACA,GAFD,MAEO,IAAIE,OAAOxG,QAAP,IAAmBwG,OAAOxG,QAAP,CAAgB0G,IAAhB,EAAvB,EAA+C;AACrD3G,WAAOxD,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwBE,iBAAxB,CAA0CN,OAAOxG,QAAjD,KAA8DsG,WAArE;AACA,GAFM,MAEA,IAAIE,OAAOzG,IAAP,IAAeyG,OAAOzG,IAAP,CAAY2G,IAAZ,EAAnB,EAAuC;AAC7C3G,WAAOxD,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwBE,iBAAxB,CAA0CN,OAAOzG,IAAjD,KAA0DuG,WAAjE;AACA,GAFM,MAEA;AACN,UAAM,IAAI5E,OAAOqF,KAAX,CAAiB,+BAAjB,EAAkD,4DAAlD,CAAN;AACA;;AAED,MAAIhH,KAAKwG,YAAT,EAAuB;AACtB,UAAM,IAAI7E,OAAOqF,KAAX,CAAiB,oBAAjB,EAAuC,6EAAvC,CAAN;AACA;;AAED,SAAOhH,IAAP;AACA,CApBD,E;;;;;;;;;;;ACDA,MAAMiH,wBAAyBjH,IAAD,IAAU;AACvC,QAAM;AACLgC,OADK;AAELnF,QAFK;AAGLpB,UAHK;AAILkE,UAJK;AAKLhE,oBALK;AAMLsE,YANK;AAOLiH,aAPK;AAQLC,UARK;AASLC,YATK;AAULnL,SAVK;AAWLI,YAXK;AAYLD;AAZK,MAaF4D,IAbJ;AAcA,SAAO;AACNgC,OADM;AAENnF,QAFM;AAGNpB,UAHM;AAINkE,UAJM;AAKNhE,oBALM;AAMNsE,YANM;AAONiH,aAPM;AAQNC,UARM;AASNC,YATM;AAUNnL,SAVM;AAWNI,YAXM;AAYND;AAZM,GAAP;AAcA,CA7BD;;AAgCAI,WAAW3B,GAAX,CAAe4B,aAAf,CAA6BoJ,GAA7B,CAAiC,aAAjC,EAAgD,SAASwB,YAAT,CAAsBrH,IAAtB,EAA4B;AAC3E,QAAM2C,KAAKsE,sBAAsBjH,IAAtB,CAAX;;AACA,QAAMsH,kBAAkB,MAAM;AAC7B,QAAI3E,MAAMA,GAAGlH,MAAT,IAAmB8L,MAAMpJ,OAAN,CAAcwE,GAAGlH,MAAjB,CAAvB,EAAiD;AAChD,aAAOkH,GAAGlH,MAAH,CAAU+L,IAAV,CAAgBtH,KAAD,IAAWA,MAAMuH,QAAhC,CAAP;AACA;;AACD,WAAO,KAAP;AACA,GALD;;AAMA,QAAMC,qBAAqB,MAAM;AAChC,UAAMC,2BAA2B,oCAAjC;AACA,UAAMC,yBAAyBpL,WAAWH,QAAX,CAAoBS,GAApB,CAAwB,IAAI+K,MAAJ,CAAY,IAAIF,wBAA0B,KAA1C,CAAxB,CAA/B;AAEA,WAAOC,uBAAuBE,MAAvB,CAA8B,CAACC,WAAD,EAAcC,OAAd,KAA0B;AAC9D,YAAMC,uBAAuBD,QAAQ3C,GAAR,CAAY6C,OAAZ,CAAoBP,wBAApB,EAA8C,GAA9C,EAAmDhB,IAAnD,EAA7B;AACAoB,kBAAYE,oBAAZ,IAAoCzL,WAAW2L,iBAAX,CAA6BnI,IAA7B,EAAmCiI,oBAAnC,CAApC;AACA,aAAOF,WAAP;AACA,KAJM,EAIJ,EAJI,CAAP;AAKA,GATD;;AAUA,QAAMK,gBAAgBd,iBAAtB;AACA3E,KAAGzC,KAAH,GAAWkI,gBAAgBA,cAAcC,OAA9B,GAAwCpE,SAAnD;AACAtB,KAAGtG,QAAH,GAAc;AACbiM,iBAAaZ;AADA,GAAd;AAIA,SAAO/E,EAAP;AACA,CAzBD,E;;;;;;;;;;;AChCAnG,WAAW3B,GAAX,CAAe4B,aAAf,CAA6BoJ,GAA7B,CAAiC,kBAAjC,EAAqD,SAAS0C,iBAAT,GAA6B;AACjF,QAAM9B,SAAS,KAAKC,aAAL,EAAf;AAEA,SAAQ,CAACD,OAAOvE,MAAR,IAAkB,CAACuE,OAAOxG,QAA1B,IAAsC,CAACwG,OAAOzG,IAA/C,IACLyG,OAAOvE,MAAP,IAAiB,KAAKA,MAAL,KAAgBuE,OAAOvE,MADnC,IAELuE,OAAOxG,QAAP,IAAmB,KAAKD,IAAL,CAAUC,QAAV,KAAuBwG,OAAOxG,QAF5C,IAGLwG,OAAOzG,IAAP,IAAe,KAAKA,IAAL,CAAUC,QAAV,KAAuBwG,OAAOzG,IAH/C;AAIA,CAPD,E;;;;;;;;;;;ACAAxD,WAAW3B,GAAX,CAAe4B,aAAf,CAA6BoJ,GAA7B,CAAiC,gBAAjC,EAAmD,SAAS2C,eAAT,GAA2B;AAC7E,MAAIC,IAAJ;;AACA,MAAI,KAAK1C,WAAL,CAAiB0C,IAArB,EAA2B;AAC1B,QAAI;AACHA,aAAOtE,KAAKC,KAAL,CAAW,KAAK2B,WAAL,CAAiB0C,IAA5B,CAAP;AACA,KAFD,CAEE,OAAOjJ,CAAP,EAAU;AACX,WAAK7E,MAAL,CAAYkJ,IAAZ,CAAkB,oCAAoC,KAAKkC,WAAL,CAAiB0C,IAAM,IAA7E,EAAkFjJ,CAAlF;AACA,YAAM,IAAImC,OAAOqF,KAAX,CAAiB,oBAAjB,EAAwC,qCAAqC,KAAKjB,WAAL,CAAiB0C,IAAM,GAApG,EAAwG;AAAE7I,sBAAc;AAAhB,OAAxG,CAAN;AACA;AACD;;AAED,MAAI8I,MAAJ;;AACA,MAAI,KAAK3C,WAAL,CAAiB2C,MAArB,EAA6B;AAC5B,QAAI;AACHA,eAASvE,KAAKC,KAAL,CAAW,KAAK2B,WAAL,CAAiB2C,MAA5B,CAAT;AACA,KAFD,CAEE,OAAOlJ,CAAP,EAAU;AACX,WAAK7E,MAAL,CAAYkJ,IAAZ,CAAkB,sCAAsC,KAAKkC,WAAL,CAAiB2C,MAAQ,IAAjF,EAAsFlJ,CAAtF;AACA,YAAM,IAAImC,OAAOqF,KAAX,CAAiB,sBAAjB,EAA0C,uCAAuC,KAAKjB,WAAL,CAAiB2C,MAAQ,GAA1G,EAA8G;AAAE9I,sBAAc;AAAhB,OAA9G,CAAN;AACA;AACD,GAnB4E,CAqB7E;;;AACA,MAAI,OAAO8I,MAAP,KAAkB,QAAtB,EAAgC;AAC/B,QAAIC,sBAAsBnK,OAAOC,IAAP,CAAYjC,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE,sBAA9B,CAA1B;;AACA,QAAI,KAAK+D,OAAL,CAAaX,KAAb,CAAmBiC,QAAnB,CAA4B,YAA5B,CAAJ,EAA+C;AAC9C,YAAMoI,YAAY,MAAMpK,OAAOC,IAAP,CAAYjC,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,2BAA5C,IAA2E1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBnD,4CAA7F,GAA4IE,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBlE,0BAA1K,CAAxB;;AACAoN,4BAAsBA,oBAAoBI,MAApB,CAA2BH,WAA3B,CAAtB;AACA;;AAEDpK,WAAOC,IAAP,CAAYiK,MAAZ,EAAoBpK,OAApB,CAA6B0K,CAAD,IAAO;AAClC,UAAIL,oBAAoBnI,QAApB,CAA6BwI,CAA7B,KAAmCL,oBAAoBnI,QAApB,CAA6BwI,EAAEC,KAAF,CAAQzM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvE,cAA1B,EAA0C,CAA1C,CAA7B,CAAvC,EAAmH;AAClH,eAAOwN,OAAOM,CAAP,CAAP;AACA;AACD,KAJD;AAKA,GAlC4E,CAoC7E;;;AACAN,WAASlK,OAAO0K,MAAP,CAAc,EAAd,EAAkBR,MAAlB,EAA0BlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE,sBAA5C,CAAT;;AACA,MAAI,KAAK+D,OAAL,CAAaX,KAAb,CAAmBiC,QAAnB,CAA4B,YAA5B,CAAJ,EAA+C;AAC9C,QAAIhE,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,2BAA5C,CAAJ,EAA8E;AAC7EwG,eAASlK,OAAO0K,MAAP,CAAcR,MAAd,EAAsBlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBnD,4CAAxC,CAAT;AACA,KAFD,MAEO;AACNoM,eAASlK,OAAO0K,MAAP,CAAcR,MAAd,EAAsBlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBlE,0BAAxC,CAAT;AACA;AACD;;AAED,MAAI4N,QAAQ,EAAZ;;AACA,MAAI,KAAKpD,WAAL,CAAiBoD,KAArB,EAA4B;AAC3B,QAAI;AACHA,cAAQhF,KAAKC,KAAL,CAAW,KAAK2B,WAAL,CAAiBoD,KAA5B,CAAR;AACA,KAFD,CAEE,OAAO3J,CAAP,EAAU;AACX,WAAK7E,MAAL,CAAYkJ,IAAZ,CAAkB,qCAAqC,KAAKkC,WAAL,CAAiBoD,KAAO,IAA/E,EAAoF3J,CAApF;AACA,YAAM,IAAImC,OAAOqF,KAAX,CAAiB,qBAAjB,EAAyC,sCAAsC,KAAKjB,WAAL,CAAiBoD,KAAO,GAAvG,EAA2G;AAAEvJ,sBAAc;AAAhB,OAA3G,CAAN;AACA;AACD,GAtD4E,CAwD7E;;;AACA,MAAI,OAAOuJ,KAAP,KAAiB,QAArB,EAA+B;AAC9B,QAAIC,qBAAqB5K,OAAOC,IAAP,CAAYjC,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE,sBAA9B,CAAzB;;AACA,QAAI,KAAK+D,OAAL,CAAaX,KAAb,CAAmBiC,QAAnB,CAA4B,YAA5B,CAAJ,EAA+C;AAC9C,UAAIhE,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,2BAA5C,CAAJ,EAA8E;AAC7EkH,6BAAqBA,mBAAmBL,MAAnB,CAA0BvK,OAAOC,IAAP,CAAYjC,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBnD,4CAA9B,CAA1B,CAArB;AACA,OAFD,MAEO;AACN8M,6BAAqBA,mBAAmBL,MAAnB,CAA0BvK,OAAOC,IAAP,CAAYjC,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBlE,0BAA9B,CAA1B,CAArB;AACA;AACD;;AAEDiD,WAAOC,IAAP,CAAY0K,KAAZ,EAAmB7K,OAAnB,CAA4B0K,CAAD,IAAO;AACjC,UAAII,mBAAmB5I,QAAnB,CAA4BwI,CAA5B,KAAkCI,mBAAmB5I,QAAnB,CAA4BwI,EAAEC,KAAF,CAAQzM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvE,cAA1B,EAA0C,CAA1C,CAA5B,CAAtC,EAAiH;AAChH,eAAOiO,MAAMH,CAAN,CAAP;AACA;AACD,KAJD;AAKA;;AAED,SAAO;AACNP,QADM;AAENC,UAFM;AAGNS;AAHM,GAAP;AAKA,CA/ED,E;;;;;;;;;;;;;;;ACAA3M,WAAW3B,GAAX,CAAe4B,aAAf,CAA6BoJ,GAA7B,CAAiC,oBAAjC,EAAuD,SAASwD,mBAAT,CAA6B;AAAEC,UAAF;AAAYC,qBAAZ;AAAiC/G;AAAjC,CAA7B,EAA0E;AAChI,QAAMgH,iBAAkB,iBAAiBF,QAAU,qDAAqDC,mBAAqB,EAA7H;AACA3F,UAAQC,IAAR,CAAa2F,cAAb;;AACA,MAAItE,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,aAA7B,EAA4C;AAC3C;AACCqE,eAASD;AADV,OAEIhH,QAFJ;AAIA;;AAED,SAAOA,QAAP;AACA,CAXD,E;;;;;;;;;;;ACAAhG,WAAW3B,GAAX,CAAe4B,aAAf,CAA6BoJ,GAA7B,CAAiC,iBAAjC,EAAoD,SAAS6D,gBAAT,GAA4B;AAC/E,MAAI1J,IAAJ;;AAEA,MAAI,KAAKd,OAAL,CAAaC,OAAb,CAAqB,cAArB,KAAwC,KAAKD,OAAL,CAAaC,OAAb,CAAqB,WAArB,CAA5C,EAA+E;AAC9Ea,WAAOxD,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwB9E,OAAxB,CAAgC;AACtCC,WAAK,KAAK9C,OAAL,CAAaC,OAAb,CAAqB,WAArB,CADiC;AAEtC,iDAA2CiD,SAASC,eAAT,CAAyB,KAAKnD,OAAL,CAAaC,OAAb,CAAqB,cAArB,CAAzB;AAFL,KAAhC,CAAP;AAIA;;AAED,SAAOa,IAAP;AACA,CAXD,E;;;;;;;;;;;ACAAxD,WAAW3B,GAAX,CAAe4B,aAAf,CAA6BoJ,GAA7B,CAAiC,kBAAjC,EAAqD,SAAS8D,gBAAT,CAA0B;AAAEC,QAAF;AAAU1H;AAAV,CAA1B,EAA8C;AAClG,QAAMlC,OAAOxD,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwBC,WAAxB,CAAoC5E,MAApC,CAAb;AACA0H,SAAO5J,IAAP,GAAc,EAAd;;AACA,MAAIA,IAAJ,EAAU;AACT4J,WAAO5J,IAAP,GAAc;AACbgC,WAAKE,MADQ;AAEbjC,gBAAUD,KAAKC,QAFF;AAGbpD,YAAMmD,KAAKnD;AAHE,KAAd;AAKA;;AAGD,SAAO+M,MAAP;AACA,CAbD,E;;;;;;;;;;;ACAApN,WAAW3B,GAAX,CAAeJ,OAAf,CAAuBsD,QAAvB,CAAgC,MAAhC,EAAwC;AAAEgD,gBAAc;AAAhB,CAAxC,EAAiE;AAChEjE,QAAM;AACL,UAAMkD,OAAO,KAAK6J,eAAL,EAAb;;AAEA,QAAI7J,QAAQxD,WAAWqM,KAAX,CAAiBiB,OAAjB,CAAyB9J,KAAKgC,GAA9B,EAAmC,OAAnC,CAAZ,EAAyD;AACxD,aAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC6M,cAAMvN,WAAWwN;AADe,OAA1B,CAAP;AAGA;;AAED,WAAOxN,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCkB,eAAS5B,WAAWwN,IAAX,CAAgB5L;AADO,KAA1B,CAAP;AAGA;;AAb+D,CAAjE,E;;;;;;;;;;;;;;;ACAA,IAAI/D,CAAJ;;AAAMC,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACL,QAAEK,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;;AAEN;AACA,SAASuP,qBAAT,CAA+B;AAAExD,QAAF;AAAUyD,oBAAkB;AAA5B,CAA/B,EAAmE;AAClE,MAAI,CAAC,CAACzD,OAAO0D,MAAR,IAAkB,CAAC1D,OAAO0D,MAAP,CAAcxD,IAAd,EAApB,MAA8C,CAACF,OAAO2D,QAAR,IAAoB,CAAC3D,OAAO2D,QAAP,CAAgBzD,IAAhB,EAAnE,CAAJ,EAAgG;AAC/F,UAAM,IAAIhF,OAAOqF,KAAX,CAAiB,iCAAjB,EAAoD,kDAApD,CAAN;AACA;;AAED,QAAM0B,yCAAclM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE,sBAAhC,CAAN;AAEA,MAAIkP,IAAJ;;AACA,MAAI5D,OAAO0D,MAAX,EAAmB;AAClBE,WAAO7N,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoCL,OAAO0D,MAA3C,EAAmD;AAAEzB;AAAF,KAAnD,CAAP;AACA,GAFD,MAEO,IAAIjC,OAAO2D,QAAX,EAAqB;AAC3BC,WAAO7N,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBC,aAAxB,CAAsC9D,OAAO2D,QAA7C,EAAuD;AAAE1B;AAAF,KAAvD,CAAP;AACA;;AAED,MAAI,CAAC2B,IAAD,IAASA,KAAKG,CAAL,KAAW,GAAxB,EAA6B;AAC5B,UAAM,IAAI7I,OAAOqF,KAAX,CAAiB,sBAAjB,EAAyC,+EAAzC,CAAN;AACA;;AAED,MAAIkD,mBAAmBG,KAAKI,QAA5B,EAAsC;AACrC,UAAM,IAAI9I,OAAOqF,KAAX,CAAiB,qBAAjB,EAAyC,gBAAgBqD,KAAKxN,IAAM,eAApE,CAAN;AACA;;AAED,SAAOwN,IAAP;AACA;;AAED7N,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,iBAA3B,EAA8C;AAAEgD,gBAAc;AAAhB,CAA9C,EAAsE;AACrEC,SAAO;AACN,UAAM0J,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL;AAAV,KAAtB,CAAnB;AAEA/E,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAW1I,GAA3C,EAAgD,KAAKjC,UAAL,CAAgB6K,eAAhE;AACA,KAFD;AAIA,WAAOpO,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC2N,eAASrO,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC4D,WAAW1I,GAA/C,EAAoD;AAAE0G,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAApD;AADuB,KAA1B,CAAP;AAGA;;AAXoE,CAAtE;AAcAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,uBAA3B,EAAoD;AAAEgD,gBAAc;AAAhB,CAApD,EAA4E;AAC3EC,SAAO;AACN,UAAM0J,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL;AAAV,KAAtB,CAAnB;AAEA,UAAM1G,OAAO,KAAK8K,iBAAL,EAAb;AAEAnJ,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAW1I,GAA3C,EAAgDhC,KAAKgC,GAArD;AACA,KAFD;AAIA,WAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAX0E,CAA5E;AAcAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,mBAA3B,EAAgD;AAAEgD,gBAAc;AAAhB,CAAhD,EAAwE;AACvEC,SAAO;AACN,UAAM0J,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL;AAAV,KAAtB,CAAnB;AAEA,UAAM1G,OAAO,KAAK8K,iBAAL,EAAb;AAEAnJ,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,cAAZ,EAA4B8I,WAAW1I,GAAvC,EAA4ChC,KAAKgC,GAAjD;AACA,KAFD;AAIA,WAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAXsE,CAAxE;AAcAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,kBAA3B,EAA+C;AAAEgD,gBAAc;AAAhB,CAA/C,EAAuE;AACtEC,SAAO;AACN,UAAM0J,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL;AAAV,KAAtB,CAAnB;AAEA/E,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,aAAZ,EAA2B8I,WAAW1I,GAAtC;AACA,KAFD;AAIA,WAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AATqE,CAAvE;AAYAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,gBAA3B,EAA6C;AAAEgD,gBAAc;AAAhB,CAA7C,EAAqE;AACpEC,SAAO;AACN,UAAM0J,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL,EAAV;AAAgCwD,uBAAiB;AAAjD,KAAtB,CAAnB;AAEA,UAAMa,MAAMvO,WAAWoK,MAAX,CAAkBoE,aAAlB,CAAgCC,wBAAhC,CAAyDP,WAAW1I,GAApE,EAAyE,KAAKE,MAA9E,CAAZ;;AAEA,QAAI,CAAC6I,GAAL,EAAU;AACT,aAAOvO,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA2B,0CAA0CkN,WAAW7N,IAAM,GAAtF,CAAP;AACA;;AAED,QAAI,CAACkO,IAAIG,IAAT,EAAe;AACd,aAAO1O,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA2B,gBAAgBkN,WAAW7N,IAAM,mCAA5D,CAAP;AACA;;AAED8E,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,UAAZ,EAAwB8I,WAAW1I,GAAnC;AACA,KAFD;AAIA,WAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAnBmE,CAArE;AAsBAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,mBAA3B,EAAgD;AAAEgD,gBAAc;AAAhB,CAAhD,EAAwE;AACvEjE,QAAM;AACL,UAAMqO,SAAS3O,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,0BAA5C,CAAf;AACA,UAAM;AAAEA;AAAF,QAAa,KAAKwE,aAAL,EAAnB;AACA,QAAI1G,OAAO,KAAKkC,MAAhB;AACA,QAAIkJ,UAAU,IAAd;AACA,QAAIC,eAAe,IAAnB;AACA,QAAIC,cAAc,IAAlB;AACA,QAAIC,SAAS,KAAb;AACA,QAAIC,OAAO,IAAX;AACA,QAAIC,SAAS,IAAb;AACA,QAAIpQ,UAAU,IAAd;;AAEA,QAAI6G,MAAJ,EAAY;AACX,UAAI,CAACiJ,MAAL,EAAa;AACZ,eAAO3O,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AACDkC,aAAOkC,MAAP;AACA;;AACD,UAAMmI,OAAOJ,sBAAsB;AAClCxD,cAAQ,KAAKC,aAAL,EAD0B;AAElCgF,uBAAiB;AAFiB,KAAtB,CAAb;AAIA,UAAMC,eAAenP,WAAWoK,MAAX,CAAkBoE,aAAlB,CAAgCC,wBAAhC,CAAyDZ,KAAKrI,GAA9D,EAAmEhC,IAAnE,CAArB;AACA,UAAM4L,KAAKvB,KAAKuB,EAAL,GAAUvB,KAAKuB,EAAf,GAAoBvB,KAAKlO,UAApC;;AAEA,QAAI,OAAOwP,YAAP,KAAwB,WAAxB,IAAuCA,aAAaT,IAAxD,EAA8D;AAC7DE,gBAAU5O,WAAWoK,MAAX,CAAkBiF,QAAlB,CAA2BC,8CAA3B,CAA0EH,aAAaI,GAAvF,EAA4FJ,aAAaK,EAAzG,EAA6GJ,EAA7G,CAAV;AACAN,oBAAcK,aAAaK,EAAb,IAAmBL,aAAaM,EAA9C;AACAZ,qBAAeM,aAAaN,YAA5B;AACAE,eAAS,IAAT;AACA;;AAED,QAAIJ,UAAUI,MAAd,EAAsB;AACrBC,aAAOnB,KAAKmB,IAAZ;AACAC,eAASG,EAAT;AACAvQ,gBAAUgP,KAAK6B,UAAf;AACA;;AAED,WAAO1P,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCqO,YADgC;AAEhClQ,aAFgC;AAGhC+P,aAHgC;AAIhCE,iBAJgC;AAKhCE,UALgC;AAMhCC,YANgC;AAOhCJ;AAPgC,KAA1B,CAAP;AASA;;AAhDsE,CAAxE,E,CAmDA;;AAEA,SAASc,sBAAT,CAAgC1F,MAAhC,EAAwC;AACvC,MAAI,CAACjK,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+BrC,OAAOzG,IAAP,CAAYsF,KAA3C,EAAkD,UAAlD,CAAL,EAAoE;AACnE,UAAM,IAAI0B,KAAJ,CAAU,cAAV,CAAN;AACA;;AAED,MAAI,CAACP,OAAO5J,IAAR,IAAgB,CAAC4J,OAAO5J,IAAP,CAAYyI,KAAjC,EAAwC;AACvC,UAAM,IAAI0B,KAAJ,CAAW,UAAUP,OAAO5J,IAAP,CAAYwI,GAAK,eAAtC,CAAN;AACA;;AAED,MAAIoB,OAAOpL,OAAP,IAAkBoL,OAAOpL,OAAP,CAAeiK,KAAjC,IAA0C,CAACjL,EAAE8D,OAAF,CAAUsI,OAAOpL,OAAP,CAAeiK,KAAzB,CAA/C,EAAgF;AAC/E,UAAM,IAAI0B,KAAJ,CAAW,UAAUP,OAAOpL,OAAP,CAAegK,GAAK,gCAAzC,CAAN;AACA;;AAED,MAAIoB,OAAOrK,YAAP,IAAuBqK,OAAOrK,YAAP,CAAoBkJ,KAA3C,IAAoD,EAAE,OAAOmB,OAAOrK,YAAP,CAAoBkJ,KAA3B,KAAqC,QAAvC,CAAxD,EAA0G;AACzG,UAAM,IAAI0B,KAAJ,CAAW,UAAUP,OAAOrK,YAAP,CAAoBiJ,GAAK,iCAA9C,CAAN;AACA;AACD;;AAED,SAAS+G,aAAT,CAAuBlK,MAAvB,EAA+BuE,MAA/B,EAAuC;AACtC,QAAM4F,WAAW,OAAO5F,OAAO4F,QAAd,KAA2B,WAA3B,GAAyC5F,OAAO4F,QAAhD,GAA2D,KAA5E;AAEA,MAAIpK,EAAJ;AACAN,SAAOgJ,SAAP,CAAiBzI,MAAjB,EAAyB,MAAM;AAC9BD,SAAKN,OAAOC,IAAP,CAAY,eAAZ,EAA6B6E,OAAO5J,IAApC,EAA0C4J,OAAOpL,OAAP,GAAiBoL,OAAOpL,OAAxB,GAAkC,EAA5E,EAAgFgR,QAAhF,EAA0F5F,OAAOrK,YAAjG,CAAL;AACA,GAFD;AAIA,SAAO;AACNyO,aAASrO,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC7E,GAAG8J,GAAvC,EAA4C;AAAErD,cAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,KAA5C;AADH,GAAP;AAGA;;AAEDqB,WAAW3B,GAAX,CAAeyR,QAAf,GAA0B,EAA1B;AACA9P,WAAW3B,GAAX,CAAeyR,QAAf,CAAwBC,MAAxB,GAAiC;AAChCC,YAAUL,sBADsB;AAEhCM,WAASL;AAFuB,CAAjC;AAKA5P,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,iBAA3B,EAA8C;AAAEgD,gBAAc;AAAhB,CAA9C,EAAsE;AACrEC,SAAO;AACN,UAAM;AAAEkB,YAAF;AAAUnC;AAAV,QAAyB,IAA/B;AAEA,QAAIpC,KAAJ;;AAEA,QAAI;AACHnB,iBAAW3B,GAAX,CAAeyR,QAAf,CAAwBC,MAAxB,CAA+BC,QAA/B,CAAwC;AACvCxM,cAAM;AACLsF,iBAAOpD;AADF,SADiC;AAIvCrF,cAAM;AACLyI,iBAAOvF,WAAWlD,IADb;AAELwI,eAAK;AAFA,SAJiC;AAQvChK,iBAAS;AACRiK,iBAAOvF,WAAW1E,OADV;AAERgK,eAAK;AAFG;AAR8B,OAAxC;AAaA,KAdD,CAcE,OAAO7F,CAAP,EAAU;AACX,UAAIA,EAAEE,OAAF,KAAc,cAAlB,EAAkC;AACjC/B,gBAAQnB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAR;AACA,OAFD,MAEO;AACNH,gBAAQnB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0BgC,EAAEE,OAA5B,CAAR;AACA;AACD;;AAED,QAAI/B,KAAJ,EAAW;AACV,aAAOA,KAAP;AACA;;AAED,WAAOnB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0BV,WAAW3B,GAAX,CAAeyR,QAAf,CAAwBC,MAAxB,CAA+BE,OAA/B,CAAuCvK,MAAvC,EAA+CnC,UAA/C,CAA1B,CAAP;AACA;;AAjCoE,CAAtE;AAoCAvD,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,iBAA3B,EAA8C;AAAEgD,gBAAc;AAAhB,CAA9C,EAAsE;AACrEC,SAAO;AACN,UAAM0J,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL,EAAV;AAAgCwD,uBAAiB;AAAjD,KAAtB,CAAnB;AAEAvI,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,WAAZ,EAAyB8I,WAAW1I,GAApC;AACA,KAFD;AAIA,WAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC2N,eAASH;AADuB,KAA1B,CAAP;AAGA;;AAXoE,CAAtE;AAcAlO,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,gBAA3B,EAA6C;AAAEgD,gBAAc;AAAhB,CAA7C,EAAqE;AACpEjE,QAAM;AACL,UAAM4N,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL,EAAV;AAAgCwD,uBAAiB;AAAjD,KAAtB,CAAnB;;AACA,UAAMwC,6BAA8BC,IAAD,IAAU;AAC5C,UAAIA,KAAKzK,MAAT,EAAiB;AAChByK,eAAO,KAAKC,gBAAL,CAAsB;AAAEhD,kBAAQ+C,IAAV;AAAgBzK,kBAAQyK,KAAKzK;AAA7B,SAAtB,CAAP;AACA;;AACD,aAAOyK,IAAP;AACA,KALD;;AAOAhL,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,eAAZ,EAA6B8I,WAAW1I,GAAxC,EAA6C,KAAKE,MAAlD;AACA,KAFD;AAIA,UAAM;AAAEiE,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,UAAF;AAAQC,YAAR;AAAgBS;AAAhB,QAA0B,KAAK2D,cAAL,EAAhC;AAEA,UAAMC,WAAWvO,OAAO0K,MAAP,CAAc,EAAd,EAAkBC,KAAlB,EAAyB;AAAE4C,WAAKrB,WAAW1I;AAAlB,KAAzB,CAAjB;AAEA,UAAMgL,QAAQxQ,WAAWoK,MAAX,CAAkBqG,OAAlB,CAA0BzF,IAA1B,CAA+BuF,QAA/B,EAAyC;AACtDtE,YAAMA,OAAOA,IAAP,GAAc;AAAE5L,cAAM;AAAR,OADkC;AAEtDqQ,YAAM/G,MAFgD;AAGtDgH,aAAO9G,KAH+C;AAItDqC;AAJsD,KAAzC,EAKX0E,KALW,EAAd;AAOA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC8P,aAAOA,MAAMK,GAAN,CAAUX,0BAAV,CADyB;AAEhCrG,aACA2G,MAAM1M,MAH0B;AAIhC6F,YAJgC;AAKhCmH,aAAO9Q,WAAWoK,MAAX,CAAkBqG,OAAlB,CAA0BzF,IAA1B,CAA+BuF,QAA/B,EAAyC1G,KAAzC;AALyB,KAA1B,CAAP;AAOA;;AAjCmE,CAArE;AAoCA7J,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,0BAA3B,EAAuD;AAAEgD,gBAAc;AAAhB,CAAvD,EAA+E;AAC9EjE,QAAM;AACL,QAAI,CAACN,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,qBAA5C,CAAL,EAAyE;AACxE,aAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AAED,UAAM4M,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL,EAAV;AAAgCwD,uBAAiB;AAAjD,KAAtB,CAAnB;AAEA,QAAIqD,2BAA2B,IAA/B;;AACA,QAAI,OAAO,KAAKxH,WAAL,CAAiBwH,wBAAxB,KAAqD,WAAzD,EAAsE;AACrEA,iCAA2B,KAAKxH,WAAL,CAAiBwH,wBAAjB,KAA8C,MAAzE;AACA;;AAED,QAAIR,WAAW;AACdlC,eAAU,IAAIH,WAAW7N,IAAM;AADjB,KAAf;;AAIA,QAAI0Q,wBAAJ,EAA8B;AAC7BR,eAASlC,OAAT,GAAmB;AAClB2C,aAAK,CAACT,SAASlC,OAAV,EAAmB,qBAAnB;AADa,OAAnB;AAGA;;AAED,UAAM;AAAE1E,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,UAAF;AAAQC,YAAR;AAAgBS;AAAhB,QAA0B,KAAK2D,cAAL,EAAhC;AAEAC,eAAWvO,OAAO0K,MAAP,CAAc,EAAd,EAAkBC,KAAlB,EAAyB4D,QAAzB,CAAX;AAEA,UAAMU,eAAejR,WAAWoK,MAAX,CAAkB8G,YAAlB,CAA+BlG,IAA/B,CAAoCuF,QAApC,EAA8C;AAClEtE,YAAMA,OAAOA,IAAP,GAAc;AAAEkF,oBAAY;AAAd,OAD8C;AAElET,YAAM/G,MAF4D;AAGlEgH,aAAO9G,KAH2D;AAIlEqC;AAJkE,KAA9C,EAKlB0E,KALkB,EAArB;AAOA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCuQ,kBADgC;AAEhCpH,aAAOoH,aAAanN,MAFY;AAGhC6F,YAHgC;AAIhCmH,aAAO9Q,WAAWoK,MAAX,CAAkB8G,YAAlB,CAA+BlG,IAA/B,CAAoCuF,QAApC,EAA8C1G,KAA9C;AAJyB,KAA1B,CAAP;AAMA;;AAzC6E,CAA/E;AA4CA7J,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,kBAA3B,EAA+C;AAAEgD,gBAAc;AAAhB,CAA/C,EAAuE;AACtEjE,QAAM;AACL,UAAM4N,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL,EAAV;AAAgCwD,uBAAiB;AAAjD,KAAtB,CAAnB;AAEA,QAAI0D,aAAa,IAAIC,IAAJ,EAAjB;;AACA,QAAI,KAAK9H,WAAL,CAAiB0F,MAArB,EAA6B;AAC5BmC,mBAAa,IAAIC,IAAJ,CAAS,KAAK9H,WAAL,CAAiB0F,MAA1B,CAAb;AACA;;AAED,QAAIqC,aAAa7J,SAAjB;;AACA,QAAI,KAAK8B,WAAL,CAAiBgI,MAArB,EAA6B;AAC5BD,mBAAa,IAAID,IAAJ,CAAS,KAAK9H,WAAL,CAAiBgI,MAA1B,CAAb;AACA;;AAED,UAAMC,YAAY,KAAKjI,WAAL,CAAiBiI,SAAjB,IAA8B,KAAhD;AAEA,QAAI3H,QAAQ,EAAZ;;AACA,QAAI,KAAKN,WAAL,CAAiBM,KAArB,EAA4B;AAC3BA,cAAQD,SAAS,KAAKL,WAAL,CAAiBM,KAA1B,CAAR;AACA;;AAED,UAAM+E,UAAU,KAAKrF,WAAL,CAAiBqF,OAAjB,IAA4B,KAA5C;AAEA,QAAIjO,MAAJ;AACAwE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnC/E,eAASwE,OAAOC,IAAP,CAAY,mBAAZ,EAAiC;AACzCmK,aAAKrB,WAAW1I,GADyB;AAEzCyJ,gBAAQmC,UAFiC;AAGzCG,gBAAQD,UAHiC;AAIzCE,iBAJyC;AAKzC3H,aALyC;AAMzC+E;AANyC,OAAjC,CAAT;AAQA,KATD;;AAWA,QAAI,CAACjO,MAAL,EAAa;AACZ,aAAOX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AAED,WAAOtB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0BC,MAA1B,CAAP;AACA;;AAxCqE,CAAvE;AA2CAX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,eAA3B,EAA4C;AAAEgD,gBAAc;AAAhB,CAA5C,EAAoE;AACnEjE,QAAM;AACL,UAAM4N,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL,EAAV;AAAgCwD,uBAAiB;AAAjD,KAAtB,CAAnB;AAEA,WAAO1N,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC2N,eAASrO,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC4D,WAAW1I,GAA/C,EAAoD;AAAE0G,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAApD;AADuB,KAA1B,CAAP;AAGA;;AAPkE,CAApE;AAUAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,iBAA3B,EAA8C;AAAEgD,gBAAc;AAAhB,CAA9C,EAAsE;AACrEC,SAAO;AACN,UAAM0J,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL;AAAV,KAAtB,CAAnB;AAEA,UAAM1G,OAAO,KAAK8K,iBAAL,EAAb;AAEAnJ,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,eAAZ,EAA6B;AAAEmK,aAAKrB,WAAW1I,GAAlB;AAAuB/B,kBAAUD,KAAKC;AAAtC,OAA7B;AACA,KAFD;AAIA,WAAOzD,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC2N,eAASrO,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC4D,WAAW1I,GAA/C,EAAoD;AAAE0G,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAApD;AADuB,KAA1B,CAAP;AAGA;;AAboE,CAAtE;AAgBAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,eAA3B,EAA4C;AAAEgD,gBAAc;AAAhB,CAA5C,EAAoE;AACnEC,SAAO;AACN,UAAM0J,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL;AAAV,KAAtB,CAAnB;AAEA/E,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,UAAZ,EAAwB8I,WAAW1I,GAAnC,EAAwC,KAAKjC,UAAL,CAAgB3E,QAAxD;AACA,KAFD;AAIA,WAAOoB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC2N,eAASrO,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC4D,WAAW1I,GAA/C,EAAoD;AAAE0G,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAApD;AADuB,KAA1B,CAAP;AAGA;;AAXkE,CAApE;AAcAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,eAA3B,EAA4C;AAAEgD,gBAAc;AAAhB,CAA5C,EAAoE;AACnEC,SAAO;AACN,UAAM0J,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL;AAAV,KAAtB,CAAnB;AAEA,UAAM1G,OAAO,KAAK8K,iBAAL,EAAb;AAEAnJ,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,oBAAZ,EAAkC;AAAEmK,aAAKrB,WAAW1I,GAAlB;AAAuB/B,kBAAUD,KAAKC;AAAtC,OAAlC;AACA,KAFD;AAIA,WAAOzD,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC2N,eAASrO,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC4D,WAAW1I,GAA/C,EAAoD;AAAE0G,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAApD;AADuB,KAA1B,CAAP;AAGA;;AAbkE,CAApE;AAgBAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,gBAA3B,EAA6C;AAAEgD,gBAAc;AAAhB,CAA7C,EAAqE;AACpEC,SAAO;AACN,UAAM0J,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL;AAAV,KAAtB,CAAnB;AAEA/E,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,WAAZ,EAAyB8I,WAAW1I,GAApC;AACA,KAFD;AAIA,WAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC2N,eAASrO,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC4D,WAAW1I,GAA/C,EAAoD;AAAE0G,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAApD;AADuB,KAA1B,CAAP;AAGA;;AAXmE,CAArE;AAcAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,eAA3B,EAA4C;AAAEgD,gBAAc;AAAhB,CAA5C,EAAoE;AACnEjE,OAAK;AACJ;AACA4B,aAAS;AACR,YAAM;AAAEyH,cAAF;AAAUE;AAAV,UAAoB,KAAKwG,kBAAL,EAA1B;AACA,YAAM;AAAEpE,YAAF;AAAQC,cAAR;AAAgBS;AAAhB,UAA0B,KAAK2D,cAAL,EAAhC;AACA,YAAMmB,sCAAsCzR,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,aAA5C,CAA5C;AAEA,YAAM6K,2CAAgB5D,KAAhB;AAAuBqB,WAAG;AAA1B,QAAN;;AAEA,UAAI,CAACyD,mCAAL,EAA0C;AACzC,YAAI,CAACzR,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,kBAA5C,CAAL,EAAsE;AACrE,iBAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AACD,cAAMoQ,UAAU1R,WAAWoK,MAAX,CAAkBoE,aAAlB,CAAgCmD,mBAAhC,CAAoD,KAAKjM,MAAzD,EAAiE,GAAjE,EAAsE;AAAEwG,kBAAQ;AAAEqD,iBAAK;AAAP;AAAV,SAAtE,EAA8FqB,KAA9F,GAAsGC,GAAtG,CAA2Ge,CAAD,IAAOA,EAAErC,GAAnH,CAAhB;AACAgB,iBAAS/K,GAAT,GAAe;AAAEwL,eAAKU;AAAP,SAAf;AACA;;AAED,YAAMG,SAAS7R,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwB9C,IAAxB,CAA6BuF,QAA7B,EAAuC;AACrDtE,cAAMA,OAAOA,IAAP,GAAc;AAAE5L,gBAAM;AAAR,SADiC;AAErDqQ,cAAM/G,MAF+C;AAGrDgH,eAAO9G,KAH8C;AAIrDqC;AAJqD,OAAvC,CAAf;AAOA,YAAM4E,QAAQe,OAAOhI,KAAP,EAAd;AAEA,YAAMiI,QAAQD,OAAOjB,KAAP,EAAd;AAEA,aAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCoP,kBAAUgC,KADsB;AAEhCjI,eAAOiI,MAAMhO,MAFmB;AAGhC6F,cAHgC;AAIhCmH;AAJgC,OAA1B,CAAP;AAMA;;AAlCG;AAD8D,CAApE;AAuCA9Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,sBAA3B,EAAmD;AAAEgD,gBAAc;AAAhB,CAAnD,EAA2E;AAC1EjE,QAAM;AACL,UAAM;AAAEqJ,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,UAAF;AAAQC;AAAR,QAAmB,KAAKoE,cAAL,EAAzB,CAFK,CAIL;;AACA,UAAMuB,SAAS7R,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBiE,+BAAxB,CAAwD,GAAxD,EAA6D,KAAKrM,MAAlE,EAA0E;AACxFuG,YAAMA,OAAOA,IAAP,GAAc;AAAE5L,cAAM;AAAR,OADoE;AAExFqQ,YAAM/G,MAFkF;AAGxFgH,aAAO9G,KAHiF;AAIxFqC;AAJwF,KAA1E,CAAf;AAOA,UAAM8F,aAAaH,OAAOhI,KAAP,EAAnB;AACA,UAAMiI,QAAQD,OAAOjB,KAAP,EAAd;AAEA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCoP,gBAAUgC,KADsB;AAEhCnI,YAFgC;AAGhCE,aAAOiI,MAAMhO,MAHmB;AAIhCgN,aAAOkB;AAJyB,KAA1B,CAAP;AAMA;;AAtByE,CAA3E;AAyBAhS,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,kBAA3B,EAA+C;AAAEgD,gBAAc;AAAhB,CAA/C,EAAuE;AACtEjE,QAAM;AACL,UAAM4N,aAAaT,sBAAsB;AACxCxD,cAAQ,KAAKC,aAAL,EADgC;AAExCwD,uBAAiB;AAFuB,KAAtB,CAAnB;;AAKA,QAAIQ,WAAW+D,SAAX,IAAwB,CAACjS,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,4BAA5C,CAA7B,EAAwG;AACvG,aAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AAED,UAAM;AAAEqI,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,aAAO;AAAT,QAAgB,KAAKqE,cAAL,EAAtB;AAEA,UAAM4B,gBAAgBlS,WAAWoK,MAAX,CAAkBoE,aAAlB,CAAgC2D,YAAhC,CAA6CjE,WAAW1I,GAAxD,EAA6D;AAClF0G,cAAQ;AAAE,iBAAS;AAAX,OAD0E;AAElFD,YAAM;AAAE,sBAAcA,KAAKxI,QAAL,IAAiB,IAAjB,GAAwBwI,KAAKxI,QAA7B,GAAwC;AAAxD,OAF4E;AAGlFiN,YAAM/G,MAH4E;AAIlFgH,aAAO9G;AAJ2E,KAA7D,CAAtB;AAOA,UAAMiH,QAAQoB,cAAcrI,KAAd,EAAd;AAEA,UAAMhL,UAAUqT,cAActB,KAAd,GAAsBC,GAAtB,CAA2Be,CAAD,IAAOA,EAAEQ,CAAF,IAAOR,EAAEQ,CAAF,CAAI5M,GAA5C,CAAhB;AAEA,UAAMF,QAAQtF,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwBW,IAAxB,CAA6B;AAAExF,WAAK;AAAEwL,aAAKnS;AAAP;AAAP,KAA7B,EAAwD;AACrEqN,cAAQ;AAAE1G,aAAK,CAAP;AAAU/B,kBAAU,CAApB;AAAuBpD,cAAM,CAA7B;AAAgC8C,gBAAQ,CAAxC;AAA2CuH,mBAAW;AAAtD,OAD6D;AAErEuB,YAAM;AAAExI,kBAAWwI,KAAKxI,QAAL,IAAiB,IAAjB,GAAwBwI,KAAKxI,QAA7B,GAAwC;AAArD;AAF+D,KAAxD,EAGXmN,KAHW,EAAd;AAKA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC7B,eAASyG,KADuB;AAEhCuE,aAAOvE,MAAMxB,MAFmB;AAGhC6F,YAHgC;AAIhCmH;AAJgC,KAA1B,CAAP;AAMA;;AApCqE,CAAvE;AAuCA9Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,mBAA3B,EAAgD;AAAEgD,gBAAc;AAAhB,CAAhD,EAAwE;AACvEjE,QAAM;AACL,UAAM4N,aAAaT,sBAAsB;AACxCxD,cAAQ,KAAKC,aAAL,EADgC;AAExCwD,uBAAiB;AAFuB,KAAtB,CAAnB;AAIA,UAAM;AAAE/D,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,UAAF;AAAQC,YAAR;AAAgBS;AAAhB,QAA0B,KAAK2D,cAAL,EAAhC;AAEA,UAAMC,WAAWvO,OAAO0K,MAAP,CAAc,EAAd,EAAkBC,KAAlB,EAAyB;AAAE4C,WAAKrB,WAAW1I;AAAlB,KAAzB,CAAjB,CARK,CAUL;;AACA,QAAIxF,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,kBAA5C,KAAmE,CAAC1F,WAAWoK,MAAX,CAAkBoE,aAAlB,CAAgCC,wBAAhC,CAAyDP,WAAW1I,GAApE,EAAyE,KAAKE,MAA9E,EAAsF;AAAEwG,cAAQ;AAAE1G,aAAK;AAAP;AAAV,KAAtF,CAAxE,EAAuL;AACtL,aAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AACD,QAAI,CAACtB,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,aAA5C,CAAL,EAAiE;AAChE,aAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AAED,UAAMuQ,SAAS7R,WAAWoK,MAAX,CAAkBiF,QAAlB,CAA2BrE,IAA3B,CAAgCuF,QAAhC,EAA0C;AACxDtE,YAAMA,OAAOA,IAAP,GAAc;AAAEwD,YAAI,CAAC;AAAP,OADoC;AAExDiB,YAAM/G,MAFkD;AAGxDgH,aAAO9G,KAHiD;AAIxDqC;AAJwD,KAA1C,CAAf;AAOA,UAAM4E,QAAQe,OAAOhI,KAAP,EAAd;AACA,UAAMwI,WAAWR,OAAOjB,KAAP,EAAjB;AAEA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC2R,cADgC;AAEhCxI,aAAOwI,SAASvO,MAFgB;AAGhC6F,YAHgC;AAIhCmH;AAJgC,KAA1B,CAAP;AAMA;;AAnCsE,CAAxE,E,CAqCA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;AAEA9Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,iBAA3B,EAA8C;AAAEgD,gBAAc;AAAhB,CAA9C,EAAsE;AACrEjE,QAAM;AACL,UAAM;AAAEqM;AAAF,QAAY,KAAK2D,cAAL,EAAlB;AACA,UAAMC,WAAWvO,OAAO0K,MAAP,CAAc,EAAd,EAAkBC,KAAlB,EAAyB;AAAEqB,SAAG;AAAL,KAAzB,CAAjB;AAEA,UAAMH,OAAO7N,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBvI,OAAxB,CAAgCgL,QAAhC,CAAb;;AAEA,QAAI1C,QAAQ,IAAZ,EAAkB;AACjB,aAAO7N,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,yBAA1B,CAAP;AACA;;AAED,UAAMsR,SAAStS,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwBkI,mBAAxB,CAA4C;AAC1DrG,cAAQ;AAAEzI,kBAAU;AAAZ;AADkD,KAA5C,EAEZmN,KAFY,EAAf;AAIA,UAAM4B,eAAe,EAArB;AACAF,WAAOxQ,OAAP,CAAgB0B,IAAD,IAAU;AACxB,YAAM2L,eAAenP,WAAWoK,MAAX,CAAkBoE,aAAlB,CAAgCC,wBAAhC,CAAyDZ,KAAKrI,GAA9D,EAAmEhC,KAAKgC,GAAxE,EAA6E;AAAE0G,gBAAQ;AAAE1G,eAAK;AAAP;AAAV,OAA7E,CAArB;;AACA,UAAI2J,YAAJ,EAAkB;AACjBqD,qBAAa/R,IAAb,CAAkB;AACjB+E,eAAKhC,KAAKgC,GADO;AAEjB/B,oBAAUD,KAAKC;AAFE,SAAlB;AAIA;AACD,KARD;AAUA,WAAOzD,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC4R,cAAQE;AADwB,KAA1B,CAAP;AAGA;;AA7BoE,CAAtE;AAgCAxS,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,eAA3B,EAA4C;AAAEgD,gBAAc;AAAhB,CAA5C,EAAoE;AACnEC,SAAO;AACN,UAAM0J,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL,EAAV;AAAgCwD,uBAAiB;AAAjD,KAAtB,CAAnB;AAEA,UAAMa,MAAMvO,WAAWoK,MAAX,CAAkBoE,aAAlB,CAAgCC,wBAAhC,CAAyDP,WAAW1I,GAApE,EAAyE,KAAKE,MAA9E,CAAZ;;AAEA,QAAI,CAAC6I,GAAL,EAAU;AACT,aAAOvO,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA2B,0CAA0CkN,WAAW7N,IAAM,IAAtF,CAAP;AACA;;AAED,QAAIkO,IAAIG,IAAR,EAAc;AACb,aAAO1O,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA2B,gBAAgBkN,WAAW7N,IAAM,iCAA5D,CAAP;AACA;;AAED8E,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,UAAZ,EAAwB8I,WAAW1I,GAAnC;AACA,KAFD;AAIA,WAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAnBkE,CAApE;AAsBAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,0BAA3B,EAAuD;AAAEgD,gBAAc;AAAhB,CAAvD,EAA+E;AAC9EC,SAAO;AACN,UAAM0J,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL;AAAV,KAAtB,CAAnB;AAEA,UAAM1G,OAAO,KAAK8K,iBAAL,EAAb;AAEAnJ,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,qBAAZ,EAAmC8I,WAAW1I,GAA9C,EAAmDhC,KAAKgC,GAAxD;AACA,KAFD;AAIA,WAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAX6E,CAA/E;AAcAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,sBAA3B,EAAmD;AAAEgD,gBAAc;AAAhB,CAAnD,EAA2E;AAC1EC,SAAO;AACN,UAAM0J,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL;AAAV,KAAtB,CAAnB;AAEA,UAAM1G,OAAO,KAAK8K,iBAAL,EAAb;AAEAnJ,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,iBAAZ,EAA+B8I,WAAW1I,GAA1C,EAA+ChC,KAAKgC,GAApD;AACA,KAFD;AAIA,WAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAXyE,CAA3E;AAcAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,iBAA3B,EAA8C;AAAEgD,gBAAc;AAAhB,CAA9C,EAAsE;AACrEC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgBlD,IAAjB,IAAyB,CAAC,KAAKkD,UAAL,CAAgBlD,IAAhB,CAAqB8J,IAArB,EAA9B,EAA2D;AAC1D,aAAOnK,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,kCAA1B,CAAP;AACA;;AAED,UAAMkN,aAAaT,sBAAsB;AAAExD,cAAQ;AAAE0D,gBAAQ,KAAKpK,UAAL,CAAgBoK;AAA1B;AAAV,KAAtB,CAAnB;;AAEA,QAAIO,WAAW7N,IAAX,KAAoB,KAAKkD,UAAL,CAAgBlD,IAAxC,EAA8C;AAC7C,aAAOL,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,8DAA1B,CAAP;AACA;;AAEDmE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAW1I,GAA3C,EAAgD,UAAhD,EAA4D,KAAKjC,UAAL,CAAgBlD,IAA5E;AACA,KAFD;AAIA,WAAOL,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC2N,eAASrO,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC4D,WAAW1I,GAA/C,EAAoD;AAAE0G,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAApD;AADuB,KAA1B,CAAP;AAGA;;AAnBoE,CAAtE;AAsBAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,0BAA3B,EAAuD;AAAEgD,gBAAc;AAAhB,CAAvD,EAA+E;AAC9EC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgB3D,YAAjB,IAAiC,EAAE,OAAO,KAAK2D,UAAL,CAAgB3D,YAAvB,KAAwC,QAA1C,CAArC,EAA0F;AACzF,aAAOI,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,mEAA1B,CAAP;AACA;;AAED,UAAMkN,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL;AAAV,KAAtB,CAAnB;AAEA/E,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAW1I,GAA3C,EAAgD,kBAAhD,EAAoE,KAAKjC,UAAL,CAAgB3D,YAApF;AACA,KAFD;AAIA,WAAOI,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC2N,eAASrO,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC4D,WAAW1I,GAA/C,EAAoD;AAAE0G,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAApD;AADuB,KAA1B,CAAP;AAGA;;AAf6E,CAA/E;AAkBAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,qBAA3B,EAAkD;AAAEgD,gBAAc;AAAhB,CAAlD,EAA0E;AACzEC,SAAO;AACN,QAAI,OAAO,KAAKjB,UAAL,CAAgBtF,OAAvB,KAAmC,WAAvC,EAAoD;AACnD,aAAO+B,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,qCAA1B,EAAiE,mCAAjE,CAAP;AACA;;AAED,UAAMkN,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL;AAAV,KAAtB,CAAnB;;AAEA,QAAIgE,WAAWjQ,OAAX,KAAuB,KAAKsF,UAAL,CAAgBtF,OAA3C,EAAoD;AACnD,aAAO+B,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,yEAA1B,EAAqG,iDAArG,CAAP;AACA;;AAEDmE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAW1I,GAA3C,EAAgD,SAAhD,EAA2D,KAAKjC,UAAL,CAAgBtF,OAAhB,CAAwBwU,QAAxB,EAA3D;AACA,KAFD;AAIA,WAAOzS,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC2N,eAASrO,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC4D,WAAW1I,GAA/C,EAAoD;AAAE0G,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAApD;AADuB,KAA1B,CAAP;AAGA;;AAnBwE,CAA1E;AAsBAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,yBAA3B,EAAsD;AAAEgD,gBAAc;AAAhB,CAAtD,EAA8E;AAC7EC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgBmP,WAAjB,IAAgC,CAAC,KAAKnP,UAAL,CAAgBmP,WAAhB,CAA4BvI,IAA5B,EAArC,EAAyE;AACxE,aAAOnK,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,yCAA1B,CAAP;AACA;;AAED,UAAMkN,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL;AAAV,KAAtB,CAAnB;;AAEA,QAAIgE,WAAWwE,WAAX,KAA2B,KAAKnP,UAAL,CAAgBmP,WAA/C,EAA4D;AAC3D,aAAO1S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,qEAA1B,CAAP;AACA;;AAEDmE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAW1I,GAA3C,EAAgD,iBAAhD,EAAmE,KAAKjC,UAAL,CAAgBmP,WAAnF;AACA,KAFD;AAIA,WAAO1S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCgS,mBAAa,KAAKnP,UAAL,CAAgBmP;AADG,KAA1B,CAAP;AAGA;;AAnB4E,CAA9E;AAsBA1S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,sBAA3B,EAAmD;AAAEgD,gBAAc;AAAhB,CAAnD,EAA2E;AAC1EC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgB3E,QAAjB,IAA6B,CAAC,KAAK2E,UAAL,CAAgB3E,QAAhB,CAAyBuL,IAAzB,EAAlC,EAAmE;AAClE,aAAOnK,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,sCAA1B,CAAP;AACA;;AAED,UAAMkN,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL;AAAV,KAAtB,CAAnB;AAEA/E,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAW1I,GAA3C,EAAgD,UAAhD,EAA4D,KAAKjC,UAAL,CAAgB3E,QAA5E;AACA,KAFD;AAIA,WAAOoB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC2N,eAASrO,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC4D,WAAW1I,GAA/C,EAAoD;AAAE0G,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAApD;AADuB,KAA1B,CAAP;AAGA;;AAfyE,CAA3E;AAkBAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,qBAA3B,EAAkD;AAAEgD,gBAAc;AAAhB,CAAlD,EAA0E;AACzEC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgBoP,OAAjB,IAA4B,CAAC,KAAKpP,UAAL,CAAgBoP,OAAhB,CAAwBxI,IAAxB,EAAjC,EAAiE;AAChE,aAAOnK,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,qCAA1B,CAAP;AACA;;AAED,UAAMkN,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL;AAAV,KAAtB,CAAnB;;AAEA,QAAIgE,WAAWwE,WAAX,KAA2B,KAAKnP,UAAL,CAAgBoP,OAA/C,EAAwD;AACvD,aAAO3S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,+EAA1B,CAAP;AACA;;AAEDmE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAW1I,GAA3C,EAAgD,iBAAhD,EAAmE,KAAKjC,UAAL,CAAgBoP,OAAnF;AACA,KAFD;AAIA,WAAO3S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCiS,eAAS,KAAKpP,UAAL,CAAgBoP;AADO,KAA1B,CAAP;AAGA;;AAnBwE,CAA1E;AAsBA3S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,sBAA3B,EAAmD;AAAEgD,gBAAc;AAAhB,CAAnD,EAA2E;AAC1EC,SAAO;AACN,QAAI,OAAO,KAAKjB,UAAL,CAAgBsM,QAAvB,KAAoC,WAAxC,EAAqD;AACpD,aAAO7P,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,sCAA1B,CAAP;AACA;;AAED,UAAMkN,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL;AAAV,KAAtB,CAAnB;;AAEA,QAAIgE,WAAW0E,EAAX,KAAkB,KAAKrP,UAAL,CAAgBsM,QAAtC,EAAgD;AAC/C,aAAO7P,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,2EAA1B,CAAP;AACA;;AAEDmE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAW1I,GAA3C,EAAgD,UAAhD,EAA4D,KAAKjC,UAAL,CAAgBsM,QAA5E;AACA,KAFD;AAIA,WAAO7P,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC2N,eAASrO,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC4D,WAAW1I,GAA/C,EAAoD;AAAE0G,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAApD;AADuB,KAA1B,CAAP;AAGA;;AAnByE,CAA3E;AAsBAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,mBAA3B,EAAgD;AAAEgD,gBAAc;AAAhB,CAAhD,EAAwE;AACvEC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgBsP,KAAjB,IAA0B,CAAC,KAAKtP,UAAL,CAAgBsP,KAAhB,CAAsB1I,IAAtB,EAA/B,EAA6D;AAC5D,aAAOnK,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,mCAA1B,CAAP;AACA;;AAED,UAAMkN,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL;AAAV,KAAtB,CAAnB;;AAEA,QAAIgE,WAAW2E,KAAX,KAAqB,KAAKtP,UAAL,CAAgBsP,KAAzC,EAAgD;AAC/C,aAAO7S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,+DAA1B,CAAP;AACA;;AAEDmE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAW1I,GAA3C,EAAgD,WAAhD,EAA6D,KAAKjC,UAAL,CAAgBsP,KAA7E;AACA,KAFD;AAIA,WAAO7S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCmS,aAAO,KAAKtP,UAAL,CAAgBsP;AADS,KAA1B,CAAP;AAGA;;AAnBsE,CAAxE;AAsBA7S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,0BAA3B,EAAuD;AAAEgD,gBAAc;AAAhB,CAAvD,EAA+E;AAC9EC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgBuP,YAAjB,IAAiC,CAAC,KAAKvP,UAAL,CAAgBuP,YAAhB,CAA6B3I,IAA7B,EAAtC,EAA2E;AAC1E,aAAOnK,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,0CAA1B,CAAP;AACA;;AAED,UAAMkN,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL;AAAV,KAAtB,CAAnB;AAEA/E,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAW1I,GAA3C,EAAgD,kBAAhD,EAAoE,KAAKjC,UAAL,CAAgBuP,YAApF;AACA,KAFD;AAIA,WAAO9S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCoS,oBAAc,KAAKvP,UAAL,CAAgBuP;AADE,KAA1B,CAAP;AAGA;;AAf6E,CAA/E;AAkBA9S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,kBAA3B,EAA+C;AAAEgD,gBAAc;AAAhB,CAA/C,EAAuE;AACtEC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgB2F,IAAjB,IAAyB,CAAC,KAAK3F,UAAL,CAAgB2F,IAAhB,CAAqBiB,IAArB,EAA9B,EAA2D;AAC1D,aAAOnK,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,kCAA1B,CAAP;AACA;;AAED,UAAMkN,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL;AAAV,KAAtB,CAAnB;;AAEA,QAAIgE,WAAWF,CAAX,KAAiB,KAAKzK,UAAL,CAAgB2F,IAArC,EAA2C;AAC1C,aAAOlJ,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,8DAA1B,CAAP;AACA;;AAEDmE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAW1I,GAA3C,EAAgD,UAAhD,EAA4D,KAAKjC,UAAL,CAAgB2F,IAA5E;AACA,KAFD;AAIA,WAAOlJ,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC2N,eAASrO,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC4D,WAAW1I,GAA/C,EAAoD;AAAE0G,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAApD;AADuB,KAA1B,CAAP;AAGA;;AAnBqE,CAAvE;AAsBAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,oBAA3B,EAAiD;AAAEgD,gBAAc;AAAhB,CAAjD,EAAyE;AACxEC,SAAO;AACN,UAAM0J,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL,EAAV;AAAgCwD,uBAAiB;AAAjD,KAAtB,CAAnB;;AAEA,QAAI,CAACQ,WAAWD,QAAhB,EAA0B;AACzB,aAAOjO,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA2B,gBAAgBkN,WAAW7N,IAAM,mBAA5D,CAAP;AACA;;AAED8E,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,eAAZ,EAA6B8I,WAAW1I,GAAxC;AACA,KAFD;AAIA,WAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAbuE,CAAzE;AAgBAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,sCAA3B,EAAmE;AAAEgD,gBAAc;AAAhB,CAAnE,EAA2F;AAC1FjE,QAAM;AACL,UAAM;AAAEqN;AAAF,QAAa,KAAKzD,aAAL,EAAnB;AACA,UAAM;AAAEP,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE;AAAF,QAAW,KAAKqE,cAAL,EAAjB;;AAEA,QAAI,CAAC3C,MAAL,EAAa;AACZ,aAAO3N,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,wCAA1B,CAAP;AACA;;AAED,UAAM+R,WAAW5N,OAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,0BAAZ,EAAwC;AAC5FuI,YAD4F;AAE5FlM,eAAS;AACRwK,cAAMA,OAAOA,IAAP,GAAc;AAAEwD,cAAI;AAAN,SADZ;AAERiB,cAAM/G,MAFE;AAGRgH,eAAO9G;AAHC;AAFmF,KAAxC,CAApC,CAAjB;AASA,UAAMmJ,cAAc7N,OAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,0BAAZ,EAAwC;AAC/FuI,YAD+F;AAE/FlM,eAAS;AAFsF,KAAxC,CAApC,CAApB;AAKA,WAAOzB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCqS,cADgC;AAEhClJ,aAAOkJ,SAASjP,MAFgB;AAGhC6F,YAHgC;AAIhCmH,aAAOkC,YAAYlP;AAJa,KAA1B,CAAP;AAMA;;AA9ByF,CAA3F;AAiCA9D,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,gBAA3B,EAA6C;AAAEgD,gBAAc;AAAhB,CAA7C,EAAqE;AACpEjE,QAAM;AACL,UAAM4N,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL;AAAV,KAAtB,CAAnB;AAEA,UAAMzK,QAAQ0F,OAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,cAAZ,EAA4B8I,WAAW1I,GAAvC,CAApC,CAAd;AAEA,WAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCjB;AADgC,KAA1B,CAAP;AAGA;;AATmE,CAArE;AAYAO,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,qBAA3B,EAAkD;AAAEgD,gBAAc;AAAhB,CAAlD,EAA0E;AACzEjE,QAAM;AACL,UAAM4N,aAAaT,sBAAsB;AAAExD,cAAQ,KAAKC,aAAL;AAAV,KAAtB,CAAnB;AAEA,UAAM+I,aAAajT,WAAWoK,MAAX,CAAkBoE,aAAlB,CAAgC0E,oBAAhC,CAAqDhF,WAAW1I,GAAhE,EAAqE,CAAC,WAAD,CAArE,EAAoF;AAAE0G,cAAQ;AAAEkG,WAAG;AAAL;AAAV,KAApF,EAA0GxB,KAA1G,GAAkHC,GAAlH,CAAuHtC,GAAD,IAASA,IAAI6D,CAAnI,CAAnB;AAEA,WAAOpS,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCuS;AADgC,KAA1B,CAAP;AAGA;;AATwE,CAA1E,E;;;;;;;;;;;AC77BAjT,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,YAA3B,EAAyC;AAAEgD,gBAAc;AAAhB,CAAzC,EAAiE;AAChEjE,QAAM;AACL,UAAMb,QAAQO,WAAWoK,MAAX,CAAkB+I,KAAlB,CAAwBnI,IAAxB,CAA6B,EAA7B,EAAiC;AAAEkB,cAAQ;AAAEvM,oBAAY;AAAd;AAAV,KAAjC,EAAgEiR,KAAhE,EAAd;AAEA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAAEjB;AAAF,KAA1B,CAAP;AACA;;AAL+D,CAAjE;AAQAO,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,cAA3B,EAA2C;AAAEgD,gBAAc;AAAhB,CAA3C,EAAmE;AAClEC,SAAO;AACN4O,UAAM,KAAK7P,UAAX,EAAuB;AACtBlD,YAAMgT,MADgB;AAEtBC,aAAOC,MAAMC,KAAN,CAAYH,MAAZ,CAFe;AAGtBX,mBAAaa,MAAMC,KAAN,CAAYH,MAAZ;AAHS,KAAvB;AAMA,UAAMI,WAAW;AAChBpT,YAAM,KAAKkD,UAAL,CAAgBlD,IADN;AAEhBiT,aAAO,KAAK/P,UAAL,CAAgB+P,KAFP;AAGhBZ,mBAAa,KAAKnP,UAAL,CAAgBmP;AAHb,KAAjB;AAMAvN,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,wBAAZ,EAAsCqO,QAAtC;AACA,KAFD;AAIA,WAAOzT,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCgT,YAAM1T,WAAWoK,MAAX,CAAkB+I,KAAlB,CAAwBQ,iBAAxB,CAA0CF,SAASpT,IAAnD,EAAyD;AAAE6L,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAAzD;AAD0B,KAA1B,CAAP;AAGA;;AArBiE,CAAnE;AAwBAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,qBAA3B,EAAkD;AAAEgD,gBAAc;AAAhB,CAAlD,EAA0E;AACzEC,SAAO;AACN4O,UAAM,KAAK7P,UAAX,EAAuB;AACtBqQ,gBAAUP,MADY;AAEtB5P,gBAAU4P,MAFY;AAGtB1F,cAAQ4F,MAAMC,KAAN,CAAYH,MAAZ;AAHc,KAAvB;AAMA,UAAM7P,OAAO,KAAK8K,iBAAL,EAAb;AAEAnJ,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,6BAAZ,EAA2C,KAAK7B,UAAL,CAAgBqQ,QAA3D,EAAqEpQ,KAAKC,QAA1E,EAAoF,KAAKF,UAAL,CAAgBoK,MAApG;AACA,KAFD;AAIA,WAAO3N,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCgT,YAAM1T,WAAWoK,MAAX,CAAkB+I,KAAlB,CAAwBQ,iBAAxB,CAA0C,KAAKpQ,UAAL,CAAgBqQ,QAA1D,EAAoE;AAAE1H,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAApE;AAD0B,KAA1B,CAAP;AAGA;;AAjBwE,CAA1E,E;;;;;;;;;;;;;;;AChCA,IAAIkV,MAAJ;AAAW/V,OAAOC,KAAP,CAAaC,QAAQ,QAAR,CAAb,EAA+B;AAACC,UAAQC,CAAR,EAAU;AAAC2V,aAAO3V,CAAP;AAAS;;AAArB,CAA/B,EAAsD,CAAtD;;AAEX,SAAS4V,kBAAT,CAA4B;AAAE7J,QAAF;AAAUyD,oBAAkB;AAA5B,CAA5B,EAAgE;AAC/D,MAAI,CAAC,CAACzD,OAAO0D,MAAR,IAAkB,CAAC1D,OAAO0D,MAAP,CAAcxD,IAAd,EAApB,MAA8C,CAACF,OAAO2D,QAAR,IAAoB,CAAC3D,OAAO2D,QAAP,CAAgBzD,IAAhB,EAAnE,CAAJ,EAAgG;AAC/F,UAAM,IAAIhF,OAAOqF,KAAX,CAAiB,iCAAjB,EAAoD,kDAApD,CAAN;AACA;;AAED,QAAM0B,yCAAclM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE,sBAAhC,CAAN;AAEA,MAAIkP,IAAJ;;AACA,MAAI5D,OAAO0D,MAAX,EAAmB;AAClBE,WAAO7N,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoCL,OAAO0D,MAA3C,EAAmD;AAAEzB;AAAF,KAAnD,CAAP;AACA,GAFD,MAEO,IAAIjC,OAAO2D,QAAX,EAAqB;AAC3BC,WAAO7N,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBC,aAAxB,CAAsC9D,OAAO2D,QAA7C,EAAuD;AAAE1B;AAAF,KAAvD,CAAP;AACA;;AACD,MAAI,CAAC2B,IAAL,EAAW;AACV,UAAM,IAAI1I,OAAOqF,KAAX,CAAiB,sBAAjB,EAAyC,+EAAzC,CAAN;AACA;;AACD,MAAIkD,mBAAmBG,KAAKI,QAA5B,EAAsC;AACrC,UAAM,IAAI9I,OAAOqF,KAAX,CAAiB,qBAAjB,EAAyC,gBAAgBqD,KAAKxN,IAAM,eAApE,CAAN;AACA;;AAED,SAAOwN,IAAP;AACA;;AAED7N,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,WAA3B,EAAwC;AAAEgD,gBAAc;AAAhB,CAAxC,EAAgE;AAC/DjE,QAAM;AACL,UAAM;AAAEyT;AAAF,QAAmB,KAAKxK,WAA9B;AAEA,QAAIyK,gBAAJ;;AACA,QAAID,YAAJ,EAAkB;AACjB,UAAIE,MAAM5C,KAAKzJ,KAAL,CAAWmM,YAAX,CAAN,CAAJ,EAAqC;AACpC,cAAM,IAAI5O,OAAOqF,KAAX,CAAiB,kCAAjB,EAAqD,0DAArD,CAAN;AACA,OAFD,MAEO;AACNwJ,2BAAmB,IAAI3C,IAAJ,CAAS0C,YAAT,CAAnB;AACA;AACD;;AAED,QAAIpT,MAAJ;AACAwE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM/E,SAASwE,OAAOC,IAAP,CAAY,WAAZ,EAAyB4O,gBAAzB,CAA7C;;AAEA,QAAIjJ,MAAMpJ,OAAN,CAAchB,MAAd,CAAJ,EAA2B;AAC1BA,eAAS;AACRgF,gBAAQhF,MADA;AAERuT,gBAAQ;AAFA,OAAT;AAIA;;AAED,WAAOlU,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0BC,MAA1B,CAAP;AACA;;AAxB8D,CAAhE;AA2BAX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,mBAA3B,EAAgD;AAAEgD,gBAAc;AAAhB,CAAhD,EAAwE;AACvEC,SAAO;AACN,UAAMqJ,OAAO1I,OAAOC,IAAP,CAAY,eAAZ,EAA6B,KAAK+O,SAAL,CAAe5E,GAA5C,EAAiD,KAAK7J,MAAtD,CAAb;;AAEA,QAAI,CAACmI,IAAL,EAAW;AACV,aAAO7N,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AAED,UAAM8S,SAAS,IAAIP,MAAJ,CAAW;AAAElR,eAAS,KAAKD,OAAL,CAAaC;AAAxB,KAAX,CAAf;AACA,UAAM6N,QAAQ,EAAd;AACA,UAAMtE,SAAS,EAAf;AAEA/G,WAAOkP,SAAP,CAAkBC,QAAD,IAAc;AAC9BF,aAAOG,EAAP,CAAU,MAAV,EAAkB,CAACC,SAAD,EAAYrE,IAAZ,EAAkBsE,QAAlB,EAA4BC,QAA5B,EAAsCC,QAAtC,KAAmD;AACpE,YAAIH,cAAc,MAAlB,EAA0B;AACzB,iBAAOhE,MAAM/P,IAAN,CAAW,IAAI0E,OAAOqF,KAAX,CAAiB,eAAjB,CAAX,CAAP;AACA;;AAED,cAAMoK,WAAW,EAAjB;AACAzE,aAAKoE,EAAL,CAAQ,MAAR,EAAiBtO,IAAD,IAAU2O,SAASnU,IAAT,CAAcwF,IAAd,CAA1B;AAEAkK,aAAKoE,EAAL,CAAQ,KAAR,EAAe,MAAM;AACpB/D,gBAAM/P,IAAN,CAAW;AAAE+T,qBAAF;AAAarE,gBAAb;AAAmBsE,oBAAnB;AAA6BC,oBAA7B;AAAuCC,oBAAvC;AAAiDE,wBAAYC,OAAOvI,MAAP,CAAcqI,QAAd;AAA7D,WAAX;AACA,SAFD;AAGA,OAXD;AAaAR,aAAOG,EAAP,CAAU,OAAV,EAAmB,CAACC,SAAD,EAAY1L,KAAZ,KAAsBoD,OAAOsI,SAAP,IAAoB1L,KAA7D;AAEAsL,aAAOG,EAAP,CAAU,QAAV,EAAoBpP,OAAO4P,eAAP,CAAuB,MAAMT,UAA7B,CAApB;AAEA,WAAK5R,OAAL,CAAasS,IAAb,CAAkBZ,MAAlB;AACA,KAnBD;;AAqBA,QAAI5D,MAAM1M,MAAN,KAAiB,CAArB,EAAwB;AACvB,aAAO9D,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,eAA1B,CAAP;AACA;;AAED,QAAIwP,MAAM1M,MAAN,GAAe,CAAnB,EAAsB;AACrB,aAAO9D,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,wBAA1B,CAAP;AACA;;AAED,UAAMmP,OAAOK,MAAM,CAAN,CAAb;AAEA,UAAMyE,YAAYC,WAAWC,QAAX,CAAoB,SAApB,CAAlB;AAEA,UAAMC,UAAU;AACf/U,YAAM8P,KAAKsE,QADI;AAEfvU,YAAMiQ,KAAK0E,UAAL,CAAgB/Q,MAFP;AAGfoF,YAAMiH,KAAKwE,QAHI;AAIfpF,WAAK,KAAK4E,SAAL,CAAe5E,GAJL;AAKf7J,cAAQ,KAAKA;AALE,KAAhB;AAQAP,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnC,YAAM2P,eAAelQ,OAAOkP,SAAP,CAAiBY,UAAUK,MAAV,CAAiBC,IAAjB,CAAsBN,SAAtB,CAAjB,EAAmDG,OAAnD,EAA4DjF,KAAK0E,UAAjE,CAArB;AAEAQ,mBAAa3C,WAAb,GAA2BxG,OAAOwG,WAAlC;AAEA,aAAOxG,OAAOwG,WAAd;AAEA1S,iBAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0ByE,OAAOC,IAAP,CAAY,iBAAZ,EAA+B,KAAK+O,SAAL,CAAe5E,GAA9C,EAAmD,IAAnD,EAAyD8F,YAAzD,EAAuEnJ,MAAvE,CAA1B;AACA,KARD;AAUA,WAAOlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAhEsE,CAAxE;AAmEAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,wBAA3B,EAAqD;AAAEgD,gBAAc;AAAhB,CAArD,EAA6E;AAC5EC,SAAO;AACN,UAAMgR,oBAAoB,CAACC,aAAD,EAAgB9H,MAAhB,KAA2B;AACpD3L,aAAOC,IAAP,CAAYwT,aAAZ,EAA2B3T,OAA3B,CAAoC4T,eAAD,IAClCvQ,OAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAC7BP,OAAOC,IAAP,CAAY,0BAAZ,EAAwCuI,MAAxC,EAAgD+H,eAAhD,EAAiED,cAAcC,eAAd,CAAjE,CADD,CADD;AAKA,KAND;;AAOA,UAAM;AAAE/H,YAAF;AAAU8H;AAAV,QAA4B,KAAKlS,UAAvC;;AAEA,QAAI,CAACoK,MAAL,EAAa;AACZ,aAAO3N,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,kCAA1B,CAAP;AACA;;AAED,QAAI,CAACyU,aAAD,IAAkBzT,OAAOC,IAAP,CAAYwT,aAAZ,EAA2B3R,MAA3B,KAAsC,CAA5D,EAA+D;AAC9D,aAAO9D,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,yCAA1B,CAAP;AACA;;AAEDwU,sBAAkBC,aAAlB,EAAiC9H,MAAjC;AAEA,WAAO3N,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAtB2E,CAA7E;AAyBAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,gBAA3B,EAA6C;AAAEgD,gBAAc;AAAhB,CAA7C,EAAqE;AACpEC,SAAO;AACN,UAAM;AAAEmR;AAAF,QAAe,KAAKpS,UAA1B;;AAEA,QAAI,CAAC,KAAKA,UAAL,CAAgBqS,cAAhB,CAA+B,UAA/B,CAAL,EAAiD;AAChD,aAAO5V,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,oCAA1B,CAAP;AACA;;AAED,UAAM6M,OAAOiG,mBAAmB;AAAE7J,cAAQ,KAAK1G;AAAf,KAAnB,CAAb;AAEA4B,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,gBAAZ,EAA8ByI,KAAKrI,GAAnC,EAAwCmQ,QAAxC,CAApC;AAEA,WAAO3V,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAbmE,CAArE;AAgBAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,oBAA3B,EAAiD;AAAEgD,gBAAc;AAAhB,CAAjD,EAAyE;AACxEC,SAAO;AACN,UAAM0J,aAAa4F,mBAAmB;AAAE7J,cAAQ,KAAK1G;AAAf,KAAnB,CAAnB;;AAEA,QAAI,CAAC,KAAKA,UAAL,CAAgB0L,MAArB,EAA6B;AAC5B,aAAOjP,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,sCAA1B,CAAP;AACA;;AAED,QAAI,CAAC,KAAKuC,UAAL,CAAgBgO,MAArB,EAA6B;AAC5B,aAAOvR,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,sCAA1B,CAAP;AACA;;AAED,UAAMiO,SAAS,IAAIoC,IAAJ,CAAS,KAAK9N,UAAL,CAAgB0L,MAAzB,CAAf;AACA,UAAMsC,SAAS,IAAIF,IAAJ,CAAS,KAAK9N,UAAL,CAAgBgO,MAAzB,CAAf;AAEA,UAAMC,YAAY,KAAKjO,UAAL,CAAgBiO,SAAhB,IAA6B,KAA/C;AAEArM,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,kBAAZ,EAAgC;AACnEuI,cAAQO,WAAW1I,GADgD;AAEnEyJ,YAFmE;AAGnEsC,YAHmE;AAInEC,eAJmE;AAKnEb,aAAO,KAAKpN,UAAL,CAAgBoN,KAL4C;AAMnEkF,qBAAe,KAAKtS,UAAL,CAAgBsS,aANoC;AAOnEC,iBAAW,KAAKvS,UAAL,CAAgBuS,SAPwC;AAQnEC,iBAAW,KAAKxS,UAAL,CAAgB+B;AARwC,KAAhC,CAApC;AAWA,WAAOtF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AA7BuE,CAAzE,E;;;;;;;;;;;AChKAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,mBAA3B,EAAgD;AAAEgD,gBAAc;AAAhB,CAAhD,EAAwE;AACvEjE,QAAM;AACL,UAAM;AAAEyT;AAAF,QAAmB,KAAKxK,WAA9B;AAEA,QAAIyK,gBAAJ;;AACA,QAAID,YAAJ,EAAkB;AACjB,UAAIE,MAAM5C,KAAKzJ,KAAL,CAAWmM,YAAX,CAAN,CAAJ,EAAqC;AACpC,cAAM,IAAI5O,OAAOqF,KAAX,CAAiB,4BAAjB,EAA+C,wDAA/C,CAAN;AACA,OAFD,MAEO;AACNwJ,2BAAmB,IAAI3C,IAAJ,CAAS0C,YAAT,CAAnB;AACA;AACD;;AAED,QAAIpT,MAAJ;AACAwE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM/E,SAASwE,OAAOC,IAAP,CAAY,mBAAZ,EAAiC4O,gBAAjC,CAA7C;;AAEA,QAAIjJ,MAAMpJ,OAAN,CAAchB,MAAd,CAAJ,EAA2B;AAC1BA,eAAS;AACRgF,gBAAQhF,MADA;AAERuT,gBAAQ;AAFA,OAAT;AAIA;;AAED,WAAOlU,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0BC,MAA1B,CAAP;AACA;;AAxBsE,CAAxE;AA2BAX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,sBAA3B,EAAmD;AAAEgD,gBAAc;AAAhB,CAAnD,EAA2E;AAC1EjE,QAAM;AACL,UAAM;AAAEqN;AAAF,QAAa,KAAKzD,aAAL,EAAnB;;AAEA,QAAI,CAACyD,MAAL,EAAa;AACZ,aAAO3N,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,kCAA1B,CAAP;AACA;;AAED,UAAMmO,eAAenP,WAAWoK,MAAX,CAAkBoE,aAAlB,CAAgCC,wBAAhC,CAAyDd,MAAzD,EAAiE,KAAKjI,MAAtE,CAArB;AAEA,WAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCyO;AADgC,KAA1B,CAAP;AAGA;;AAbyE,CAA3E;AAgBA;;;;;;;;;AAQAnP,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,oBAA3B,EAAiD;AAAEgD,gBAAc;AAAhB,CAAjD,EAAyE;AACxEC,SAAO;AACN4O,UAAM,KAAK7P,UAAX,EAAuB;AACtBgM,WAAK8D;AADiB,KAAvB;AAIAlO,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAC7BP,OAAOC,IAAP,CAAY,cAAZ,EAA4B,KAAK7B,UAAL,CAAgBgM,GAA5C,CADD;AAIA,WAAOvP,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAXuE,CAAzE;AAcAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,sBAA3B,EAAmD;AAAEgD,gBAAc;AAAhB,CAAnD,EAA2E;AAC1EC,SAAO;AACN,UAAM;AAAEmJ,YAAF;AAAUqI;AAAV,QAAiC,KAAKzS,UAA5C;;AACA,QAAI,CAACoK,MAAD,IAAYqI,sBAAsB,CAACA,mBAAmBxQ,GAA1D,EAAgE;AAC/D,aAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,yEAA1B,CAAP;AACA;;AAEDmE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAC7BP,OAAOC,IAAP,CAAY,gBAAZ,EAA8B4Q,kBAA9B,EAAkDrI,MAAlD,CADD;AAIA,WAAO3N,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAZyE,CAA3E,E;;;;;;;;;;;ACjEA;AAEAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,aAA3B,EAA0C;AAAEgD,gBAAc;AAAhB,CAA1C,EAAkE;AACjEC,SAAO;AACN4O,UAAM,KAAK7P,UAAX,EAAuBgQ,MAAM0C,eAAN,CAAsB;AAC5CC,aAAO7C,MADqC;AAE5C1F,cAAQ0F,MAFoC;AAG5C8C,cAAQ5C,MAAMC,KAAN,CAAY4C,OAAZ;AAHoC,KAAtB,CAAvB;AAMA,UAAM/U,MAAMrB,WAAWoK,MAAX,CAAkBiF,QAAlB,CAA2B/E,WAA3B,CAAuC,KAAK/G,UAAL,CAAgB2S,KAAvD,EAA8D;AAAEhK,cAAQ;AAAEkG,WAAG,CAAL;AAAQ7C,aAAK;AAAb;AAAV,KAA9D,CAAZ;;AAEA,QAAI,CAAClO,GAAL,EAAU;AACT,aAAOrB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA2B,oCAAoC,KAAKuC,UAAL,CAAgB2S,KAAO,IAAtF,CAAP;AACA;;AAED,QAAI,KAAK3S,UAAL,CAAgBoK,MAAhB,KAA2BtM,IAAIkO,GAAnC,EAAwC;AACvC,aAAOvP,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,gEAA1B,CAAP;AACA;;AAED,QAAI,KAAKuC,UAAL,CAAgB4S,MAAhB,IAA0B9U,IAAI+Q,CAAJ,CAAM5M,GAAN,KAAc,KAAKE,MAA7C,IAAuD,CAAC1F,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+BnH,OAAOO,MAAP,EAA/B,EAAgD,sBAAhD,EAAwErE,IAAIkO,GAA5E,CAA5D,EAA8I;AAC7I,aAAOvP,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,uGAA1B,CAAP;AACA;;AAEDmE,WAAOgJ,SAAP,CAAiB,KAAK5K,UAAL,CAAgB4S,MAAhB,GAAyB9U,IAAI+Q,CAAJ,CAAM5M,GAA/B,GAAqC,KAAKE,MAA3D,EAAmE,MAAM;AACxEP,aAAOC,IAAP,CAAY,eAAZ,EAA6B;AAAEI,aAAKnE,IAAImE;AAAX,OAA7B;AACA,KAFD;AAIA,WAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC8E,WAAKnE,IAAImE,GADuB;AAEhCiK,UAAI4B,KAAKgF,GAAL,EAF4B;AAGhCnT,eAAS7B;AAHuB,KAA1B,CAAP;AAKA;;AA/BgE,CAAlE;AAkCArB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,mBAA3B,EAAgD;AAAEgD,gBAAc;AAAhB,CAAhD,EAAwE;AACvEjE,QAAM;AACL,UAAM;AAAEqN,YAAF;AAAU2I;AAAV,QAAyB,KAAK/M,WAApC;;AAEA,QAAI,CAACoE,MAAL,EAAa;AACZ,YAAM,IAAIxI,OAAOqF,KAAX,CAAiB,iCAAjB,EAAoD,+CAApD,CAAN;AACA;;AAED,QAAI,CAAC8L,UAAL,EAAiB;AAChB,YAAM,IAAInR,OAAOqF,KAAX,CAAiB,qCAAjB,EAAwD,mDAAxD,CAAN;AACA,KAFD,MAEO,IAAIyJ,MAAM5C,KAAKzJ,KAAL,CAAW0O,UAAX,CAAN,CAAJ,EAAmC;AACzC,YAAM,IAAInR,OAAOqF,KAAX,CAAiB,4BAAjB,EAA+C,wDAA/C,CAAN;AACA;;AAED,QAAI7J,MAAJ;AACAwE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnC/E,eAASwE,OAAOC,IAAP,CAAY,cAAZ,EAA4BuI,MAA5B,EAAoC;AAAE2I,oBAAY,IAAIjF,IAAJ,CAASiF,UAAT;AAAd,OAApC,CAAT;AACA,KAFD;;AAIA,QAAI,CAAC3V,MAAL,EAAa;AACZ,aAAOX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,EAAP;AACA;;AAED,WAAOhB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCC;AADgC,KAA1B,CAAP;AAGA;;AA1BsE,CAAxE;AA6BAX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,iBAA3B,EAA8C;AAAEgD,gBAAc;AAAhB,CAA9C,EAAsE;AACrEjE,QAAM;AACL,QAAI,CAAC,KAAKiJ,WAAL,CAAiB2M,KAAtB,EAA6B;AAC5B,aAAOlW,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,+CAA1B,CAAP;AACA;;AAED,QAAIK,GAAJ;AACA8D,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCrE,YAAM8D,OAAOC,IAAP,CAAY,kBAAZ,EAAgC,KAAKmE,WAAL,CAAiB2M,KAAjD,CAAN;AACA,KAFD;;AAIA,QAAI,CAAC7U,GAAL,EAAU;AACT,aAAOrB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,EAAP;AACA;;AAED,WAAOhB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCwC,eAAS7B;AADuB,KAA1B,CAAP;AAGA;;AAlBoE,CAAtE;AAqBArB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,iBAA3B,EAA8C;AAAEgD,gBAAc;AAAhB,CAA9C,EAAsE;AACrEC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgBgT,SAAjB,IAA8B,CAAC,KAAKhT,UAAL,CAAgBgT,SAAhB,CAA0BpM,IAA1B,EAAnC,EAAqE;AACpE,YAAM,IAAIhF,OAAOqF,KAAX,CAAiB,oCAAjB,EAAuD,4CAAvD,CAAN;AACA;;AAED,UAAMnJ,MAAMrB,WAAWoK,MAAX,CAAkBiF,QAAlB,CAA2B/E,WAA3B,CAAuC,KAAK/G,UAAL,CAAgBgT,SAAvD,CAAZ;;AAEA,QAAI,CAAClV,GAAL,EAAU;AACT,YAAM,IAAI8D,OAAOqF,KAAX,CAAiB,yBAAjB,EAA4C,+DAA5C,CAAN;AACA;;AAED,QAAIgM,aAAJ;AACArR,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM8Q,gBAAgBrR,OAAOC,IAAP,CAAY,YAAZ,EAA0B/D,GAA1B,CAApD;AAEA,WAAOrB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCwC,eAASsT;AADuB,KAA1B,CAAP;AAGA;;AAlBoE,CAAtE;AAqBAxW,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,kBAA3B,EAA+C;AAAEgD,gBAAc;AAAhB,CAA/C,EAAuE;AACtEC,SAAO;AACN,UAAMiS,gBAAgBC,sBAAsB,KAAKnT,UAA3B,EAAuC,KAAKC,IAA5C,EAAkDiE,SAAlD,EAA6D,IAA7D,EAAmE,CAAnE,CAAtB;;AAEA,QAAI,CAACgP,aAAL,EAAoB;AACnB,aAAOzW,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,eAA1B,CAAP;AACA;;AAED,WAAOhB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC+O,UAAI4B,KAAKgF,GAAL,EAD4B;AAEhChI,eAASoI,cAAcpI,OAFS;AAGhCnL,eAASuT,cAAcvT;AAHS,KAA1B,CAAP;AAKA;;AAbqE,CAAvE;AAgBAlD,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,aAA3B,EAA0C;AAAEgD,gBAAc;AAAhB,CAA1C,EAAkE;AACjEjE,QAAM;AACL,UAAM;AAAEqN,YAAF;AAAUgJ;AAAV,QAAyB,KAAKpN,WAApC;AACA,UAAM;AAAEM;AAAF,QAAY,KAAKwG,kBAAL,EAAlB;;AAEA,QAAI,CAAC1C,MAAL,EAAa;AACZ,YAAM,IAAIxI,OAAOqF,KAAX,CAAiB,iCAAjB,EAAoD,+CAApD,CAAN;AACA;;AAED,QAAI,CAACmM,UAAL,EAAiB;AAChB,YAAM,IAAIxR,OAAOqF,KAAX,CAAiB,qCAAjB,EAAwD,mDAAxD,CAAN;AACA;;AAED,QAAI7J,MAAJ;AACAwE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM/E,SAASwE,OAAOC,IAAP,CAAY,eAAZ,EAA6BuR,UAA7B,EAAyChJ,MAAzC,EAAiD9D,KAAjD,EAAwD3G,OAAxD,CAAgE0T,IAA7G;AAEA,WAAO5W,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC2R,gBAAU1R;AADsB,KAA1B,CAAP;AAGA;;AAnBgE,CAAlE,E,CAsBA;AACA;AACA;;AACAX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,kBAA3B,EAA+C;AAAEgD,gBAAc;AAAhB,CAA/C,EAAuE;AACtEC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgBL,OAArB,EAA8B;AAC7B,YAAM,IAAIiC,OAAOqF,KAAX,CAAiB,sBAAjB,EAAyC,2CAAzC,CAAN;AACA;;AAED,QAAItH,OAAJ;AACAiC,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMxC,UAAUiC,OAAOC,IAAP,CAAY,aAAZ,EAA2B,KAAK7B,UAAL,CAAgBL,OAA3C,CAA9C;AAEA,WAAOlD,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCwC;AADgC,KAA1B,CAAP;AAGA;;AAZqE,CAAvE;AAeAlD,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,kBAA3B,EAA+C;AAAEgD,gBAAc;AAAhB,CAA/C,EAAuE;AACtEC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgBgT,SAAjB,IAA8B,CAAC,KAAKhT,UAAL,CAAgBgT,SAAhB,CAA0BpM,IAA1B,EAAnC,EAAqE;AACpE,YAAM,IAAIhF,OAAOqF,KAAX,CAAiB,oCAAjB,EAAuD,6CAAvD,CAAN;AACA;;AAED,UAAMnJ,MAAMrB,WAAWoK,MAAX,CAAkBiF,QAAlB,CAA2B/E,WAA3B,CAAuC,KAAK/G,UAAL,CAAgBgT,SAAvD,CAAZ;;AAEA,QAAI,CAAClV,GAAL,EAAU;AACT,YAAM,IAAI8D,OAAOqF,KAAX,CAAiB,yBAAjB,EAA4C,+DAA5C,CAAN;AACA;;AAEDrF,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,aAAZ,EAA2B;AAC9DI,WAAKnE,IAAImE,GADqD;AAE9D+J,WAAKlO,IAAIkO,GAFqD;AAG9DsH,eAAS;AAHqD,KAA3B,CAApC;AAMA,WAAO7W,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAnBqE,CAAvE;AAsBAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,mBAA3B,EAAgD;AAAEgD,gBAAc;AAAhB,CAAhD,EAAwE;AACvEC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgBgT,SAAjB,IAA8B,CAAC,KAAKhT,UAAL,CAAgBgT,SAAhB,CAA0BpM,IAA1B,EAAnC,EAAqE;AACpE,YAAM,IAAIhF,OAAOqF,KAAX,CAAiB,oCAAjB,EAAuD,6CAAvD,CAAN;AACA;;AAED,UAAMnJ,MAAMrB,WAAWoK,MAAX,CAAkBiF,QAAlB,CAA2B/E,WAA3B,CAAuC,KAAK/G,UAAL,CAAgBgT,SAAvD,CAAZ;;AAEA,QAAI,CAAClV,GAAL,EAAU;AACT,YAAM,IAAI8D,OAAOqF,KAAX,CAAiB,yBAAjB,EAA4C,+DAA5C,CAAN;AACA;;AAEDrF,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,cAAZ,EAA4B/D,GAA5B,CAApC;AAEA,WAAOrB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAfsE,CAAxE;AAkBAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,oBAA3B,EAAiD;AAAEgD,gBAAc;AAAhB,CAAjD,EAAyE;AACxEC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgBgT,SAAjB,IAA8B,CAAC,KAAKhT,UAAL,CAAgBgT,SAAhB,CAA0BpM,IAA1B,EAAnC,EAAqE;AACpE,YAAM,IAAIhF,OAAOqF,KAAX,CAAiB,oCAAjB,EAAuD,6CAAvD,CAAN;AACA;;AAED,UAAMnJ,MAAMrB,WAAWoK,MAAX,CAAkBiF,QAAlB,CAA2B/E,WAA3B,CAAuC,KAAK/G,UAAL,CAAgBgT,SAAvD,CAAZ;;AAEA,QAAI,CAAClV,GAAL,EAAU;AACT,YAAM,IAAI8D,OAAOqF,KAAX,CAAiB,yBAAjB,EAA4C,+DAA5C,CAAN;AACA;;AAEDrF,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,aAAZ,EAA2B;AAC9DI,WAAKnE,IAAImE,GADqD;AAE9D+J,WAAKlO,IAAIkO,GAFqD;AAG9DsH,eAAS;AAHqD,KAA3B,CAApC;AAMA,WAAO7W,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAnBuE,CAAzE;AAsBAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,aAA3B,EAA0C;AAAEgD,gBAAc;AAAhB,CAA1C,EAAkE;AACjEC,SAAO;AACN4O,UAAM,KAAK7P,UAAX,EAAuBgQ,MAAM0C,eAAN,CAAsB;AAC5CtI,cAAQ0F,MADoC;AAE5C6C,aAAO7C,MAFqC;AAG5CyD,YAAMzD,MAHsC,CAG9B;;AAH8B,KAAtB,CAAvB;AAMA,UAAMhS,MAAMrB,WAAWoK,MAAX,CAAkBiF,QAAlB,CAA2B/E,WAA3B,CAAuC,KAAK/G,UAAL,CAAgB2S,KAAvD,CAAZ,CAPM,CASN;;AACA,QAAI,CAAC7U,GAAL,EAAU;AACT,aAAOrB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA2B,oCAAoC,KAAKuC,UAAL,CAAgB2S,KAAO,IAAtF,CAAP;AACA;;AAED,QAAI,KAAK3S,UAAL,CAAgBoK,MAAhB,KAA2BtM,IAAIkO,GAAnC,EAAwC;AACvC,aAAOvP,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,gEAA1B,CAAP;AACA,KAhBK,CAkBN;;;AACAmE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,eAAZ,EAA6B;AAAEI,aAAKnE,IAAImE,GAAX;AAAgBnE,aAAK,KAAKkC,UAAL,CAAgBuT,IAArC;AAA2CvH,aAAKlO,IAAIkO;AAApD,OAA7B;AACA,KAFD;AAIA,WAAOvP,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCwC,eAASlD,WAAWoK,MAAX,CAAkBiF,QAAlB,CAA2B/E,WAA3B,CAAuCjJ,IAAImE,GAA3C;AADuB,KAA1B,CAAP;AAGA;;AA3BgE,CAAlE;AA8BAxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,YAA3B,EAAyC;AAAEgD,gBAAc;AAAhB,CAAzC,EAAiE;AAChEC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgBgT,SAAjB,IAA8B,CAAC,KAAKhT,UAAL,CAAgBgT,SAAhB,CAA0BpM,IAA1B,EAAnC,EAAqE;AACpE,YAAM,IAAIhF,OAAOqF,KAAX,CAAiB,oCAAjB,EAAuD,4CAAvD,CAAN;AACA;;AAED,UAAMnJ,MAAMrB,WAAWoK,MAAX,CAAkBiF,QAAlB,CAA2B/E,WAA3B,CAAuC,KAAK/G,UAAL,CAAgBgT,SAAvD,CAAZ;;AAEA,QAAI,CAAClV,GAAL,EAAU;AACT,YAAM,IAAI8D,OAAOqF,KAAX,CAAiB,yBAAjB,EAA4C,+DAA5C,CAAN;AACA;;AAED,UAAMuM,QAAQ,KAAKxT,UAAL,CAAgBwT,KAAhB,IAAyB,KAAKxT,UAAL,CAAgByT,QAAvD;;AAEA,QAAI,CAACD,KAAL,EAAY;AACX,YAAM,IAAI5R,OAAOqF,KAAX,CAAiB,gCAAjB,EAAmD,wCAAnD,CAAN;AACA;;AAEDrF,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,aAAZ,EAA2B2R,KAA3B,EAAkC1V,IAAImE,GAAtC,EAA2C,KAAKjC,UAAL,CAAgB0T,WAA3D,CAApC;AAEA,WAAOjX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AArB+D,CAAjE;AAwBAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,6BAA3B,EAA0D;AAAEgD,gBAAc;AAAhB,CAA1D,EAAkF;AACjFjE,QAAM;AACL,UAAM;AAAEiW;AAAF,QAAgB,KAAKhN,WAA3B;;AACA,QAAI,CAACgN,SAAL,EAAgB;AACf,aAAOvW,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B;AAChCG,eAAO;AADyB,OAA1B,CAAP;AAGA;;AAED,QAAI;AACH,YAAM+V,sBAAsB/R,OAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,iBAAZ,EAA+B;AAAEmR;AAAF,OAA/B,CAApC,CAA5B;AACA,aAAOvW,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCyW,kBAAUD;AADsB,OAA1B,CAAP;AAGA,KALD,CAKE,OAAO/V,KAAP,EAAc;AACf,aAAOnB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B;AAChCG,eAAOA,MAAM+B;AADmB,OAA1B,CAAP;AAGA;AACD;;AAnBgF,CAAlF;AAsBAlD,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,oBAA3B,EAAiD;AAAEgD,gBAAc;AAAhB,CAAjD,EAAyE;AACxEC,SAAO;AACN,UAAM;AAAE+R,eAAF;AAAa7D;AAAb,QAA6B,KAAKnP,UAAxC;;AACA,QAAI,CAACgT,SAAL,EAAgB;AACf,aAAOvW,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,4CAA1B,CAAP;AACA;;AAED,QAAI,CAAC0R,WAAL,EAAkB;AACjB,aAAO1S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,8CAA1B,CAAP;AACA;;AAEDmE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,eAAZ,EAA6BmR,SAA7B,EAAwC7D,WAAxC,CAApC;AAEA,WAAO1S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAduE,CAAzE;AAiBAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,iBAA3B,EAA8C;AAAEgD,gBAAc;AAAhB,CAA9C,EAAsE;AACrEjE,QAAM;AACL,UAAM;AAAEiP,SAAF;AAAO7J;AAAP,QAAkB,KAAK6D,WAA7B;AACA,QAAI;AAAE6N,eAAS;AAAX,QAAoB,KAAK7N,WAA7B;AAEA6N,aAAS,OAAOA,MAAP,KAAkB,QAAlB,GAA6B,SAASC,IAAT,CAAcD,MAAd,CAA7B,GAAqDA,MAA9D;;AAEA,QAAI,CAAC7H,GAAD,IAAQ,CAACA,IAAIpF,IAAJ,EAAb,EAAyB;AACxB,YAAM,IAAIhF,OAAOqF,KAAX,CAAiB,kCAAjB,EAAqD,sCAArD,CAAN;AACA;;AAED,QAAI,CAAC9E,MAAD,IAAW,CAACA,OAAOyE,IAAP,EAAhB,EAA+B;AAC9B,YAAM,IAAIhF,OAAOqF,KAAX,CAAiB,kCAAjB,EAAqD,yCAArD,CAAN;AACA;;AAEDrF,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,YAAZ,EAA0B;AAAEmK,SAAF;AAAO7J,YAAP;AAAe0R;AAAf,KAA1B,CAApC;AAEA,WAAOpX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAlBoE,CAAtE,E;;;;;;;;;;;AC9TAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,cAA3B,EAA2C;AAAEgD,gBAAc;AAAhB,CAA3C,EAAmE;AAClEjE,QAAM;AACL,UAAM2J,SAAS,KAAKV,WAApB;;AAEA,QAAI,OAAOU,OAAOqN,OAAd,KAA0B,QAA9B,EAAwC;AACvC,aAAOtX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,6CAA1B,CAAP;AACA;;AAED,UAAMuW,MAAMvX,WAAWwX,aAAX,CAAyBC,QAAzB,CAAkCxN,OAAOqN,OAAP,CAAeI,WAAf,EAAlC,CAAZ;;AAEA,QAAI,CAACH,GAAL,EAAU;AACT,aAAOvX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA2B,qDAAqDiJ,OAAOqN,OAAS,EAAhG,CAAP;AACA;;AAED,WAAOtX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAAE4W,eAASC;AAAX,KAA1B,CAAP;AACA;;AAfiE,CAAnE;AAkBAvX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,eAA3B,EAA4C;AAAEgD,gBAAc;AAAhB,CAA5C,EAAoE;AACnEjE,QAAM;AACL,UAAM;AAAEqJ,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,UAAF;AAAQC,YAAR;AAAgBS;AAAhB,QAA0B,KAAK2D,cAAL,EAAhC;AAEA,QAAImH,WAAWzV,OAAO2V,MAAP,CAAc3X,WAAWwX,aAAX,CAAyBC,QAAvC,CAAf;;AAEA,QAAI9K,SAASA,MAAM2K,OAAnB,EAA4B;AAC3BG,iBAAWA,SAASG,MAAT,CAAiBN,OAAD,IAAaA,QAAQA,OAAR,KAAoB3K,MAAM2K,OAAvD,CAAX;AACA;;AAED,UAAMtF,aAAayF,SAAS3T,MAA5B;AACA2T,eAAWzX,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwB+J,2BAAxB,CAAoDJ,QAApD,EAA8D;AACxExL,YAAMA,OAAOA,IAAP,GAAc;AAAE5L,cAAM;AAAR,OADoD;AAExEqQ,YAAM/G,MAFkE;AAGxEgH,aAAO9G,KAHiE;AAIxEqC;AAJwE,KAA9D,CAAX;AAOA,WAAOlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC+W,cADgC;AAEhC9N,YAFgC;AAGhCE,aAAO4N,SAAS3T,MAHgB;AAIhCgN,aAAOkB;AAJyB,KAA1B,CAAP;AAMA;;AAzBkE,CAApE,E,CA4BA;;AACAhS,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,cAA3B,EAA2C;AAAEgD,gBAAc;AAAhB,CAA3C,EAAmE;AAClEC,SAAO;AACN,UAAM1D,OAAO,KAAKyC,UAAlB;AACA,UAAMC,OAAO,KAAK6J,eAAL,EAAb;;AAEA,QAAI,OAAOvM,KAAKwW,OAAZ,KAAwB,QAA5B,EAAsC;AACrC,aAAOtX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,oCAA1B,CAAP;AACA;;AAED,QAAIF,KAAKmJ,MAAL,IAAe,OAAOnJ,KAAKmJ,MAAZ,KAAuB,QAA1C,EAAoD;AACnD,aAAOjK,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,yDAA1B,CAAP;AACA;;AAED,QAAI,OAAOF,KAAK6M,MAAZ,KAAuB,QAA3B,EAAqC;AACpC,aAAO3N,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,gFAA1B,CAAP;AACA;;AAED,UAAMuW,MAAMzW,KAAKwW,OAAL,CAAaI,WAAb,EAAZ;;AACA,QAAI,CAAC1X,WAAWwX,aAAX,CAAyBC,QAAzB,CAAkC3W,KAAKwW,OAAL,CAAaI,WAAb,EAAlC,CAAL,EAAoE;AACnE,aAAO1X,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,uDAA1B,CAAP;AACA,KAnBK,CAqBN;;;AACAmE,WAAOC,IAAP,CAAY,eAAZ,EAA6BtE,KAAK6M,MAAlC,EAA0CnK,KAAKgC,GAA/C;AAEA,UAAMyE,SAASnJ,KAAKmJ,MAAL,GAAcnJ,KAAKmJ,MAAnB,GAA4B,EAA3C;AAEA,QAAItJ,MAAJ;AACAwE,WAAOgJ,SAAP,CAAiB3K,KAAKgC,GAAtB,EAA2B,MAAM;AAChC7E,eAASX,WAAWwX,aAAX,CAAyBM,GAAzB,CAA6BP,GAA7B,EAAkCtN,MAAlC,EAA0C;AAClDzE,aAAKuS,OAAOtS,EAAP,EAD6C;AAElD8J,aAAKzO,KAAK6M,MAFwC;AAGlDtM,aAAM,IAAIkW,GAAK,IAAItN,MAAQ;AAHuB,OAA1C,CAAT;AAKA,KAND;AAQA,WAAOjK,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAAEC;AAAF,KAA1B,CAAP;AACA;;AArCiE,CAAnE;AAwCAX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,kBAA3B,EAA+C;AAAEgD,gBAAc;AAAhB,CAA/C,EAAuE;AACtE;AACAjE,QAAM;AACL,UAAMqM,QAAQ,KAAKpD,WAAnB;AACA,UAAM/F,OAAO,KAAK6J,eAAL,EAAb;;AAEA,QAAI,OAAOV,MAAM2K,OAAb,KAAyB,QAA7B,EAAuC;AACtC,aAAOtX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,sDAA1B,CAAP;AACA;;AAED,QAAI2L,MAAM1C,MAAN,IAAgB,OAAO0C,MAAM1C,MAAb,KAAwB,QAA5C,EAAsD;AACrD,aAAOjK,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,yDAA1B,CAAP;AACA;;AAED,QAAI,OAAO2L,MAAMgB,MAAb,KAAwB,QAA5B,EAAsC;AACrC,aAAO3N,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,yFAA1B,CAAP;AACA;;AAED,UAAMuW,MAAM5K,MAAM2K,OAAN,CAAcI,WAAd,EAAZ;;AACA,QAAI,CAAC1X,WAAWwX,aAAX,CAAyBC,QAAzB,CAAkCF,GAAlC,CAAL,EAA6C;AAC5C,aAAOvX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,uDAA1B,CAAP;AACA,KAnBI,CAqBL;;;AACAmE,WAAOC,IAAP,CAAY,eAAZ,EAA6BuH,MAAMgB,MAAnC,EAA2CnK,KAAKgC,GAAhD;AAEA,UAAMyE,SAAS0C,MAAM1C,MAAN,GAAe0C,MAAM1C,MAArB,GAA8B,EAA7C;AAEA,QAAI+N,OAAJ;AACA7S,WAAOgJ,SAAP,CAAiB3K,KAAKgC,GAAtB,EAA2B,MAAM;AAChCwS,gBAAU7S,OAAOC,IAAP,CAAY,yBAAZ,EAAuC;AAAEmS,WAAF;AAAOtN,cAAP;AAAe5I,aAAK;AAAEkO,eAAK5C,MAAMgB;AAAb;AAApB,OAAvC,CAAV;AACA,KAFD;AAIA,WAAO3N,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAAEsX;AAAF,KAA1B,CAAP;AACA,GAlCqE;;AAmCtE;AACAxT,SAAO;AACN,UAAM1D,OAAO,KAAKyC,UAAlB;AACA,UAAMC,OAAO,KAAK6J,eAAL,EAAb;;AAEA,QAAI,OAAOvM,KAAKwW,OAAZ,KAAwB,QAA5B,EAAsC;AACrC,aAAOtX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,wDAA1B,CAAP;AACA;;AAED,QAAIF,KAAKmJ,MAAL,IAAe,OAAOnJ,KAAKmJ,MAAZ,KAAuB,QAA1C,EAAoD;AACnD,aAAOjK,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,yDAA1B,CAAP;AACA;;AAED,QAAI,OAAOF,KAAK6M,MAAZ,KAAuB,QAA3B,EAAqC;AACpC,aAAO3N,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,yFAA1B,CAAP;AACA;;AAED,QAAI,OAAOF,KAAKmX,WAAZ,KAA4B,WAAhC,EAA6C;AAC5C,aAAOjY,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,mDAA1B,CAAP;AACA;;AAED,QAAI,CAACF,KAAKmX,WAAL,CAAiBxS,EAAlB,IAAwB,CAAC3E,KAAKmX,WAAL,CAAiB/O,IAA1C,IAAkD,OAAOpI,KAAKmX,WAAL,CAAiBnP,KAAxB,KAAkC,WAAxF,EAAqG;AACpG,aAAO9I,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,yDAA1B,CAAP;AACA;;AAED,UAAMuW,MAAMzW,KAAKwW,OAAL,CAAaI,WAAb,EAAZ;;AACA,QAAI,CAAC1X,WAAWwX,aAAX,CAAyBC,QAAzB,CAAkCF,GAAlC,CAAL,EAA6C;AAC5C,aAAOvX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,uDAA1B,CAAP;AACA,KA3BK,CA6BN;;;AACAmE,WAAOC,IAAP,CAAY,eAAZ,EAA6BtE,KAAK6M,MAAlC,EAA0CnK,KAAKgC,GAA/C;AAEA,UAAMyE,SAASnJ,KAAKmJ,MAAL,GAAcnJ,KAAKmJ,MAAnB,GAA4B,EAA3C;AAEA9E,WAAOgJ,SAAP,CAAiB3K,KAAKgC,GAAtB,EAA2B,MAAM;AAChCL,aAAOC,IAAP,CAAY,4BAAZ,EAA0C;AAAEmS,WAAF;AAAOtN,cAAP;AAAe5I,aAAK;AAAEkO,eAAKzO,KAAK6M;AAAZ;AAApB,OAA1C,EAAsF7M,KAAKmX,WAA3F;AACA,KAFD;AAIA,WAAOjY,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AA3EqE,CAAvE,E;;;;;;;;;;;ACvFAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,cAA3B,EAA2C;AAAEgD,gBAAc;AAAhB,CAA3C,EAAmE;AAClEjE,QAAM;AACL,UAAM4X,SAAS/S,OAAOC,IAAP,CAAY,iBAAZ,CAAf;AAEA,WAAOpF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAAEwX;AAAF,KAA1B,CAAP;AACA;;AALiE,CAAnE,E;;;;;;;;;;;ACAA,IAAIra,CAAJ;;AAAMC,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACL,QAAEK,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;;AAEN;AACA,SAASia,0BAAT,CAAoC;AAAElO,QAAF;AAAUvE,QAAV;AAAkBgI,oBAAkB;AAApC,CAApC,EAAgF;AAC/E,MAAI,CAAC,CAACzD,OAAO0D,MAAR,IAAkB,CAAC1D,OAAO0D,MAAP,CAAcxD,IAAd,EAApB,MAA8C,CAACF,OAAO2D,QAAR,IAAoB,CAAC3D,OAAO2D,QAAP,CAAgBzD,IAAhB,EAAnE,CAAJ,EAAgG;AAC/F,UAAM,IAAIhF,OAAOqF,KAAX,CAAiB,+BAAjB,EAAkD,kDAAlD,CAAN;AACA;;AAED,MAAI4N,OAAJ;;AACA,MAAInO,OAAO0D,MAAX,EAAmB;AAClByK,cAAUpY,WAAWoK,MAAX,CAAkBoE,aAAlB,CAAgCC,wBAAhC,CAAyDxE,OAAO0D,MAAhE,EAAwEjI,MAAxE,CAAV;AACA,GAFD,MAEO,IAAIuE,OAAO2D,QAAX,EAAqB;AAC3BwK,cAAUpY,WAAWoK,MAAX,CAAkBoE,aAAlB,CAAgC6J,0BAAhC,CAA2DpO,OAAO2D,QAAlE,EAA4ElI,MAA5E,CAAV;AACA;;AAED,MAAI,CAAC0S,OAAD,IAAYA,QAAQpK,CAAR,KAAc,GAA9B,EAAmC;AAClC,UAAM,IAAI7I,OAAOqF,KAAX,CAAiB,sBAAjB,EAAyC,6EAAzC,CAAN;AACA;;AAED,MAAIkD,mBAAmB0K,QAAQnK,QAA/B,EAAyC;AACxC,UAAM,IAAI9I,OAAOqF,KAAX,CAAiB,qBAAjB,EAAyC,sBAAsB4N,QAAQ/X,IAAM,eAA7E,CAAN;AACA;;AAED,SAAO+X,OAAP;AACA;;AAEDpY,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,eAA3B,EAA4C;AAAEgD,gBAAc;AAAhB,CAA5C,EAAoE;AACnEC,SAAO;AACN,UAAM0J,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA;AAA7C,KAA3B,CAAnB;AAEAP,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAWqB,GAA3C,EAAgD,KAAKhM,UAAL,CAAgB6K,eAAhE;AACA,KAFD;AAIA,WAAOpO,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC4X,aAAOtY,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC4D,WAAWqB,GAA/C,EAAoD;AAAErD,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAApD;AADyB,KAA1B,CAAP;AAGA;;AAXkE,CAApE;AAcAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,qBAA3B,EAAkD;AAAEgD,gBAAc;AAAhB,CAAlD,EAA0E;AACzEC,SAAO;AACN,UAAM0J,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA;AAA7C,KAA3B,CAAnB;AAEA,UAAMlC,OAAO,KAAK8K,iBAAL,EAAb;AAEAnJ,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAWqB,GAA3C,EAAgD/L,KAAKgC,GAArD;AACA,KAFD;AAIA,WAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAXwE,CAA1E;AAcAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,iBAA3B,EAA8C;AAAEgD,gBAAc;AAAhB,CAA9C,EAAsE;AACrEC,SAAO;AACN,UAAM0J,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA;AAA7C,KAA3B,CAAnB;AAEA,UAAMlC,OAAO,KAAK8K,iBAAL,EAAb;AAEAnJ,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,cAAZ,EAA4B8I,WAAWqB,GAAvC,EAA4C/L,KAAKgC,GAAjD;AACA,KAFD;AAIA,WAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAXoE,CAAtE;AAcAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,kBAA3B,EAA+C;AAAEgD,gBAAc;AAAhB,CAA/C,EAAuE;AACtEC,SAAO;AACN,UAAM0J,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA;AAA7C,KAA3B,CAAnB;AACA,UAAMlC,OAAO,KAAK8K,iBAAL,EAAb;AACAnJ,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,eAAZ,EAA6B8I,WAAWqB,GAAxC,EAA6C/L,KAAKgC,GAAlD;AACA,KAFD;AAIA,WAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AATqE,CAAvE,E,CAYA;;AACAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,gBAA3B,EAA6C;AAAEgD,gBAAc;AAAhB,CAA7C,EAAqE;AACpEC,SAAO;AACN,UAAM0J,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA;AAA7C,KAA3B,CAAnB;AAEAP,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,aAAZ,EAA2B8I,WAAWqB,GAAtC;AACA,KAFD;AAIA,WAAOvP,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AATmE,CAArE;AAYAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,cAA3B,EAA2C;AAAEgD,gBAAc;AAAhB,CAA3C,EAAmE;AAClEC,SAAO;AACN,UAAM0J,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA,MAA7C;AAAqDgI,uBAAiB;AAAtE,KAA3B,CAAnB;;AAEA,QAAI,CAACQ,WAAWQ,IAAhB,EAAsB;AACrB,aAAO1O,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA2B,sBAAsBkN,WAAW7N,IAAM,mCAAlE,CAAP;AACA;;AAED8E,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,UAAZ,EAAwB8I,WAAWqB,GAAnC;AACA,KAFD;AAIA,WAAOvP,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAbiE,CAAnE;AAgBAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,iBAA3B,EAA8C;AAAEgD,gBAAc;AAAhB,CAA9C,EAAsE;AACrEjE,QAAM;AACL,UAAMqO,SAAS3O,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,0BAA5C,CAAf;AACA,UAAMuE,SAAS,KAAKC,aAAL,EAAf;AACA,QAAI1G,OAAO,KAAKkC,MAAhB;AACA,QAAImI,IAAJ;AACA,QAAIe,UAAU,IAAd;AACA,QAAIC,eAAe,IAAnB;AACA,QAAIC,cAAc,IAAlB;AACA,QAAIC,SAAS,KAAb;AACA,QAAIC,OAAO,IAAX;AACA,QAAIC,SAAS,IAAb;AACA,QAAIpQ,UAAU,IAAd;;AAEA,QAAI,CAAC,CAACoL,OAAO0D,MAAR,IAAkB,CAAC1D,OAAO0D,MAAP,CAAcxD,IAAd,EAApB,MAA8C,CAACF,OAAO2D,QAAR,IAAoB,CAAC3D,OAAO2D,QAAP,CAAgBzD,IAAhB,EAAnE,CAAJ,EAAgG;AAC/F,YAAM,IAAIhF,OAAOqF,KAAX,CAAiB,+BAAjB,EAAkD,kDAAlD,CAAN;AACA;;AAED,QAAIP,OAAO0D,MAAX,EAAmB;AAClBE,aAAO7N,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoCL,OAAO0D,MAA3C,CAAP;AACA,KAFD,MAEO,IAAI1D,OAAO2D,QAAX,EAAqB;AAC3BC,aAAO7N,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBC,aAAxB,CAAsC9D,OAAO2D,QAA7C,CAAP;AACA;;AAED,QAAI,CAACC,IAAD,IAASA,KAAKG,CAAL,KAAW,GAAxB,EAA6B;AAC5B,YAAM,IAAI7I,OAAOqF,KAAX,CAAiB,sBAAjB,EAAyC,6EAAzC,CAAN;AACA;;AAED,QAAIqD,KAAKI,QAAT,EAAmB;AAClB,YAAM,IAAI9I,OAAOqF,KAAX,CAAiB,qBAAjB,EAAyC,sBAAsBqD,KAAKxN,IAAM,eAA1E,CAAN;AACA;;AAED,QAAI4J,OAAOvE,MAAX,EAAmB;AAClB,UAAI,CAACiJ,MAAL,EAAa;AACZ,eAAO3O,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AACDkC,aAAOyG,OAAOvE,MAAd;AACA;;AACD,UAAMyJ,eAAenP,WAAWoK,MAAX,CAAkBoE,aAAlB,CAAgCC,wBAAhC,CAAyDZ,KAAKrI,GAA9D,EAAmEhC,IAAnE,CAArB;AACA,UAAM4L,KAAKvB,KAAKuB,EAAL,GAAUvB,KAAKuB,EAAf,GAAoBvB,KAAKlO,UAApC;;AAEA,QAAI,OAAOwP,YAAP,KAAwB,WAAxB,IAAuCA,aAAaT,IAAxD,EAA8D;AAC7D,UAAIS,aAAaK,EAAjB,EAAqB;AACpBZ,kBAAU5O,WAAWoK,MAAX,CAAkBiF,QAAlB,CAA2BC,8CAA3B,CAA0EH,aAAaI,GAAvF,EAA4FJ,aAAaK,EAAzG,EAA6GJ,EAA7G,CAAV;AACAN,sBAAcK,aAAaK,EAA3B;AACA;;AACDX,qBAAeM,aAAaN,YAA5B;AACAE,eAAS,IAAT;AACA;;AAED,QAAIJ,UAAUI,MAAd,EAAsB;AACrBC,aAAOnB,KAAKmB,IAAZ;AACAC,eAASG,EAAT;AACAvQ,gBAAUgP,KAAK6B,UAAf;AACA;;AAED,WAAO1P,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCqO,YADgC;AAEhClQ,aAFgC;AAGhC+P,aAHgC;AAIhCE,iBAJgC;AAKhCE,UALgC;AAMhCC,YANgC;AAOhCJ;AAPgC,KAA1B,CAAP;AASA;;AAjEoE,CAAtE,E,CAoEA;;AACA7O,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,eAA3B,EAA4C;AAAEgD,gBAAc;AAAhB,CAA5C,EAAoE;AACnEC,SAAO;AACN,QAAI,CAACxE,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,UAA5C,CAAL,EAA8D;AAC7D,aAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AAED,QAAI,CAAC,KAAKiC,UAAL,CAAgBlD,IAArB,EAA2B;AAC1B,aAAOL,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,+BAA1B,CAAP;AACA;;AAED,QAAI,KAAKuC,UAAL,CAAgB1E,OAAhB,IAA2B,CAAChB,EAAE8D,OAAF,CAAU,KAAK4B,UAAL,CAAgB1E,OAA1B,CAAhC,EAAoE;AACnE,aAAOmB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,mDAA1B,CAAP;AACA;;AAED,QAAI,KAAKuC,UAAL,CAAgB3D,YAAhB,IAAgC,EAAE,OAAO,KAAK2D,UAAL,CAAgB3D,YAAvB,KAAwC,QAA1C,CAApC,EAAyF;AACxF,aAAOI,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,yDAA1B,CAAP;AACA;;AAED,UAAM6O,WAAW,OAAO,KAAKtM,UAAL,CAAgBsM,QAAvB,KAAoC,WAApC,GAAkD,KAAKtM,UAAL,CAAgBsM,QAAlE,GAA6E,KAA9F;AAEA,QAAIpK,EAAJ;AACAN,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCD,WAAKN,OAAOC,IAAP,CAAY,oBAAZ,EAAkC,KAAK7B,UAAL,CAAgBlD,IAAlD,EAAwD,KAAKkD,UAAL,CAAgB1E,OAAhB,GAA0B,KAAK0E,UAAL,CAAgB1E,OAA1C,GAAoD,EAA5G,EAAgHgR,QAAhH,EAA0H,KAAKtM,UAAL,CAAgB3D,YAA1I,CAAL;AACA,KAFD;AAIA,WAAOI,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC4X,aAAOtY,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC7E,GAAG8J,GAAvC,EAA4C;AAAErD,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAA5C;AADyB,KAA1B,CAAP;AAGA;;AA5BkE,CAApE;AA+BAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,eAA3B,EAA4C;AAAEgD,gBAAc;AAAhB,CAA5C,EAAoE;AACnEC,SAAO;AACN,UAAM0J,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA,MAA7C;AAAqDgI,uBAAiB;AAAtE,KAA3B,CAAnB;AAEAvI,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,WAAZ,EAAyB8I,WAAWqB,GAApC;AACA,KAFD;AAIA,WAAOvP,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC4X,aAAOtY,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC4D,WAAWqB,GAA/C,EAAoD;AAAErD,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAApD;AADyB,KAA1B,CAAP;AAGA;;AAXkE,CAApE;AAcAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,cAA3B,EAA2C;AAAEgD,gBAAc;AAAhB,CAA3C,EAAmE;AAClEjE,QAAM;AACL,UAAM4N,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA,MAA7C;AAAqDgI,uBAAiB;AAAtE,KAA3B,CAAnB;;AACA,UAAMwC,6BAA8BC,IAAD,IAAU;AAC5C,UAAIA,KAAKzK,MAAT,EAAiB;AAChByK,eAAO,KAAKC,gBAAL,CAAsB;AAAEhD,kBAAQ+C,IAAV;AAAgBzK,kBAAQyK,KAAKzK;AAA7B,SAAtB,CAAP;AACA;;AACD,aAAOyK,IAAP;AACA,KALD;;AAOA,UAAM;AAAExG,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,UAAF;AAAQC,YAAR;AAAgBS;AAAhB,QAA0B,KAAK2D,cAAL,EAAhC;AAEA,UAAMC,WAAWvO,OAAO0K,MAAP,CAAc,EAAd,EAAkBC,KAAlB,EAAyB;AAAE4C,WAAKrB,WAAWqB;AAAlB,KAAzB,CAAjB;AAEA,UAAMiB,QAAQxQ,WAAWoK,MAAX,CAAkBqG,OAAlB,CAA0BzF,IAA1B,CAA+BuF,QAA/B,EAAyC;AACtDtE,YAAMA,OAAOA,IAAP,GAAc;AAAE5L,cAAM;AAAR,OADkC;AAEtDqQ,YAAM/G,MAFgD;AAGtDgH,aAAO9G,KAH+C;AAItDqC;AAJsD,KAAzC,EAKX0E,KALW,EAAd;AAOA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC8P,aAAOA,MAAMK,GAAN,CAAUX,0BAAV,CADyB;AAEhCrG,aAAO2G,MAAM1M,MAFmB;AAGhC6F,YAHgC;AAIhCmH,aAAO9Q,WAAWoK,MAAX,CAAkBqG,OAAlB,CAA0BzF,IAA1B,CAA+BuF,QAA/B,EAAyC1G,KAAzC;AAJyB,KAA1B,CAAP;AAMA;;AA5BiE,CAAnE;AA+BA7J,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,wBAA3B,EAAqD;AAAEgD,gBAAc;AAAhB,CAArD,EAA6E;AAC5EjE,QAAM;AACL,QAAI,CAACN,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,qBAA5C,CAAL,EAAyE;AACxE,aAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AAED,UAAM4M,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA,MAA7C;AAAqDgI,uBAAiB;AAAtE,KAA3B,CAAnB;AAEA,QAAI6K,0BAA0B,IAA9B;;AACA,QAAI,OAAO,KAAKhP,WAAL,CAAiBgP,uBAAxB,KAAoD,WAAxD,EAAqE;AACpEA,gCAA0B,KAAKhP,WAAL,CAAiBgP,uBAAjB,KAA6C,MAAvE;AACA;;AAED,UAAMC,mBAAmB,CAAE,IAAItK,WAAW7N,IAAM,EAAvB,CAAzB;;AACA,QAAIkY,uBAAJ,EAA6B;AAC5BC,uBAAiB/X,IAAjB,CAAsB,oBAAtB;AACA;;AAED,UAAM;AAAEkJ,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,UAAF;AAAQC,YAAR;AAAgBS;AAAhB,QAA0B,KAAK2D,cAAL,EAAhC;AAEA,UAAMC,WAAWvO,OAAO0K,MAAP,CAAc,EAAd,EAAkBC,KAAlB,EAAyB;AAAE0B,eAAS;AAAE2C,aAAKwH;AAAP;AAAX,KAAzB,CAAjB;AACA,UAAMvH,eAAejR,WAAWoK,MAAX,CAAkB8G,YAAlB,CAA+BlG,IAA/B,CAAoCuF,QAApC,EAA8C;AAClEtE,YAAMA,OAAOA,IAAP,GAAc;AAAEkF,oBAAY;AAAd,OAD8C;AAElET,YAAM/G,MAF4D;AAGlEgH,aAAO9G,KAH2D;AAIlEqC;AAJkE,KAA9C,EAKlB0E,KALkB,EAArB;AAOA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCuQ,kBADgC;AAEhCpH,aAAOoH,aAAanN,MAFY;AAGhC6F,YAHgC;AAIhCmH,aAAO9Q,WAAWoK,MAAX,CAAkB8G,YAAlB,CAA+BlG,IAA/B,CAAoCuF,QAApC,EAA8C1G,KAA9C;AAJyB,KAA1B,CAAP;AAMA;;AAnC2E,CAA7E;AAsCA7J,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,gBAA3B,EAA6C;AAAEgD,gBAAc;AAAhB,CAA7C,EAAqE;AACpEjE,QAAM;AACL,UAAM4N,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA,MAA7C;AAAqDgI,uBAAiB;AAAtE,KAA3B,CAAnB;AAEA,QAAI0D,aAAa,IAAIC,IAAJ,EAAjB;;AACA,QAAI,KAAK9H,WAAL,CAAiB0F,MAArB,EAA6B;AAC5BmC,mBAAa,IAAIC,IAAJ,CAAS,KAAK9H,WAAL,CAAiB0F,MAA1B,CAAb;AACA;;AAED,QAAIqC,aAAa7J,SAAjB;;AACA,QAAI,KAAK8B,WAAL,CAAiBgI,MAArB,EAA6B;AAC5BD,mBAAa,IAAID,IAAJ,CAAS,KAAK9H,WAAL,CAAiBgI,MAA1B,CAAb;AACA;;AAED,UAAMC,YAAY,KAAKjI,WAAL,CAAiBiI,SAAjB,IAA8B,KAAhD;AAEA,QAAI3H,QAAQ,EAAZ;;AACA,QAAI,KAAKN,WAAL,CAAiBM,KAArB,EAA4B;AAC3BA,cAAQD,SAAS,KAAKL,WAAL,CAAiBM,KAA1B,CAAR;AACA;;AAED,UAAM+E,UAAU,KAAKrF,WAAL,CAAiBqF,OAAjB,IAA4B,KAA5C;AAEA,QAAIjO,MAAJ;AACAwE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnC/E,eAASwE,OAAOC,IAAP,CAAY,mBAAZ,EAAiC;AAAEmK,aAAKrB,WAAWqB,GAAlB;AAAuBN,gBAAQmC,UAA/B;AAA2CG,gBAAQD,UAAnD;AAA+DE,iBAA/D;AAA0E3H,aAA1E;AAAiF+E;AAAjF,OAAjC,CAAT;AACA,KAFD;;AAIA,QAAI,CAACjO,MAAL,EAAa;AACZ,aAAOX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AAED,WAAOtB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0BC,MAA1B,CAAP;AACA;;AAjCmE,CAArE;AAoCAX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,aAA3B,EAA0C;AAAEgD,gBAAc;AAAhB,CAA1C,EAAkE;AACjEjE,QAAM;AACL,UAAM4N,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA,MAA7C;AAAqDgI,uBAAiB;AAAtE,KAA3B,CAAnB;AAEA,WAAO1N,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC4X,aAAOtY,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC4D,WAAWqB,GAA/C,EAAoD;AAAErD,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAApD;AADyB,KAA1B,CAAP;AAGA;;AAPgE,CAAlE;AAUAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,eAA3B,EAA4C;AAAEgD,gBAAc;AAAhB,CAA5C,EAAoE;AACnEC,SAAO;AACN,UAAM;AAAEmJ,eAAS,EAAX;AAAeC,iBAAW;AAA1B,QAAiC,KAAK1D,aAAL,EAAvC;AACA,UAAMuO,WAAW9K,UAAUC,QAA3B;;AACA,QAAI,CAAC6K,SAAStO,IAAT,EAAL,EAAsB;AACrB,YAAM,IAAIhF,OAAOqF,KAAX,CAAiB,+BAAjB,EAAkD,kDAAlD,CAAN;AACA;;AAED,UAAM;AAAEhF,WAAK+J,GAAP;AAAYvB,SAAG9E;AAAf,QAAwBlJ,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwB6F,iBAAxB,CAA0C8E,QAA1C,KAAuD,EAArF;;AAEA,QAAI,CAAClJ,GAAD,IAAQrG,SAAS,GAArB,EAA0B;AACzB,YAAM,IAAI/D,OAAOqF,KAAX,CAAiB,sBAAjB,EAAyC,6EAAzC,CAAN;AACA;;AAED,UAAM;AAAE/G;AAAF,QAAe,KAAK6K,iBAAL,EAArB;AAEAnJ,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,eAAZ,EAA6B;AAAEmK,SAAF;AAAO9L;AAAP,KAA7B,CAApC;AAEA,WAAOzD,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC4X,aAAOtY,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoCiF,GAApC,EAAyC;AAAErD,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAAzC;AADyB,KAA1B,CAAP;AAGA;;AArBkE,CAApE;AAwBAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,aAA3B,EAA0C;AAAEgD,gBAAc;AAAhB,CAA1C,EAAkE;AACjEC,SAAO;AACN,UAAM0J,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA;AAA7C,KAA3B,CAAnB;AAEA,UAAMlC,OAAO,KAAK8K,iBAAL,EAAb;AAEAnJ,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,oBAAZ,EAAkC;AAAEmK,aAAKrB,WAAWqB,GAAlB;AAAuB9L,kBAAUD,KAAKC;AAAtC,OAAlC;AACA,KAFD;AAIA,WAAOzD,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAXgE,CAAlE;AAcAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,cAA3B,EAA2C;AAAEgD,gBAAc;AAAhB,CAA3C,EAAmE;AAClEC,SAAO;AACN,UAAM0J,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA;AAA7C,KAA3B,CAAnB;AAEAP,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,WAAZ,EAAyB8I,WAAWqB,GAApC;AACA,KAFD;AAIA,WAAOvP,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AATiE,CAAnE,E,CAYA;;AACAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,aAA3B,EAA0C;AAAEgD,gBAAc;AAAhB,CAA1C,EAAkE;AACjEjE,QAAM;AACL,UAAM;AAAEqJ,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,UAAF;AAAQC;AAAR,QAAmB,KAAKoE,cAAL,EAAzB,CAFK,CAIL;;AACA,UAAMuB,SAAS7R,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBiE,+BAAxB,CAAwD,GAAxD,EAA6D,KAAKrM,MAAlE,EAA0E;AACxFuG,YAAMA,OAAOA,IAAP,GAAc;AAAE5L,cAAM;AAAR,OADoE;AAExFqQ,YAAM/G,MAFkF;AAGxFgH,aAAO9G,KAHiF;AAIxFqC;AAJwF,KAA1E,CAAf;AAOA,UAAM8F,aAAaH,OAAOhI,KAAP,EAAnB;AACA,UAAMiI,QAAQD,OAAOjB,KAAP,EAAd;AAGA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCgY,cAAQ5G,KADwB;AAEhCnI,YAFgC;AAGhCE,aAAOiI,MAAMhO,MAHmB;AAIhCgN,aAAOkB;AAJyB,KAA1B,CAAP;AAMA;;AAvBgE,CAAlE;AA2BAhS,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,gBAA3B,EAA6C;AAAEgD,gBAAc;AAAhB,CAA7C,EAAqE;AACpEjE,QAAM;AACL,QAAI,CAACN,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,0BAA5C,CAAL,EAA8E;AAC7E,aAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AACD,UAAM;AAAEqI,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,UAAF;AAAQC,YAAR;AAAgBS;AAAhB,QAA0B,KAAK2D,cAAL,EAAhC;AACA,UAAMC,WAAWvO,OAAO0K,MAAP,CAAc,EAAd,EAAkBC,KAAlB,EAAyB;AAAEqB,SAAG;AAAL,KAAzB,CAAjB;AAEA,QAAI8D,QAAQ9R,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwB9C,IAAxB,CAA6BuF,QAA7B,EAAuCK,KAAvC,EAAZ;AACA,UAAMoB,aAAaF,MAAMhO,MAAzB;AAEAgO,YAAQ9R,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwB+J,2BAAxB,CAAoD/F,KAApD,EAA2D;AAClE7F,YAAMA,OAAOA,IAAP,GAAc;AAAE5L,cAAM;AAAR,OAD8C;AAElEqQ,YAAM/G,MAF4D;AAGlEgH,aAAO9G,KAH2D;AAIlEqC;AAJkE,KAA3D,CAAR;AAOA,WAAOlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCgY,cAAQ5G,KADwB;AAEhCnI,YAFgC;AAGhCE,aAAOiI,MAAMhO,MAHmB;AAIhCgN,aAAOkB;AAJyB,KAA1B,CAAP;AAMA;;AAzBmE,CAArE;AA4BAhS,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,gBAA3B,EAA6C;AAAEgD,gBAAc;AAAhB,CAA7C,EAAqE;AACpEjE,QAAM;AACL,UAAM4N,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA;AAA7C,KAA3B,CAAnB;AACA,UAAMmI,OAAO7N,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC4D,WAAWqB,GAA/C,EAAoD;AAAErD,cAAQ;AAAE+F,mBAAW;AAAb;AAAV,KAApD,CAAb;;AAEA,QAAIpE,KAAKoE,SAAL,IAAkB,CAACjS,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,4BAA5C,CAAvB,EAAkG;AACjG,aAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AAED,UAAM;AAAEqI,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,aAAO;AAAT,QAAgB,KAAKqE,cAAL,EAAtB;AAEA,UAAM4B,gBAAgBlS,WAAWoK,MAAX,CAAkBoE,aAAlB,CAAgC2D,YAAhC,CAA6CjE,WAAWqB,GAAxD,EAA6D;AAClFrD,cAAQ;AAAE,iBAAS;AAAX,OAD0E;AAElFD,YAAM;AAAE,sBAAcA,KAAKxI,QAAL,IAAiB,IAAjB,GAAwBwI,KAAKxI,QAA7B,GAAwC;AAAxD,OAF4E;AAGlFiN,YAAM/G,MAH4E;AAIlFgH,aAAO9G;AAJ2E,KAA7D,CAAtB;AAOA,UAAMiH,QAAQoB,cAAcrI,KAAd,EAAd;AAEA,UAAMhL,UAAUqT,cAActB,KAAd,GAAsBC,GAAtB,CAA2Be,CAAD,IAAOA,EAAEQ,CAAF,IAAOR,EAAEQ,CAAF,CAAI5M,GAA5C,CAAhB;AAEA,UAAMF,QAAQtF,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwBW,IAAxB,CAA6B;AAAExF,WAAK;AAAEwL,aAAKnS;AAAP;AAAP,KAA7B,EAAwD;AACrEqN,cAAQ;AAAE1G,aAAK,CAAP;AAAU/B,kBAAU,CAApB;AAAuBpD,cAAM,CAA7B;AAAgC8C,gBAAQ,CAAxC;AAA2CuH,mBAAW;AAAtD,OAD6D;AAErEuB,YAAM;AAAExI,kBAAWwI,KAAKxI,QAAL,IAAiB,IAAjB,GAAwBwI,KAAKxI,QAA7B,GAAwC;AAArD;AAF+D,KAAxD,EAGXmN,KAHW,EAAd;AAKA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC7B,eAASyG,KADuB;AAEhCuE,aAAOvE,MAAMxB,MAFmB;AAGhC6F,YAHgC;AAIhCmH;AAJgC,KAA1B,CAAP;AAMA;;AAlCmE,CAArE;AAqCA9Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,iBAA3B,EAA8C;AAAEgD,gBAAc;AAAhB,CAA9C,EAAsE;AACrEjE,QAAM;AACL,UAAM4N,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA;AAA7C,KAA3B,CAAnB;AACA,UAAM;AAAEiE,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,UAAF;AAAQC,YAAR;AAAgBS;AAAhB,QAA0B,KAAK2D,cAAL,EAAhC;AAEA,UAAMC,WAAWvO,OAAO0K,MAAP,CAAc,EAAd,EAAkBC,KAAlB,EAAyB;AAAE4C,WAAKrB,WAAWqB;AAAlB,KAAzB,CAAjB;AAEA,UAAM8C,WAAWrS,WAAWoK,MAAX,CAAkBiF,QAAlB,CAA2BrE,IAA3B,CAAgCuF,QAAhC,EAA0C;AAC1DtE,YAAMA,OAAOA,IAAP,GAAc;AAAEwD,YAAI,CAAC;AAAP,OADsC;AAE1DiB,YAAM/G,MAFoD;AAG1DgH,aAAO9G,KAHmD;AAI1DqC;AAJ0D,KAA1C,EAKd0E,KALc,EAAjB;AAOA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC2R,cADgC;AAEhCxI,aAAOwI,SAASvO,MAFgB;AAGhC6F,YAHgC;AAIhCmH,aAAO9Q,WAAWoK,MAAX,CAAkBiF,QAAlB,CAA2BrE,IAA3B,CAAgCuF,QAAhC,EAA0C1G,KAA1C;AAJyB,KAA1B,CAAP;AAMA;;AArBoE,CAAtE,E,CAuBA;;AACA7J,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,eAA3B,EAA4C;AAAEgD,gBAAc;AAAhB,CAA5C,EAAoE;AACnEjE,QAAM;AACL,UAAM;AAAEqM;AAAF,QAAY,KAAK2D,cAAL,EAAlB;AACA,UAAMC,WAAWvO,OAAO0K,MAAP,CAAc,EAAd,EAAkBC,KAAlB,EAAyB;AAAEqB,SAAG;AAAL,KAAzB,CAAjB;AAEA,UAAMH,OAAO7N,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBvI,OAAxB,CAAgCgL,QAAhC,CAAb;;AAEA,QAAI1C,QAAQ,IAAZ,EAAkB;AACjB,aAAO7N,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,uBAA1B,CAAP;AACA;;AAED,UAAMsR,SAAStS,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwBkI,mBAAxB,CAA4C;AAC1DrG,cAAQ;AACPzI,kBAAU;AADH;AADkD,KAA5C,EAIZmN,KAJY,EAAf;AAMA,UAAM4B,eAAe,EAArB;AACAF,WAAOxQ,OAAP,CAAgB0B,IAAD,IAAU;AACxB,YAAM2L,eAAenP,WAAWoK,MAAX,CAAkBoE,aAAlB,CAAgCC,wBAAhC,CAAyDZ,KAAKrI,GAA9D,EAAmEhC,KAAKgC,GAAxE,EAA6E;AAAE0G,gBAAQ;AAAE1G,eAAK;AAAP;AAAV,OAA7E,CAArB;;AACA,UAAI2J,YAAJ,EAAkB;AACjBqD,qBAAa/R,IAAb,CAAkB;AACjB+E,eAAKhC,KAAKgC,GADO;AAEjB/B,oBAAUD,KAAKC;AAFE,SAAlB;AAIA;AACD,KARD;AAUA,WAAOzD,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC4R,cAAQE;AADwB,KAA1B,CAAP;AAGA;;AA/BkE,CAApE;AAkCAxS,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,aAA3B,EAA0C;AAAEgD,gBAAc;AAAhB,CAA1C,EAAkE;AACjEC,SAAO;AACN,UAAM0J,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA,MAA7C;AAAqDgI,uBAAiB;AAAtE,KAA3B,CAAnB;;AAEA,QAAIQ,WAAWQ,IAAf,EAAqB;AACpB,aAAO1O,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA2B,sBAAsBkN,WAAW7N,IAAM,kCAAlE,CAAP;AACA;;AAED8E,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,UAAZ,EAAwB8I,WAAWqB,GAAnC;AACA,KAFD;AAIA,WAAOvP,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAbgE,CAAlE;AAgBAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,wBAA3B,EAAqD;AAAEgD,gBAAc;AAAhB,CAArD,EAA6E;AAC5EC,SAAO;AACN,UAAM0J,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA;AAA7C,KAA3B,CAAnB;AAEA,UAAMlC,OAAO,KAAK8K,iBAAL,EAAb;AAEAnJ,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,qBAAZ,EAAmC8I,WAAWqB,GAA9C,EAAmD/L,KAAKgC,GAAxD;AACA,KAFD;AAIA,WAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAX2E,CAA7E;AAcAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,oBAA3B,EAAiD;AAAEgD,gBAAc;AAAhB,CAAjD,EAAyE;AACxEC,SAAO;AACN,UAAM0J,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA;AAA7C,KAA3B,CAAnB;AAEA,UAAMlC,OAAO,KAAK8K,iBAAL,EAAb;AAEAnJ,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,iBAAZ,EAA+B8I,WAAWqB,GAA1C,EAA+C/L,KAAKgC,GAApD;AACA,KAFD;AAIA,WAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAXuE,CAAzE;AAcAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,qBAA3B,EAAkD;AAAEgD,gBAAc;AAAhB,CAAlD,EAA0E;AACzEC,SAAO;AACN,UAAM0J,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA;AAA7C,KAA3B,CAAnB;AAEA,UAAMlC,OAAO,KAAK8K,iBAAL,EAAb;AAEAnJ,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAWqB,GAA3C,EAAgD/L,KAAKgC,GAArD;AACA,KAFD;AAIA,WAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAXwE,CAA1E;AAcAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,eAA3B,EAA4C;AAAEgD,gBAAc;AAAhB,CAA5C,EAAoE;AACnEC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgBlD,IAAjB,IAAyB,CAAC,KAAKkD,UAAL,CAAgBlD,IAAhB,CAAqB8J,IAArB,EAA9B,EAA2D;AAC1D,aAAOnK,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,kCAA1B,CAAP;AACA;;AAED,UAAMkN,aAAaiK,2BAA2B;AAAElO,cAAQ;AAAE0D,gBAAQ,KAAKpK,UAAL,CAAgBoK;AAA1B,OAAV;AAA8CjI,cAAQ,KAAKA;AAA3D,KAA3B,CAAnB;AAEAP,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAWqB,GAA3C,EAAgD,UAAhD,EAA4D,KAAKhM,UAAL,CAAgBlD,IAA5E;AACA,KAFD;AAIA,WAAOL,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC4X,aAAOtY,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC4D,WAAWqB,GAA/C,EAAoD;AAAErD,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAApD;AADyB,KAA1B,CAAP;AAGA;;AAfkE,CAApE;AAkBAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,wBAA3B,EAAqD;AAAEgD,gBAAc;AAAhB,CAArD,EAA6E;AAC5EC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgB3D,YAAjB,IAAiC,EAAE,OAAO,KAAK2D,UAAL,CAAgB3D,YAAvB,KAAwC,QAA1C,CAArC,EAA0F;AACzF,aAAOI,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,mEAA1B,CAAP;AACA;;AAED,UAAMkN,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA;AAA7C,KAA3B,CAAnB;AAEAP,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAWqB,GAA3C,EAAgD,kBAAhD,EAAoE,KAAKhM,UAAL,CAAgB3D,YAApF;AACA,KAFD;AAIA,WAAOI,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC4X,aAAOtY,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC4D,WAAWqB,GAA/C,EAAoD;AAAErD,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAApD;AADyB,KAA1B,CAAP;AAGA;;AAf2E,CAA7E;AAkBAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,uBAA3B,EAAoD;AAAEgD,gBAAc;AAAhB,CAApD,EAA4E;AAC3EC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgBmP,WAAjB,IAAgC,CAAC,KAAKnP,UAAL,CAAgBmP,WAAhB,CAA4BvI,IAA5B,EAArC,EAAyE;AACxE,aAAOnK,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,yCAA1B,CAAP;AACA;;AAED,UAAMkN,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA;AAA7C,KAA3B,CAAnB;AAEAP,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAWqB,GAA3C,EAAgD,iBAAhD,EAAmE,KAAKhM,UAAL,CAAgBmP,WAAnF;AACA,KAFD;AAIA,WAAO1S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCgS,mBAAa,KAAKnP,UAAL,CAAgBmP;AADG,KAA1B,CAAP;AAGA;;AAf0E,CAA5E;AAkBA1S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,mBAA3B,EAAgD;AAAEgD,gBAAc;AAAhB,CAAhD,EAAwE;AACvEC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgBoP,OAAjB,IAA4B,CAAC,KAAKpP,UAAL,CAAgBoP,OAAhB,CAAwBxI,IAAxB,EAAjC,EAAiE;AAChE,aAAOnK,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,qCAA1B,CAAP;AACA;;AAED,UAAMkN,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA;AAA7C,KAA3B,CAAnB;AAEAP,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAWqB,GAA3C,EAAgD,iBAAhD,EAAmE,KAAKhM,UAAL,CAAgBoP,OAAnF;AACA,KAFD;AAIA,WAAO3S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCiS,eAAS,KAAKpP,UAAL,CAAgBoP;AADO,KAA1B,CAAP;AAGA;;AAfsE,CAAxE;AAkBA3S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,oBAA3B,EAAiD;AAAEgD,gBAAc;AAAhB,CAAjD,EAAyE;AACxEC,SAAO;AACN,QAAI,OAAO,KAAKjB,UAAL,CAAgBsM,QAAvB,KAAoC,WAAxC,EAAqD;AACpD,aAAO7P,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,sCAA1B,CAAP;AACA;;AAED,UAAMkN,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA;AAA7C,KAA3B,CAAnB;;AAEA,QAAIwI,WAAW0E,EAAX,KAAkB,KAAKrP,UAAL,CAAgBsM,QAAtC,EAAgD;AAC/C,aAAO7P,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,iFAA1B,CAAP;AACA;;AAEDmE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAWqB,GAA3C,EAAgD,UAAhD,EAA4D,KAAKhM,UAAL,CAAgBsM,QAA5E;AACA,KAFD;AAIA,WAAO7P,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC4X,aAAOtY,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC4D,WAAWqB,GAA/C,EAAoD;AAAErD,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAApD;AADyB,KAA1B,CAAP;AAGA;;AAnBuE,CAAzE;AAsBAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,iBAA3B,EAA8C;AAAEgD,gBAAc;AAAhB,CAA9C,EAAsE;AACrEC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgBsP,KAAjB,IAA0B,CAAC,KAAKtP,UAAL,CAAgBsP,KAAhB,CAAsB1I,IAAtB,EAA/B,EAA6D;AAC5D,aAAOnK,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,mCAA1B,CAAP;AACA;;AAED,UAAMkN,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA;AAA7C,KAA3B,CAAnB;AAEAP,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAWqB,GAA3C,EAAgD,WAAhD,EAA6D,KAAKhM,UAAL,CAAgBsP,KAA7E;AACA,KAFD;AAIA,WAAO7S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCmS,aAAO,KAAKtP,UAAL,CAAgBsP;AADS,KAA1B,CAAP;AAGA;;AAfoE,CAAtE;AAkBA7S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,gBAA3B,EAA6C;AAAEgD,gBAAc;AAAhB,CAA7C,EAAqE;AACpEC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgB2F,IAAjB,IAAyB,CAAC,KAAK3F,UAAL,CAAgB2F,IAAhB,CAAqBiB,IAArB,EAA9B,EAA2D;AAC1D,aAAOnK,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,kCAA1B,CAAP;AACA;;AAED,UAAMkN,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA;AAA7C,KAA3B,CAAnB;;AAEA,QAAIwI,WAAWF,CAAX,KAAiB,KAAKzK,UAAL,CAAgB2F,IAArC,EAA2C;AAC1C,aAAOlJ,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,oEAA1B,CAAP;AACA;;AAEDmE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAWqB,GAA3C,EAAgD,UAAhD,EAA4D,KAAKhM,UAAL,CAAgB2F,IAA5E;AACA,KAFD;AAIA,WAAOlJ,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC4X,aAAOtY,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoC4D,WAAWqB,GAA/C,EAAoD;AAAErD,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAApD;AADyB,KAA1B,CAAP;AAGA;;AAnBmE,CAArE;AAsBAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,wBAA3B,EAAqD;AAAEgD,gBAAc;AAAhB,CAArD,EAA6E;AAC5EC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgBuP,YAAjB,IAAiC,CAAC,KAAKvP,UAAL,CAAgBuP,YAAhB,CAA6B3I,IAA7B,EAAtC,EAA2E;AAC1E,aAAOnK,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,0CAA1B,CAAP;AACA;;AAED,UAAMkN,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA;AAA7C,KAA3B,CAAnB;AAEAP,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAWqB,GAA3C,EAAgD,kBAAhD,EAAoE,KAAKhM,UAAL,CAAgBuP,YAApF;AACA,KAFD;AAIA,WAAO9S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCoS,oBAAc,KAAKvP,UAAL,CAAgBuP;AADE,KAA1B,CAAP;AAGA;;AAf2E,CAA7E;AAkBA9S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,kBAA3B,EAA+C;AAAEgD,gBAAc;AAAhB,CAA/C,EAAuE;AACtEC,SAAO;AACN,UAAM0J,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA,MAA7C;AAAqDgI,uBAAiB;AAAtE,KAA3B,CAAnB;AAEAvI,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,eAAZ,EAA6B8I,WAAWqB,GAAxC;AACA,KAFD;AAIA,WAAOvP,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AATqE,CAAvE;AAYAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,cAA3B,EAA2C;AAAEgD,gBAAc;AAAhB,CAA3C,EAAmE;AAClEjE,QAAM;AACL,UAAM4N,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA;AAA7C,KAA3B,CAAnB;AAEA,UAAMjG,QAAQ0F,OAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,cAAZ,EAA4B8I,WAAWqB,GAAvC,CAApC,CAAd;AAEA,WAAOvP,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCjB;AADgC,KAA1B,CAAP;AAGA;;AATiE,CAAnE;AAYAO,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,mBAA3B,EAAgD;AAAEgD,gBAAc;AAAhB,CAAhD,EAAwE;AACvEjE,QAAM;AACL,UAAM4N,aAAaiK,2BAA2B;AAAElO,cAAQ,KAAKC,aAAL,EAAV;AAAgCxE,cAAQ,KAAKA;AAA7C,KAA3B,CAAnB;AAEA,UAAMuN,aAAajT,WAAWoK,MAAX,CAAkBoE,aAAlB,CAAgC0E,oBAAhC,CAAqDhF,WAAWqB,GAAhE,EAAqE,CAAC,WAAD,CAArE,EAAoF;AAAErD,cAAQ;AAAEkG,WAAG;AAAL;AAAV,KAApF,EAA0GxB,KAA1G,GAAkHC,GAAlH,CAAuHtC,GAAD,IAASA,IAAI6D,CAAnI,CAAnB;AAEA,WAAOpS,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCuS;AADgC,KAA1B,CAAP;AAGA;;AATsE,CAAxE,E;;;;;;;;;;;ACrwBA,SAAS0F,qBAAT,CAA+B1O,MAA/B,EAAuCzG,IAAvC,EAA6C;AAC5C,MAAI,CAAC,CAACyG,OAAO0D,MAAR,IAAkB,CAAC1D,OAAO0D,MAAP,CAAcxD,IAAd,EAApB,MAA8C,CAACF,OAAOxG,QAAR,IAAoB,CAACwG,OAAOxG,QAAP,CAAgB0G,IAAhB,EAAnE,CAAJ,EAAgG;AAC/F,UAAM,IAAIhF,OAAOqF,KAAX,CAAiB,+BAAjB,EAAkD,+CAAlD,CAAN;AACA;;AAED,QAAMqD,OAAO7N,WAAW4Y,iCAAX,CAA6C;AACzDC,mBAAerV,KAAKgC,GADqC;AAEzDsT,cAAU7O,OAAOxG,QAAP,IAAmBwG,OAAO0D,MAFqB;AAGzDzE,UAAM;AAHmD,GAA7C,CAAb;;AAMA,MAAI,CAAC2E,IAAD,IAASA,KAAKG,CAAL,KAAW,GAAxB,EAA6B;AAC5B,UAAM,IAAI7I,OAAOqF,KAAX,CAAiB,sBAAjB,EAAyC,qFAAzC,CAAN;AACA;;AAED,QAAM2E,eAAenP,WAAWoK,MAAX,CAAkBoE,aAAlB,CAAgCC,wBAAhC,CAAyDZ,KAAKrI,GAA9D,EAAmEhC,KAAKgC,GAAxE,CAArB;AAEA,SAAO;AACNqI,QADM;AAENsB;AAFM,GAAP;AAIA;;AAEDnP,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,CAAC,WAAD,EAAc,WAAd,CAA3B,EAAuD;AAAEgD,gBAAc;AAAhB,CAAvD,EAA+E;AAC9EC,SAAO;AACN,UAAM0J,aAAayK,sBAAsB,KAAKzO,aAAL,EAAtB,EAA4C,KAAK1G,IAAjD,CAAnB;AAEA,WAAOxD,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCmN,YAAMK,WAAWL;AADe,KAA1B,CAAP;AAGA;;AAP6E,CAA/E;AAUA7N,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,CAAC,UAAD,EAAa,UAAb,CAA3B,EAAqD;AAAEgD,gBAAc;AAAhB,CAArD,EAA6E;AAC5EC,SAAO;AACN,UAAM0J,aAAayK,sBAAsB,KAAKzO,aAAL,EAAtB,EAA4C,KAAK1G,IAAjD,CAAnB;;AAEA,QAAI,CAAC0K,WAAWiB,YAAX,CAAwBT,IAA7B,EAAmC;AAClC,aAAO1O,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA2B,4BAA4B,KAAKuC,UAAL,CAAgBlD,IAAM,mCAA7E,CAAP;AACA;;AAED8E,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,UAAZ,EAAwB8I,WAAWL,IAAX,CAAgBrI,GAAxC;AACA,KAFD;AAIA,WAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAb2E,CAA7E;AAgBAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,CAAC,aAAD,EAAgB,aAAhB,CAA3B,EAA2D;AAAEgD,gBAAc;AAAhB,CAA3D,EAAmF;AAClFjE,QAAM;AACL,UAAMqO,SAAS3O,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,0BAA5C,CAAf;AACA,UAAMqT,UAAU,KAAK7O,aAAL,GAAqBxE,MAArC;AACA,QAAIlC,OAAO,KAAKkC,MAAhB;AACA,QAAIkJ,UAAU,IAAd;AACA,QAAIC,eAAe,IAAnB;AACA,QAAIC,cAAc,IAAlB;AACA,QAAIC,SAAS,KAAb;AACA,QAAIC,OAAO,IAAX;AACA,QAAIC,SAAS,IAAb;AACA,QAAIpQ,UAAU,IAAd;AACA,QAAIuQ,KAAK,IAAT;;AAEA,QAAI2J,OAAJ,EAAa;AACZ,UAAI,CAACpK,MAAL,EAAa;AACZ,eAAO3O,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AACDkC,aAAOuV,OAAP;AACA;;AACD,UAAMC,KAAKL,sBAAsB,KAAKzO,aAAL,EAAtB,EAA4C;AAAE1E,WAAKhC;AAAP,KAA5C,CAAX;AACA,UAAM;AAAEqK;AAAF,QAAWmL,EAAjB;AACA,UAAMC,KAAKD,GAAG7J,YAAd;AACAC,SAAKvB,KAAKuB,EAAL,GAAUvB,KAAKuB,EAAf,GAAoBvB,KAAKlO,UAA9B;;AAEA,QAAI,OAAOsZ,EAAP,KAAc,WAAd,IAA6BA,GAAGvK,IAApC,EAA0C;AACzC,UAAIuK,GAAGzJ,EAAH,IAAS3B,KAAKmB,IAAlB,EAAwB;AACvBJ,kBAAUqK,GAAGC,MAAb;AACApK,sBAAcmK,GAAGzJ,EAAjB;AACA;;AACDX,qBAAeoK,GAAGpK,YAAlB;AACAE,eAAS,IAAT;AACA;;AAED,QAAIJ,UAAUI,MAAd,EAAsB;AACrBC,aAAOnB,KAAKmB,IAAZ;AACAC,eAASG,EAAT;AACAvQ,gBAAUgP,KAAK6B,UAAf;AACA;;AAED,WAAO1P,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCqO,YADgC;AAEhClQ,aAFgC;AAGhC+P,aAHgC;AAIhCE,iBAJgC;AAKhCE,UALgC;AAMhCC,YANgC;AAOhCJ;AAPgC,KAA1B,CAAP;AASA;;AAjDiF,CAAnF;AAoDA7O,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,CAAC,UAAD,EAAa,UAAb,CAA3B,EAAqD;AAAEgD,gBAAc;AAAhB,CAArD,EAA6E;AAC5EjE,QAAM;AACL,UAAM4N,aAAayK,sBAAsB,KAAKzO,aAAL,EAAtB,EAA4C,KAAK1G,IAAjD,CAAnB;;AACA,UAAM0M,6BAA8BC,IAAD,IAAU;AAC5C,UAAIA,KAAKzK,MAAT,EAAiB;AAChByK,eAAO,KAAKC,gBAAL,CAAsB;AAAEhD,kBAAQ+C,IAAV;AAAgBzK,kBAAQyK,KAAKzK;AAA7B,SAAtB,CAAP;AACA;;AACD,aAAOyK,IAAP;AACA,KALD;;AAOA,UAAM;AAAExG,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,UAAF;AAAQC,YAAR;AAAgBS;AAAhB,QAA0B,KAAK2D,cAAL,EAAhC;AAEA,UAAMC,WAAWvO,OAAO0K,MAAP,CAAc,EAAd,EAAkBC,KAAlB,EAAyB;AAAE4C,WAAKrB,WAAWL,IAAX,CAAgBrI;AAAvB,KAAzB,CAAjB;AAEA,UAAMgL,QAAQxQ,WAAWoK,MAAX,CAAkBqG,OAAlB,CAA0BzF,IAA1B,CAA+BuF,QAA/B,EAAyC;AACtDtE,YAAMA,OAAOA,IAAP,GAAc;AAAE5L,cAAM;AAAR,OADkC;AAEtDqQ,YAAM/G,MAFgD;AAGtDgH,aAAO9G,KAH+C;AAItDqC;AAJsD,KAAzC,EAKX0E,KALW,EAAd;AAOA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC8P,aAAOA,MAAMK,GAAN,CAAUX,0BAAV,CADyB;AAEhCrG,aAAO2G,MAAM1M,MAFmB;AAGhC6F,YAHgC;AAIhCmH,aAAO9Q,WAAWoK,MAAX,CAAkBqG,OAAlB,CAA0BzF,IAA1B,CAA+BuF,QAA/B,EAAyC1G,KAAzC;AAJyB,KAA1B,CAAP;AAMA;;AA5B2E,CAA7E;AA+BA7J,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,CAAC,YAAD,EAAe,YAAf,CAA3B,EAAyD;AAAEgD,gBAAc;AAAhB,CAAzD,EAAiF;AAChFjE,QAAM;AACL,UAAM4N,aAAayK,sBAAsB,KAAKzO,aAAL,EAAtB,EAA4C,KAAK1G,IAAjD,CAAnB;AAEA,QAAI4N,aAAa,IAAIC,IAAJ,EAAjB;;AACA,QAAI,KAAK9H,WAAL,CAAiB0F,MAArB,EAA6B;AAC5BmC,mBAAa,IAAIC,IAAJ,CAAS,KAAK9H,WAAL,CAAiB0F,MAA1B,CAAb;AACA;;AAED,QAAIqC,aAAa7J,SAAjB;;AACA,QAAI,KAAK8B,WAAL,CAAiBgI,MAArB,EAA6B;AAC5BD,mBAAa,IAAID,IAAJ,CAAS,KAAK9H,WAAL,CAAiBgI,MAA1B,CAAb;AACA;;AAED,UAAMC,YAAY,KAAKjI,WAAL,CAAiBiI,SAAjB,IAA8B,KAAhD;AAEA,QAAI3H,QAAQ,EAAZ;;AACA,QAAI,KAAKN,WAAL,CAAiBM,KAArB,EAA4B;AAC3BA,cAAQD,SAAS,KAAKL,WAAL,CAAiBM,KAA1B,CAAR;AACA;;AAED,UAAM+E,UAAU,KAAKrF,WAAL,CAAiBqF,OAAjB,IAA4B,KAA5C;AAEA,QAAIjO,MAAJ;AACAwE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnC/E,eAASwE,OAAOC,IAAP,CAAY,mBAAZ,EAAiC;AACzCmK,aAAKrB,WAAWL,IAAX,CAAgBrI,GADoB;AAEzCyJ,gBAAQmC,UAFiC;AAGzCG,gBAAQD,UAHiC;AAIzCE,iBAJyC;AAKzC3H,aALyC;AAMzC+E;AANyC,OAAjC,CAAT;AAQA,KATD;;AAWA,QAAI,CAACjO,MAAL,EAAa;AACZ,aAAOX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AAED,WAAOtB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0BC,MAA1B,CAAP;AACA;;AAxC+E,CAAjF;AA2CAX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,CAAC,YAAD,EAAe,YAAf,CAA3B,EAAyD;AAAEgD,gBAAc;AAAhB,CAAzD,EAAiF;AAChFjE,QAAM;AACL,UAAM4N,aAAayK,sBAAsB,KAAKzO,aAAL,EAAtB,EAA4C,KAAK1G,IAAjD,CAAnB;AAEA,UAAM;AAAEmG,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE;AAAF,QAAW,KAAKqE,cAAL,EAAjB;AACA,UAAMuB,SAAS7R,WAAWoK,MAAX,CAAkBoE,aAAlB,CAAgC2D,YAAhC,CAA6CjE,WAAWL,IAAX,CAAgBrI,GAA7D,EAAkE;AAChFyG,YAAM;AAAE,sBAAeA,QAAQA,KAAKxI,QAAb,GAAwBwI,KAAKxI,QAA7B,GAAwC;AAAzD,OAD0E;AAEhFiN,YAAM/G,MAF0E;AAGhFgH,aAAO9G;AAHyE,KAAlE,CAAf;AAMA,UAAMiH,QAAQe,OAAOhI,KAAP,EAAd;AACA,UAAMhL,UAAUgT,OAAOjB,KAAP,GAAeC,GAAf,CAAoBe,CAAD,IAAOA,EAAEQ,CAAF,IAAOR,EAAEQ,CAAF,CAAI3O,QAArC,CAAhB;AAEA,UAAM6B,QAAQtF,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwBW,IAAxB,CAA6B;AAAEvH,gBAAU;AAAEuN,aAAKnS;AAAP;AAAZ,KAA7B,EAA6D;AAC1EqN,cAAQ;AAAE1G,aAAK,CAAP;AAAU/B,kBAAU,CAApB;AAAuBpD,cAAM,CAA7B;AAAgC8C,gBAAQ,CAAxC;AAA2CuH,mBAAW;AAAtD,OADkE;AAE1EuB,YAAM;AAAExI,kBAAWwI,QAAQA,KAAKxI,QAAb,GAAwBwI,KAAKxI,QAA7B,GAAwC;AAArD;AAFoE,KAA7D,EAGXmN,KAHW,EAAd;AAKA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC7B,eAASyG,KADuB;AAEhCuE,aAAOhL,QAAQiF,MAFiB;AAGhC6F,YAHgC;AAIhCmH;AAJgC,KAA1B,CAAP;AAMA;;AA1B+E,CAAjF;AA6BA9Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,CAAC,aAAD,EAAgB,aAAhB,CAA3B,EAA2D;AAAEgD,gBAAc;AAAhB,CAA3D,EAAmF;AAClFjE,QAAM;AACL,UAAM4N,aAAayK,sBAAsB,KAAKzO,aAAL,EAAtB,EAA4C,KAAK1G,IAAjD,CAAnB;AAEA,UAAM;AAAEmG,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,UAAF;AAAQC,YAAR;AAAgBS;AAAhB,QAA0B,KAAK2D,cAAL,EAAhC;AAEA,UAAMC,WAAWvO,OAAO0K,MAAP,CAAc,EAAd,EAAkBC,KAAlB,EAAyB;AAAE4C,WAAKrB,WAAWL,IAAX,CAAgBrI;AAAvB,KAAzB,CAAjB;AAEA,UAAM6M,WAAWrS,WAAWoK,MAAX,CAAkBiF,QAAlB,CAA2BrE,IAA3B,CAAgCuF,QAAhC,EAA0C;AAC1DtE,YAAMA,OAAOA,IAAP,GAAc;AAAEwD,YAAI,CAAC;AAAP,OADsC;AAE1DiB,YAAM/G,MAFoD;AAG1DgH,aAAO9G,KAHmD;AAI1DqC;AAJ0D,KAA1C,EAKd0E,KALc,EAAjB;AAOA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC2R,cADgC;AAEhCxI,aAAOwI,SAASvO,MAFgB;AAGhC6F,YAHgC;AAIhCmH,aAAO9Q,WAAWoK,MAAX,CAAkBiF,QAAlB,CAA2BrE,IAA3B,CAAgCuF,QAAhC,EAA0C1G,KAA1C;AAJyB,KAA1B,CAAP;AAMA;;AAtBiF,CAAnF;AAyBA7J,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,CAAC,oBAAD,EAAuB,oBAAvB,CAA3B,EAAyE;AAAEgD,gBAAc;AAAhB,CAAzE,EAAiG;AAChGjE,QAAM;AACL,QAAIN,WAAWH,QAAX,CAAoBS,GAApB,CAAwB,4CAAxB,MAA0E,IAA9E,EAAoF;AACnF,YAAM,IAAI6E,OAAOqF,KAAX,CAAiB,yBAAjB,EAA4C,2BAA5C,EAAyE;AAAEzI,eAAO;AAAT,OAAzE,CAAN;AACA;;AAED,QAAI,CAAC/B,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,0BAA5C,CAAL,EAA8E;AAC7E,aAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AAED,UAAM;AAAEqM;AAAF,QAAa,KAAKpE,WAAxB;;AACA,QAAI,CAACoE,MAAD,IAAW,CAACA,OAAOxD,IAAP,EAAhB,EAA+B;AAC9B,YAAM,IAAIhF,OAAOqF,KAAX,CAAiB,iCAAjB,EAAoD,oCAApD,CAAN;AACA;;AAED,UAAMqD,OAAO7N,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBxD,WAAxB,CAAoCqD,MAApC,CAAb;;AACA,QAAI,CAACE,IAAD,IAASA,KAAKG,CAAL,KAAW,GAAxB,EAA6B;AAC5B,YAAM,IAAI7I,OAAOqF,KAAX,CAAiB,sBAAjB,EAA0C,8CAA8CmD,MAAQ,EAAhG,CAAN;AACA;;AAED,UAAM;AAAEhE,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,UAAF;AAAQC,YAAR;AAAgBS;AAAhB,QAA0B,KAAK2D,cAAL,EAAhC;AACA,UAAMC,WAAWvO,OAAO0K,MAAP,CAAc,EAAd,EAAkBC,KAAlB,EAAyB;AAAE4C,WAAK1B,KAAKrI;AAAZ,KAAzB,CAAjB;AAEA,UAAMwJ,OAAOhP,WAAWoK,MAAX,CAAkBiF,QAAlB,CAA2BrE,IAA3B,CAAgCuF,QAAhC,EAA0C;AACtDtE,YAAMA,OAAOA,IAAP,GAAc;AAAEwD,YAAI,CAAC;AAAP,OADkC;AAEtDiB,YAAM/G,MAFgD;AAGtDgH,aAAO9G,KAH+C;AAItDqC;AAJsD,KAA1C,EAKV0E,KALU,EAAb;AAOA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC2R,gBAAUrD,IADsB;AAEhCrF,YAFgC;AAGhCE,aAAOmF,KAAKlL,MAHoB;AAIhCgN,aAAO9Q,WAAWoK,MAAX,CAAkBiF,QAAlB,CAA2BrE,IAA3B,CAAgCuF,QAAhC,EAA0C1G,KAA1C;AAJyB,KAA1B,CAAP;AAMA;;AArC+F,CAAjG;AAwCA7J,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,CAAC,SAAD,EAAY,SAAZ,CAA3B,EAAmD;AAAEgD,gBAAc;AAAhB,CAAnD,EAA2E;AAC1EjE,QAAM;AACL,UAAM;AAAEqJ,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,aAAO;AAAE5L,cAAM;AAAR,OAAT;AAAsB6L;AAAtB,QAAiC,KAAKoE,cAAL,EAAvC,CAFK,CAIL;;AAEA,UAAMuB,SAAS7R,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwBiE,+BAAxB,CAAwD,GAAxD,EAA6D,KAAKrM,MAAlE,EAA0E;AACxFuG,UADwF;AAExFyE,YAAM/G,MAFkF;AAGxFgH,aAAO9G,KAHiF;AAIxFqC;AAJwF,KAA1E,CAAf;AAOA,UAAM4E,QAAQe,OAAOhI,KAAP,EAAd;AACA,UAAMiI,QAAQD,OAAOjB,KAAP,EAAd;AAEA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCyY,WAAKrH,KAD2B;AAEhCnI,YAFgC;AAGhCE,aAAOiI,MAAMhO,MAHmB;AAIhCgN;AAJgC,KAA1B,CAAP;AAMA;;AAvByE,CAA3E;AA0BA9Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,CAAC,kBAAD,EAAqB,kBAArB,CAA3B,EAAqE;AAAEgD,gBAAc;AAAhB,CAArE,EAA6F;AAC5FjE,QAAM;AACL,QAAI,CAACN,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,0BAA5C,CAAL,EAA8E;AAC7E,aAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AAED,UAAM;AAAEqI,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,UAAF;AAAQC,YAAR;AAAgBS;AAAhB,QAA0B,KAAK2D,cAAL,EAAhC;AAEA,UAAMC,WAAWvO,OAAO0K,MAAP,CAAc,EAAd,EAAkBC,KAAlB,EAAyB;AAAEqB,SAAG;AAAL,KAAzB,CAAjB;AAEA,UAAM8D,QAAQ9R,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwB9C,IAAxB,CAA6BuF,QAA7B,EAAuC;AACpDtE,YAAMA,OAAOA,IAAP,GAAc;AAAE5L,cAAM;AAAR,OADgC;AAEpDqQ,YAAM/G,MAF8C;AAGpDgH,aAAO9G,KAH6C;AAIpDqC;AAJoD,KAAvC,EAKX0E,KALW,EAAd;AAOA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCyY,WAAKrH,KAD2B;AAEhCnI,YAFgC;AAGhCE,aAAOiI,MAAMhO,MAHmB;AAIhCgN,aAAO9Q,WAAWoK,MAAX,CAAkB0D,KAAlB,CAAwB9C,IAAxB,CAA6BuF,QAA7B,EAAuC1G,KAAvC;AAJyB,KAA1B,CAAP;AAMA;;AAxB2F,CAA7F;AA2BA7J,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,CAAC,SAAD,EAAY,SAAZ,CAA3B,EAAmD;AAAEgD,gBAAc;AAAhB,CAAnD,EAA2E;AAC1EC,SAAO;AACN,UAAM0J,aAAayK,sBAAsB,KAAKzO,aAAL,EAAtB,EAA4C,KAAK1G,IAAjD,CAAnB;;AAEA,QAAI,CAAC0K,WAAWiB,YAAX,CAAwBT,IAA7B,EAAmC;AAClCvJ,aAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,eAAOC,IAAP,CAAY,UAAZ,EAAwB8I,WAAWL,IAAX,CAAgBrI,GAAxC;AACA,OAFD;AAGA;;AAED,WAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAXyE,CAA3E;AAcAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,CAAC,aAAD,EAAgB,aAAhB,CAA3B,EAA2D;AAAEgD,gBAAc;AAAhB,CAA3D,EAAmF;AAClFC,SAAO;AACN,QAAI,CAAC,KAAKjB,UAAL,CAAgBsP,KAAjB,IAA0B,CAAC,KAAKtP,UAAL,CAAgBsP,KAAhB,CAAsB1I,IAAtB,EAA/B,EAA6D;AAC5D,aAAOnK,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,mCAA1B,CAAP;AACA;;AAED,UAAMkN,aAAayK,sBAAsB,KAAKzO,aAAL,EAAtB,EAA4C,KAAK1G,IAAjD,CAAnB;AAEA2B,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,kBAAZ,EAAgC8I,WAAWL,IAAX,CAAgBrI,GAAhD,EAAqD,WAArD,EAAkE,KAAKjC,UAAL,CAAgBsP,KAAlF;AACA,KAFD;AAIA,WAAO7S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCmS,aAAO,KAAKtP,UAAL,CAAgBsP;AADS,KAA1B,CAAP;AAGA;;AAfiF,CAAnF,E;;;;;;;;;;;AChVA7S,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,qBAA3B,EAAkD;AAAEgD,gBAAc;AAAhB,CAAlD,EAA0E;AACzEC,SAAO;AACN4O,UAAM,KAAK7P,UAAX,EAAuBgQ,MAAM0C,eAAN,CAAsB;AAC5C/M,YAAMmK,MADsC;AAE5ChT,YAAMgT,MAFsC;AAG5C+F,eAAShD,OAHmC;AAI5C3S,gBAAU4P,MAJkC;AAK5CgG,YAAM9F,MAAMC,KAAN,CAAY,CAACH,MAAD,CAAZ,CALsC;AAM5ChF,eAASgF,MANmC;AAO5CiG,aAAO/F,MAAMC,KAAN,CAAYH,MAAZ,CAPqC;AAQ5CkG,oBAAchG,MAAMC,KAAN,CAAY,CAACH,MAAD,CAAZ,CAR8B;AAS5CmG,aAAOjG,MAAMC,KAAN,CAAYH,MAAZ,CATqC;AAU5CoG,cAAQlG,MAAMC,KAAN,CAAYH,MAAZ,CAVoC;AAW5C0D,aAAOxD,MAAMC,KAAN,CAAYH,MAAZ,CAXqC;AAY5CvN,aAAOyN,MAAMC,KAAN,CAAYH,MAAZ,CAZqC;AAa5CqG,qBAAetD,OAb6B;AAc5CuD,cAAQpG,MAAMC,KAAN,CAAYH,MAAZ,CAdoC;AAe5CuG,qBAAerG,MAAMC,KAAN,CAAYH,MAAZ;AAf6B,KAAtB,CAAvB;AAkBA,QAAIwG,WAAJ;;AAEA,YAAQ,KAAKtW,UAAL,CAAgB2F,IAAxB;AACC,WAAK,kBAAL;AACC/D,eAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCmU,wBAAc1U,OAAOC,IAAP,CAAY,wBAAZ,EAAsC,KAAK7B,UAA3C,CAAd;AACA,SAFD;AAGA;;AACD,WAAK,kBAAL;AACC4B,eAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCmU,wBAAc1U,OAAOC,IAAP,CAAY,wBAAZ,EAAsC,KAAK7B,UAA3C,CAAd;AACA,SAFD;AAGA;;AACD;AACC,eAAOvD,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,2BAA1B,CAAP;AAZF;;AAeA,WAAOhB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAAEmZ;AAAF,KAA1B,CAAP;AACA;;AAtCwE,CAA1E;AAyCA7Z,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,sBAA3B,EAAmD;AAAEgD,gBAAc;AAAhB,CAAnD,EAA2E;AAC1EjE,QAAM;AACL,QAAI,CAACN,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,qBAA5C,CAAL,EAAyE;AACxE,aAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AAED,QAAI,CAAC,KAAKiI,WAAL,CAAiB9D,EAAlB,IAAwB,KAAK8D,WAAL,CAAiB9D,EAAjB,CAAoB0E,IAApB,OAA+B,EAA3D,EAA+D;AAC9D,aAAOnK,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,yBAA1B,CAAP;AACA;;AAED,UAAM;AAAEyE;AAAF,QAAS,KAAK8D,WAApB;AACA,UAAM;AAAEI,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,UAAF;AAAQC,YAAR;AAAgBS;AAAhB,QAA0B,KAAK2D,cAAL,EAAhC;AAEA,UAAMC,WAAWvO,OAAO0K,MAAP,CAAc,EAAd,EAAkBC,KAAlB,EAAyB;AAAE,yBAAmBlH;AAArB,KAAzB,CAAjB;AACA,UAAMqU,UAAU9Z,WAAWoK,MAAX,CAAkB2P,kBAAlB,CAAqC/O,IAArC,CAA0CuF,QAA1C,EAAoD;AACnEtE,YAAMA,OAAOA,IAAP,GAAc;AAAEtM,oBAAY,CAAC;AAAf,OAD+C;AAEnE+Q,YAAM/G,MAF6D;AAGnEgH,aAAO9G,KAH4D;AAInEqC;AAJmE,KAApD,EAKb0E,KALa,EAAhB;AAOA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCoZ,aADgC;AAEhCnQ,YAFgC;AAGhCqQ,aAAOF,QAAQhW,MAHiB;AAIhCgN,aAAO9Q,WAAWoK,MAAX,CAAkB2P,kBAAlB,CAAqC/O,IAArC,CAA0CuF,QAA1C,EAAoD1G,KAApD;AAJyB,KAA1B,CAAP;AAMA;;AA5ByE,CAA3E;AA+BA7J,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,mBAA3B,EAAgD;AAAEgD,gBAAc;AAAhB,CAAhD,EAAwE;AACvEjE,QAAM;AACL,QAAI,CAACN,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,qBAA5C,CAAL,EAAyE;AACxE,aAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AAED,UAAM;AAAEqI,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,UAAF;AAAQC,YAAR;AAAgBS;AAAhB,QAA0B,KAAK2D,cAAL,EAAhC;AAEA,UAAMC,WAAWvO,OAAO0K,MAAP,CAAc,EAAd,EAAkBC,KAAlB,CAAjB;AACA,UAAMsE,eAAejR,WAAWoK,MAAX,CAAkB8G,YAAlB,CAA+BlG,IAA/B,CAAoCuF,QAApC,EAA8C;AAClEtE,YAAMA,OAAOA,IAAP,GAAc;AAAEwD,YAAI,CAAC;AAAP,OAD8C;AAElEiB,YAAM/G,MAF4D;AAGlEgH,aAAO9G,KAH2D;AAIlEqC;AAJkE,KAA9C,EAKlB0E,KALkB,EAArB;AAOA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCuQ,kBADgC;AAEhCtH,YAFgC;AAGhCqQ,aAAO/I,aAAanN,MAHY;AAIhCgN,aAAO9Q,WAAWoK,MAAX,CAAkB8G,YAAlB,CAA+BlG,IAA/B,CAAoCuF,QAApC,EAA8C1G,KAA9C;AAJyB,KAA1B,CAAP;AAMA;;AAvBsE,CAAxE;AA0BA7J,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,qBAA3B,EAAkD;AAAEgD,gBAAc;AAAhB,CAAlD,EAA0E;AACzEC,SAAO;AACN4O,UAAM,KAAK7P,UAAX,EAAuBgQ,MAAM0C,eAAN,CAAsB;AAC5C/M,YAAMmK,MADsC;AAE5C4G,kBAAY1G,MAAMC,KAAN,CAAYH,MAAZ,CAFgC;AAG5C6G,qBAAe3G,MAAMC,KAAN,CAAYH,MAAZ;AAH6B,KAAtB,CAAvB;;AAMA,QAAI,CAAC,KAAK9P,UAAL,CAAgB0W,UAAjB,IAA+B,CAAC,KAAK1W,UAAL,CAAgB2W,aAApD,EAAmE;AAClE,aAAOla,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,sDAA1B,CAAP;AACA;;AAED,QAAI6Y,WAAJ;;AACA,YAAQ,KAAKtW,UAAL,CAAgB2F,IAAxB;AACC,WAAK,kBAAL;AACC,YAAI,KAAK3F,UAAL,CAAgB0W,UAApB,EAAgC;AAC/BJ,wBAAc7Z,WAAWoK,MAAX,CAAkB8G,YAAlB,CAA+B3L,OAA/B,CAAuC;AAAE8T,kBAAM,KAAK9V,UAAL,CAAgB0W;AAAxB,WAAvC,CAAd;AACA,SAFD,MAEO,IAAI,KAAK1W,UAAL,CAAgB2W,aAApB,EAAmC;AACzCL,wBAAc7Z,WAAWoK,MAAX,CAAkB8G,YAAlB,CAA+B3L,OAA/B,CAAuC;AAAEC,iBAAK,KAAKjC,UAAL,CAAgB2W;AAAvB,WAAvC,CAAd;AACA;;AAED,YAAI,CAACL,WAAL,EAAkB;AACjB,iBAAO7Z,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,uBAA1B,CAAP;AACA;;AAEDmE,eAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,iBAAOC,IAAP,CAAY,2BAAZ,EAAyCyU,YAAYrU,GAArD;AACA,SAFD;AAIA,eAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCmZ;AADgC,SAA1B,CAAP;;AAGD,WAAK,kBAAL;AACCA,sBAAc7Z,WAAWoK,MAAX,CAAkB8G,YAAlB,CAA+B3L,OAA/B,CAAuC;AAAEC,eAAK,KAAKjC,UAAL,CAAgB2W;AAAvB,SAAvC,CAAd;;AAEA,YAAI,CAACL,WAAL,EAAkB;AACjB,iBAAO7Z,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,uBAA1B,CAAP;AACA;;AAEDmE,eAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,iBAAOC,IAAP,CAAY,2BAAZ,EAAyCyU,YAAYrU,GAArD;AACA,SAFD;AAIA,eAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCmZ;AADgC,SAA1B,CAAP;;AAGD;AACC,eAAO7Z,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,2BAA1B,CAAP;AAlCF;AAoCA;;AAjDwE,CAA1E,E;;;;;;;;;;;ACjGAhB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,MAA3B,EAAmC;AAAEgD,gBAAc;AAAhB,CAAnC,EAA4D;AAC3DjE,QAAM;AACL,UAAMkD,OAAO,KAAK6J,eAAL,EAAb;;AAEA,QAAI7J,QAAQxD,WAAWqM,KAAX,CAAiBiB,OAAjB,CAAyB9J,KAAKgC,GAA9B,EAAmC,OAAnC,CAAZ,EAAyD;AACxD,aAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC6M,cAAMvN,WAAWwN;AADe,OAA1B,CAAP;AAGA;;AAED,WAAOxN,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC6M,YAAM;AACL3L,iBAAS5B,WAAWwN,IAAX,CAAgB5L;AADpB;AAD0B,KAA1B,CAAP;AAKA;;AAf0D,CAA5D;AAkBA5B,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,IAA3B,EAAiC;AAAEgD,gBAAc;AAAhB,CAAjC,EAAyD;AACxDjE,QAAM;AACL,WAAON,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B,KAAKgE,WAAL,CAAiB1E,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwBC,WAAxB,CAAoC,KAAK5E,MAAzC,CAAjB,CAA1B,CAAP;AACA;;AAHuD,CAAzD;AAMA,IAAIyU,cAAc,CAAlB;AACA,IAAIC,kBAAkB,CAAtB;AACA,MAAMC,eAAe,KAArB,C,CAA4B;;AAC5Bra,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,YAA3B,EAAyC;AAAEgD,gBAAc;AAAhB,CAAzC,EAAkE;AACjEjE,QAAM;AACL,UAAM;AAAE4I,UAAF;AAAQmF,aAAR;AAAiBhO,UAAjB;AAAuBia;AAAvB,QAAgC,KAAK/Q,WAA3C;;AACA,QAAI,CAACvJ,WAAWH,QAAX,CAAoBS,GAApB,CAAwB,oBAAxB,CAAL,EAAoD;AACnD,YAAM,IAAI6E,OAAOqF,KAAX,CAAiB,yBAAjB,EAA4C,2BAA5C,EAAyE;AAAEzI,eAAO;AAAT,OAAzE,CAAN;AACA;;AAED,UAAMwY,QAAQva,WAAWH,QAAX,CAAoBS,GAApB,CAAwB,kBAAxB,CAAd;;AACA,QAAI4I,QAASqR,UAAU,GAAV,IAAiB,CAACA,MAAM9N,KAAN,CAAY,GAAZ,EAAiBoE,GAAjB,CAAsB7C,CAAD,IAAOA,EAAE7D,IAAF,EAA5B,EAAsCnG,QAAtC,CAA+CkF,IAA/C,CAA/B,EAAsF;AACrF,YAAM,IAAI/D,OAAOqF,KAAX,CAAiB,uBAAjB,EAA0C,8BAA1C,EAA0E;AAAEzI,eAAO;AAAT,OAA1E,CAAN;AACA;;AAED,UAAMyY,WAAWF,SAAS,OAA1B;;AACA,QAAIE,aAAa,CAACna,IAAD,IAAS,CAACA,KAAK8J,IAAL,EAAvB,CAAJ,EAAyC;AACxC,aAAOnK,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,0CAA1B,CAAP;AACA;;AAED,QAAI8V,IAAJ;AACA,QAAI2D,kBAAkB,MAAtB;;AACA,YAAQvR,IAAR;AACC,WAAK,QAAL;AACC,YAAImI,KAAKgF,GAAL,KAAa+D,eAAb,GAA+BC,YAAnC,EAAiD;AAChDF,wBAAcna,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwBkI,mBAAxB,GAA8C1I,KAA9C,EAAd;AACAuQ,4BAAkB/I,KAAKgF,GAAL,EAAlB;AACA;;AAEDS,eAAQ,GAAGqD,WAAa,IAAIO,QAAQC,EAAR,CAAW,QAAX,CAAsB,EAAlD;AACA;;AACD,WAAK,SAAL;AACC,YAAI,CAACtM,OAAL,EAAc;AACb,iBAAOrO,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,+CAA1B,CAAP;AACA;;AAED8V,eAAQ,IAAIzI,OAAS,EAArB;AACA;;AACD,WAAK,MAAL;AACC,cAAM7K,OAAO,KAAK8K,iBAAL,EAAb,CADD,CAGC;;AACA,YAAI9K,KAAKnD,IAAL,IAAaL,WAAWH,QAAX,CAAoBS,GAApB,CAAwB,kBAAxB,CAAjB,EAA8D;AAC7DwW,iBAAQ,GAAGtT,KAAKnD,IAAM,EAAtB;AACA,SAFD,MAEO;AACNyW,iBAAQ,IAAItT,KAAKC,QAAU,EAA3B;AACA;;AAED,gBAAQD,KAAKL,MAAb;AACC,eAAK,QAAL;AACCsX,8BAAkB,SAAlB;AACA;;AACD,eAAK,MAAL;AACCA,8BAAkB,SAAlB;AACA;;AACD,eAAK,MAAL;AACCA,8BAAkB,SAAlB;AACA;;AACD,eAAK,SAAL;AACCA,8BAAkB,SAAlB;AAXF;;AAaA;;AACD;AACC3D,eAAO4D,QAAQC,EAAR,CAAW,WAAX,EAAwB9X,WAAxB,EAAP;AAzCF;;AA4CA,UAAM+X,WAAWJ,WAAW,CAAX,GAAe,EAAhC;AACA,UAAMK,WAAWxa,OAAOA,KAAKyD,MAAL,GAAc,CAAd,GAAkB,CAAlB,GAAsB8W,QAA7B,GAAwCA,QAAzD;AACA,UAAME,YAAYhE,KAAKhT,MAAL,GAAc,CAAd,GAAkB,EAApC;AACA,UAAMiX,QAAQF,WAAWC,SAAzB;AACA,UAAME,SAAS,EAAf;AACA,WAAO;AACNrY,eAAS;AAAE,wBAAgB;AAAlB,OADH;AAEN7B,YAAO;gGACuFia,KAAO,aAAaC,MAAQ;;;;;;uBAMrGD,KAAO,aAAaC,MAAQ;;;oCAGfH,QAAU,IAAIG,MAAQ;sBACpCP,eAAiB,SAASI,QAAU,MAAMC,SAAW,IAAIE,MAAQ,IAAIH,QAAU;uCAC9DE,KAAO,IAAIC,MAAQ;;UAEhDR,WAAW,EAAX,GAAgB,8EAAgF;;QAElGna,OAAQ,YAAYua,QAAU,6CAA6Cva,IAAM;mBACtEua,QAAU,YAAYva,IAAM,SADvC,GACkD,EAAI;mBAC3Cwa,WAAW,CAAG,6CAA6C/D,IAAM;mBACjE+D,WAAW,CAAG,YAAY/D,IAAM;;;IAnB3C,CAsBJ3M,IAtBI,GAsBGuB,OAtBH,CAsBW,aAtBX,EAsB0B,IAtB1B;AAFA,KAAP;AA0BA;;AA9FgE,CAAlE;AAiGA1L,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,WAA3B,EAAwC;AAAEgD,gBAAc;AAAhB,CAAxC,EAAgE;AAC/DjE,QAAM;AACL8S,UAAM,KAAK7J,WAAX,EAAwB;AACvBoD,aAAO0G;AADgB,KAAxB;AAIA,UAAM;AAAE1G;AAAF,QAAY,KAAKpD,WAAvB;AAEA,UAAM5I,SAASwE,OAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAC5CP,OAAOC,IAAP,CAAY,WAAZ,EAAyBuH,KAAzB,CADc,CAAf;AAIA,WAAO3M,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0BC,MAA1B,CAAP;AACA;;AAb8D,CAAhE;AAgBAX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,WAA3B,EAAwC;AAAEgD,gBAAc;AAAhB,CAAxC,EAAgE;AAC/DjE,QAAM;AACL,UAAM;AAAEqJ,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,UAAF;AAAQU;AAAR,QAAkB,KAAK2D,cAAL,EAAxB;AAEA,UAAM;AAAEwG,UAAF;AAAQ5N;AAAR,QAAiByD,KAAvB;;AACA,QAAIV,QAAQjK,OAAOC,IAAP,CAAYgK,IAAZ,EAAkBnI,MAAlB,GAA2B,CAAvC,EAA0C;AACzC,aAAO9D,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,+CAA1B,CAAP;AACA;;AACD,UAAMia,SAAShP,OAAOjK,OAAOC,IAAP,CAAYgK,IAAZ,EAAkB,CAAlB,CAAP,GAA8BxE,SAA7C;AACA,UAAMyT,gBAAgBjP,QAAQjK,OAAO2V,MAAP,CAAc1L,IAAd,EAAoB,CAApB,MAA2B,CAAnC,GAAuC,KAAvC,GAA+C,MAArE;AAEA,UAAMtL,SAASwE,OAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,gBAAZ,EAA8B;AAChF0R,UADgF;AAEhF5N,UAFgF;AAGhF+R,YAHgF;AAIhFC,mBAJgF;AAKhFvR,cAAQwR,KAAKC,GAAL,CAAS,CAAT,EAAYzR,MAAZ,CALwE;AAMhFgH,aAAOwK,KAAKC,GAAL,CAAS,CAAT,EAAYvR,KAAZ;AANyE,KAA9B,CAApC,CAAf;;AASA,QAAI,CAAClJ,MAAL,EAAa;AACZ,aAAOX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,8BAA1B,CAAP;AACA;;AACD,WAAOhB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCC,cAAQA,OAAO0a,OADiB;AAEhCxR,aAAOlJ,OAAO0a,OAAP,CAAevX,MAFU;AAGhC6F,YAHgC;AAIhCmH,aAAOnQ,OAAOmQ;AAJkB,KAA1B,CAAP;AAMA;;AA9B8D,CAAhE,E;;;;;;;;;;;AC7IA;;;;;;;AAOA9Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,aAA3B,EAA0C;AAAEgD,gBAAc;AAAhB,CAA1C,EAAkE;AACjEjE,QAAM;AACL,UAAM0M,iBAAiB,kFAAvB;AACA5F,YAAQC,IAAR,CAAa2F,cAAb;AAEA,UAAMrM,SAASwE,OAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,iBAAZ,CAApC,CAAf;AAEA,WAAOpF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0BC,MAA1B,CAAP;AACA;;AARgE,CAAlE;AAWAX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,kBAA3B,EAA+C;AAAEgD,gBAAc;AAAhB,CAA/C,EAAuE;AACtEjE,QAAM;AACL,UAAMK,SAASwE,OAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,iBAAZ,CAApC,CAAf;AAEA,WAAOpF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC4a,mBAAa3a;AADmB,KAA1B,CAAP;AAGA;;AAPqE,CAAvE;AAUAX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,oBAA3B,EAAiD;AAAEgD,gBAAc;AAAhB,CAAjD,EAAyE;AACxEC,SAAO;AACN,QAAI,CAACxE,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,oBAA5C,CAAL,EAAwE;AACvE,aAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,oCAA1B,EAAgE,oCAAhE,CAAP;AACA;;AAEDoS,UAAM,KAAK7P,UAAX,EAAuB;AACtB+X,mBAAa,CACZ/H,MAAM0C,eAAN,CAAsB;AACrBzQ,aAAK6N,MADgB;AAErB5T,eAAO,CAAC4T,MAAD;AAFc,OAAtB,CADY;AADS,KAAvB;AASA,QAAIkI,qBAAqB,KAAzB;AACA,QAAIC,eAAe,KAAnB;AACAxZ,WAAOC,IAAP,CAAY,KAAKsB,UAAL,CAAgB+X,WAA5B,EAAyCxZ,OAAzC,CAAkD+G,GAAD,IAAS;AACzD,YAAM4S,UAAU,KAAKlY,UAAL,CAAgB+X,WAAhB,CAA4BzS,GAA5B,CAAhB;;AAEA,UAAI,CAAC7I,WAAWoK,MAAX,CAAkBsR,WAAlB,CAA8BpR,WAA9B,CAA0CmR,QAAQjW,GAAlD,CAAL,EAA6D;AAC5D+V,6BAAqB,IAArB;AACA;;AAEDvZ,aAAOC,IAAP,CAAYwZ,QAAQhc,KAApB,EAA2BqC,OAA3B,CAAoC+G,GAAD,IAAS;AAC3C,cAAM8S,aAAaF,QAAQhc,KAAR,CAAcoJ,GAAd,CAAnB;;AAEA,YAAI,CAAC7I,WAAWoK,MAAX,CAAkB+I,KAAlB,CAAwB7I,WAAxB,CAAoCqR,UAApC,CAAL,EAAsD;AACrDH,yBAAe,IAAf;AACA;AACD,OAND;AAOA,KAdD;;AAgBA,QAAID,kBAAJ,EAAwB;AACvB,aAAOvb,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,oBAA1B,EAAgD,0BAAhD,CAAP;AACA,KAFD,MAEO,IAAIwa,YAAJ,EAAkB;AACxB,aAAOxb,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,cAA1B,EAA0C,oBAA1C,CAAP;AACA;;AAEDgB,WAAOC,IAAP,CAAY,KAAKsB,UAAL,CAAgB+X,WAA5B,EAAyCxZ,OAAzC,CAAkD+G,GAAD,IAAS;AACzD,YAAM4S,UAAU,KAAKlY,UAAL,CAAgB+X,WAAhB,CAA4BzS,GAA5B,CAAhB;AAEA7I,iBAAWoK,MAAX,CAAkBsR,WAAlB,CAA8BE,cAA9B,CAA6CH,QAAQjW,GAArD,EAA0DiW,QAAQhc,KAAlE;AACA,KAJD;AAMA,UAAMkB,SAASwE,OAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,iBAAZ,CAApC,CAAf;AAEA,WAAOpF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC4a,mBAAa3a;AADmB,KAA1B,CAAP;AAGA;;AAlDuE,CAAzE,E;;;;;;;;;;;AC5BA;AAEAX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,YAA3B,EAAyC;AAAEgD,gBAAc;AAAhB,CAAzC,EAAiE;AAChEC,SAAO;AACN,UAAM;AAAE0E,UAAF;AAAQJ,WAAR;AAAe+S;AAAf,QAA2B,KAAKtY,UAAtC;AACA,QAAI;AAAEkC;AAAF,QAAS,KAAKlC,UAAlB;;AAEA,QAAIkC,MAAM,OAAOA,EAAP,KAAc,QAAxB,EAAkC;AACjC,YAAM,IAAIN,OAAOqF,KAAX,CAAiB,0BAAjB,EAA6C,0CAA7C,CAAN;AACA,KAFD,MAEO;AACN/E,WAAKsS,OAAOtS,EAAP,EAAL;AACA;;AAED,QAAI,CAACyD,IAAD,IAAUA,SAAS,KAAT,IAAkBA,SAAS,KAAzC,EAAiD;AAChD,YAAM,IAAI/D,OAAOqF,KAAX,CAAiB,4BAAjB,EAA+C,uDAA/C,CAAN;AACA;;AAED,QAAI,CAAC1B,KAAD,IAAU,OAAOA,KAAP,KAAiB,QAA/B,EAAyC;AACxC,YAAM,IAAI3D,OAAOqF,KAAX,CAAiB,6BAAjB,EAAgD,wDAAhD,CAAN;AACA;;AAED,QAAI,CAACqR,OAAD,IAAY,OAAOA,OAAP,KAAmB,QAAnC,EAA6C;AAC5C,YAAM,IAAI1W,OAAOqF,KAAX,CAAiB,+BAAjB,EAAkD,0DAAlD,CAAN;AACA;;AAGD,QAAI7J,MAAJ;AACAwE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM/E,SAASwE,OAAOC,IAAP,CAAY,kBAAZ,EAAgC;AAC5EK,QAD4E;AAE5EK,aAAO;AAAE,SAACoD,IAAD,GAAQJ;AAAV,OAFqE;AAG5E+S,aAH4E;AAI5EnW,cAAQ,KAAKA;AAJ+D,KAAhC,CAA7C;AAOA,WAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAAEC;AAAF,KAA1B,CAAP;AACA,GAjC+D;;AAkChEmb,WAAS;AACR,UAAM;AAAEhW;AAAF,QAAY,KAAKvC,UAAvB;;AAEA,QAAI,CAACuC,KAAD,IAAU,OAAOA,KAAP,KAAiB,QAA/B,EAAyC;AACxC,YAAM,IAAIX,OAAOqF,KAAX,CAAiB,6BAAjB,EAAgD,wDAAhD,CAAN;AACA;;AAED,UAAMuR,kBAAkBC,KAAKC,aAAL,CAAmB/H,MAAnB,CAA0B;AACjDgI,WAAK,CAAC;AACL,qBAAapW;AADR,OAAD,EAEF;AACF,qBAAaA;AADX,OAFE,CAD4C;AAMjDJ,cAAQ,KAAKA;AANoC,KAA1B,CAAxB;;AASA,QAAIqW,oBAAoB,CAAxB,EAA2B;AAC1B,aAAO/b,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB7B,QAAlB,EAAP;AACA;;AAED,WAAOpB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAvD+D,CAAjE,E;;;;;;;;;;;;;;;ACFA,IAAI7C,CAAJ;;AAAMC,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACL,QAAEK,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAEN;AACA8B,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,iBAA3B,EAA8C;AAAEgD,gBAAc;AAAhB,CAA9C,EAAuE;AACtEjE,QAAM;AACL,UAAM;AAAEqJ,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,UAAF;AAAQC,YAAR;AAAgBS;AAAhB,QAA0B,KAAK2D,cAAL,EAAhC;AAEA,QAAIC,WAAW;AACd4L,cAAQ;AAAEC,aAAK;AAAP,OADM;AAEdjT,cAAQ;AAFM,KAAf;AAKAoH,eAAWvO,OAAO0K,MAAP,CAAc,EAAd,EAAkBC,KAAlB,EAAyB4D,QAAzB,CAAX;AAEA,UAAM1Q,WAAWG,WAAWoK,MAAX,CAAkBiS,QAAlB,CAA2BrR,IAA3B,CAAgCuF,QAAhC,EAA0C;AAC1DtE,YAAMA,OAAOA,IAAP,GAAc;AAAEzG,aAAK;AAAP,OADsC;AAE1DkL,YAAM/G,MAFoD;AAG1DgH,aAAO9G,KAHmD;AAI1DqC,cAAQlK,OAAO0K,MAAP,CAAc;AAAElH,aAAK,CAAP;AAAUsD,eAAO;AAAjB,OAAd,EAAoCoD,MAApC;AAJkD,KAA1C,EAKd0E,KALc,EAAjB;AAOA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCb,cADgC;AAEhCgK,aAAOhK,SAASiE,MAFgB;AAGhC6F,YAHgC;AAIhCmH,aAAO9Q,WAAWoK,MAAX,CAAkBiS,QAAlB,CAA2BrR,IAA3B,CAAgCuF,QAAhC,EAA0C1G,KAA1C;AAJyB,KAA1B,CAAP;AAMA;;AAzBqE,CAAvE;AA4BA7J,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,gBAA3B,EAA6C;AAAEgD,gBAAc;AAAhB,CAA7C,EAAsE;AACrEjE,QAAM;AACL,UAAMgc,qBAAqB,MAAM;AAChC,YAAMC,uBAAuBC,qBAAqBC,cAArB,CAAoCzR,IAApC,CAAyC,EAAzC,EAA6C;AAAEkB,gBAAQ;AAAEwQ,kBAAQ;AAAV;AAAV,OAA7C,EAAwE9L,KAAxE,EAA7B;AAEA,aAAO2L,qBAAqB1L,GAArB,CAA0B8L,OAAD,IAAa;AAC5C,YAAIA,QAAQC,MAAR,IAAkB,CAAC,MAAD,EAAS,KAAT,EAAgB,WAAhB,EAA6B5Y,QAA7B,CAAsC2Y,QAAQA,OAA9C,CAAtB,EAA8E;AAC7E,iDAAYA,OAAZ;AACA;;AAED,eAAO;AACNnX,eAAKmX,QAAQnX,GADP;AAENnF,gBAAMsc,QAAQA,OAFR;AAGNE,oBAAUF,QAAQG,KAAR,IAAiBH,QAAQE,QAAzB,IAAqCF,QAAQI,WAHjD;AAINC,2BAAiBL,QAAQK,eAAR,IAA2B,EAJtC;AAKNC,uBAAaN,QAAQM,WAAR,IAAuB,EAL9B;AAMNC,4BAAkBP,QAAQO,gBAAR,IAA4B,EANxC;AAONN,kBAAQ;AAPF,SAAP;AASA,OAdM,CAAP;AAeA,KAlBD;;AAoBA,WAAO5c,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCpB,gBAAUgd;AADsB,KAA1B,CAAP;AAGA;;AAzBoE,CAAtE;AA4BAtc,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,UAA3B,EAAuC;AAAEgD,gBAAc;AAAhB,CAAvC,EAA+D;AAC9DjE,QAAM;AACL,UAAM;AAAEqJ,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,UAAF;AAAQC,YAAR;AAAgBS;AAAhB,QAA0B,KAAK2D,cAAL,EAAhC;AAEA,QAAIC,WAAW;AACd4L,cAAQ;AAAEC,aAAK;AAAP;AADM,KAAf;;AAIA,QAAI,CAACpc,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,yBAA5C,CAAL,EAA6E;AAC5E6K,eAASpH,MAAT,GAAkB,IAAlB;AACA;;AAEDoH,eAAWvO,OAAO0K,MAAP,CAAc,EAAd,EAAkBC,KAAlB,EAAyB4D,QAAzB,CAAX;AAEA,UAAM1Q,WAAWG,WAAWoK,MAAX,CAAkBiS,QAAlB,CAA2BrR,IAA3B,CAAgCuF,QAAhC,EAA0C;AAC1DtE,YAAMA,OAAOA,IAAP,GAAc;AAAEzG,aAAK;AAAP,OADsC;AAE1DkL,YAAM/G,MAFoD;AAG1DgH,aAAO9G,KAHmD;AAI1DqC,cAAQlK,OAAO0K,MAAP,CAAc;AAAElH,aAAK,CAAP;AAAUsD,eAAO;AAAjB,OAAd,EAAoCoD,MAApC;AAJkD,KAA1C,EAKd0E,KALc,EAAjB;AAOA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCb,cADgC;AAEhCgK,aAAOhK,SAASiE,MAFgB;AAGhC6F,YAHgC;AAIhCmH,aAAO9Q,WAAWoK,MAAX,CAAkBiS,QAAlB,CAA2BrR,IAA3B,CAAgCuF,QAAhC,EAA0C1G,KAA1C;AAJyB,KAA1B,CAAP;AAMA;;AA5B6D,CAA/D;AA+BA7J,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,eAA3B,EAA4C;AAAEgD,gBAAc;AAAhB,CAA5C,EAAoE;AACnEjE,QAAM;AACL,QAAI,CAACN,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,yBAA5C,CAAL,EAA6E;AAC5E,aAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AAED,WAAOtB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B7C,EAAEsf,IAAF,CAAOnd,WAAWoK,MAAX,CAAkBiS,QAAlB,CAA2Be,oBAA3B,CAAgD,KAAKjJ,SAAL,CAAe3O,GAA/D,CAAP,EAA4E,KAA5E,EAAmF,OAAnF,CAA1B,CAAP;AACA,GAPkE;;AAQnEhB,SAAO;AACN,QAAI,CAACxE,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,yBAA5C,CAAL,EAA6E;AAC5E,aAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA,KAHK,CAKN;;;AACA,UAAMkK,UAAUxL,WAAWoK,MAAX,CAAkBiS,QAAlB,CAA2Be,oBAA3B,CAAgD,KAAKjJ,SAAL,CAAe3O,GAA/D,CAAhB;;AACA,QAAIgG,QAAQtC,IAAR,KAAiB,QAAjB,IAA6B,KAAK3F,UAAlC,IAAgD,KAAKA,UAAL,CAAgB0M,OAApE,EAA6E;AAC5E;AACA9K,aAAOC,IAAP,CAAYoG,QAAQ1C,KAApB;AACA,aAAO9I,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAED,QAAI8K,QAAQtC,IAAR,KAAiB,OAAjB,IAA4B,KAAK3F,UAAjC,IAA+C,KAAKA,UAAL,CAAgB8Z,MAA/D,IAAyE,KAAK9Z,UAAL,CAAgBuF,KAA7F,EAAoG;AACnG9I,iBAAWoK,MAAX,CAAkBiS,QAAlB,CAA2BiB,iBAA3B,CAA6C,KAAKnJ,SAAL,CAAe3O,GAA5D,EAAiE;AAAE6X,gBAAQ,KAAK9Z,UAAL,CAAgB8Z;AAA1B,OAAjE;AACArd,iBAAWoK,MAAX,CAAkBiS,QAAlB,CAA2BkB,wBAA3B,CAAoD,KAAKpJ,SAAL,CAAe3O,GAAnE,EAAwE,KAAKjC,UAAL,CAAgBuF,KAAxF;AACA,aAAO9I,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAED0S,UAAM,KAAK7P,UAAX,EAAuB;AACtBuF,aAAOyK,MAAMiK;AADS,KAAvB;;AAGA,QAAIxd,WAAWoK,MAAX,CAAkBiS,QAAlB,CAA2BkB,wBAA3B,CAAoD,KAAKpJ,SAAL,CAAe3O,GAAnE,EAAwE,KAAKjC,UAAL,CAAgBuF,KAAxF,CAAJ,EAAoG;AACnG,aAAO9I,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAED,WAAOV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,EAAP;AACA;;AAnCkE,CAApE;AAsCAhB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,wBAA3B,EAAqD;AAAEgD,gBAAc;AAAhB,CAArD,EAA8E;AAC7EjE,QAAM;AACL,UAAM;AAAEkc;AAAF,QAA2BiB,QAAQ,uBAAR,CAAjC;AAEA,WAAOzd,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC+b,sBAAgBD,qBAAqBC,cAArB,CAAoCzR,IAApC,CAAyC,EAAzC,EAA6C;AAAEkB,gBAAQ;AAAEwQ,kBAAQ;AAAV;AAAV,OAA7C,EAAwE9L,KAAxE;AADgB,KAA1B,CAAP;AAGA;;AAP4E,CAA9E,E;;;;;;;;;;;AChIA5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,YAA3B,EAAyC;AAAEgD,gBAAc;AAAhB,CAAzC,EAAiE;AAChEjE,QAAM;AACL,QAAIod,UAAU,KAAd;;AACA,QAAI,OAAO,KAAKnU,WAAL,CAAiBmU,OAAxB,KAAoC,WAApC,IAAmD,KAAKnU,WAAL,CAAiBmU,OAAjB,KAA6B,MAApF,EAA4F;AAC3FA,gBAAU,IAAV;AACA;;AAED,QAAIC,KAAJ;AACAxY,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCiY,cAAQxY,OAAOC,IAAP,CAAY,eAAZ,EAA6BsY,OAA7B,CAAR;AACA,KAFD;AAIA,WAAO1d,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCkd,kBAAYD;AADoB,KAA1B,CAAP;AAGA;;AAf+D,CAAjE;AAkBA3d,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,iBAA3B,EAA8C;AAAEgD,gBAAc;AAAhB,CAA9C,EAAsE;AACrEjE,QAAM;AACL,QAAI,CAACN,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,iBAA5C,CAAL,EAAqE;AACpE,aAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AAED,UAAM;AAAEqI,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,UAAF;AAAQC,YAAR;AAAgBS;AAAhB,QAA0B,KAAK2D,cAAL,EAAhC;AAEA,UAAMsN,aAAa5d,WAAWoK,MAAX,CAAkByT,UAAlB,CAA6B7S,IAA7B,CAAkC2B,KAAlC,EAAyC;AAC3DV,YAAMA,OAAOA,IAAP,GAAc;AAAE5L,cAAM;AAAR,OADuC;AAE3DqQ,YAAM/G,MAFqD;AAG3DgH,aAAO9G,KAHoD;AAI3DqC;AAJ2D,KAAzC,EAKhB0E,KALgB,EAAnB;AAOA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCkd,gBADgC;AAEhC/T,aAAO+T,WAAW9Z,MAFc;AAGhC6F,YAHgC;AAIhCmH,aAAO9Q,WAAWoK,MAAX,CAAkByT,UAAlB,CAA6B7S,IAA7B,CAAkC2B,KAAlC,EAAyC9C,KAAzC;AAJyB,KAA1B,CAAP;AAMA;;AAtBoE,CAAtE,E;;;;;;;;;;;AClBA,IAAIhM,CAAJ;;AAAMC,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACL,QAAEK,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAAwD,IAAI2V,MAAJ;AAAW/V,OAAOC,KAAP,CAAaC,QAAQ,QAAR,CAAb,EAA+B;AAACC,UAAQC,CAAR,EAAU;AAAC2V,aAAO3V,CAAP;AAAS;;AAArB,CAA/B,EAAsD,CAAtD;AAGzE8B,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,cAA3B,EAA2C;AAAEgD,gBAAc;AAAhB,CAA3C,EAAmE;AAClEC,SAAO;AACN4O,UAAM,KAAK7P,UAAX,EAAuB;AACtBG,aAAO2P,MADe;AAEtBhT,YAAMgT,MAFgB;AAGtB1P,gBAAU0P,MAHY;AAItB5P,gBAAU4P,MAJY;AAKtB1I,cAAQ4I,MAAMC,KAAN,CAAY4C,OAAZ,CALc;AAMtB3W,aAAO8T,MAAMC,KAAN,CAAYzI,KAAZ,CANe;AAOtB+S,2BAAqBvK,MAAMC,KAAN,CAAY4C,OAAZ,CAPC;AAQtB7W,6BAAuBgU,MAAMC,KAAN,CAAY4C,OAAZ,CARD;AAStB2H,wBAAkBxK,MAAMC,KAAN,CAAY4C,OAAZ,CATI;AAUtBnL,gBAAUsI,MAAMC,KAAN,CAAY4C,OAAZ,CAVY;AAWtBxW,oBAAc2T,MAAMC,KAAN,CAAYxR,MAAZ;AAXQ,KAAvB,EADM,CAeN;;AACA,QAAI,OAAO,KAAKuB,UAAL,CAAgBua,mBAAvB,KAA+C,WAAnD,EAAgE;AAC/D,WAAKva,UAAL,CAAgBua,mBAAhB,GAAsC,IAAtC;AACA;;AAED,QAAI,KAAKva,UAAL,CAAgB3D,YAApB,EAAkC;AACjCI,iBAAWge,oBAAX,CAAgC,KAAKza,UAAL,CAAgB3D,YAAhD;AACA;;AAED,UAAMqe,YAAYje,WAAWke,QAAX,CAAoB,KAAKxY,MAAzB,EAAiC,KAAKnC,UAAtC,CAAlB;;AAEA,QAAI,KAAKA,UAAL,CAAgB3D,YAApB,EAAkC;AACjCI,iBAAWme,iCAAX,CAA6CF,SAA7C,EAAwD,KAAK1a,UAAL,CAAgB3D,YAAxE;AACA;;AAGD,QAAI,OAAO,KAAK2D,UAAL,CAAgBoH,MAAvB,KAAkC,WAAtC,EAAmD;AAClDxF,aAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,eAAOC,IAAP,CAAY,qBAAZ,EAAmC6Y,SAAnC,EAA8C,KAAK1a,UAAL,CAAgBoH,MAA9D;AACA,OAFD;AAGA;;AAED,WAAO3K,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAAE8C,YAAMxD,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwBC,WAAxB,CAAoC2T,SAApC,EAA+C;AAAE/R,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAA/C;AAAR,KAA1B,CAAP;AACA;;AAvCiE,CAAnE;AA0CAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,cAA3B,EAA2C;AAAEgD,gBAAc;AAAhB,CAA3C,EAAmE;AAClEC,SAAO;AACN,QAAI,CAACxE,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,aAA5C,CAAL,EAAiE;AAChE,aAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AAED,UAAMkC,OAAO,KAAK8K,iBAAL,EAAb;AAEAnJ,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,YAAZ,EAA0B5B,KAAKgC,GAA/B;AACA,KAFD;AAIA,WAAOxF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAbiE,CAAnE;AAgBAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,wBAA3B,EAAqD;AAAEgD,gBAAc;AAAhB,CAArD,EAA6E;AAC5EC,SAAO;AACN,UAAM;AAAEb;AAAF,QAAe,KAAKJ,UAA1B;;AACA,QAAI,CAACI,QAAL,EAAe;AACd,aAAO3D,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,wCAA1B,CAAP;AACA;;AACD,QAAI,CAAChB,WAAWH,QAAX,CAAoBS,GAApB,CAAwB,gCAAxB,CAAL,EAAgE;AAC/D,YAAM,IAAI6E,OAAOqF,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,CAAN;AACA;;AAEDrF,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,aAAOC,IAAP,CAAY,sBAAZ,EAAoCzB,QAApC;AACA,KAFD;AAIA,WAAO3D,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAf2E,CAA7E;AAkBAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,iBAA3B,EAA8C;AAAEgD,gBAAc;AAAhB,CAA9C,EAAuE;AACtEjE,QAAM;AACL,UAAMkD,OAAO,KAAK8K,iBAAL,EAAb;AAEA,UAAMxL,MAAM9C,WAAWoe,MAAX,CAAmB,WAAW5a,KAAKC,QAAU,EAA7C,EAAgD;AAAE4a,WAAK,KAAP;AAAcC,YAAM;AAApB,KAAhD,CAAZ;AACA,SAAKtY,QAAL,CAAcuY,SAAd,CAAwB,UAAxB,EAAoCzb,GAApC;AAEA,WAAO;AACNjC,kBAAY,GADN;AAENC,YAAMgC;AAFA,KAAP;AAIA;;AAXqE,CAAvE;AAcA9C,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,mBAA3B,EAAgD;AAAEgD,gBAAc;AAAhB,CAAhD,EAAwE;AACvEjE,QAAM;AACL,QAAI,KAAKke,gBAAL,EAAJ,EAA6B;AAC5B,YAAMhb,OAAOxD,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwBC,WAAxB,CAAoC,KAAK5E,MAAzC,CAAb;AACA,aAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC+d,kBAAUjb,KAAKL,MADiB;AAEhCub,0BAAkBlb,KAAKrE,gBAFS;AAGhCE,mBAAWmE,KAAKnE;AAHgB,OAA1B,CAAP;AAKA;;AAED,UAAMmE,OAAO,KAAK8K,iBAAL,EAAb;AAEA,WAAOtO,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC+d,gBAAUjb,KAAKL;AADiB,KAA1B,CAAP;AAGA;;AAhBsE,CAAxE;AAmBAnD,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,YAA3B,EAAyC;AAAEgD,gBAAc;AAAhB,CAAzC,EAAiE;AAChEjE,QAAM;AACL,UAAM;AAAEmD;AAAF,QAAe,KAAK6K,iBAAL,EAArB;AAEA,QAAI3N,MAAJ;AACAwE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnC/E,eAASwE,OAAOC,IAAP,CAAY,iBAAZ,EAA+B;AAAE3B,gBAAF;AAAYkN,eAAO;AAAnB,OAA/B,CAAT;AACA,KAFD;;AAIA,QAAI,CAAChQ,MAAD,IAAWA,OAAOmD,MAAP,KAAkB,CAAjC,EAAoC;AACnC,aAAO9D,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA2B,kDAAkDyC,QAAU,IAAvF,CAAP;AACA;;AAED,WAAOzD,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC8C,YAAM7C,OAAO,CAAP;AAD0B,KAA1B,CAAP;AAGA;;AAhB+D,CAAjE;AAmBAX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,YAA3B,EAAyC;AAAEgD,gBAAc;AAAhB,CAAzC,EAAiE;AAChEjE,QAAM;AACL,QAAI,CAACN,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,aAA5C,CAAL,EAAiE;AAChE,aAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AAED,UAAM;AAAEqI,YAAF;AAAUE;AAAV,QAAoB,KAAKwG,kBAAL,EAA1B;AACA,UAAM;AAAEpE,UAAF;AAAQC,YAAR;AAAgBS;AAAhB,QAA0B,KAAK2D,cAAL,EAAhC;AAEA,UAAMhL,QAAQtF,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwBW,IAAxB,CAA6B2B,KAA7B,EAAoC;AACjDV,YAAMA,OAAOA,IAAP,GAAc;AAAExI,kBAAU;AAAZ,OAD6B;AAEjDiN,YAAM/G,MAF2C;AAGjDgH,aAAO9G,KAH0C;AAIjDqC;AAJiD,KAApC,EAKX0E,KALW,EAAd;AAOA,WAAO5Q,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC4E,WADgC;AAEhCuE,aAAOvE,MAAMxB,MAFmB;AAGhC6F,YAHgC;AAIhCmH,aAAO9Q,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwBW,IAAxB,CAA6B2B,KAA7B,EAAoC9C,KAApC;AAJyB,KAA1B,CAAP;AAMA;;AAtB+D,CAAjE;AAyBA7J,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,gBAA3B,EAA6C;AAAEgD,gBAAc;AAAhB,CAA7C,EAAsE;AACrEC,SAAO;AACN,QAAI,KAAKkB,MAAT,EAAiB;AAChB,aAAO1F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,yCAA1B,CAAP;AACA,KAHK,CAKN;AACA;;;AACAoS,UAAM,KAAK7P,UAAX,EAAuBgQ,MAAM0C,eAAN,CAAsB;AAC5CxS,gBAAU4P;AADkC,KAAtB,CAAvB,EAPM,CAWN;;AACA,UAAM3N,SAASP,OAAOC,IAAP,CAAY,cAAZ,EAA4B,KAAK7B,UAAjC,CAAf,CAZM,CAcN;;AACA4B,WAAOgJ,SAAP,CAAiBzI,MAAjB,EAAyB,MAAMP,OAAOC,IAAP,CAAY,aAAZ,EAA2B,KAAK7B,UAAL,CAAgBE,QAA3C,CAA/B;AAEA,WAAOzD,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAAE8C,YAAMxD,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwBC,WAAxB,CAAoC5E,MAApC,EAA4C;AAAEwG,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAA5C;AAAR,KAA1B,CAAP;AACA;;AAnBoE,CAAtE;AAsBAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,mBAA3B,EAAgD;AAAEgD,gBAAc;AAAhB,CAAhD,EAAwE;AACvEC,SAAO;AACN,UAAMhB,OAAO,KAAK8K,iBAAL,EAAb;;AAEA,QAAI9K,KAAKgC,GAAL,KAAa,KAAKE,MAAtB,EAA8B;AAC7BP,aAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,aAAZ,CAApC;AACA,KAFD,MAEO,IAAIpF,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,sBAA5C,CAAJ,EAAyE;AAC/EP,aAAOgJ,SAAP,CAAiB3K,KAAKgC,GAAtB,EAA2B,MAAML,OAAOC,IAAP,CAAY,aAAZ,CAAjC;AACA,KAFM,MAEA;AACN,aAAOpF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AAED,WAAOtB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAbsE,CAAxE;AAgBAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,iBAA3B,EAA8C;AAAEgD,gBAAc;AAAhB,CAA9C,EAAsE;AACrEC,SAAO;AACN4O,UAAM,KAAK7P,UAAX,EAAuBgQ,MAAM0C,eAAN,CAAsB;AAC5C0I,iBAAWpL,MAAMC,KAAN,CAAYH,MAAZ,CADiC;AAE5C3N,cAAQ6N,MAAMC,KAAN,CAAYH,MAAZ,CAFoC;AAG5C5P,gBAAU8P,MAAMC,KAAN,CAAYH,MAAZ;AAHkC,KAAtB,CAAvB;;AAMA,QAAI,CAACrT,WAAWH,QAAX,CAAoBS,GAApB,CAAwB,gCAAxB,CAAL,EAAgE;AAC/D,YAAM,IAAI6E,OAAOqF,KAAX,CAAiB,mBAAjB,EAAsC,8BAAtC,EAAsE;AAC3EhK,gBAAQ;AADmE,OAAtE,CAAN;AAGA;;AAED,QAAIgD,IAAJ;;AACA,QAAI,KAAKgb,gBAAL,EAAJ,EAA6B;AAC5Bhb,aAAO2B,OAAOG,KAAP,CAAaC,OAAb,CAAqB,KAAKG,MAA1B,CAAP;AACA,KAFD,MAEO,IAAI1F,WAAWqM,KAAX,CAAiBC,aAAjB,CAA+B,KAAK5G,MAApC,EAA4C,sBAA5C,CAAJ,EAAyE;AAC/ElC,aAAO,KAAK8K,iBAAL,EAAP;AACA,KAFM,MAEA;AACN,aAAOtO,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAAP;AACA;;AAED6D,WAAOgJ,SAAP,CAAiB3K,KAAKgC,GAAtB,EAA2B,MAAM;AAChC,UAAI,KAAKjC,UAAL,CAAgBob,SAApB,EAA+B;AAC9B3e,mBAAW4e,aAAX,CAAyBpb,IAAzB,EAA+B,KAAKD,UAAL,CAAgBob,SAA/C,EAA0D,EAA1D,EAA8D,KAA9D;AACA,OAFD,MAEO;AACN,cAAMvK,SAAS,IAAIP,MAAJ,CAAW;AAAElR,mBAAS,KAAKD,OAAL,CAAaC;AAAxB,SAAX,CAAf;AAEAwC,eAAOkP,SAAP,CAAkBC,QAAD,IAAc;AAC9BF,iBAAOG,EAAP,CAAU,MAAV,EAAkBpP,OAAO4P,eAAP,CAAuB,CAACP,SAAD,EAAYrE,IAAZ,EAAkBsE,QAAlB,EAA4BC,QAA5B,EAAsCC,QAAtC,KAAmD;AAC3F,gBAAIH,cAAc,OAAlB,EAA2B;AAC1B,qBAAOF,SAAS,IAAInP,OAAOqF,KAAX,CAAiB,eAAjB,CAAT,CAAP;AACA;;AAED,kBAAMqU,YAAY,EAAlB;AACA1O,iBAAKoE,EAAL,CAAQ,MAAR,EAAgBpP,OAAO4P,eAAP,CAAwB9O,IAAD,IAAU;AAChD4Y,wBAAUpe,IAAV,CAAewF,IAAf;AACA,aAFe,CAAhB;AAIAkK,iBAAKoE,EAAL,CAAQ,KAAR,EAAepP,OAAO4P,eAAP,CAAuB,MAAM;AAC3C/U,yBAAW4e,aAAX,CAAyBpb,IAAzB,EAA+BsR,OAAOvI,MAAP,CAAcsS,SAAd,CAA/B,EAAyDlK,QAAzD,EAAmE,MAAnE;AACAL;AACA,aAHc,CAAf;AAKA,WAfiB,CAAlB;AAgBA,eAAK5R,OAAL,CAAasS,IAAb,CAAkBZ,MAAlB;AACA,SAlBD;AAmBA;AACD,KA1BD;AA4BA,WAAOpU,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AApDoE,CAAtE;AAuDAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,cAA3B,EAA2C;AAAEgD,gBAAc;AAAhB,CAA3C,EAAmE;AAClEC,SAAO;AACN4O,UAAM,KAAK7P,UAAX,EAAuB;AACtBmC,cAAQ2N,MADc;AAEtBpN,YAAMsN,MAAM0C,eAAN,CAAsB;AAC3BvS,eAAO6P,MAAMC,KAAN,CAAYH,MAAZ,CADoB;AAE3BhT,cAAMkT,MAAMC,KAAN,CAAYH,MAAZ,CAFqB;AAG3B1P,kBAAU4P,MAAMC,KAAN,CAAYH,MAAZ,CAHiB;AAI3B5P,kBAAU8P,MAAMC,KAAN,CAAYH,MAAZ,CAJiB;AAK3B1I,gBAAQ4I,MAAMC,KAAN,CAAY4C,OAAZ,CALmB;AAM3B3W,eAAO8T,MAAMC,KAAN,CAAYzI,KAAZ,CANoB;AAO3B+S,6BAAqBvK,MAAMC,KAAN,CAAY4C,OAAZ,CAPM;AAQ3B7W,+BAAuBgU,MAAMC,KAAN,CAAY4C,OAAZ,CARI;AAS3B2H,0BAAkBxK,MAAMC,KAAN,CAAY4C,OAAZ,CATS;AAU3BnL,kBAAUsI,MAAMC,KAAN,CAAY4C,OAAZ,CAViB;AAW3BxW,sBAAc2T,MAAMC,KAAN,CAAYxR,MAAZ;AAXa,OAAtB;AAFgB,KAAvB;;AAiBA,UAAM8c,WAAWjhB,EAAEyI,MAAF,CAAS;AAAEd,WAAK,KAAKjC,UAAL,CAAgBmC;AAAvB,KAAT,EAA0C,KAAKnC,UAAL,CAAgB0C,IAA1D,CAAjB;;AAEAd,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM1F,WAAWke,QAAX,CAAoB,KAAKxY,MAAzB,EAAiCoZ,QAAjC,CAApC;;AAEA,QAAI,KAAKvb,UAAL,CAAgB0C,IAAhB,CAAqBrG,YAAzB,EAAuC;AACtCI,iBAAW+e,gBAAX,CAA4B,KAAKxb,UAAL,CAAgBmC,MAA5C,EAAoD,KAAKnC,UAAL,CAAgB0C,IAAhB,CAAqBrG,YAAzE;AACA;;AAED,QAAI,OAAO,KAAK2D,UAAL,CAAgB0C,IAAhB,CAAqB0E,MAA5B,KAAuC,WAA3C,EAAwD;AACvDxF,aAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCP,eAAOC,IAAP,CAAY,qBAAZ,EAAmC,KAAK7B,UAAL,CAAgBmC,MAAnD,EAA2D,KAAKnC,UAAL,CAAgB0C,IAAhB,CAAqB0E,MAAhF;AACA,OAFD;AAGA;;AAED,WAAO3K,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAAE8C,YAAMxD,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwBC,WAAxB,CAAoC,KAAK/G,UAAL,CAAgBmC,MAApD,EAA4D;AAAEwG,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAA5D;AAAR,KAA1B,CAAP;AACA;;AAlCiE,CAAnE;AAqCAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,0BAA3B,EAAuD;AAAEgD,gBAAc;AAAhB,CAAvD,EAA+E;AAC9EC,SAAO;AACN4O,UAAM,KAAK7P,UAAX,EAAuB;AACtB0C,YAAMsN,MAAM0C,eAAN,CAAsB;AAC3BvS,eAAO6P,MAAMC,KAAN,CAAYH,MAAZ,CADoB;AAE3BhT,cAAMkT,MAAMC,KAAN,CAAYH,MAAZ,CAFqB;AAG3B5P,kBAAU8P,MAAMC,KAAN,CAAYH,MAAZ,CAHiB;AAI3B2L,yBAAiBzL,MAAMC,KAAN,CAAYH,MAAZ,CAJU;AAK3B4L,qBAAa1L,MAAMC,KAAN,CAAYH,MAAZ;AALc,OAAtB,CADgB;AAQtBzT,oBAAc2T,MAAMC,KAAN,CAAYxR,MAAZ;AARQ,KAAvB;AAWA,UAAM8c,WAAW;AAChBpb,aAAO,KAAKH,UAAL,CAAgB0C,IAAhB,CAAqBvC,KADZ;AAEhBwb,gBAAU,KAAK3b,UAAL,CAAgB0C,IAAhB,CAAqB5F,IAFf;AAGhBoD,gBAAU,KAAKF,UAAL,CAAgB0C,IAAhB,CAAqBxC,QAHf;AAIhBwb,mBAAa,KAAK1b,UAAL,CAAgB0C,IAAhB,CAAqBgZ,WAJlB;AAKhBE,qBAAe,KAAK5b,UAAL,CAAgB0C,IAAhB,CAAqB+Y;AALpB,KAAjB;AAQA7Z,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,iBAAZ,EAA+B0Z,QAA/B,EAAyC,KAAKvb,UAAL,CAAgB3D,YAAzD,CAApC;AAEA,WAAOI,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAAE8C,YAAMxD,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwBC,WAAxB,CAAoC,KAAK5E,MAAzC,EAAiD;AAAEwG,gBAAQlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBtE;AAA5B,OAAjD;AAAR,KAA1B,CAAP;AACA;;AAxB6E,CAA/E;AA2BAqB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,mBAA3B,EAAgD;AAAEgD,gBAAc;AAAhB,CAAhD,EAAwE;AACvEC,SAAO;AACN,UAAMhB,OAAO,KAAK8K,iBAAL,EAAb;AACA,QAAIrI,IAAJ;AACAd,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM;AACnCO,aAAOd,OAAOC,IAAP,CAAY,aAAZ,EAA2B5B,KAAKgC,GAAhC,CAAP;AACA,KAFD;AAGA,WAAOS,OAAOjG,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAAEuF;AAAF,KAA1B,CAAP,GAA6CjG,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB3B,YAAlB,EAApD;AACA;;AARsE,CAAxE;AAWAtB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,sBAA3B,EAAmD;AAAEgD,gBAAc;AAAhB,CAAnD,EAA2E;AAC1EjE,QAAM;AACL,UAAMkD,OAAOxD,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwBC,WAAxB,CAAoC,KAAK5E,MAAzC,CAAb;;AACA,QAAIlC,KAAK3D,QAAT,EAAmB;AAClB,YAAM;AAAEiM;AAAF,UAAkBtI,KAAK3D,QAA7B;AACAiM,kBAAYlB,QAAZ,GAAuBpH,KAAKoH,QAA5B;AAEA,aAAO5K,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCoL;AADgC,OAA1B,CAAP;AAGA,KAPD,MAOO;AACN,aAAO9L,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B0Z,QAAQC,EAAR,CAAW,iDAAX,EAA8D9X,WAA9D,EAA1B,CAAP;AACA;AACD;;AAbyE,CAA3E;AAgBA7C,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,sBAA3B,EAAmD;AAAEgD,gBAAc;AAAhB,CAAnD,EAA2E;AAC1EC,SAAO;AACN4O,UAAM,KAAK7P,UAAX,EAAuB;AACtBmC,cAAQ6N,MAAMC,KAAN,CAAYH,MAAZ,CADc;AAEtBpN,YAAMsN,MAAM0C,eAAN,CAAsB;AAC3BmJ,6BAAqB7L,MAAMC,KAAN,CAAYH,MAAZ,CADM;AAE3BgM,gCAAwB9L,MAAMC,KAAN,CAAYH,MAAZ,CAFG;AAG3BiM,mBAAW/L,MAAMC,KAAN,CAAY+L,MAAZ,CAHgB;AAI3BC,mBAAWjM,MAAMC,KAAN,CAAY4C,OAAZ,CAJgB;AAK3BqJ,2BAAmBlM,MAAMC,KAAN,CAAY4C,OAAZ,CALQ;AAM3BsJ,6BAAqBnM,MAAMC,KAAN,CAAY4C,OAAZ,CANM;AAO3BuJ,gCAAwBpM,MAAMC,KAAN,CAAY4C,OAAZ,CAPG;AAQ3BwJ,uBAAerM,MAAMC,KAAN,CAAY4C,OAAZ,CARY;AAS3ByJ,+BAAuBtM,MAAMC,KAAN,CAAYH,MAAZ,CATI;AAU3ByM,qBAAavM,MAAMC,KAAN,CAAY4C,OAAZ,CAVc;AAW3B2J,kCAA0BxM,MAAMC,KAAN,CAAY+L,MAAZ,CAXC;AAY3BS,8BAAsBzM,MAAMC,KAAN,CAAYH,MAAZ,CAZK;AAa3B4M,6BAAqB1M,MAAMC,KAAN,CAAYH,MAAZ,CAbM;AAc3B6M,wBAAgB3M,MAAMC,KAAN,CAAY4C,OAAZ,CAdW;AAe3B+J,oBAAY5M,MAAMC,KAAN,CAAYzI,KAAZ,CAfe;AAgB3BqV,qCAA6B7M,MAAMC,KAAN,CAAY+L,MAAZ,CAhBF;AAiB3Bc,yBAAiB9M,MAAMC,KAAN,CAAY+L,MAAZ,CAjBU;AAkB3Be,uBAAe/M,MAAMC,KAAN,CAAY4C,OAAZ,CAlBY;AAmB3BmK,mBAAWhN,MAAMC,KAAN,CAAY4C,OAAZ,CAnBgB;AAoB3BoK,qBAAajN,MAAMC,KAAN,CAAY4C,OAAZ,CApBc;AAqB3BqK,qBAAalN,MAAMC,KAAN,CAAY4C,OAAZ,CArBc;AAsB3BsK,qBAAanN,MAAMC,KAAN,CAAYH,MAAZ,CAtBc;AAuB3BsN,4BAAoBpN,MAAMC,KAAN,CAAY4C,OAAZ,CAvBO;AAwB3BxL,kBAAU2I,MAAMC,KAAN,CAAYH,MAAZ,CAxBiB;AAyB3BuN,8BAAsBrN,MAAMsN,QAAN,CAAezK,OAAf,CAzBK;AA0B3B0K,2BAAmBvN,MAAMsN,QAAN,CAAezK,OAAf,CA1BQ;AA2B3B2K,uBAAexN,MAAMsN,QAAN,CAAexN,MAAf,CA3BY;AA4B3B2N,yBAAiBzN,MAAMsN,QAAN,CAAexN,MAAf,CA5BU;AA6B3B4N,2BAAmB1N,MAAMsN,QAAN,CAAezK,OAAf,CA7BQ;AA8B3B8K,4BAAoB3N,MAAMsN,QAAN,CAAezK,OAAf,CA9BO;AA+B3B+K,kCAA0B5N,MAAMsN,QAAN,CAAezK,OAAf;AA/BC,OAAtB;AAFgB,KAAvB;AAqCA,UAAM1Q,SAAS,KAAKnC,UAAL,CAAgBmC,MAAhB,GAAyB,KAAKnC,UAAL,CAAgBmC,MAAzC,GAAkD,KAAKA,MAAtE;AACA,UAAMoZ,WAAW;AAChBtZ,WAAKE,MADW;AAEhB7F,gBAAU;AACTiM,qBAAa,KAAKvI,UAAL,CAAgB0C;AADpB;AAFM,KAAjB;;AAOA,QAAI,KAAK1C,UAAL,CAAgB0C,IAAhB,CAAqB2E,QAAzB,EAAmC;AAClC,YAAM;AAAEA;AAAF,UAAe,KAAKrH,UAAL,CAAgB0C,IAArC;AACA,aAAO,KAAK1C,UAAL,CAAgB0C,IAAhB,CAAqB2E,QAA5B;AACAkU,eAASlU,QAAT,GAAoBA,QAApB;AACA;;AAEDzF,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAM1F,WAAWke,QAAX,CAAoB,KAAKxY,MAAzB,EAAiCoZ,QAAjC,CAApC;AAEA,WAAO9e,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChC8C,YAAMxD,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwBC,WAAxB,CAAoC5E,MAApC,EAA4C;AACjDwG,gBAAQ;AACP,kCAAwB;AADjB;AADyC,OAA5C;AAD0B,KAA1B,CAAP;AAOA;;AA9DyE,CAA3E;AAiEAlM,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,sBAA3B,EAAmD;AAAEgD,gBAAc;AAAhB,CAAnD,EAA4E;AAC3EC,SAAO;AACN,UAAM;AAAEd;AAAF,QAAY,KAAKH,UAAvB;;AACA,QAAI,CAACG,KAAL,EAAY;AACX,aAAO1D,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,iCAA1B,CAAP;AACA;;AAED,UAAMogB,YAAYjc,OAAOC,IAAP,CAAY,yBAAZ,EAAuC1B,KAAvC,CAAlB;;AACA,QAAI0d,SAAJ,EAAe;AACd,aAAOphB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AACD,WAAOV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,gBAA1B,CAAP;AACA;;AAZ0E,CAA5E;AAeAhB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,6BAA3B,EAA0D;AAAEgD,gBAAc;AAAhB,CAA1D,EAAkF;AACjFjE,QAAM;AACL,UAAMK,SAASwE,OAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,uBAAZ,CAApC,CAAf;AAEA,WAAOpF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAAEC;AAAF,KAA1B,CAAP;AACA;;AALgF,CAAlF;AAQAX,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,mCAA3B,EAAgE;AAAEgD,gBAAc;AAAhB,CAAhE,EAAwF;AACvFC,SAAO;AACN,UAAM;AAAE6c;AAAF,QAAgB,KAAK9d,UAA3B;;AACA,QAAI,CAAC8d,SAAL,EAAgB;AACf,aAAOrhB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,qCAA1B,CAAP;AACA;;AACD,UAAM8E,QAAQX,OAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,oCAAZ,EAAkD;AAAEic;AAAF,KAAlD,CAApC,CAAd;AAEA,WAAOrhB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAAEoF;AAAF,KAA1B,CAAP;AACA;;AATsF,CAAxF;AAYA9F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,qCAA3B,EAAkE;AAAEgD,gBAAc;AAAhB,CAAlE,EAA0F;AACzFC,SAAO;AACN,UAAM;AAAE6c;AAAF,QAAgB,KAAK9d,UAA3B;;AACA,QAAI,CAAC8d,SAAL,EAAgB;AACf,aAAOrhB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,qCAA1B,CAAP;AACA;;AACD,UAAM8E,QAAQX,OAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,sCAAZ,EAAoD;AAAEic;AAAF,KAApD,CAApC,CAAd;AAEA,WAAOrhB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAAEoF;AAAF,KAA1B,CAAP;AACA;;AATwF,CAA1F;AAYA9F,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,+BAA3B,EAA4D;AAAEgD,gBAAc;AAAhB,CAA5D,EAAoF;AACnFjE,QAAM;AACL,QAAI,CAACN,WAAWH,QAAX,CAAoBS,GAApB,CAAwB,mCAAxB,CAAL,EAAmE;AAClE,YAAM,IAAI6E,OAAOqF,KAAX,CAAiB,mDAAjB,EAAsE,+CAAtE,CAAN;AACA;;AACD,UAAM8W,cAActhB,WAAWoK,MAAX,CAAkBC,KAAlB,CAAwBkX,sBAAxB,CAA+C,KAAK7b,MAApD,EAA4DkL,KAA5D,GAAoE,CAApE,CAApB;;AACA,UAAM4Q,0BAA0B,MAAMF,YAAYhiB,QAAZ,CAAqBmiB,MAArB,CAA4BH,WAA5B,CACpC1J,MADoC,CAC5B8J,UAAD,IAAgBA,WAAWxY,IAAX,IAAmBwY,WAAWxY,IAAX,KAAoB,qBAD1B,EAEpC2H,GAFoC,CAE/B6Q,UAAD,KAAiB;AACrBrhB,YAAMqhB,WAAWrhB,IADI;AAErBjB,iBAAWsiB,WAAWtiB,SAFD;AAGrBuiB,qBAAeD,WAAWC;AAHL,KAAjB,CAFgC,CAAtC;;AAQA,WAAO3hB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,CAA0B;AAChCkhB,cAAQJ;AADwB,KAA1B,CAAP;AAGA;;AAjBkF,CAApF;AAoBAxhB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,iCAA3B,EAA8D;AAAEgD,gBAAc;AAAhB,CAA9D,EAAsF;AACrFC,SAAO;AACN,UAAM;AAAE6c;AAAF,QAAgB,KAAK9d,UAA3B;;AACA,QAAI,CAAC8d,SAAL,EAAgB;AACf,aAAOrhB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBjC,OAAlB,CAA0B,qCAA1B,CAAP;AACA;;AACDmE,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,kCAAZ,EAAgD;AACnFic;AADmF,KAAhD,CAApC;AAIA,WAAOrhB,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAXoF,CAAtF,E;;;;;;;;;;;ACxdA,IAAImT,MAAJ;AAAW/V,OAAOC,KAAP,CAAaC,QAAQ,QAAR,CAAb,EAA+B;AAACC,UAAQC,CAAR,EAAU;AAAC2V,aAAO3V,CAAP;AAAS;;AAArB,CAA/B,EAAsD,CAAtD;AAEX8B,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,iBAA3B,EAA8C;AAAEgD,gBAAc;AAAhB,CAA9C,EAAsE;AACrEC,SAAO;AACN,UAAM4P,SAAS,IAAIP,MAAJ,CAAW;AAAElR,eAAS,KAAKD,OAAL,CAAaC;AAAxB,KAAX,CAAf;AACA,UAAMuJ,SAAS,EAAf;AACA,QAAI2V,QAAQ,EAAZ;AAEA1c,WAAOkP,SAAP,CAAkBC,QAAD,IAAc;AAC9BF,aAAOG,EAAP,CAAU,OAAV,EAAmB,CAACC,SAAD,EAAY1L,KAAZ,KAAsBoD,OAAOsI,SAAP,IAAoB1L,KAA7D;AACAsL,aAAOG,EAAP,CAAU,MAAV,EAAkBpP,OAAO4P,eAAP,CAAuB,CAACP,SAAD,EAAYrE,IAAZ,EAAkBsE,QAAlB,EAA4BC,QAA5B,EAAsCC,QAAtC,KAAmD;AAC3F,cAAMmN,eAAe9f,OAAOC,IAAP,CAAYjC,WAAW+hB,MAAX,CAAkBC,MAA9B,EAAsChe,QAAtC,CAA+CwQ,SAA/C,CAArB;;AACA,YAAI,CAACsN,YAAL,EAAmB;AAClBxN,mBAAS,IAAInP,OAAOqF,KAAX,CAAiB,qBAAjB,EAAwC,eAAxC,CAAT;AACA;;AACD,cAAMyX,YAAY,EAAlB;AACA9R,aAAKoE,EAAL,CAAQ,MAAR,EAAgBpP,OAAO4P,eAAP,CAAwB9O,IAAD,IAAU;AAChDgc,oBAAUxhB,IAAV,CAAewF,IAAf;AACA,SAFe,CAAhB;AAIAkK,aAAKoE,EAAL,CAAQ,KAAR,EAAepP,OAAO4P,eAAP,CAAuB,MAAM;AAC3C8M,kBAAQ;AACPK,oBAAQpN,OAAOvI,MAAP,CAAc0V,SAAd,CADD;AAEP5hB,kBAAMmU,SAFC;AAGPG;AAHO,WAAR;AAKA,SANc,CAAf;AAOA,OAjBiB,CAAlB;AAkBAP,aAAOG,EAAP,CAAU,QAAV,EAAoB,MAAMD,UAA1B;AACA,WAAK5R,OAAL,CAAasS,IAAb,CAAkBZ,MAAlB;AACA,KAtBD;AAuBAjP,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,UAAZ,EAAwByc,MAAMK,MAA9B,EAAsCL,MAAMlN,QAA5C,EAAsDkN,MAAMxhB,IAA5D,CAApC;;AACA,QAAI6L,OAAOiW,iBAAX,EAA8B;AAC7Bhd,aAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,gBAAZ,CAApC;AACA;;AACD,WAAOpF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAlCoE,CAAtE;AAqCAV,WAAW3B,GAAX,CAAe4E,EAAf,CAAkB1B,QAAlB,CAA2B,mBAA3B,EAAgD;AAAEgD,gBAAc;AAAhB,CAAhD,EAAwE;AACvEC,SAAO;AACN,UAAM;AAAE4d,eAAF;AAAaD;AAAb,QAAmC,KAAK5e,UAA9C;AACA,UAAMue,eAAe9f,OAAOC,IAAP,CAAYjC,WAAW+hB,MAAX,CAAkBC,MAA9B,EAAsChe,QAAtC,CAA+Coe,SAA/C,CAArB;;AACA,QAAI,CAACN,YAAL,EAAmB;AAClB,YAAM,IAAI3c,OAAOqF,KAAX,CAAiB,qBAAjB,EAAwC,eAAxC,CAAN;AACA;;AACDrF,WAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,YAAZ,EAA0Bgd,SAA1B,CAApC;;AACA,QAAID,iBAAJ,EAAuB;AACtBhd,aAAOgJ,SAAP,CAAiB,KAAKzI,MAAtB,EAA8B,MAAMP,OAAOC,IAAP,CAAY,gBAAZ,CAApC;AACA;;AACD,WAAOpF,WAAW3B,GAAX,CAAe4E,EAAf,CAAkBvC,OAAlB,EAAP;AACA;;AAZsE,CAAxE,E","file":"/packages/rocketchat_api.js","sourcesContent":["/* global Restivus, DDP, DDPCommon */\nimport _ from 'underscore';\nconst logger = new Logger('API', {});\n\nclass API extends Restivus {\n\tconstructor(properties) {\n\t\tsuper(properties);\n\t\tthis.authMethods = [];\n\t\tthis.fieldSeparator = '.';\n\t\tthis.defaultFieldsToExclude = {\n\t\t\tjoinCode: 0,\n\t\t\tmembers: 0,\n\t\t\timportIds: 0,\n\t\t};\n\t\tthis.limitedUserFieldsToExclude = {\n\t\t\tavatarOrigin: 0,\n\t\t\temails: 0,\n\t\t\tphone: 0,\n\t\t\tstatusConnection: 0,\n\t\t\tcreatedAt: 0,\n\t\t\tlastLogin: 0,\n\t\t\tservices: 0,\n\t\t\trequirePasswordChange: 0,\n\t\t\trequirePasswordChangeReason: 0,\n\t\t\troles: 0,\n\t\t\tstatusDefault: 0,\n\t\t\t_updatedAt: 0,\n\t\t\tcustomFields: 0,\n\t\t\tsettings: 0,\n\t\t};\n\t\tthis.limitedUserFieldsToExcludeIfIsPrivilegedUser = {\n\t\t\tservices: 0,\n\t\t};\n\t}\n\n\thasHelperMethods() {\n\t\treturn RocketChat.API.helperMethods.size !== 0;\n\t}\n\n\tgetHelperMethods() {\n\t\treturn RocketChat.API.helperMethods;\n\t}\n\n\tgetHelperMethod(name) {\n\t\treturn RocketChat.API.helperMethods.get(name);\n\t}\n\n\taddAuthMethod(method) {\n\t\tthis.authMethods.push(method);\n\t}\n\n\tsuccess(result = {}) {\n\t\tif (_.isObject(result)) {\n\t\t\tresult.success = true;\n\t\t}\n\n\t\tresult = {\n\t\t\tstatusCode: 200,\n\t\t\tbody: result,\n\t\t};\n\n\t\tlogger.debug('Success', result);\n\n\t\treturn result;\n\t}\n\n\tfailure(result, errorType, stack) {\n\t\tif (_.isObject(result)) {\n\t\t\tresult.success = false;\n\t\t} else {\n\t\t\tresult = {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: result,\n\t\t\t\tstack,\n\t\t\t};\n\n\t\t\tif (errorType) {\n\t\t\t\tresult.errorType = errorType;\n\t\t\t}\n\t\t}\n\n\t\tresult = {\n\t\t\tstatusCode: 400,\n\t\t\tbody: result,\n\t\t};\n\n\t\tlogger.debug('Failure', result);\n\n\t\treturn result;\n\t}\n\n\tnotFound(msg) {\n\t\treturn {\n\t\t\tstatusCode: 404,\n\t\t\tbody: {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: msg ? msg : 'Resource not found',\n\t\t\t},\n\t\t};\n\t}\n\n\tunauthorized(msg) {\n\t\treturn {\n\t\t\tstatusCode: 403,\n\t\t\tbody: {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: msg ? msg : 'unauthorized',\n\t\t\t},\n\t\t};\n\t}\n\n\taddRoute(routes, options, endpoints) {\n\t\t// Note: required if the developer didn't provide options\n\t\tif (typeof endpoints === 'undefined') {\n\t\t\tendpoints = options;\n\t\t\toptions = {};\n\t\t}\n\n\t\t// Allow for more than one route using the same option and endpoints\n\t\tif (!_.isArray(routes)) {\n\t\t\troutes = [routes];\n\t\t}\n\n\t\tconst { version } = this._config;\n\n\t\troutes.forEach((route) => {\n\t\t\t// Note: This is required due to Restivus calling `addRoute` in the constructor of itself\n\t\t\tObject.keys(endpoints).forEach((method) => {\n\t\t\t\tif (typeof endpoints[method] === 'function') {\n\t\t\t\t\tendpoints[method] = { action: endpoints[method] };\n\t\t\t\t}\n\n\t\t\t\t// Add a try/catch for each endpoint\n\t\t\t\tconst originalAction = endpoints[method].action;\n\t\t\t\tendpoints[method].action = function _internalRouteActionHandler() {\n\t\t\t\t\tconst rocketchatRestApiEnd = RocketChat.metrics.rocketchatRestApi.startTimer({\n\t\t\t\t\t\tmethod,\n\t\t\t\t\t\tversion,\n\t\t\t\t\t\tuser_agent: this.request.headers['user-agent'],\n\t\t\t\t\t\tentrypoint: route,\n\t\t\t\t\t});\n\n\t\t\t\t\tlogger.debug(`${ this.request.method.toUpperCase() }: ${ this.request.url }`);\n\t\t\t\t\tlet result;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tresult = originalAction.apply(this);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlogger.debug(`${ method } ${ route } threw an error:`, e.stack);\n\t\t\t\t\t\tresult = RocketChat.API.v1.failure(e.message, e.error);\n\t\t\t\t\t}\n\n\t\t\t\t\tresult = result || RocketChat.API.v1.success();\n\n\t\t\t\t\trocketchatRestApiEnd({\n\t\t\t\t\t\tstatus: result.statusCode,\n\t\t\t\t\t});\n\n\t\t\t\t\treturn result;\n\t\t\t\t};\n\n\t\t\t\tif (this.hasHelperMethods()) {\n\t\t\t\t\tfor (const [name, helperMethod] of this.getHelperMethods()) {\n\t\t\t\t\t\tendpoints[method][name] = helperMethod;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Allow the endpoints to make usage of the logger which respects the user's settings\n\t\t\t\tendpoints[method].logger = logger;\n\t\t\t});\n\n\t\t\tsuper.addRoute(route, options, endpoints);\n\t\t});\n\t}\n\n\t_initAuth() {\n\t\tconst loginCompatibility = (bodyParams) => {\n\t\t\t// Grab the username or email that the user is logging in with\n\t\t\tconst { user, username, email, password, code } = bodyParams;\n\n\t\t\tif (password == null) {\n\t\t\t\treturn bodyParams;\n\t\t\t}\n\n\t\t\tif (_.without(Object.keys(bodyParams), 'user', 'username', 'email', 'password', 'code').length > 0) {\n\t\t\t\treturn bodyParams;\n\t\t\t}\n\n\t\t\tconst auth = {\n\t\t\t\tpassword,\n\t\t\t};\n\n\t\t\tif (typeof user === 'string') {\n\t\t\t\tauth.user = user.includes('@') ? { email: user } : { username: user };\n\t\t\t} else if (username) {\n\t\t\t\tauth.user = { username };\n\t\t\t} else if (email) {\n\t\t\t\tauth.user = { email };\n\t\t\t}\n\n\t\t\tif (auth.user == null) {\n\t\t\t\treturn bodyParams;\n\t\t\t}\n\n\t\t\tif (auth.password.hashed) {\n\t\t\t\tauth.password = {\n\t\t\t\t\tdigest: auth.password,\n\t\t\t\t\talgorithm: 'sha-256',\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (code) {\n\t\t\t\treturn {\n\t\t\t\t\ttotp: {\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\tlogin: auth,\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn auth;\n\t\t};\n\n\t\tconst self = this;\n\n\t\tthis.addRoute('login', { authRequired: false }, {\n\t\t\tpost() {\n\t\t\t\tconst args = loginCompatibility(this.bodyParams);\n\t\t\t\tconst getUserInfo = self.getHelperMethod('getUserInfo');\n\n\t\t\t\tconst invocation = new DDPCommon.MethodInvocation({\n\t\t\t\t\tconnection: {\n\t\t\t\t\t\tclose() {},\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tlet auth;\n\t\t\t\ttry {\n\t\t\t\t\tauth = DDP._CurrentInvocation.withValue(invocation, () => Meteor.call('login', args));\n\t\t\t\t} catch (error) {\n\t\t\t\t\tlet e = error;\n\t\t\t\t\tif (error.reason === 'User not found') {\n\t\t\t\t\t\te = {\n\t\t\t\t\t\t\terror: 'Unauthorized',\n\t\t\t\t\t\t\treason: 'Unauthorized',\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tstatusCode: 401,\n\t\t\t\t\t\tbody: {\n\t\t\t\t\t\t\tstatus: 'error',\n\t\t\t\t\t\t\terror: e.error,\n\t\t\t\t\t\t\tmessage: e.reason || e.message,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tthis.user = Meteor.users.findOne({\n\t\t\t\t\t_id: auth.id,\n\t\t\t\t});\n\n\t\t\t\tthis.userId = this.user._id;\n\n\t\t\t\t// Remove tokenExpires to keep the old behavior\n\t\t\t\tMeteor.users.update({\n\t\t\t\t\t_id: this.user._id,\n\t\t\t\t\t'services.resume.loginTokens.hashedToken': Accounts._hashLoginToken(auth.token),\n\t\t\t\t}, {\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\t'services.resume.loginTokens.$.when': 1,\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tconst response = {\n\t\t\t\t\tstatus: 'success',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tauthToken: auth.token,\n\t\t\t\t\t\tme: getUserInfo(this.user),\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tconst extraData = self._config.onLoggedIn && self._config.onLoggedIn.call(this);\n\n\t\t\t\tif (extraData != null) {\n\t\t\t\t\t_.extend(response.data, {\n\t\t\t\t\t\textra: extraData,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn response;\n\t\t\t},\n\t\t});\n\n\t\tconst logout = function() {\n\t\t\t// Remove the given auth token from the user's account\n\t\t\tconst authToken = this.request.headers['x-auth-token'];\n\t\t\tconst hashedToken = Accounts._hashLoginToken(authToken);\n\t\t\tconst tokenLocation = self._config.auth.token;\n\t\t\tconst index = tokenLocation.lastIndexOf('.');\n\t\t\tconst tokenPath = tokenLocation.substring(0, index);\n\t\t\tconst tokenFieldName = tokenLocation.substring(index + 1);\n\t\t\tconst tokenToRemove = {};\n\t\t\ttokenToRemove[tokenFieldName] = hashedToken;\n\t\t\tconst tokenRemovalQuery = {};\n\t\t\ttokenRemovalQuery[tokenPath] = tokenToRemove;\n\n\t\t\tMeteor.users.update(this.user._id, {\n\t\t\t\t$pull: tokenRemovalQuery,\n\t\t\t});\n\n\t\t\tconst response = {\n\t\t\t\tstatus: 'success',\n\t\t\t\tdata: {\n\t\t\t\t\tmessage: 'You\\'ve been logged out!',\n\t\t\t\t},\n\t\t\t};\n\n\t\t\t// Call the logout hook with the authenticated user attached\n\t\t\tconst extraData = self._config.onLoggedOut && self._config.onLoggedOut.call(this);\n\t\t\tif (extraData != null) {\n\t\t\t\t_.extend(response.data, {\n\t\t\t\t\textra: extraData,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn response;\n\t\t};\n\n\t\t/*\n\t\t\tAdd a logout endpoint to the API\n\t\t\tAfter the user is logged out, the onLoggedOut hook is called (see Restfully.configure() for\n\t\t\tadding hook).\n\t\t*/\n\t\treturn this.addRoute('logout', {\n\t\t\tauthRequired: true,\n\t\t}, {\n\t\t\tget() {\n\t\t\t\tconsole.warn('Warning: Default logout via GET will be removed in Restivus v1.0. Use POST instead.');\n\t\t\t\tconsole.warn('    See https://github.com/kahmali/meteor-restivus/issues/100');\n\t\t\t\treturn logout.call(this);\n\t\t\t},\n\t\t\tpost: logout,\n\t\t});\n\t}\n}\n\nconst getUserAuth = function _getUserAuth(...args) {\n\tconst invalidResults = [undefined, null, false];\n\treturn {\n\t\ttoken: 'services.resume.loginTokens.hashedToken',\n\t\tuser() {\n\t\t\tif (this.bodyParams && this.bodyParams.payload) {\n\t\t\t\tthis.bodyParams = JSON.parse(this.bodyParams.payload);\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < RocketChat.API.v1.authMethods.length; i++) {\n\t\t\t\tconst method = RocketChat.API.v1.authMethods[i];\n\n\t\t\t\tif (typeof method === 'function') {\n\t\t\t\t\tconst result = method.apply(this, args);\n\t\t\t\t\tif (!invalidResults.includes(result)) {\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet token;\n\t\t\tif (this.request.headers['x-auth-token']) {\n\t\t\t\ttoken = Accounts._hashLoginToken(this.request.headers['x-auth-token']);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tuserId: this.request.headers['x-user-id'],\n\t\t\t\ttoken,\n\t\t\t};\n\t\t},\n\t};\n};\n\nRocketChat.API = {\n\thelperMethods: new Map(),\n\tgetUserAuth,\n\tApiClass: API,\n};\n\nconst defaultOptionsEndpoint = function _defaultOptionsEndpoint() {\n\tif (this.request.method === 'OPTIONS' && this.request.headers['access-control-request-method']) {\n\t\tif (RocketChat.settings.get('API_Enable_CORS') === true) {\n\t\t\tthis.response.writeHead(200, {\n\t\t\t\t'Access-Control-Allow-Origin': RocketChat.settings.get('API_CORS_Origin'),\n\t\t\t\t'Access-Control-Allow-Headers': 'Origin, X-Requested-With, Content-Type, Accept, X-User-Id, X-Auth-Token',\n\t\t\t});\n\t\t} else {\n\t\t\tthis.response.writeHead(405);\n\t\t\tthis.response.write('CORS not enabled. Go to \"Admin > General > REST Api\" to enable it.');\n\t\t}\n\t} else {\n\t\tthis.response.writeHead(404);\n\t}\n\tthis.done();\n};\n\nconst createApi = function _createApi(enableCors) {\n\tif (!RocketChat.API.v1 || RocketChat.API.v1._config.enableCors !== enableCors) {\n\t\tRocketChat.API.v1 = new API({\n\t\t\tversion: 'v1',\n\t\t\tuseDefaultAuth: true,\n\t\t\tprettyJson: process.env.NODE_ENV === 'development',\n\t\t\tenableCors,\n\t\t\tdefaultOptionsEndpoint,\n\t\t\tauth: getUserAuth(),\n\t\t});\n\t}\n\n\tif (!RocketChat.API.default || RocketChat.API.default._config.enableCors !== enableCors) {\n\t\tRocketChat.API.default = new API({\n\t\t\tuseDefaultAuth: true,\n\t\t\tprettyJson: process.env.NODE_ENV === 'development',\n\t\t\tenableCors,\n\t\t\tdefaultOptionsEndpoint,\n\t\t\tauth: getUserAuth(),\n\t\t});\n\t}\n};\n\n// register the API to be re-created once the CORS-setting changes.\nRocketChat.settings.get('API_Enable_CORS', (key, value) => {\n\tcreateApi(value);\n});\n\n// also create the API immediately\ncreateApi(!!RocketChat.settings.get('API_Enable_CORS'));\n","RocketChat.settings.addGroup('General', function() {\n\tthis.section('REST API', function() {\n\t\tthis.add('API_Upper_Count_Limit', 100, { type: 'int', public: false });\n\t\tthis.add('API_Default_Count', 50, { type: 'int', public: false });\n\t\tthis.add('API_Allow_Infinite_Count', true, { type: 'boolean', public: false });\n\t\tthis.add('API_Enable_Direct_Message_History_EndPoint', false, { type: 'boolean', public: false });\n\t\tthis.add('API_Enable_Shields', true, { type: 'boolean', public: false });\n\t\tthis.add('API_Shield_Types', '*', { type: 'string', public: false, enableQuery: { _id: 'API_Enable_Shields', value: true } });\n\t\tthis.add('API_Enable_CORS', false, { type: 'boolean', public: false });\n\t\tthis.add('API_CORS_Origin', '*', { type: 'string', public: false, enableQuery: { _id: 'API_Enable_CORS', value: true } });\n\t});\n});\n","RocketChat.API.helperMethods.set('requestParams', function _requestParams() {\n\treturn ['POST', 'PUT'].includes(this.request.method) ? this.bodyParams : this.queryParams;\n});\n","// If the count query param is higher than the \"API_Upper_Count_Limit\" setting, then we limit that\n// If the count query param isn't defined, then we set it to the \"API_Default_Count\" setting\n// If the count is zero, then that means unlimited and is only allowed if the setting \"API_Allow_Infinite_Count\" is true\n\nRocketChat.API.helperMethods.set('getPaginationItems', function _getPaginationItems() {\n\tconst hardUpperLimit = RocketChat.settings.get('API_Upper_Count_Limit') <= 0 ? 100 : RocketChat.settings.get('API_Upper_Count_Limit');\n\tconst defaultCount = RocketChat.settings.get('API_Default_Count') <= 0 ? 50 : RocketChat.settings.get('API_Default_Count');\n\tconst offset = this.queryParams.offset ? parseInt(this.queryParams.offset) : 0;\n\tlet count = defaultCount;\n\n\t// Ensure count is an appropiate amount\n\tif (typeof this.queryParams.count !== 'undefined') {\n\t\tcount = parseInt(this.queryParams.count);\n\t} else {\n\t\tcount = defaultCount;\n\t}\n\n\tif (count > hardUpperLimit) {\n\t\tcount = hardUpperLimit;\n\t}\n\n\tif (count === 0 && !RocketChat.settings.get('API_Allow_Infinite_Count')) {\n\t\tcount = defaultCount;\n\t}\n\n\treturn {\n\t\toffset,\n\t\tcount,\n\t};\n});\n","// Convenience method, almost need to turn it into a middleware of sorts\nRocketChat.API.helperMethods.set('getUserFromParams', function _getUserFromParams() {\n\tconst doesntExist = { _doesntExist: true };\n\tlet user;\n\tconst params = this.requestParams();\n\n\tif (params.userId && params.userId.trim()) {\n\t\tuser = RocketChat.models.Users.findOneById(params.userId) || doesntExist;\n\t} else if (params.username && params.username.trim()) {\n\t\tuser = RocketChat.models.Users.findOneByUsername(params.username) || doesntExist;\n\t} else if (params.user && params.user.trim()) {\n\t\tuser = RocketChat.models.Users.findOneByUsername(params.user) || doesntExist;\n\t} else {\n\t\tthrow new Meteor.Error('error-user-param-not-provided', 'The required \"userId\" or \"username\" param was not provided');\n\t}\n\n\tif (user._doesntExist) {\n\t\tthrow new Meteor.Error('error-invalid-user', 'The required \"userId\" or \"username\" param provided does not match any users');\n\t}\n\n\treturn user;\n});\n","const getInfoFromUserObject = (user) => {\n\tconst {\n\t\t_id,\n\t\tname,\n\t\temails,\n\t\tstatus,\n\t\tstatusConnection,\n\t\tusername,\n\t\tutcOffset,\n\t\tactive,\n\t\tlanguage,\n\t\troles,\n\t\tsettings,\n\t\tcustomFields,\n\t} = user;\n\treturn {\n\t\t_id,\n\t\tname,\n\t\temails,\n\t\tstatus,\n\t\tstatusConnection,\n\t\tusername,\n\t\tutcOffset,\n\t\tactive,\n\t\tlanguage,\n\t\troles,\n\t\tsettings,\n\t\tcustomFields,\n\t};\n};\n\n\nRocketChat.API.helperMethods.set('getUserInfo', function _getUserInfo(user) {\n\tconst me = getInfoFromUserObject(user);\n\tconst isVerifiedEmail = () => {\n\t\tif (me && me.emails && Array.isArray(me.emails)) {\n\t\t\treturn me.emails.find((email) => email.verified);\n\t\t}\n\t\treturn false;\n\t};\n\tconst getUserPreferences = () => {\n\t\tconst defaultUserSettingPrefix = 'Accounts_Default_User_Preferences_';\n\t\tconst allDefaultUserSettings = RocketChat.settings.get(new RegExp(`^${ defaultUserSettingPrefix }.*$`));\n\n\t\treturn allDefaultUserSettings.reduce((accumulator, setting) => {\n\t\t\tconst settingWithoutPrefix = setting.key.replace(defaultUserSettingPrefix, ' ').trim();\n\t\t\taccumulator[settingWithoutPrefix] = RocketChat.getUserPreference(user, settingWithoutPrefix);\n\t\t\treturn accumulator;\n\t\t}, {});\n\t};\n\tconst verifiedEmail = isVerifiedEmail();\n\tme.email = verifiedEmail ? verifiedEmail.address : undefined;\n\tme.settings = {\n\t\tpreferences: getUserPreferences(),\n\t};\n\n\treturn me;\n});\n","RocketChat.API.helperMethods.set('isUserFromParams', function _isUserFromParams() {\n\tconst params = this.requestParams();\n\n\treturn (!params.userId && !params.username && !params.user) ||\n\t\t(params.userId && this.userId === params.userId) ||\n\t\t(params.username && this.user.username === params.username) ||\n\t\t(params.user && this.user.username === params.user);\n});\n","RocketChat.API.helperMethods.set('parseJsonQuery', function _parseJsonQuery() {\n\tlet sort;\n\tif (this.queryParams.sort) {\n\t\ttry {\n\t\t\tsort = JSON.parse(this.queryParams.sort);\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(`Invalid sort parameter provided \"${ this.queryParams.sort }\":`, e);\n\t\t\tthrow new Meteor.Error('error-invalid-sort', `Invalid sort parameter provided: \"${ this.queryParams.sort }\"`, { helperMethod: 'parseJsonQuery' });\n\t\t}\n\t}\n\n\tlet fields;\n\tif (this.queryParams.fields) {\n\t\ttry {\n\t\t\tfields = JSON.parse(this.queryParams.fields);\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(`Invalid fields parameter provided \"${ this.queryParams.fields }\":`, e);\n\t\t\tthrow new Meteor.Error('error-invalid-fields', `Invalid fields parameter provided: \"${ this.queryParams.fields }\"`, { helperMethod: 'parseJsonQuery' });\n\t\t}\n\t}\n\n\t// Verify the user's selected fields only contains ones which their role allows\n\tif (typeof fields === 'object') {\n\t\tlet nonSelectableFields = Object.keys(RocketChat.API.v1.defaultFieldsToExclude);\n\t\tif (this.request.route.includes('/v1/users.')) {\n\t\t\tconst getFields = () => Object.keys(RocketChat.authz.hasPermission(this.userId, 'view-full-other-user-info') ? RocketChat.API.v1.limitedUserFieldsToExcludeIfIsPrivilegedUser : RocketChat.API.v1.limitedUserFieldsToExclude);\n\t\t\tnonSelectableFields = nonSelectableFields.concat(getFields());\n\t\t}\n\n\t\tObject.keys(fields).forEach((k) => {\n\t\t\tif (nonSelectableFields.includes(k) || nonSelectableFields.includes(k.split(RocketChat.API.v1.fieldSeparator)[0])) {\n\t\t\t\tdelete fields[k];\n\t\t\t}\n\t\t});\n\t}\n\n\t// Limit the fields by default\n\tfields = Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude);\n\tif (this.request.route.includes('/v1/users.')) {\n\t\tif (RocketChat.authz.hasPermission(this.userId, 'view-full-other-user-info')) {\n\t\t\tfields = Object.assign(fields, RocketChat.API.v1.limitedUserFieldsToExcludeIfIsPrivilegedUser);\n\t\t} else {\n\t\t\tfields = Object.assign(fields, RocketChat.API.v1.limitedUserFieldsToExclude);\n\t\t}\n\t}\n\n\tlet query = {};\n\tif (this.queryParams.query) {\n\t\ttry {\n\t\t\tquery = JSON.parse(this.queryParams.query);\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(`Invalid query parameter provided \"${ this.queryParams.query }\":`, e);\n\t\t\tthrow new Meteor.Error('error-invalid-query', `Invalid query parameter provided: \"${ this.queryParams.query }\"`, { helperMethod: 'parseJsonQuery' });\n\t\t}\n\t}\n\n\t// Verify the user has permission to query the fields they are\n\tif (typeof query === 'object') {\n\t\tlet nonQueryableFields = Object.keys(RocketChat.API.v1.defaultFieldsToExclude);\n\t\tif (this.request.route.includes('/v1/users.')) {\n\t\t\tif (RocketChat.authz.hasPermission(this.userId, 'view-full-other-user-info')) {\n\t\t\t\tnonQueryableFields = nonQueryableFields.concat(Object.keys(RocketChat.API.v1.limitedUserFieldsToExcludeIfIsPrivilegedUser));\n\t\t\t} else {\n\t\t\t\tnonQueryableFields = nonQueryableFields.concat(Object.keys(RocketChat.API.v1.limitedUserFieldsToExclude));\n\t\t\t}\n\t\t}\n\n\t\tObject.keys(query).forEach((k) => {\n\t\t\tif (nonQueryableFields.includes(k) || nonQueryableFields.includes(k.split(RocketChat.API.v1.fieldSeparator)[0])) {\n\t\t\t\tdelete query[k];\n\t\t\t}\n\t\t});\n\t}\n\n\treturn {\n\t\tsort,\n\t\tfields,\n\t\tquery,\n\t};\n});\n","RocketChat.API.helperMethods.set('deprecationWarning', function _deprecationWarning({ endpoint, versionWillBeRemove, response }) {\n\tconst warningMessage = `The endpoint \"${ endpoint }\" is deprecated and will be removed after version ${ versionWillBeRemove }`;\n\tconsole.warn(warningMessage);\n\tif (process.env.NODE_ENV === 'development') {\n\t\treturn {\n\t\t\twarning: warningMessage,\n\t\t\t...response,\n\t\t};\n\t}\n\n\treturn response;\n});\n\n","RocketChat.API.helperMethods.set('getLoggedInUser', function _getLoggedInUser() {\n\tlet user;\n\n\tif (this.request.headers['x-auth-token'] && this.request.headers['x-user-id']) {\n\t\tuser = RocketChat.models.Users.findOne({\n\t\t\t_id: this.request.headers['x-user-id'],\n\t\t\t'services.resume.loginTokens.hashedToken': Accounts._hashLoginToken(this.request.headers['x-auth-token']),\n\t\t});\n\t}\n\n\treturn user;\n});\n","RocketChat.API.helperMethods.set('insertUserObject', function _addUserToObject({ object, userId }) {\n\tconst user = RocketChat.models.Users.findOneById(userId);\n\tobject.user = { };\n\tif (user) {\n\t\tobject.user = {\n\t\t\t_id: userId,\n\t\t\tusername: user.username,\n\t\t\tname: user.name,\n\t\t};\n\t}\n\n\n\treturn object;\n});\n\n","RocketChat.API.default.addRoute('info', { authRequired: false }, {\n\tget() {\n\t\tconst user = this.getLoggedInUser();\n\n\t\tif (user && RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tinfo: RocketChat.Info,\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tversion: RocketChat.Info.version,\n\t\t});\n\t},\n});\n","import _ from 'underscore';\n\n// Returns the channel IF found otherwise it will return the failure of why it didn't. Check the `statusCode` property\nfunction findChannelByIdOrName({ params, checkedArchived = true }) {\n\tif ((!params.roomId || !params.roomId.trim()) && (!params.roomName || !params.roomName.trim())) {\n\t\tthrow new Meteor.Error('error-roomid-param-not-provided', 'The parameter \"roomId\" or \"roomName\" is required');\n\t}\n\n\tconst fields = { ...RocketChat.API.v1.defaultFieldsToExclude };\n\n\tlet room;\n\tif (params.roomId) {\n\t\troom = RocketChat.models.Rooms.findOneById(params.roomId, { fields });\n\t} else if (params.roomName) {\n\t\troom = RocketChat.models.Rooms.findOneByName(params.roomName, { fields });\n\t}\n\n\tif (!room || room.t !== 'c') {\n\t\tthrow new Meteor.Error('error-room-not-found', 'The required \"roomId\" or \"roomName\" param provided does not match any channel');\n\t}\n\n\tif (checkedArchived && room.archived) {\n\t\tthrow new Meteor.Error('error-room-archived', `The channel, ${ room.name }, is archived`);\n\t}\n\n\treturn room;\n}\n\nRocketChat.API.v1.addRoute('channels.addAll', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addAllUserToRoom', findResult._id, this.bodyParams.activeUsersOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.addModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomModerator', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.addOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomOwner', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.archive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('archiveRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.close', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tconst sub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(findResult._id, this.userId);\n\n\t\tif (!sub) {\n\t\t\treturn RocketChat.API.v1.failure(`The user/callee is not in the channel \"${ findResult.name }.`);\n\t\t}\n\n\t\tif (!sub.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The channel, ${ findResult.name }, is already closed to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('hideRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.counters', { authRequired: true }, {\n\tget() {\n\t\tconst access = RocketChat.authz.hasPermission(this.userId, 'view-room-administration');\n\t\tconst { userId } = this.requestParams();\n\t\tlet user = this.userId;\n\t\tlet unreads = null;\n\t\tlet userMentions = null;\n\t\tlet unreadsFrom = null;\n\t\tlet joined = false;\n\t\tlet msgs = null;\n\t\tlet latest = null;\n\t\tlet members = null;\n\n\t\tif (userId) {\n\t\t\tif (!access) {\n\t\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t\t}\n\t\t\tuser = userId;\n\t\t}\n\t\tconst room = findChannelByIdOrName({\n\t\t\tparams: this.requestParams(),\n\t\t\treturnUsernames: true,\n\t\t});\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(room._id, user);\n\t\tconst lm = room.lm ? room.lm : room._updatedAt;\n\n\t\tif (typeof subscription !== 'undefined' && subscription.open) {\n\t\t\tunreads = RocketChat.models.Messages.countVisibleByRoomIdBetweenTimestampsInclusive(subscription.rid, subscription.ls, lm);\n\t\t\tunreadsFrom = subscription.ls || subscription.ts;\n\t\t\tuserMentions = subscription.userMentions;\n\t\t\tjoined = true;\n\t\t}\n\n\t\tif (access || joined) {\n\t\t\tmsgs = room.msgs;\n\t\t\tlatest = lm;\n\t\t\tmembers = room.usersCount;\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tjoined,\n\t\t\tmembers,\n\t\t\tunreads,\n\t\t\tunreadsFrom,\n\t\t\tmsgs,\n\t\t\tlatest,\n\t\t\tuserMentions,\n\t\t});\n\t},\n});\n\n// Channel -> create\n\nfunction createChannelValidator(params) {\n\tif (!RocketChat.authz.hasPermission(params.user.value, 'create-c')) {\n\t\tthrow new Error('unauthorized');\n\t}\n\n\tif (!params.name || !params.name.value) {\n\t\tthrow new Error(`Param \"${ params.name.key }\" is required`);\n\t}\n\n\tif (params.members && params.members.value && !_.isArray(params.members.value)) {\n\t\tthrow new Error(`Param \"${ params.members.key }\" must be an array if provided`);\n\t}\n\n\tif (params.customFields && params.customFields.value && !(typeof params.customFields.value === 'object')) {\n\t\tthrow new Error(`Param \"${ params.customFields.key }\" must be an object if provided`);\n\t}\n}\n\nfunction createChannel(userId, params) {\n\tconst readOnly = typeof params.readOnly !== 'undefined' ? params.readOnly : false;\n\n\tlet id;\n\tMeteor.runAsUser(userId, () => {\n\t\tid = Meteor.call('createChannel', params.name, params.members ? params.members : [], readOnly, params.customFields);\n\t});\n\n\treturn {\n\t\tchannel: RocketChat.models.Rooms.findOneById(id.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t};\n}\n\nRocketChat.API.channels = {};\nRocketChat.API.channels.create = {\n\tvalidate: createChannelValidator,\n\texecute: createChannel,\n};\n\nRocketChat.API.v1.addRoute('channels.create', { authRequired: true }, {\n\tpost() {\n\t\tconst { userId, bodyParams } = this;\n\n\t\tlet error;\n\n\t\ttry {\n\t\t\tRocketChat.API.channels.create.validate({\n\t\t\t\tuser: {\n\t\t\t\t\tvalue: userId,\n\t\t\t\t},\n\t\t\t\tname: {\n\t\t\t\t\tvalue: bodyParams.name,\n\t\t\t\t\tkey: 'name',\n\t\t\t\t},\n\t\t\t\tmembers: {\n\t\t\t\t\tvalue: bodyParams.members,\n\t\t\t\t\tkey: 'members',\n\t\t\t\t},\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tif (e.message === 'unauthorized') {\n\t\t\t\terror = RocketChat.API.v1.unauthorized();\n\t\t\t} else {\n\t\t\t\terror = RocketChat.API.v1.failure(e.message);\n\t\t\t}\n\t\t}\n\n\t\tif (error) {\n\t\t\treturn error;\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(RocketChat.API.channels.create.execute(userId, bodyParams));\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.delete', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('eraseRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: findResult,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.files', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\t\tconst addUserObjectToEveryObject = (file) => {\n\t\t\tif (file.userId) {\n\t\t\t\tfile = this.insertUserObject({ object: file, userId: file.userId });\n\t\t\t}\n\t\t\treturn file;\n\t\t};\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('canAccessRoom', findResult._id, this.userId);\n\t\t});\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult._id });\n\n\t\tconst files = RocketChat.models.Uploads.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields,\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tfiles: files.map(addUserObjectToEveryObject),\n\t\t\tcount:\n\t\t\tfiles.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Uploads.find(ourQuery).count(),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.getIntegrations', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tlet includeAllPublicChannels = true;\n\t\tif (typeof this.queryParams.includeAllPublicChannels !== 'undefined') {\n\t\t\tincludeAllPublicChannels = this.queryParams.includeAllPublicChannels === 'true';\n\t\t}\n\n\t\tlet ourQuery = {\n\t\t\tchannel: `#${ findResult.name }`,\n\t\t};\n\n\t\tif (includeAllPublicChannels) {\n\t\t\tourQuery.channel = {\n\t\t\t\t$in: [ourQuery.channel, 'all_public_channels'],\n\t\t\t};\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tourQuery = Object.assign({}, query, ourQuery);\n\n\t\tconst integrations = RocketChat.models.Integrations.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _createdAt: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields,\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tintegrations,\n\t\t\tcount: integrations.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Integrations.find(ourQuery).count(),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.history', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tlet latestDate = new Date();\n\t\tif (this.queryParams.latest) {\n\t\t\tlatestDate = new Date(this.queryParams.latest);\n\t\t}\n\n\t\tlet oldestDate = undefined;\n\t\tif (this.queryParams.oldest) {\n\t\t\toldestDate = new Date(this.queryParams.oldest);\n\t\t}\n\n\t\tconst inclusive = this.queryParams.inclusive || false;\n\n\t\tlet count = 20;\n\t\tif (this.queryParams.count) {\n\t\t\tcount = parseInt(this.queryParams.count);\n\t\t}\n\n\t\tconst unreads = this.queryParams.unreads || false;\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getChannelHistory', {\n\t\t\t\trid: findResult._id,\n\t\t\t\tlatest: latestDate,\n\t\t\t\toldest: oldestDate,\n\t\t\t\tinclusive,\n\t\t\t\tcount,\n\t\t\t\tunreads,\n\t\t\t});\n\t\t});\n\n\t\tif (!result) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(result);\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.info', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.invite', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addUserToRoom', { rid: findResult._id, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.join', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('joinRoom', findResult._id, this.bodyParams.joinCode);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.kick', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeUserFromRoom', { rid: findResult._id, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.leave', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('leaveRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.list', { authRequired: true }, {\n\tget: {\n\t\t// This is defined as such only to provide an example of how the routes can be defined :X\n\t\taction() {\n\t\t\tconst { offset, count } = this.getPaginationItems();\n\t\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\t\t\tconst hasPermissionToSeeAllPublicChannels = RocketChat.authz.hasPermission(this.userId, 'view-c-room');\n\n\t\t\tconst ourQuery = { ...query, t: 'c' };\n\n\t\t\tif (!hasPermissionToSeeAllPublicChannels) {\n\t\t\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-joined-room')) {\n\t\t\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t\t\t}\n\t\t\t\tconst roomIds = RocketChat.models.Subscriptions.findByUserIdAndType(this.userId, 'c', { fields: { rid: 1 } }).fetch().map((s) => s.rid);\n\t\t\t\tourQuery._id = { $in: roomIds };\n\t\t\t}\n\n\t\t\tconst cursor = RocketChat.models.Rooms.find(ourQuery, {\n\t\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\t\tskip: offset,\n\t\t\t\tlimit: count,\n\t\t\t\tfields,\n\t\t\t});\n\n\t\t\tconst total = cursor.count();\n\n\t\t\tconst rooms = cursor.fetch();\n\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tchannels: rooms,\n\t\t\t\tcount: rooms.length,\n\t\t\t\toffset,\n\t\t\t\ttotal,\n\t\t\t});\n\t\t},\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.list.joined', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields } = this.parseJsonQuery();\n\n\t\t// TODO: CACHE: Add Breacking notice since we removed the query param\n\t\tconst cursor = RocketChat.models.Rooms.findBySubscriptionTypeAndUserId('c', this.userId, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields,\n\t\t});\n\n\t\tconst totalCount = cursor.count();\n\t\tconst rooms = cursor.fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannels: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.members', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({\n\t\t\tparams: this.requestParams(),\n\t\t\tcheckedArchived: false,\n\t\t});\n\n\t\tif (findResult.broadcast && !RocketChat.authz.hasPermission(this.userId, 'view-broadcast-member-list')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort = {} } = this.parseJsonQuery();\n\n\t\tconst subscriptions = RocketChat.models.Subscriptions.findByRoomId(findResult._id, {\n\t\t\tfields: { 'u._id': 1 },\n\t\t\tsort: { 'u.username': sort.username != null ? sort.username : 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t});\n\n\t\tconst total = subscriptions.count();\n\n\t\tconst members = subscriptions.fetch().map((s) => s.u && s.u._id);\n\n\t\tconst users = RocketChat.models.Users.find({ _id: { $in: members } }, {\n\t\t\tfields: { _id: 1, username: 1, name: 1, status: 1, utcOffset: 1 },\n\t\t\tsort: { username:  sort.username != null ? sort.username : 1 },\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmembers: users,\n\t\t\tcount: users.length,\n\t\t\toffset,\n\t\t\ttotal,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.messages', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({\n\t\t\tparams: this.requestParams(),\n\t\t\tcheckedArchived: false,\n\t\t});\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult._id });\n\n\t\t// Special check for the permissions\n\t\tif (RocketChat.authz.hasPermission(this.userId, 'view-joined-room') && !RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(findResult._id, this.userId, { fields: { _id: 1 } })) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-c-room')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst cursor = RocketChat.models.Messages.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields,\n\t\t});\n\n\t\tconst total = cursor.count();\n\t\tconst messages = cursor.fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages,\n\t\t\tcount: messages.length,\n\t\t\toffset,\n\t\t\ttotal,\n\t\t});\n\t},\n});\n// TODO: CACHE: I dont like this method( functionality and how we implemented ) its very expensive\n// TODO check if this code is better or not\n// RocketChat.API.v1.addRoute('channels.online', { authRequired: true }, {\n// \tget() {\n// \t\tconst { query } = this.parseJsonQuery();\n// \t\tconst ourQuery = Object.assign({}, query, { t: 'c' });\n\n// \t\tconst room = RocketChat.models.Rooms.findOne(ourQuery);\n\n// \t\tif (room == null) {\n// \t\t\treturn RocketChat.API.v1.failure('Channel does not exists');\n// \t\t}\n\n// \t\tconst ids = RocketChat.models.Subscriptions.find({ rid: room._id }, { fields: { 'u._id': 1 } }).fetch().map(sub => sub.u._id);\n\n// \t\tconst online = RocketChat.models.Users.find({\n// \t\t\tusername: { $exists: 1 },\n// \t\t\t_id: { $in: ids },\n// \t\t\tstatus: { $in: ['online', 'away', 'busy'] }\n// \t\t}, {\n// \t\t\tfields: { username: 1 }\n// \t\t}).fetch();\n\n// \t\treturn RocketChat.API.v1.success({\n// \t\t\tonline\n// \t\t});\n// \t}\n// });\n\nRocketChat.API.v1.addRoute('channels.online', { authRequired: true }, {\n\tget() {\n\t\tconst { query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { t: 'c' });\n\n\t\tconst room = RocketChat.models.Rooms.findOne(ourQuery);\n\n\t\tif (room == null) {\n\t\t\treturn RocketChat.API.v1.failure('Channel does not exists');\n\t\t}\n\n\t\tconst online = RocketChat.models.Users.findUsersNotOffline({\n\t\t\tfields: { username: 1 },\n\t\t}).fetch();\n\n\t\tconst onlineInRoom = [];\n\t\tonline.forEach((user) => {\n\t\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(room._id, user._id, { fields: { _id: 1 } });\n\t\t\tif (subscription) {\n\t\t\t\tonlineInRoom.push({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tonline: onlineInRoom,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.open', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tconst sub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(findResult._id, this.userId);\n\n\t\tif (!sub) {\n\t\t\treturn RocketChat.API.v1.failure(`The user/callee is not in the channel \"${ findResult.name }\".`);\n\t\t}\n\n\t\tif (sub.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The channel, ${ findResult.name }, is already open to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('openRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.removeModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomModerator', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.removeOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomOwner', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.rename', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.name || !this.bodyParams.name.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"name\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: { roomId: this.bodyParams.roomId } });\n\n\t\tif (findResult.name === this.bodyParams.name) {\n\t\t\treturn RocketChat.API.v1.failure('The channel name is the same as what it would be renamed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomName', this.bodyParams.name);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.setCustomFields', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.customFields || !(typeof this.bodyParams.customFields === 'object')) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"customFields\" is required with a type like object.');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomCustomFields', this.bodyParams.customFields);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.setDefault', { authRequired: true }, {\n\tpost() {\n\t\tif (typeof this.bodyParams.default === 'undefined') {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"default\" is required', 'error-channels-setdefault-is-same');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.default === this.bodyParams.default) {\n\t\t\treturn RocketChat.API.v1.failure('The channel default setting is the same as what it would be changed to.', 'error-channels-setdefault-missing-default-param');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'default', this.bodyParams.default.toString());\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.setDescription', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.description || !this.bodyParams.description.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"description\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.description === this.bodyParams.description) {\n\t\t\treturn RocketChat.API.v1.failure('The channel description is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomDescription', this.bodyParams.description);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tdescription: this.bodyParams.description,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.setJoinCode', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.joinCode || !this.bodyParams.joinCode.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"joinCode\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'joinCode', this.bodyParams.joinCode);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.setPurpose', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.purpose || !this.bodyParams.purpose.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"purpose\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.description === this.bodyParams.purpose) {\n\t\t\treturn RocketChat.API.v1.failure('The channel purpose (description) is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomDescription', this.bodyParams.purpose);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpurpose: this.bodyParams.purpose,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.setReadOnly', { authRequired: true }, {\n\tpost() {\n\t\tif (typeof this.bodyParams.readOnly === 'undefined') {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"readOnly\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.ro === this.bodyParams.readOnly) {\n\t\t\treturn RocketChat.API.v1.failure('The channel read only setting is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'readOnly', this.bodyParams.readOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.setTopic', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.topic || !this.bodyParams.topic.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"topic\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.topic === this.bodyParams.topic) {\n\t\t\treturn RocketChat.API.v1.failure('The channel topic is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomTopic', this.bodyParams.topic);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttopic: this.bodyParams.topic,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.setAnnouncement', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.announcement || !this.bodyParams.announcement.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"announcement\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomAnnouncement', this.bodyParams.announcement);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tannouncement: this.bodyParams.announcement,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.setType', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.type || !this.bodyParams.type.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"type\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.t === this.bodyParams.type) {\n\t\t\treturn RocketChat.API.v1.failure('The channel type is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomType', this.bodyParams.type);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.unarchive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tif (!findResult.archived) {\n\t\t\treturn RocketChat.API.v1.failure(`The channel, ${ findResult.name }, is not archived`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('unarchiveRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.getAllUserMentionsByChannel', { authRequired: true }, {\n\tget() {\n\t\tconst { roomId } = this.requestParams();\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort } = this.parseJsonQuery();\n\n\t\tif (!roomId) {\n\t\t\treturn RocketChat.API.v1.failure('The request param \"roomId\" is required');\n\t\t}\n\n\t\tconst mentions = Meteor.runAsUser(this.userId, () => Meteor.call('getUserMentionsByChannel', {\n\t\t\troomId,\n\t\t\toptions: {\n\t\t\t\tsort: sort ? sort : { ts: 1 },\n\t\t\t\tskip: offset,\n\t\t\t\tlimit: count,\n\t\t\t},\n\t\t}));\n\n\t\tconst allMentions = Meteor.runAsUser(this.userId, () => Meteor.call('getUserMentionsByChannel', {\n\t\t\troomId,\n\t\t\toptions: {},\n\t\t}));\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmentions,\n\t\t\tcount: mentions.length,\n\t\t\toffset,\n\t\t\ttotal: allMentions.length,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.roles', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst roles = Meteor.runAsUser(this.userId, () => Meteor.call('getRoomRoles', findResult._id));\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\troles,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('channels.moderators', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst moderators = RocketChat.models.Subscriptions.findByRoomIdAndRoles(findResult._id, ['moderator'], { fields: { u: 1 } }).fetch().map((sub) => sub.u);\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmoderators,\n\t\t});\n\t},\n});\n","RocketChat.API.v1.addRoute('roles.list', { authRequired: true }, {\n\tget() {\n\t\tconst roles = RocketChat.models.Roles.find({}, { fields: { _updatedAt: 0 } }).fetch();\n\n\t\treturn RocketChat.API.v1.success({ roles });\n\t},\n});\n\nRocketChat.API.v1.addRoute('roles.create', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, {\n\t\t\tname: String,\n\t\t\tscope: Match.Maybe(String),\n\t\t\tdescription: Match.Maybe(String),\n\t\t});\n\n\t\tconst roleData = {\n\t\t\tname: this.bodyParams.name,\n\t\t\tscope: this.bodyParams.scope,\n\t\t\tdescription: this.bodyParams.description,\n\t\t};\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('authorization:saveRole', roleData);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\trole: RocketChat.models.Roles.findOneByIdOrName(roleData.name, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('roles.addUserToRole', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, {\n\t\t\troleName: String,\n\t\t\tusername: String,\n\t\t\troomId: Match.Maybe(String),\n\t\t});\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('authorization:addUserToRole', this.bodyParams.roleName, user.username, this.bodyParams.roomId);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\trole: RocketChat.models.Roles.findOneByIdOrName(this.bodyParams.roleName, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n","import Busboy from 'busboy';\n\nfunction findRoomByIdOrName({ params, checkedArchived = true }) {\n\tif ((!params.roomId || !params.roomId.trim()) && (!params.roomName || !params.roomName.trim())) {\n\t\tthrow new Meteor.Error('error-roomid-param-not-provided', 'The parameter \"roomId\" or \"roomName\" is required');\n\t}\n\n\tconst fields = { ...RocketChat.API.v1.defaultFieldsToExclude };\n\n\tlet room;\n\tif (params.roomId) {\n\t\troom = RocketChat.models.Rooms.findOneById(params.roomId, { fields });\n\t} else if (params.roomName) {\n\t\troom = RocketChat.models.Rooms.findOneByName(params.roomName, { fields });\n\t}\n\tif (!room) {\n\t\tthrow new Meteor.Error('error-room-not-found', 'The required \"roomId\" or \"roomName\" param provided does not match any channel');\n\t}\n\tif (checkedArchived && room.archived) {\n\t\tthrow new Meteor.Error('error-room-archived', `The channel, ${ room.name }, is archived`);\n\t}\n\n\treturn room;\n}\n\nRocketChat.API.v1.addRoute('rooms.get', { authRequired: true }, {\n\tget() {\n\t\tconst { updatedSince } = this.queryParams;\n\n\t\tlet updatedSinceDate;\n\t\tif (updatedSince) {\n\t\t\tif (isNaN(Date.parse(updatedSince))) {\n\t\t\t\tthrow new Meteor.Error('error-updatedSince-param-invalid', 'The \"updatedSince\" query parameter must be a valid date.');\n\t\t\t} else {\n\t\t\t\tupdatedSinceDate = new Date(updatedSince);\n\t\t\t}\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => result = Meteor.call('rooms/get', updatedSinceDate));\n\n\t\tif (Array.isArray(result)) {\n\t\t\tresult = {\n\t\t\t\tupdate: result,\n\t\t\t\tremove: [],\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(result);\n\t},\n});\n\nRocketChat.API.v1.addRoute('rooms.upload/:rid', { authRequired: true }, {\n\tpost() {\n\t\tconst room = Meteor.call('canAccessRoom', this.urlParams.rid, this.userId);\n\n\t\tif (!room) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst busboy = new Busboy({ headers: this.request.headers });\n\t\tconst files = [];\n\t\tconst fields = {};\n\n\t\tMeteor.wrapAsync((callback) => {\n\t\t\tbusboy.on('file', (fieldname, file, filename, encoding, mimetype) => {\n\t\t\t\tif (fieldname !== 'file') {\n\t\t\t\t\treturn files.push(new Meteor.Error('invalid-field'));\n\t\t\t\t}\n\n\t\t\t\tconst fileDate = [];\n\t\t\t\tfile.on('data', (data) => fileDate.push(data));\n\n\t\t\t\tfile.on('end', () => {\n\t\t\t\t\tfiles.push({ fieldname, file, filename, encoding, mimetype, fileBuffer: Buffer.concat(fileDate) });\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tbusboy.on('field', (fieldname, value) => fields[fieldname] = value);\n\n\t\t\tbusboy.on('finish', Meteor.bindEnvironment(() => callback()));\n\n\t\t\tthis.request.pipe(busboy);\n\t\t})();\n\n\t\tif (files.length === 0) {\n\t\t\treturn RocketChat.API.v1.failure('File required');\n\t\t}\n\n\t\tif (files.length > 1) {\n\t\t\treturn RocketChat.API.v1.failure('Just 1 file is allowed');\n\t\t}\n\n\t\tconst file = files[0];\n\n\t\tconst fileStore = FileUpload.getStore('Uploads');\n\n\t\tconst details = {\n\t\t\tname: file.filename,\n\t\t\tsize: file.fileBuffer.length,\n\t\t\ttype: file.mimetype,\n\t\t\trid: this.urlParams.rid,\n\t\t\tuserId: this.userId,\n\t\t};\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tconst uploadedFile = Meteor.wrapAsync(fileStore.insert.bind(fileStore))(details, file.fileBuffer);\n\n\t\t\tuploadedFile.description = fields.description;\n\n\t\t\tdelete fields.description;\n\n\t\t\tRocketChat.API.v1.success(Meteor.call('sendFileMessage', this.urlParams.rid, null, uploadedFile, fields));\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('rooms.saveNotification', { authRequired: true }, {\n\tpost() {\n\t\tconst saveNotifications = (notifications, roomId) => {\n\t\t\tObject.keys(notifications).forEach((notificationKey) =>\n\t\t\t\tMeteor.runAsUser(this.userId, () =>\n\t\t\t\t\tMeteor.call('saveNotificationSettings', roomId, notificationKey, notifications[notificationKey])\n\t\t\t\t)\n\t\t\t);\n\t\t};\n\t\tconst { roomId, notifications } = this.bodyParams;\n\n\t\tif (!roomId) {\n\t\t\treturn RocketChat.API.v1.failure('The \\'roomId\\' param is required');\n\t\t}\n\n\t\tif (!notifications || Object.keys(notifications).length === 0) {\n\t\t\treturn RocketChat.API.v1.failure('The \\'notifications\\' param is required');\n\t\t}\n\n\t\tsaveNotifications(notifications, roomId);\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('rooms.favorite', { authRequired: true }, {\n\tpost() {\n\t\tconst { favorite } = this.bodyParams;\n\n\t\tif (!this.bodyParams.hasOwnProperty('favorite')) {\n\t\t\treturn RocketChat.API.v1.failure('The \\'favorite\\' param is required');\n\t\t}\n\n\t\tconst room = findRoomByIdOrName({ params: this.bodyParams });\n\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('toggleFavorite', room._id, favorite));\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('rooms.cleanHistory', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findRoomByIdOrName({ params: this.bodyParams });\n\n\t\tif (!this.bodyParams.latest) {\n\t\t\treturn RocketChat.API.v1.failure('Body parameter \"latest\" is required.');\n\t\t}\n\n\t\tif (!this.bodyParams.oldest) {\n\t\t\treturn RocketChat.API.v1.failure('Body parameter \"oldest\" is required.');\n\t\t}\n\n\t\tconst latest = new Date(this.bodyParams.latest);\n\t\tconst oldest = new Date(this.bodyParams.oldest);\n\n\t\tconst inclusive = this.bodyParams.inclusive || false;\n\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('cleanRoomHistory', {\n\t\t\troomId: findResult._id,\n\t\t\tlatest,\n\t\t\toldest,\n\t\t\tinclusive,\n\t\t\tlimit: this.bodyParams.limit,\n\t\t\texcludePinned: this.bodyParams.excludePinned,\n\t\t\tfilesOnly: this.bodyParams.filesOnly,\n\t\t\tfromUsers: this.bodyParams.users,\n\t\t}));\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\n","RocketChat.API.v1.addRoute('subscriptions.get', { authRequired: true }, {\n\tget() {\n\t\tconst { updatedSince } = this.queryParams;\n\n\t\tlet updatedSinceDate;\n\t\tif (updatedSince) {\n\t\t\tif (isNaN(Date.parse(updatedSince))) {\n\t\t\t\tthrow new Meteor.Error('error-roomId-param-invalid', 'The \"lastUpdate\" query parameter must be a valid date.');\n\t\t\t} else {\n\t\t\t\tupdatedSinceDate = new Date(updatedSince);\n\t\t\t}\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => result = Meteor.call('subscriptions/get', updatedSinceDate));\n\n\t\tif (Array.isArray(result)) {\n\t\t\tresult = {\n\t\t\t\tupdate: result,\n\t\t\t\tremove: [],\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(result);\n\t},\n});\n\nRocketChat.API.v1.addRoute('subscriptions.getOne', { authRequired: true }, {\n\tget() {\n\t\tconst { roomId } = this.requestParams();\n\n\t\tif (!roomId) {\n\t\t\treturn RocketChat.API.v1.failure('The \\'roomId\\' param is required');\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(roomId, this.userId);\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tsubscription,\n\t\t});\n\t},\n});\n\n/**\n\tThis API is suppose to mark any room as read.\n\n\tMethod: POST\n\tRoute: api/v1/subscriptions.read\n\tParams:\n\t\t- rid: The rid of the room to be marked as read.\n */\nRocketChat.API.v1.addRoute('subscriptions.read', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, {\n\t\t\trid: String,\n\t\t});\n\n\t\tMeteor.runAsUser(this.userId, () =>\n\t\t\tMeteor.call('readMessages', this.bodyParams.rid)\n\t\t);\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('subscriptions.unread', { authRequired: true }, {\n\tpost() {\n\t\tconst { roomId, firstUnreadMessage } = this.bodyParams;\n\t\tif (!roomId && (firstUnreadMessage && !firstUnreadMessage._id)) {\n\t\t\treturn RocketChat.API.v1.failure('At least one of \"roomId\" or \"firstUnreadMessage._id\" params is required');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () =>\n\t\t\tMeteor.call('unreadMessages', firstUnreadMessage, roomId)\n\t\t);\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\n\n","/* global processWebhookMessage */\n\nRocketChat.API.v1.addRoute('chat.delete', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\tmsgId: String,\n\t\t\troomId: String,\n\t\t\tasUser: Match.Maybe(Boolean),\n\t\t}));\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.msgId, { fields: { u: 1, rid: 1 } });\n\n\t\tif (!msg) {\n\t\t\treturn RocketChat.API.v1.failure(`No message found with the id of \"${ this.bodyParams.msgId }\".`);\n\t\t}\n\n\t\tif (this.bodyParams.roomId !== msg.rid) {\n\t\t\treturn RocketChat.API.v1.failure('The room id provided does not match where the message is from.');\n\t\t}\n\n\t\tif (this.bodyParams.asUser && msg.u._id !== this.userId && !RocketChat.authz.hasPermission(Meteor.userId(), 'force-delete-message', msg.rid)) {\n\t\t\treturn RocketChat.API.v1.failure('Unauthorized. You must have the permission \"force-delete-message\" to delete other\\'s message as them.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.bodyParams.asUser ? msg.u._id : this.userId, () => {\n\t\t\tMeteor.call('deleteMessage', { _id: msg._id });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\t_id: msg._id,\n\t\t\tts: Date.now(),\n\t\t\tmessage: msg,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('chat.syncMessages', { authRequired: true }, {\n\tget() {\n\t\tconst { roomId, lastUpdate } = this.queryParams;\n\n\t\tif (!roomId) {\n\t\t\tthrow new Meteor.Error('error-roomId-param-not-provided', 'The required \"roomId\" query param is missing.');\n\t\t}\n\n\t\tif (!lastUpdate) {\n\t\t\tthrow new Meteor.Error('error-lastUpdate-param-not-provided', 'The required \"lastUpdate\" query param is missing.');\n\t\t} else if (isNaN(Date.parse(lastUpdate))) {\n\t\t\tthrow new Meteor.Error('error-roomId-param-invalid', 'The \"lastUpdate\" query parameter must be a valid date.');\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('messages/get', roomId, { lastUpdate: new Date(lastUpdate) });\n\t\t});\n\n\t\tif (!result) {\n\t\t\treturn RocketChat.API.v1.failure();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tresult,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('chat.getMessage', { authRequired: true }, {\n\tget() {\n\t\tif (!this.queryParams.msgId) {\n\t\t\treturn RocketChat.API.v1.failure('The \"msgId\" query parameter must be provided.');\n\t\t}\n\n\t\tlet msg;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tmsg = Meteor.call('getSingleMessage', this.queryParams.msgId);\n\t\t});\n\n\t\tif (!msg) {\n\t\t\treturn RocketChat.API.v1.failure();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessage: msg,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('chat.pinMessage', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.messageId || !this.bodyParams.messageId.trim()) {\n\t\t\tthrow new Meteor.Error('error-messageid-param-not-provided', 'The required \"messageId\" param is missing.');\n\t\t}\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.messageId);\n\n\t\tif (!msg) {\n\t\t\tthrow new Meteor.Error('error-message-not-found', 'The provided \"messageId\" does not match any existing message.');\n\t\t}\n\n\t\tlet pinnedMessage;\n\t\tMeteor.runAsUser(this.userId, () => pinnedMessage = Meteor.call('pinMessage', msg));\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessage: pinnedMessage,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('chat.postMessage', { authRequired: true }, {\n\tpost() {\n\t\tconst messageReturn = processWebhookMessage(this.bodyParams, this.user, undefined, true)[0];\n\n\t\tif (!messageReturn) {\n\t\t\treturn RocketChat.API.v1.failure('unknown-error');\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tts: Date.now(),\n\t\t\tchannel: messageReturn.channel,\n\t\t\tmessage: messageReturn.message,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('chat.search', { authRequired: true }, {\n\tget() {\n\t\tconst { roomId, searchText } = this.queryParams;\n\t\tconst { count } = this.getPaginationItems();\n\n\t\tif (!roomId) {\n\t\t\tthrow new Meteor.Error('error-roomId-param-not-provided', 'The required \"roomId\" query param is missing.');\n\t\t}\n\n\t\tif (!searchText) {\n\t\t\tthrow new Meteor.Error('error-searchText-param-not-provided', 'The required \"searchText\" query param is missing.');\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => result = Meteor.call('messageSearch', searchText, roomId, count).message.docs);\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages: result,\n\t\t});\n\t},\n});\n\n// The difference between `chat.postMessage` and `chat.sendMessage` is that `chat.sendMessage` allows\n// for passing a value for `_id` and the other one doesn't. Also, `chat.sendMessage` only sends it to\n// one channel whereas the other one allows for sending to more than one channel at a time.\nRocketChat.API.v1.addRoute('chat.sendMessage', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.message) {\n\t\t\tthrow new Meteor.Error('error-invalid-params', 'The \"message\" parameter must be provided.');\n\t\t}\n\n\t\tlet message;\n\t\tMeteor.runAsUser(this.userId, () => message = Meteor.call('sendMessage', this.bodyParams.message));\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessage,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('chat.starMessage', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.messageId || !this.bodyParams.messageId.trim()) {\n\t\t\tthrow new Meteor.Error('error-messageid-param-not-provided', 'The required \"messageId\" param is required.');\n\t\t}\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.messageId);\n\n\t\tif (!msg) {\n\t\t\tthrow new Meteor.Error('error-message-not-found', 'The provided \"messageId\" does not match any existing message.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('starMessage', {\n\t\t\t_id: msg._id,\n\t\t\trid: msg.rid,\n\t\t\tstarred: true,\n\t\t}));\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('chat.unPinMessage', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.messageId || !this.bodyParams.messageId.trim()) {\n\t\t\tthrow new Meteor.Error('error-messageid-param-not-provided', 'The required \"messageId\" param is required.');\n\t\t}\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.messageId);\n\n\t\tif (!msg) {\n\t\t\tthrow new Meteor.Error('error-message-not-found', 'The provided \"messageId\" does not match any existing message.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('unpinMessage', msg));\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('chat.unStarMessage', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.messageId || !this.bodyParams.messageId.trim()) {\n\t\t\tthrow new Meteor.Error('error-messageid-param-not-provided', 'The required \"messageId\" param is required.');\n\t\t}\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.messageId);\n\n\t\tif (!msg) {\n\t\t\tthrow new Meteor.Error('error-message-not-found', 'The provided \"messageId\" does not match any existing message.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('starMessage', {\n\t\t\t_id: msg._id,\n\t\t\trid: msg.rid,\n\t\t\tstarred: false,\n\t\t}));\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('chat.update', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\troomId: String,\n\t\t\tmsgId: String,\n\t\t\ttext: String, // Using text to be consistant with chat.postMessage\n\t\t}));\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.msgId);\n\n\t\t// Ensure the message exists\n\t\tif (!msg) {\n\t\t\treturn RocketChat.API.v1.failure(`No message found with the id of \"${ this.bodyParams.msgId }\".`);\n\t\t}\n\n\t\tif (this.bodyParams.roomId !== msg.rid) {\n\t\t\treturn RocketChat.API.v1.failure('The room id provided does not match where the message is from.');\n\t\t}\n\n\t\t// Permission checks are already done in the updateMessage method, so no need to duplicate them\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('updateMessage', { _id: msg._id, msg: this.bodyParams.text, rid: msg.rid });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessage: RocketChat.models.Messages.findOneById(msg._id),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('chat.react', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.messageId || !this.bodyParams.messageId.trim()) {\n\t\t\tthrow new Meteor.Error('error-messageid-param-not-provided', 'The required \"messageId\" param is missing.');\n\t\t}\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.messageId);\n\n\t\tif (!msg) {\n\t\t\tthrow new Meteor.Error('error-message-not-found', 'The provided \"messageId\" does not match any existing message.');\n\t\t}\n\n\t\tconst emoji = this.bodyParams.emoji || this.bodyParams.reaction;\n\n\t\tif (!emoji) {\n\t\t\tthrow new Meteor.Error('error-emoji-param-not-provided', 'The required \"emoji\" param is missing.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('setReaction', emoji, msg._id, this.bodyParams.shouldReact));\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('chat.getMessageReadReceipts', { authRequired: true }, {\n\tget() {\n\t\tconst { messageId } = this.queryParams;\n\t\tif (!messageId) {\n\t\t\treturn RocketChat.API.v1.failure({\n\t\t\t\terror: 'The required \\'messageId\\' param is missing.',\n\t\t\t});\n\t\t}\n\n\t\ttry {\n\t\t\tconst messageReadReceipts = Meteor.runAsUser(this.userId, () => Meteor.call('getReadReceipts', { messageId }));\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\treceipts: messageReadReceipts,\n\t\t\t});\n\t\t} catch (error) {\n\t\t\treturn RocketChat.API.v1.failure({\n\t\t\t\terror: error.message,\n\t\t\t});\n\t\t}\n\t},\n});\n\nRocketChat.API.v1.addRoute('chat.reportMessage', { authRequired: true }, {\n\tpost() {\n\t\tconst { messageId, description } = this.bodyParams;\n\t\tif (!messageId) {\n\t\t\treturn RocketChat.API.v1.failure('The required \"messageId\" param is missing.');\n\t\t}\n\n\t\tif (!description) {\n\t\t\treturn RocketChat.API.v1.failure('The required \"description\" param is missing.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('reportMessage', messageId, description));\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('chat.ignoreUser', { authRequired: true }, {\n\tget() {\n\t\tconst { rid, userId } = this.queryParams;\n\t\tlet { ignore = true } = this.queryParams;\n\n\t\tignore = typeof ignore === 'string' ? /true|1/.test(ignore) : ignore;\n\n\t\tif (!rid || !rid.trim()) {\n\t\t\tthrow new Meteor.Error('error-room-id-param-not-provided', 'The required \"rid\" param is missing.');\n\t\t}\n\n\t\tif (!userId || !userId.trim()) {\n\t\t\tthrow new Meteor.Error('error-user-id-param-not-provided', 'The required \"userId\" param is missing.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('ignoreUser', { rid, userId, ignore }));\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n","RocketChat.API.v1.addRoute('commands.get', { authRequired: true }, {\n\tget() {\n\t\tconst params = this.queryParams;\n\n\t\tif (typeof params.command !== 'string') {\n\t\t\treturn RocketChat.API.v1.failure('The query param \"command\" must be provided.');\n\t\t}\n\n\t\tconst cmd = RocketChat.slashCommands.commands[params.command.toLowerCase()];\n\n\t\tif (!cmd) {\n\t\t\treturn RocketChat.API.v1.failure(`There is no command in the system by the name of: ${ params.command }`);\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ command: cmd });\n\t},\n});\n\nRocketChat.API.v1.addRoute('commands.list', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tlet commands = Object.values(RocketChat.slashCommands.commands);\n\n\t\tif (query && query.command) {\n\t\t\tcommands = commands.filter((command) => command.command === query.command);\n\t\t}\n\n\t\tconst totalCount = commands.length;\n\t\tcommands = RocketChat.models.Rooms.processQueryOptionsOnResult(commands, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields,\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tcommands,\n\t\t\toffset,\n\t\t\tcount: commands.length,\n\t\t\ttotal: totalCount,\n\t\t});\n\t},\n});\n\n// Expects a body of: { command: 'gimme', params: 'any string value', roomId: 'value' }\nRocketChat.API.v1.addRoute('commands.run', { authRequired: true }, {\n\tpost() {\n\t\tconst body = this.bodyParams;\n\t\tconst user = this.getLoggedInUser();\n\n\t\tif (typeof body.command !== 'string') {\n\t\t\treturn RocketChat.API.v1.failure('You must provide a command to run.');\n\t\t}\n\n\t\tif (body.params && typeof body.params !== 'string') {\n\t\t\treturn RocketChat.API.v1.failure('The parameters for the command must be a single string.');\n\t\t}\n\n\t\tif (typeof body.roomId !== 'string') {\n\t\t\treturn RocketChat.API.v1.failure('The room\\'s id where to execute this command must be provided and be a string.');\n\t\t}\n\n\t\tconst cmd = body.command.toLowerCase();\n\t\tif (!RocketChat.slashCommands.commands[body.command.toLowerCase()]) {\n\t\t\treturn RocketChat.API.v1.failure('The command provided does not exist (or is disabled).');\n\t\t}\n\n\t\t// This will throw an error if they can't or the room is invalid\n\t\tMeteor.call('canAccessRoom', body.roomId, user._id);\n\n\t\tconst params = body.params ? body.params : '';\n\n\t\tlet result;\n\t\tMeteor.runAsUser(user._id, () => {\n\t\t\tresult = RocketChat.slashCommands.run(cmd, params, {\n\t\t\t\t_id: Random.id(),\n\t\t\t\trid: body.roomId,\n\t\t\t\tmsg: `/${ cmd } ${ params }`,\n\t\t\t});\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({ result });\n\t},\n});\n\nRocketChat.API.v1.addRoute('commands.preview', { authRequired: true }, {\n\t// Expects these query params: command: 'giphy', params: 'mine', roomId: 'value'\n\tget() {\n\t\tconst query = this.queryParams;\n\t\tconst user = this.getLoggedInUser();\n\n\t\tif (typeof query.command !== 'string') {\n\t\t\treturn RocketChat.API.v1.failure('You must provide a command to get the previews from.');\n\t\t}\n\n\t\tif (query.params && typeof query.params !== 'string') {\n\t\t\treturn RocketChat.API.v1.failure('The parameters for the command must be a single string.');\n\t\t}\n\n\t\tif (typeof query.roomId !== 'string') {\n\t\t\treturn RocketChat.API.v1.failure('The room\\'s id where the previews are being displayed must be provided and be a string.');\n\t\t}\n\n\t\tconst cmd = query.command.toLowerCase();\n\t\tif (!RocketChat.slashCommands.commands[cmd]) {\n\t\t\treturn RocketChat.API.v1.failure('The command provided does not exist (or is disabled).');\n\t\t}\n\n\t\t// This will throw an error if they can't or the room is invalid\n\t\tMeteor.call('canAccessRoom', query.roomId, user._id);\n\n\t\tconst params = query.params ? query.params : '';\n\n\t\tlet preview;\n\t\tMeteor.runAsUser(user._id, () => {\n\t\t\tpreview = Meteor.call('getSlashCommandPreviews', { cmd, params, msg: { rid: query.roomId } });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({ preview });\n\t},\n\t// Expects a body format of: { command: 'giphy', params: 'mine', roomId: 'value', previewItem: { id: 'sadf8' type: 'image', value: 'https://dev.null/gif } }\n\tpost() {\n\t\tconst body = this.bodyParams;\n\t\tconst user = this.getLoggedInUser();\n\n\t\tif (typeof body.command !== 'string') {\n\t\t\treturn RocketChat.API.v1.failure('You must provide a command to run the preview item on.');\n\t\t}\n\n\t\tif (body.params && typeof body.params !== 'string') {\n\t\t\treturn RocketChat.API.v1.failure('The parameters for the command must be a single string.');\n\t\t}\n\n\t\tif (typeof body.roomId !== 'string') {\n\t\t\treturn RocketChat.API.v1.failure('The room\\'s id where the preview is being executed in must be provided and be a string.');\n\t\t}\n\n\t\tif (typeof body.previewItem === 'undefined') {\n\t\t\treturn RocketChat.API.v1.failure('The preview item being executed must be provided.');\n\t\t}\n\n\t\tif (!body.previewItem.id || !body.previewItem.type || typeof body.previewItem.value === 'undefined') {\n\t\t\treturn RocketChat.API.v1.failure('The preview item being executed is in the wrong format.');\n\t\t}\n\n\t\tconst cmd = body.command.toLowerCase();\n\t\tif (!RocketChat.slashCommands.commands[cmd]) {\n\t\t\treturn RocketChat.API.v1.failure('The command provided does not exist (or is disabled).');\n\t\t}\n\n\t\t// This will throw an error if they can't or the room is invalid\n\t\tMeteor.call('canAccessRoom', body.roomId, user._id);\n\n\t\tconst params = body.params ? body.params : '';\n\n\t\tMeteor.runAsUser(user._id, () => {\n\t\t\tMeteor.call('executeSlashCommandPreview', { cmd, params, msg: { rid: body.roomId } }, body.previewItem);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n","RocketChat.API.v1.addRoute('emoji-custom', { authRequired: true }, {\n\tget() {\n\t\tconst emojis = Meteor.call('listEmojiCustom');\n\n\t\treturn RocketChat.API.v1.success({ emojis });\n\t},\n});\n","import _ from 'underscore';\n\n// Returns the private group subscription IF found otherwise it will return the failure of why it didn't. Check the `statusCode` property\nfunction findPrivateGroupByIdOrName({ params, userId, checkedArchived = true }) {\n\tif ((!params.roomId || !params.roomId.trim()) && (!params.roomName || !params.roomName.trim())) {\n\t\tthrow new Meteor.Error('error-room-param-not-provided', 'The parameter \"roomId\" or \"roomName\" is required');\n\t}\n\n\tlet roomSub;\n\tif (params.roomId) {\n\t\troomSub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(params.roomId, userId);\n\t} else if (params.roomName) {\n\t\troomSub = RocketChat.models.Subscriptions.findOneByRoomNameAndUserId(params.roomName, userId);\n\t}\n\n\tif (!roomSub || roomSub.t !== 'p') {\n\t\tthrow new Meteor.Error('error-room-not-found', 'The required \"roomId\" or \"roomName\" param provided does not match any group');\n\t}\n\n\tif (checkedArchived && roomSub.archived) {\n\t\tthrow new Meteor.Error('error-room-archived', `The private group, ${ roomSub.name }, is archived`);\n\t}\n\n\treturn roomSub;\n}\n\nRocketChat.API.v1.addRoute('groups.addAll', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addAllUserToRoom', findResult.rid, this.bodyParams.activeUsersOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.addModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomModerator', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.addOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomOwner', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.addLeader', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\t\tconst user = this.getUserFromParams();\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomLeader', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\n// Archives a private group only if it wasn't\nRocketChat.API.v1.addRoute('groups.archive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('archiveRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.close', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tif (!findResult.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The private group, ${ findResult.name }, is already closed to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('hideRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.counters', { authRequired: true }, {\n\tget() {\n\t\tconst access = RocketChat.authz.hasPermission(this.userId, 'view-room-administration');\n\t\tconst params = this.requestParams();\n\t\tlet user = this.userId;\n\t\tlet room;\n\t\tlet unreads = null;\n\t\tlet userMentions = null;\n\t\tlet unreadsFrom = null;\n\t\tlet joined = false;\n\t\tlet msgs = null;\n\t\tlet latest = null;\n\t\tlet members = null;\n\n\t\tif ((!params.roomId || !params.roomId.trim()) && (!params.roomName || !params.roomName.trim())) {\n\t\t\tthrow new Meteor.Error('error-room-param-not-provided', 'The parameter \"roomId\" or \"roomName\" is required');\n\t\t}\n\n\t\tif (params.roomId) {\n\t\t\troom = RocketChat.models.Rooms.findOneById(params.roomId);\n\t\t} else if (params.roomName) {\n\t\t\troom = RocketChat.models.Rooms.findOneByName(params.roomName);\n\t\t}\n\n\t\tif (!room || room.t !== 'p') {\n\t\t\tthrow new Meteor.Error('error-room-not-found', 'The required \"roomId\" or \"roomName\" param provided does not match any group');\n\t\t}\n\n\t\tif (room.archived) {\n\t\t\tthrow new Meteor.Error('error-room-archived', `The private group, ${ room.name }, is archived`);\n\t\t}\n\n\t\tif (params.userId) {\n\t\t\tif (!access) {\n\t\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t\t}\n\t\t\tuser = params.userId;\n\t\t}\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(room._id, user);\n\t\tconst lm = room.lm ? room.lm : room._updatedAt;\n\n\t\tif (typeof subscription !== 'undefined' && subscription.open) {\n\t\t\tif (subscription.ls) {\n\t\t\t\tunreads = RocketChat.models.Messages.countVisibleByRoomIdBetweenTimestampsInclusive(subscription.rid, subscription.ls, lm);\n\t\t\t\tunreadsFrom = subscription.ls;\n\t\t\t}\n\t\t\tuserMentions = subscription.userMentions;\n\t\t\tjoined = true;\n\t\t}\n\n\t\tif (access || joined) {\n\t\t\tmsgs = room.msgs;\n\t\t\tlatest = lm;\n\t\t\tmembers = room.usersCount;\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tjoined,\n\t\t\tmembers,\n\t\t\tunreads,\n\t\t\tunreadsFrom,\n\t\t\tmsgs,\n\t\t\tlatest,\n\t\t\tuserMentions,\n\t\t});\n\t},\n});\n\n// Create Private Group\nRocketChat.API.v1.addRoute('groups.create', { authRequired: true }, {\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'create-p')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tif (!this.bodyParams.name) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"name\" is required');\n\t\t}\n\n\t\tif (this.bodyParams.members && !_.isArray(this.bodyParams.members)) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"members\" must be an array if provided');\n\t\t}\n\n\t\tif (this.bodyParams.customFields && !(typeof this.bodyParams.customFields === 'object')) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"customFields\" must be an object if provided');\n\t\t}\n\n\t\tconst readOnly = typeof this.bodyParams.readOnly !== 'undefined' ? this.bodyParams.readOnly : false;\n\n\t\tlet id;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tid = Meteor.call('createPrivateGroup', this.bodyParams.name, this.bodyParams.members ? this.bodyParams.members : [], readOnly, this.bodyParams.customFields);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(id.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.delete', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('eraseRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.files', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\t\tconst addUserObjectToEveryObject = (file) => {\n\t\t\tif (file.userId) {\n\t\t\t\tfile = this.insertUserObject({ object: file, userId: file.userId });\n\t\t\t}\n\t\t\treturn file;\n\t\t};\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult.rid });\n\n\t\tconst files = RocketChat.models.Uploads.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields,\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tfiles: files.map(addUserObjectToEveryObject),\n\t\t\tcount: files.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Uploads.find(ourQuery).count(),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.getIntegrations', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tlet includeAllPrivateGroups = true;\n\t\tif (typeof this.queryParams.includeAllPrivateGroups !== 'undefined') {\n\t\t\tincludeAllPrivateGroups = this.queryParams.includeAllPrivateGroups === 'true';\n\t\t}\n\n\t\tconst channelsToSearch = [`#${ findResult.name }`];\n\t\tif (includeAllPrivateGroups) {\n\t\t\tchannelsToSearch.push('all_private_groups');\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { channel: { $in: channelsToSearch } });\n\t\tconst integrations = RocketChat.models.Integrations.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _createdAt: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields,\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tintegrations,\n\t\t\tcount: integrations.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Integrations.find(ourQuery).count(),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.history', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tlet latestDate = new Date();\n\t\tif (this.queryParams.latest) {\n\t\t\tlatestDate = new Date(this.queryParams.latest);\n\t\t}\n\n\t\tlet oldestDate = undefined;\n\t\tif (this.queryParams.oldest) {\n\t\t\toldestDate = new Date(this.queryParams.oldest);\n\t\t}\n\n\t\tconst inclusive = this.queryParams.inclusive || false;\n\n\t\tlet count = 20;\n\t\tif (this.queryParams.count) {\n\t\t\tcount = parseInt(this.queryParams.count);\n\t\t}\n\n\t\tconst unreads = this.queryParams.unreads || false;\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getChannelHistory', { rid: findResult.rid, latest: latestDate, oldest: oldestDate, inclusive, count, unreads });\n\t\t});\n\n\t\tif (!result) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(result);\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.info', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.invite', { authRequired: true }, {\n\tpost() {\n\t\tconst { roomId = '', roomName = '' } = this.requestParams();\n\t\tconst idOrName = roomId || roomName;\n\t\tif (!idOrName.trim()) {\n\t\t\tthrow new Meteor.Error('error-room-param-not-provided', 'The parameter \"roomId\" or \"roomName\" is required');\n\t\t}\n\n\t\tconst { _id: rid, t: type } = RocketChat.models.Rooms.findOneByIdOrName(idOrName) || {};\n\n\t\tif (!rid || type !== 'p') {\n\t\t\tthrow new Meteor.Error('error-room-not-found', 'The required \"roomId\" or \"roomName\" param provided does not match any group');\n\t\t}\n\n\t\tconst { username } = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('addUserToRoom', { rid, username }));\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(rid, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.kick', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeUserFromRoom', { rid: findResult.rid, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.leave', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('leaveRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\n// List Private Groups a user has access to\nRocketChat.API.v1.addRoute('groups.list', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields } = this.parseJsonQuery();\n\n\t\t// TODO: CACHE: Add Breacking notice since we removed the query param\n\t\tconst cursor = RocketChat.models.Rooms.findBySubscriptionTypeAndUserId('p', this.userId, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields,\n\t\t});\n\n\t\tconst totalCount = cursor.count();\n\t\tconst rooms = cursor.fetch();\n\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroups: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount,\n\t\t});\n\t},\n});\n\n\nRocketChat.API.v1.addRoute('groups.listAll', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-room-administration')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { t: 'p' });\n\n\t\tlet rooms = RocketChat.models.Rooms.find(ourQuery).fetch();\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields,\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroups: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.members', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\t\tconst room = RocketChat.models.Rooms.findOneById(findResult.rid, { fields: { broadcast: 1 } });\n\n\t\tif (room.broadcast && !RocketChat.authz.hasPermission(this.userId, 'view-broadcast-member-list')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort = {} } = this.parseJsonQuery();\n\n\t\tconst subscriptions = RocketChat.models.Subscriptions.findByRoomId(findResult.rid, {\n\t\t\tfields: { 'u._id': 1 },\n\t\t\tsort: { 'u.username': sort.username != null ? sort.username : 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t});\n\n\t\tconst total = subscriptions.count();\n\n\t\tconst members = subscriptions.fetch().map((s) => s.u && s.u._id);\n\n\t\tconst users = RocketChat.models.Users.find({ _id: { $in: members } }, {\n\t\t\tfields: { _id: 1, username: 1, name: 1, status: 1, utcOffset: 1 },\n\t\t\tsort: { username:  sort.username != null ? sort.username : 1 },\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmembers: users,\n\t\t\tcount: users.length,\n\t\t\toffset,\n\t\t\ttotal,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.messages', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult.rid });\n\n\t\tconst messages = RocketChat.models.Messages.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields,\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages,\n\t\t\tcount: messages.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Messages.find(ourQuery).count(),\n\t\t});\n\t},\n});\n// TODO: CACHE: same as channels.online\nRocketChat.API.v1.addRoute('groups.online', { authRequired: true }, {\n\tget() {\n\t\tconst { query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { t: 'p' });\n\n\t\tconst room = RocketChat.models.Rooms.findOne(ourQuery);\n\n\t\tif (room == null) {\n\t\t\treturn RocketChat.API.v1.failure('Group does not exists');\n\t\t}\n\n\t\tconst online = RocketChat.models.Users.findUsersNotOffline({\n\t\t\tfields: {\n\t\t\t\tusername: 1,\n\t\t\t},\n\t\t}).fetch();\n\n\t\tconst onlineInRoom = [];\n\t\tonline.forEach((user) => {\n\t\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(room._id, user._id, { fields: { _id: 1 } });\n\t\t\tif (subscription) {\n\t\t\t\tonlineInRoom.push({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tonline: onlineInRoom,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.open', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tif (findResult.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The private group, ${ findResult.name }, is already open for the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('openRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.removeModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomModerator', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.removeOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomOwner', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.removeLeader', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomLeader', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.rename', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.name || !this.bodyParams.name.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"name\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: { roomId: this.bodyParams.roomId }, userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomName', this.bodyParams.name);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.setCustomFields', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.customFields || !(typeof this.bodyParams.customFields === 'object')) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"customFields\" is required with a type like object.');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomCustomFields', this.bodyParams.customFields);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.setDescription', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.description || !this.bodyParams.description.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"description\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomDescription', this.bodyParams.description);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tdescription: this.bodyParams.description,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.setPurpose', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.purpose || !this.bodyParams.purpose.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"purpose\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomDescription', this.bodyParams.purpose);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpurpose: this.bodyParams.purpose,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.setReadOnly', { authRequired: true }, {\n\tpost() {\n\t\tif (typeof this.bodyParams.readOnly === 'undefined') {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"readOnly\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tif (findResult.ro === this.bodyParams.readOnly) {\n\t\t\treturn RocketChat.API.v1.failure('The private group read only setting is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'readOnly', this.bodyParams.readOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.setTopic', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.topic || !this.bodyParams.topic.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"topic\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomTopic', this.bodyParams.topic);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttopic: this.bodyParams.topic,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.setType', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.type || !this.bodyParams.type.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"type\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tif (findResult.t === this.bodyParams.type) {\n\t\t\treturn RocketChat.API.v1.failure('The private group type is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomType', this.bodyParams.type);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude }),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.setAnnouncement', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.announcement || !this.bodyParams.announcement.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"announcement\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomAnnouncement', this.bodyParams.announcement);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tannouncement: this.bodyParams.announcement,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.unarchive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('unarchiveRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.roles', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst roles = Meteor.runAsUser(this.userId, () => Meteor.call('getRoomRoles', findResult.rid));\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\troles,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('groups.moderators', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst moderators = RocketChat.models.Subscriptions.findByRoomIdAndRoles(findResult.rid, ['moderator'], { fields: { u: 1 } }).fetch().map((sub) => sub.u);\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmoderators,\n\t\t});\n\t},\n});\n\n","function findDirectMessageRoom(params, user) {\n\tif ((!params.roomId || !params.roomId.trim()) && (!params.username || !params.username.trim())) {\n\t\tthrow new Meteor.Error('error-room-param-not-provided', 'Body param \"roomId\" or \"username\" is required');\n\t}\n\n\tconst room = RocketChat.getRoomByNameOrIdWithOptionToJoin({\n\t\tcurrentUserId: user._id,\n\t\tnameOrId: params.username || params.roomId,\n\t\ttype: 'd',\n\t});\n\n\tif (!room || room.t !== 'd') {\n\t\tthrow new Meteor.Error('error-room-not-found', 'The required \"roomId\" or \"username\" param provided does not match any dirct message');\n\t}\n\n\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(room._id, user._id);\n\n\treturn {\n\t\troom,\n\t\tsubscription,\n\t};\n}\n\nRocketChat.API.v1.addRoute(['dm.create', 'im.create'], { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\troom: findResult.room,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute(['dm.close', 'im.close'], { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tif (!findResult.subscription.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The direct message room, ${ this.bodyParams.name }, is already closed to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('hideRoom', findResult.room._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute(['dm.counters', 'im.counters'], { authRequired: true }, {\n\tget() {\n\t\tconst access = RocketChat.authz.hasPermission(this.userId, 'view-room-administration');\n\t\tconst ruserId = this.requestParams().userId;\n\t\tlet user = this.userId;\n\t\tlet unreads = null;\n\t\tlet userMentions = null;\n\t\tlet unreadsFrom = null;\n\t\tlet joined = false;\n\t\tlet msgs = null;\n\t\tlet latest = null;\n\t\tlet members = null;\n\t\tlet lm = null;\n\n\t\tif (ruserId) {\n\t\t\tif (!access) {\n\t\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t\t}\n\t\t\tuser = ruserId;\n\t\t}\n\t\tconst rs = findDirectMessageRoom(this.requestParams(), { _id: user });\n\t\tconst { room } = rs;\n\t\tconst dm = rs.subscription;\n\t\tlm = room.lm ? room.lm : room._updatedAt;\n\n\t\tif (typeof dm !== 'undefined' && dm.open) {\n\t\t\tif (dm.ls && room.msgs) {\n\t\t\t\tunreads = dm.unread;\n\t\t\t\tunreadsFrom = dm.ls;\n\t\t\t}\n\t\t\tuserMentions = dm.userMentions;\n\t\t\tjoined = true;\n\t\t}\n\n\t\tif (access || joined) {\n\t\t\tmsgs = room.msgs;\n\t\t\tlatest = lm;\n\t\t\tmembers = room.usersCount;\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tjoined,\n\t\t\tmembers,\n\t\t\tunreads,\n\t\t\tunreadsFrom,\n\t\t\tmsgs,\n\t\t\tlatest,\n\t\t\tuserMentions,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute(['dm.files', 'im.files'], { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\t\tconst addUserObjectToEveryObject = (file) => {\n\t\t\tif (file.userId) {\n\t\t\t\tfile = this.insertUserObject({ object: file, userId: file.userId });\n\t\t\t}\n\t\t\treturn file;\n\t\t};\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult.room._id });\n\n\t\tconst files = RocketChat.models.Uploads.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields,\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tfiles: files.map(addUserObjectToEveryObject),\n\t\t\tcount: files.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Uploads.find(ourQuery).count(),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute(['dm.history', 'im.history'], { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tlet latestDate = new Date();\n\t\tif (this.queryParams.latest) {\n\t\t\tlatestDate = new Date(this.queryParams.latest);\n\t\t}\n\n\t\tlet oldestDate = undefined;\n\t\tif (this.queryParams.oldest) {\n\t\t\toldestDate = new Date(this.queryParams.oldest);\n\t\t}\n\n\t\tconst inclusive = this.queryParams.inclusive || false;\n\n\t\tlet count = 20;\n\t\tif (this.queryParams.count) {\n\t\t\tcount = parseInt(this.queryParams.count);\n\t\t}\n\n\t\tconst unreads = this.queryParams.unreads || false;\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getChannelHistory', {\n\t\t\t\trid: findResult.room._id,\n\t\t\t\tlatest: latestDate,\n\t\t\t\toldest: oldestDate,\n\t\t\t\tinclusive,\n\t\t\t\tcount,\n\t\t\t\tunreads,\n\t\t\t});\n\t\t});\n\n\t\tif (!result) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(result);\n\t},\n});\n\nRocketChat.API.v1.addRoute(['dm.members', 'im.members'], { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort } = this.parseJsonQuery();\n\t\tconst cursor = RocketChat.models.Subscriptions.findByRoomId(findResult.room._id, {\n\t\t\tsort: { 'u.username':  sort && sort.username ? sort.username : 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t});\n\n\t\tconst total = cursor.count();\n\t\tconst members = cursor.fetch().map((s) => s.u && s.u.username);\n\n\t\tconst users = RocketChat.models.Users.find({ username: { $in: members } }, {\n\t\t\tfields: { _id: 1, username: 1, name: 1, status: 1, utcOffset: 1 },\n\t\t\tsort: { username:  sort && sort.username ? sort.username : 1 },\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmembers: users,\n\t\t\tcount: members.length,\n\t\t\toffset,\n\t\t\ttotal,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute(['dm.messages', 'im.messages'], { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult.room._id });\n\n\t\tconst messages = RocketChat.models.Messages.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields,\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages,\n\t\t\tcount: messages.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Messages.find(ourQuery).count(),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute(['dm.messages.others', 'im.messages.others'], { authRequired: true }, {\n\tget() {\n\t\tif (RocketChat.settings.get('API_Enable_Direct_Message_History_EndPoint') !== true) {\n\t\t\tthrow new Meteor.Error('error-endpoint-disabled', 'This endpoint is disabled', { route: '/api/v1/im.messages.others' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-room-administration')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { roomId } = this.queryParams;\n\t\tif (!roomId || !roomId.trim()) {\n\t\t\tthrow new Meteor.Error('error-roomid-param-not-provided', 'The parameter \"roomId\" is required');\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(roomId);\n\t\tif (!room || room.t !== 'd') {\n\t\t\tthrow new Meteor.Error('error-room-not-found', `No direct message room found by the id of: ${ roomId }`);\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { rid: room._id });\n\n\t\tconst msgs = RocketChat.models.Messages.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields,\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages: msgs,\n\t\t\toffset,\n\t\t\tcount: msgs.length,\n\t\t\ttotal: RocketChat.models.Messages.find(ourQuery).count(),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute(['dm.list', 'im.list'], { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort = { name: 1 }, fields } = this.parseJsonQuery();\n\n\t\t// TODO: CACHE: Add Breacking notice since we removed the query param\n\n\t\tconst cursor = RocketChat.models.Rooms.findBySubscriptionTypeAndUserId('d', this.userId, {\n\t\t\tsort,\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields,\n\t\t});\n\n\t\tconst total = cursor.count();\n\t\tconst rooms = cursor.fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tims: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute(['dm.list.everyone', 'im.list.everyone'], { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-room-administration')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { t: 'd' });\n\n\t\tconst rooms = RocketChat.models.Rooms.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields,\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tims: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: RocketChat.models.Rooms.find(ourQuery).count(),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute(['dm.open', 'im.open'], { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tif (!findResult.subscription.open) {\n\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\tMeteor.call('openRoom', findResult.room._id);\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute(['dm.setTopic', 'im.setTopic'], { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.topic || !this.bodyParams.topic.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"topic\" is required');\n\t\t}\n\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.room._id, 'roomTopic', this.bodyParams.topic);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttopic: this.bodyParams.topic,\n\t\t});\n\t},\n});\n","RocketChat.API.v1.addRoute('integrations.create', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\ttype: String,\n\t\t\tname: String,\n\t\t\tenabled: Boolean,\n\t\t\tusername: String,\n\t\t\turls: Match.Maybe([String]),\n\t\t\tchannel: String,\n\t\t\tevent: Match.Maybe(String),\n\t\t\ttriggerWords: Match.Maybe([String]),\n\t\t\talias: Match.Maybe(String),\n\t\t\tavatar: Match.Maybe(String),\n\t\t\temoji: Match.Maybe(String),\n\t\t\ttoken: Match.Maybe(String),\n\t\t\tscriptEnabled: Boolean,\n\t\t\tscript: Match.Maybe(String),\n\t\t\ttargetChannel: Match.Maybe(String),\n\t\t}));\n\n\t\tlet integration;\n\n\t\tswitch (this.bodyParams.type) {\n\t\t\tcase 'webhook-outgoing':\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tintegration = Meteor.call('addOutgoingIntegration', this.bodyParams);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'webhook-incoming':\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tintegration = Meteor.call('addIncomingIntegration', this.bodyParams);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn RocketChat.API.v1.failure('Invalid integration type.');\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ integration });\n\t},\n});\n\nRocketChat.API.v1.addRoute('integrations.history', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tif (!this.queryParams.id || this.queryParams.id.trim() === '') {\n\t\t\treturn RocketChat.API.v1.failure('Invalid integration id.');\n\t\t}\n\n\t\tconst { id } = this.queryParams;\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { 'integration._id': id });\n\t\tconst history = RocketChat.models.IntegrationHistory.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _updatedAt: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields,\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\thistory,\n\t\t\toffset,\n\t\t\titems: history.length,\n\t\t\ttotal: RocketChat.models.IntegrationHistory.find(ourQuery).count(),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('integrations.list', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query);\n\t\tconst integrations = RocketChat.models.Integrations.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields,\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tintegrations,\n\t\t\toffset,\n\t\t\titems: integrations.length,\n\t\t\ttotal: RocketChat.models.Integrations.find(ourQuery).count(),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('integrations.remove', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\ttype: String,\n\t\t\ttarget_url: Match.Maybe(String),\n\t\t\tintegrationId: Match.Maybe(String),\n\t\t}));\n\n\t\tif (!this.bodyParams.target_url && !this.bodyParams.integrationId) {\n\t\t\treturn RocketChat.API.v1.failure('An integrationId or target_url needs to be provided.');\n\t\t}\n\n\t\tlet integration;\n\t\tswitch (this.bodyParams.type) {\n\t\t\tcase 'webhook-outgoing':\n\t\t\t\tif (this.bodyParams.target_url) {\n\t\t\t\t\tintegration = RocketChat.models.Integrations.findOne({ urls: this.bodyParams.target_url });\n\t\t\t\t} else if (this.bodyParams.integrationId) {\n\t\t\t\t\tintegration = RocketChat.models.Integrations.findOne({ _id: this.bodyParams.integrationId });\n\t\t\t\t}\n\n\t\t\t\tif (!integration) {\n\t\t\t\t\treturn RocketChat.API.v1.failure('No integration found.');\n\t\t\t\t}\n\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tMeteor.call('deleteOutgoingIntegration', integration._id);\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\t\tintegration,\n\t\t\t\t});\n\t\t\tcase 'webhook-incoming':\n\t\t\t\tintegration = RocketChat.models.Integrations.findOne({ _id: this.bodyParams.integrationId });\n\n\t\t\t\tif (!integration) {\n\t\t\t\t\treturn RocketChat.API.v1.failure('No integration found.');\n\t\t\t\t}\n\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tMeteor.call('deleteIncomingIntegration', integration._id);\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\t\tintegration,\n\t\t\t\t});\n\t\t\tdefault:\n\t\t\t\treturn RocketChat.API.v1.failure('Invalid integration type.');\n\t\t}\n\t},\n});\n","\nRocketChat.API.v1.addRoute('info', { authRequired: false }, {\n\tget() {\n\t\tconst user = this.getLoggedInUser();\n\n\t\tif (user && RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tinfo: RocketChat.Info,\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tinfo: {\n\t\t\t\tversion: RocketChat.Info.version,\n\t\t\t},\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('me', { authRequired: true }, {\n\tget() {\n\t\treturn RocketChat.API.v1.success(this.getUserInfo(RocketChat.models.Users.findOneById(this.userId)));\n\t},\n});\n\nlet onlineCache = 0;\nlet onlineCacheDate = 0;\nconst cacheInvalid = 60000; // 1 minute\nRocketChat.API.v1.addRoute('shield.svg', { authRequired: false }, {\n\tget() {\n\t\tconst { type, channel, name, icon } = this.queryParams;\n\t\tif (!RocketChat.settings.get('API_Enable_Shields')) {\n\t\t\tthrow new Meteor.Error('error-endpoint-disabled', 'This endpoint is disabled', { route: '/api/v1/shield.svg' });\n\t\t}\n\n\t\tconst types = RocketChat.settings.get('API_Shield_Types');\n\t\tif (type && (types !== '*' && !types.split(',').map((t) => t.trim()).includes(type))) {\n\t\t\tthrow new Meteor.Error('error-shield-disabled', 'This shield type is disabled', { route: '/api/v1/shield.svg' });\n\t\t}\n\n\t\tconst hideIcon = icon === 'false';\n\t\tif (hideIcon && (!name || !name.trim())) {\n\t\t\treturn RocketChat.API.v1.failure('Name cannot be empty when icon is hidden');\n\t\t}\n\n\t\tlet text;\n\t\tlet backgroundColor = '#4c1';\n\t\tswitch (type) {\n\t\t\tcase 'online':\n\t\t\t\tif (Date.now() - onlineCacheDate > cacheInvalid) {\n\t\t\t\t\tonlineCache = RocketChat.models.Users.findUsersNotOffline().count();\n\t\t\t\t\tonlineCacheDate = Date.now();\n\t\t\t\t}\n\n\t\t\t\ttext = `${ onlineCache } ${ TAPi18n.__('Online') }`;\n\t\t\t\tbreak;\n\t\t\tcase 'channel':\n\t\t\t\tif (!channel) {\n\t\t\t\t\treturn RocketChat.API.v1.failure('Shield channel is required for type \"channel\"');\n\t\t\t\t}\n\n\t\t\t\ttext = `#${ channel }`;\n\t\t\t\tbreak;\n\t\t\tcase 'user':\n\t\t\t\tconst user = this.getUserFromParams();\n\n\t\t\t\t// Respect the server's choice for using their real names or not\n\t\t\t\tif (user.name && RocketChat.settings.get('UI_Use_Real_Name')) {\n\t\t\t\t\ttext = `${ user.name }`;\n\t\t\t\t} else {\n\t\t\t\t\ttext = `@${ user.username }`;\n\t\t\t\t}\n\n\t\t\t\tswitch (user.status) {\n\t\t\t\t\tcase 'online':\n\t\t\t\t\t\tbackgroundColor = '#1fb31f';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'away':\n\t\t\t\t\t\tbackgroundColor = '#dc9b01';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'busy':\n\t\t\t\t\t\tbackgroundColor = '#bc2031';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'offline':\n\t\t\t\t\t\tbackgroundColor = '#a5a1a1';\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\ttext = TAPi18n.__('Join_Chat').toUpperCase();\n\t\t}\n\n\t\tconst iconSize = hideIcon ? 7 : 24;\n\t\tconst leftSize = name ? name.length * 6 + 7 + iconSize : iconSize;\n\t\tconst rightSize = text.length * 6 + 20;\n\t\tconst width = leftSize + rightSize;\n\t\tconst height = 20;\n\t\treturn {\n\t\t\theaders: { 'Content-Type': 'image/svg+xml;charset=utf-8' },\n\t\t\tbody: `\n\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"${ width }\" height=\"${ height }\">\n\t\t\t\t  <linearGradient id=\"b\" x2=\"0\" y2=\"100%\">\n\t\t\t\t    <stop offset=\"0\" stop-color=\"#bbb\" stop-opacity=\".1\"/>\n\t\t\t\t    <stop offset=\"1\" stop-opacity=\".1\"/>\n\t\t\t\t  </linearGradient>\n\t\t\t\t  <mask id=\"a\">\n\t\t\t\t    <rect width=\"${ width }\" height=\"${ height }\" rx=\"3\" fill=\"#fff\"/>\n\t\t\t\t  </mask>\n\t\t\t\t  <g mask=\"url(#a)\">\n\t\t\t\t    <path fill=\"#555\" d=\"M0 0h${ leftSize }v${ height }H0z\"/>\n\t\t\t\t    <path fill=\"${ backgroundColor }\" d=\"M${ leftSize } 0h${ rightSize }v${ height }H${ leftSize }z\"/>\n\t\t\t\t    <path fill=\"url(#b)\" d=\"M0 0h${ width }v${ height }H0z\"/>\n\t\t\t\t  </g>\n\t\t\t\t    ${ hideIcon ? '' : '<image x=\"5\" y=\"3\" width=\"14\" height=\"14\" xlink:href=\"/assets/favicon.svg\"/>' }\n\t\t\t\t  <g fill=\"#fff\" font-family=\"DejaVu Sans,Verdana,Geneva,sans-serif\" font-size=\"11\">\n\t\t\t\t\t\t${ name ? `<text x=\"${ iconSize }\" y=\"15\" fill=\"#010101\" fill-opacity=\".3\">${ name }</text>\n\t\t\t\t    <text x=\"${ iconSize }\" y=\"14\">${ name }</text>` : '' }\n\t\t\t\t    <text x=\"${ leftSize + 7 }\" y=\"15\" fill=\"#010101\" fill-opacity=\".3\">${ text }</text>\n\t\t\t\t    <text x=\"${ leftSize + 7 }\" y=\"14\">${ text }</text>\n\t\t\t\t  </g>\n\t\t\t\t</svg>\n\t\t\t`.trim().replace(/\\>[\\s]+\\</gm, '><'),\n\t\t};\n\t},\n});\n\nRocketChat.API.v1.addRoute('spotlight', { authRequired: true }, {\n\tget() {\n\t\tcheck(this.queryParams, {\n\t\t\tquery: String,\n\t\t});\n\n\t\tconst { query } = this.queryParams;\n\n\t\tconst result = Meteor.runAsUser(this.userId, () =>\n\t\t\tMeteor.call('spotlight', query)\n\t\t);\n\n\t\treturn RocketChat.API.v1.success(result);\n\t},\n});\n\nRocketChat.API.v1.addRoute('directory', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, query } = this.parseJsonQuery();\n\n\t\tconst { text, type } = query;\n\t\tif (sort && Object.keys(sort).length > 1) {\n\t\t\treturn RocketChat.API.v1.failure('This method support only one \"sort\" parameter');\n\t\t}\n\t\tconst sortBy = sort ? Object.keys(sort)[0] : undefined;\n\t\tconst sortDirection = sort && Object.values(sort)[0] === 1 ? 'asc' : 'desc';\n\n\t\tconst result = Meteor.runAsUser(this.userId, () => Meteor.call('browseChannels', {\n\t\t\ttext,\n\t\t\ttype,\n\t\t\tsortBy,\n\t\t\tsortDirection,\n\t\t\toffset: Math.max(0, offset),\n\t\t\tlimit: Math.max(0, count),\n\t\t}));\n\n\t\tif (!result) {\n\t\t\treturn RocketChat.API.v1.failure('Please verify the parameters');\n\t\t}\n\t\treturn RocketChat.API.v1.success({\n\t\t\tresult: result.results,\n\t\t\tcount: result.results.length,\n\t\t\toffset,\n\t\t\ttotal: result.total,\n\t\t});\n\t},\n});\n","/**\n\tThis API returns all permissions that exists\n\ton the server, with respective roles.\n\n\tMethod: GET\n\tRoute: api/v1/permissions\n */\nRocketChat.API.v1.addRoute('permissions', { authRequired: true }, {\n\tget() {\n\t\tconst warningMessage = 'The endpoint \"permissions\" is deprecated and will be removed after version v0.69';\n\t\tconsole.warn(warningMessage);\n\n\t\tconst result = Meteor.runAsUser(this.userId, () => Meteor.call('permissions/get'));\n\n\t\treturn RocketChat.API.v1.success(result);\n\t},\n});\n\nRocketChat.API.v1.addRoute('permissions.list', { authRequired: true }, {\n\tget() {\n\t\tconst result = Meteor.runAsUser(this.userId, () => Meteor.call('permissions/get'));\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpermissions: result,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('permissions.update', { authRequired: true }, {\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'access-permissions')) {\n\t\t\treturn RocketChat.API.v1.failure('Editing permissions is not allowed', 'error-edit-permissions-not-allowed');\n\t\t}\n\n\t\tcheck(this.bodyParams, {\n\t\t\tpermissions: [\n\t\t\t\tMatch.ObjectIncluding({\n\t\t\t\t\t_id: String,\n\t\t\t\t\troles: [String],\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tlet permissionNotFound = false;\n\t\tlet roleNotFound = false;\n\t\tObject.keys(this.bodyParams.permissions).forEach((key) => {\n\t\t\tconst element = this.bodyParams.permissions[key];\n\n\t\t\tif (!RocketChat.models.Permissions.findOneById(element._id)) {\n\t\t\t\tpermissionNotFound = true;\n\t\t\t}\n\n\t\t\tObject.keys(element.roles).forEach((key) => {\n\t\t\t\tconst subelement = element.roles[key];\n\n\t\t\t\tif (!RocketChat.models.Roles.findOneById(subelement)) {\n\t\t\t\t\troleNotFound = true;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tif (permissionNotFound) {\n\t\t\treturn RocketChat.API.v1.failure('Invalid permission', 'error-invalid-permission');\n\t\t} else if (roleNotFound) {\n\t\t\treturn RocketChat.API.v1.failure('Invalid role', 'error-invalid-role');\n\t\t}\n\n\t\tObject.keys(this.bodyParams.permissions).forEach((key) => {\n\t\t\tconst element = this.bodyParams.permissions[key];\n\n\t\t\tRocketChat.models.Permissions.createOrUpdate(element._id, element.roles);\n\t\t});\n\n\t\tconst result = Meteor.runAsUser(this.userId, () => Meteor.call('permissions/get'));\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpermissions: result,\n\t\t});\n\t},\n});\n","/* globals Push */\n\nRocketChat.API.v1.addRoute('push.token', { authRequired: true }, {\n\tpost() {\n\t\tconst { type, value, appName } = this.bodyParams;\n\t\tlet { id } = this.bodyParams;\n\n\t\tif (id && typeof id !== 'string') {\n\t\t\tthrow new Meteor.Error('error-id-param-not-valid', 'The required \"id\" body param is invalid.');\n\t\t} else {\n\t\t\tid = Random.id();\n\t\t}\n\n\t\tif (!type || (type !== 'apn' && type !== 'gcm')) {\n\t\t\tthrow new Meteor.Error('error-type-param-not-valid', 'The required \"type\" body param is missing or invalid.');\n\t\t}\n\n\t\tif (!value || typeof value !== 'string') {\n\t\t\tthrow new Meteor.Error('error-token-param-not-valid', 'The required \"value\" body param is missing or invalid.');\n\t\t}\n\n\t\tif (!appName || typeof appName !== 'string') {\n\t\t\tthrow new Meteor.Error('error-appName-param-not-valid', 'The required \"appName\" body param is missing or invalid.');\n\t\t}\n\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => result = Meteor.call('raix:push-update', {\n\t\t\tid,\n\t\t\ttoken: { [type]: value },\n\t\t\tappName,\n\t\t\tuserId: this.userId,\n\t\t}));\n\n\t\treturn RocketChat.API.v1.success({ result });\n\t},\n\tdelete() {\n\t\tconst { token } = this.bodyParams;\n\n\t\tif (!token || typeof token !== 'string') {\n\t\t\tthrow new Meteor.Error('error-token-param-not-valid', 'The required \"token\" body param is missing or invalid.');\n\t\t}\n\n\t\tconst affectedRecords = Push.appCollection.remove({\n\t\t\t$or: [{\n\t\t\t\t'token.apn': token,\n\t\t\t}, {\n\t\t\t\t'token.gcm': token,\n\t\t\t}],\n\t\t\tuserId: this.userId,\n\t\t});\n\n\t\tif (affectedRecords === 0) {\n\t\t\treturn RocketChat.API.v1.notFound();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n","import _ from 'underscore';\n\n// settings endpoints\nRocketChat.API.v1.addRoute('settings.public', { authRequired: false }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tlet ourQuery = {\n\t\t\thidden: { $ne: true },\n\t\t\tpublic: true,\n\t\t};\n\n\t\tourQuery = Object.assign({}, query, ourQuery);\n\n\t\tconst settings = RocketChat.models.Settings.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _id: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({ _id: 1, value: 1 }, fields),\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tsettings,\n\t\t\tcount: settings.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Settings.find(ourQuery).count(),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('settings.oauth', { authRequired: false }, {\n\tget() {\n\t\tconst mountOAuthServices = () => {\n\t\t\tconst oAuthServicesEnabled = ServiceConfiguration.configurations.find({}, { fields: { secret: 0 } }).fetch();\n\n\t\t\treturn oAuthServicesEnabled.map((service) => {\n\t\t\t\tif (service.custom || ['saml', 'cas', 'wordpress'].includes(service.service)) {\n\t\t\t\t\treturn { ...service };\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\t_id: service._id,\n\t\t\t\t\tname: service.service,\n\t\t\t\t\tclientId: service.appId || service.clientId || service.consumerKey,\n\t\t\t\t\tbuttonLabelText: service.buttonLabelText || '',\n\t\t\t\t\tbuttonColor: service.buttonColor || '',\n\t\t\t\t\tbuttonLabelColor: service.buttonLabelColor || '',\n\t\t\t\t\tcustom: false,\n\t\t\t\t};\n\t\t\t});\n\t\t};\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tservices: mountOAuthServices(),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('settings', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tlet ourQuery = {\n\t\t\thidden: { $ne: true },\n\t\t};\n\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-privileged-setting')) {\n\t\t\tourQuery.public = true;\n\t\t}\n\n\t\tourQuery = Object.assign({}, query, ourQuery);\n\n\t\tconst settings = RocketChat.models.Settings.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _id: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({ _id: 1, value: 1 }, fields),\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tsettings,\n\t\t\tcount: settings.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Settings.find(ourQuery).count(),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('settings/:_id', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-privileged-setting')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(_.pick(RocketChat.models.Settings.findOneNotHiddenById(this.urlParams._id), '_id', 'value'));\n\t},\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'edit-privileged-setting')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\t// allow special handling of particular setting types\n\t\tconst setting = RocketChat.models.Settings.findOneNotHiddenById(this.urlParams._id);\n\t\tif (setting.type === 'action' && this.bodyParams && this.bodyParams.execute) {\n\t\t\t// execute the configured method\n\t\t\tMeteor.call(setting.value);\n\t\t\treturn RocketChat.API.v1.success();\n\t\t}\n\n\t\tif (setting.type === 'color' && this.bodyParams && this.bodyParams.editor && this.bodyParams.value) {\n\t\t\tRocketChat.models.Settings.updateOptionsById(this.urlParams._id, { editor: this.bodyParams.editor });\n\t\t\tRocketChat.models.Settings.updateValueNotHiddenById(this.urlParams._id, this.bodyParams.value);\n\t\t\treturn RocketChat.API.v1.success();\n\t\t}\n\n\t\tcheck(this.bodyParams, {\n\t\t\tvalue: Match.Any,\n\t\t});\n\t\tif (RocketChat.models.Settings.updateValueNotHiddenById(this.urlParams._id, this.bodyParams.value)) {\n\t\t\treturn RocketChat.API.v1.success();\n\t\t}\n\n\t\treturn RocketChat.API.v1.failure();\n\t},\n});\n\nRocketChat.API.v1.addRoute('service.configurations', { authRequired: false }, {\n\tget() {\n\t\tconst { ServiceConfiguration } = Package['service-configuration'];\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tconfigurations: ServiceConfiguration.configurations.find({}, { fields: { secret: 0 } }).fetch(),\n\t\t});\n\t},\n});\n","RocketChat.API.v1.addRoute('statistics', { authRequired: true }, {\n\tget() {\n\t\tlet refresh = false;\n\t\tif (typeof this.queryParams.refresh !== 'undefined' && this.queryParams.refresh === 'true') {\n\t\t\trefresh = true;\n\t\t}\n\n\t\tlet stats;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tstats = Meteor.call('getStatistics', refresh);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tstatistics: stats,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('statistics.list', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-statistics')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst statistics = RocketChat.models.Statistics.find(query, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields,\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tstatistics,\n\t\t\tcount: statistics.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Statistics.find(query).count(),\n\t\t});\n\t},\n});\n","import _ from 'underscore';\nimport Busboy from 'busboy';\n\nRocketChat.API.v1.addRoute('users.create', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, {\n\t\t\temail: String,\n\t\t\tname: String,\n\t\t\tpassword: String,\n\t\t\tusername: String,\n\t\t\tactive: Match.Maybe(Boolean),\n\t\t\troles: Match.Maybe(Array),\n\t\t\tjoinDefaultChannels: Match.Maybe(Boolean),\n\t\t\trequirePasswordChange: Match.Maybe(Boolean),\n\t\t\tsendWelcomeEmail: Match.Maybe(Boolean),\n\t\t\tverified: Match.Maybe(Boolean),\n\t\t\tcustomFields: Match.Maybe(Object),\n\t\t});\n\n\t\t// New change made by pull request #5152\n\t\tif (typeof this.bodyParams.joinDefaultChannels === 'undefined') {\n\t\t\tthis.bodyParams.joinDefaultChannels = true;\n\t\t}\n\n\t\tif (this.bodyParams.customFields) {\n\t\t\tRocketChat.validateCustomFields(this.bodyParams.customFields);\n\t\t}\n\n\t\tconst newUserId = RocketChat.saveUser(this.userId, this.bodyParams);\n\n\t\tif (this.bodyParams.customFields) {\n\t\t\tRocketChat.saveCustomFieldsWithoutValidation(newUserId, this.bodyParams.customFields);\n\t\t}\n\n\n\t\tif (typeof this.bodyParams.active !== 'undefined') {\n\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\tMeteor.call('setUserActiveStatus', newUserId, this.bodyParams.active);\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(newUserId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t},\n});\n\nRocketChat.API.v1.addRoute('users.delete', { authRequired: true }, {\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'delete-user')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('deleteUser', user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('users.deleteOwnAccount', { authRequired: true }, {\n\tpost() {\n\t\tconst { password } = this.bodyParams;\n\t\tif (!password) {\n\t\t\treturn RocketChat.API.v1.failure('Body parameter \"password\" is required.');\n\t\t}\n\t\tif (!RocketChat.settings.get('Accounts_AllowDeleteOwnAccount')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('deleteUserOwnAccount', password);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('users.getAvatar', { authRequired: false }, {\n\tget() {\n\t\tconst user = this.getUserFromParams();\n\n\t\tconst url = RocketChat.getURL(`/avatar/${ user.username }`, { cdn: false, full: true });\n\t\tthis.response.setHeader('Location', url);\n\n\t\treturn {\n\t\t\tstatusCode: 307,\n\t\t\tbody: url,\n\t\t};\n\t},\n});\n\nRocketChat.API.v1.addRoute('users.getPresence', { authRequired: true }, {\n\tget() {\n\t\tif (this.isUserFromParams()) {\n\t\t\tconst user = RocketChat.models.Users.findOneById(this.userId);\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tpresence: user.status,\n\t\t\t\tconnectionStatus: user.statusConnection,\n\t\t\t\tlastLogin: user.lastLogin,\n\t\t\t});\n\t\t}\n\n\t\tconst user = this.getUserFromParams();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpresence: user.status,\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('users.info', { authRequired: true }, {\n\tget() {\n\t\tconst { username } = this.getUserFromParams();\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getFullUserData', { username, limit: 1 });\n\t\t});\n\n\t\tif (!result || result.length !== 1) {\n\t\t\treturn RocketChat.API.v1.failure(`Failed to get the user data for the userId of \"${ username }\".`);\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tuser: result[0],\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('users.list', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-d-room')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst users = RocketChat.models.Users.find(query, {\n\t\t\tsort: sort ? sort : { username: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields,\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tusers,\n\t\t\tcount: users.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Users.find(query).count(),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('users.register', { authRequired: false }, {\n\tpost() {\n\t\tif (this.userId) {\n\t\t\treturn RocketChat.API.v1.failure('Logged in users can not register again.');\n\t\t}\n\n\t\t// We set their username here, so require it\n\t\t// The `registerUser` checks for the other requirements\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\tusername: String,\n\t\t}));\n\n\t\t// Register the user\n\t\tconst userId = Meteor.call('registerUser', this.bodyParams);\n\n\t\t// Now set their username\n\t\tMeteor.runAsUser(userId, () => Meteor.call('setUsername', this.bodyParams.username));\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(userId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t},\n});\n\nRocketChat.API.v1.addRoute('users.resetAvatar', { authRequired: true }, {\n\tpost() {\n\t\tconst user = this.getUserFromParams();\n\n\t\tif (user._id === this.userId) {\n\t\t\tMeteor.runAsUser(this.userId, () => Meteor.call('resetAvatar'));\n\t\t} else if (RocketChat.authz.hasPermission(this.userId, 'edit-other-user-info')) {\n\t\t\tMeteor.runAsUser(user._id, () => Meteor.call('resetAvatar'));\n\t\t} else {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('users.setAvatar', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\tavatarUrl: Match.Maybe(String),\n\t\t\tuserId: Match.Maybe(String),\n\t\t\tusername: Match.Maybe(String),\n\t\t}));\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserAvatarChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Change avatar is not allowed', {\n\t\t\t\tmethod: 'users.setAvatar',\n\t\t\t});\n\t\t}\n\n\t\tlet user;\n\t\tif (this.isUserFromParams()) {\n\t\t\tuser = Meteor.users.findOne(this.userId);\n\t\t} else if (RocketChat.authz.hasPermission(this.userId, 'edit-other-user-info')) {\n\t\t\tuser = this.getUserFromParams();\n\t\t} else {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tMeteor.runAsUser(user._id, () => {\n\t\t\tif (this.bodyParams.avatarUrl) {\n\t\t\t\tRocketChat.setUserAvatar(user, this.bodyParams.avatarUrl, '', 'url');\n\t\t\t} else {\n\t\t\t\tconst busboy = new Busboy({ headers: this.request.headers });\n\n\t\t\t\tMeteor.wrapAsync((callback) => {\n\t\t\t\t\tbusboy.on('file', Meteor.bindEnvironment((fieldname, file, filename, encoding, mimetype) => {\n\t\t\t\t\t\tif (fieldname !== 'image') {\n\t\t\t\t\t\t\treturn callback(new Meteor.Error('invalid-field'));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst imageData = [];\n\t\t\t\t\t\tfile.on('data', Meteor.bindEnvironment((data) => {\n\t\t\t\t\t\t\timageData.push(data);\n\t\t\t\t\t\t}));\n\n\t\t\t\t\t\tfile.on('end', Meteor.bindEnvironment(() => {\n\t\t\t\t\t\t\tRocketChat.setUserAvatar(user, Buffer.concat(imageData), mimetype, 'rest');\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t}));\n\n\t\t\t\t\t}));\n\t\t\t\t\tthis.request.pipe(busboy);\n\t\t\t\t})();\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('users.update', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, {\n\t\t\tuserId: String,\n\t\t\tdata: Match.ObjectIncluding({\n\t\t\t\temail: Match.Maybe(String),\n\t\t\t\tname: Match.Maybe(String),\n\t\t\t\tpassword: Match.Maybe(String),\n\t\t\t\tusername: Match.Maybe(String),\n\t\t\t\tactive: Match.Maybe(Boolean),\n\t\t\t\troles: Match.Maybe(Array),\n\t\t\t\tjoinDefaultChannels: Match.Maybe(Boolean),\n\t\t\t\trequirePasswordChange: Match.Maybe(Boolean),\n\t\t\t\tsendWelcomeEmail: Match.Maybe(Boolean),\n\t\t\t\tverified: Match.Maybe(Boolean),\n\t\t\t\tcustomFields: Match.Maybe(Object),\n\t\t\t}),\n\t\t});\n\n\t\tconst userData = _.extend({ _id: this.bodyParams.userId }, this.bodyParams.data);\n\n\t\tMeteor.runAsUser(this.userId, () => RocketChat.saveUser(this.userId, userData));\n\n\t\tif (this.bodyParams.data.customFields) {\n\t\t\tRocketChat.saveCustomFields(this.bodyParams.userId, this.bodyParams.data.customFields);\n\t\t}\n\n\t\tif (typeof this.bodyParams.data.active !== 'undefined') {\n\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\tMeteor.call('setUserActiveStatus', this.bodyParams.userId, this.bodyParams.data.active);\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(this.bodyParams.userId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t},\n});\n\nRocketChat.API.v1.addRoute('users.updateOwnBasicInfo', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, {\n\t\t\tdata: Match.ObjectIncluding({\n\t\t\t\temail: Match.Maybe(String),\n\t\t\t\tname: Match.Maybe(String),\n\t\t\t\tusername: Match.Maybe(String),\n\t\t\t\tcurrentPassword: Match.Maybe(String),\n\t\t\t\tnewPassword: Match.Maybe(String),\n\t\t\t}),\n\t\t\tcustomFields: Match.Maybe(Object),\n\t\t});\n\n\t\tconst userData = {\n\t\t\temail: this.bodyParams.data.email,\n\t\t\trealname: this.bodyParams.data.name,\n\t\t\tusername: this.bodyParams.data.username,\n\t\t\tnewPassword: this.bodyParams.data.newPassword,\n\t\t\ttypedPassword: this.bodyParams.data.currentPassword,\n\t\t};\n\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('saveUserProfile', userData, this.bodyParams.customFields));\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(this.userId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t},\n});\n\nRocketChat.API.v1.addRoute('users.createToken', { authRequired: true }, {\n\tpost() {\n\t\tconst user = this.getUserFromParams();\n\t\tlet data;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tdata = Meteor.call('createToken', user._id);\n\t\t});\n\t\treturn data ? RocketChat.API.v1.success({ data }) : RocketChat.API.v1.unauthorized();\n\t},\n});\n\nRocketChat.API.v1.addRoute('users.getPreferences', { authRequired: true }, {\n\tget() {\n\t\tconst user = RocketChat.models.Users.findOneById(this.userId);\n\t\tif (user.settings) {\n\t\t\tconst { preferences } = user.settings;\n\t\t\tpreferences.language = user.language;\n\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tpreferences,\n\t\t\t});\n\t\t} else {\n\t\t\treturn RocketChat.API.v1.failure(TAPi18n.__('Accounts_Default_User_Preferences_not_available').toUpperCase());\n\t\t}\n\t},\n});\n\nRocketChat.API.v1.addRoute('users.setPreferences', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, {\n\t\t\tuserId: Match.Maybe(String),\n\t\t\tdata: Match.ObjectIncluding({\n\t\t\t\tnewRoomNotification: Match.Maybe(String),\n\t\t\t\tnewMessageNotification: Match.Maybe(String),\n\t\t\t\tclockMode: Match.Maybe(Number),\n\t\t\t\tuseEmojis: Match.Maybe(Boolean),\n\t\t\t\tconvertAsciiEmoji: Match.Maybe(Boolean),\n\t\t\t\tsaveMobileBandwidth: Match.Maybe(Boolean),\n\t\t\t\tcollapseMediaByDefault: Match.Maybe(Boolean),\n\t\t\t\tautoImageLoad: Match.Maybe(Boolean),\n\t\t\t\temailNotificationMode: Match.Maybe(String),\n\t\t\t\tunreadAlert: Match.Maybe(Boolean),\n\t\t\t\tnotificationsSoundVolume: Match.Maybe(Number),\n\t\t\t\tdesktopNotifications: Match.Maybe(String),\n\t\t\t\tmobileNotifications: Match.Maybe(String),\n\t\t\t\tenableAutoAway: Match.Maybe(Boolean),\n\t\t\t\thighlights: Match.Maybe(Array),\n\t\t\t\tdesktopNotificationDuration: Match.Maybe(Number),\n\t\t\t\tmessageViewMode: Match.Maybe(Number),\n\t\t\t\thideUsernames: Match.Maybe(Boolean),\n\t\t\t\thideRoles: Match.Maybe(Boolean),\n\t\t\t\thideAvatars: Match.Maybe(Boolean),\n\t\t\t\thideFlexTab: Match.Maybe(Boolean),\n\t\t\t\tsendOnEnter: Match.Maybe(String),\n\t\t\t\troomCounterSidebar: Match.Maybe(Boolean),\n\t\t\t\tlanguage: Match.Maybe(String),\n\t\t\t\tsidebarShowFavorites: Match.Optional(Boolean),\n\t\t\t\tsidebarShowUnread: Match.Optional(Boolean),\n\t\t\t\tsidebarSortby: Match.Optional(String),\n\t\t\t\tsidebarViewMode: Match.Optional(String),\n\t\t\t\tsidebarHideAvatar: Match.Optional(Boolean),\n\t\t\t\tsidebarGroupByType: Match.Optional(Boolean),\n\t\t\t\tmuteFocusedConversations: Match.Optional(Boolean),\n\t\t\t}),\n\t\t});\n\n\t\tconst userId = this.bodyParams.userId ? this.bodyParams.userId : this.userId;\n\t\tconst userData = {\n\t\t\t_id: userId,\n\t\t\tsettings: {\n\t\t\t\tpreferences: this.bodyParams.data,\n\t\t\t},\n\t\t};\n\n\t\tif (this.bodyParams.data.language) {\n\t\t\tconst { language } = this.bodyParams.data;\n\t\t\tdelete this.bodyParams.data.language;\n\t\t\tuserData.language = language;\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => RocketChat.saveUser(this.userId, userData));\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tuser: RocketChat.models.Users.findOneById(userId, {\n\t\t\t\tfields: {\n\t\t\t\t\t'settings.preferences': 1,\n\t\t\t\t},\n\t\t\t}),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('users.forgotPassword', { authRequired: false }, {\n\tpost() {\n\t\tconst { email } = this.bodyParams;\n\t\tif (!email) {\n\t\t\treturn RocketChat.API.v1.failure('The \\'email\\' param is required');\n\t\t}\n\n\t\tconst emailSent = Meteor.call('sendForgotPasswordEmail', email);\n\t\tif (emailSent) {\n\t\t\treturn RocketChat.API.v1.success();\n\t\t}\n\t\treturn RocketChat.API.v1.failure('User not found');\n\t},\n});\n\nRocketChat.API.v1.addRoute('users.getUsernameSuggestion', { authRequired: true }, {\n\tget() {\n\t\tconst result = Meteor.runAsUser(this.userId, () => Meteor.call('getUsernameSuggestion'));\n\n\t\treturn RocketChat.API.v1.success({ result });\n\t},\n});\n\nRocketChat.API.v1.addRoute('users.generatePersonalAccessToken', { authRequired: true }, {\n\tpost() {\n\t\tconst { tokenName } = this.bodyParams;\n\t\tif (!tokenName) {\n\t\t\treturn RocketChat.API.v1.failure('The \\'tokenName\\' param is required');\n\t\t}\n\t\tconst token = Meteor.runAsUser(this.userId, () => Meteor.call('personalAccessTokens:generateToken', { tokenName }));\n\n\t\treturn RocketChat.API.v1.success({ token });\n\t},\n});\n\nRocketChat.API.v1.addRoute('users.regeneratePersonalAccessToken', { authRequired: true }, {\n\tpost() {\n\t\tconst { tokenName } = this.bodyParams;\n\t\tif (!tokenName) {\n\t\t\treturn RocketChat.API.v1.failure('The \\'tokenName\\' param is required');\n\t\t}\n\t\tconst token = Meteor.runAsUser(this.userId, () => Meteor.call('personalAccessTokens:regenerateToken', { tokenName }));\n\n\t\treturn RocketChat.API.v1.success({ token });\n\t},\n});\n\nRocketChat.API.v1.addRoute('users.getPersonalAccessTokens', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.settings.get('API_Enable_Personal_Access_Tokens')) {\n\t\t\tthrow new Meteor.Error('error-personal-access-tokens-are-current-disabled', 'Personal Access Tokens are currently disabled');\n\t\t}\n\t\tconst loginTokens = RocketChat.models.Users.getLoginTokensByUserId(this.userId).fetch()[0];\n\t\tconst getPersonalAccessTokens = () => loginTokens.services.resume.loginTokens\n\t\t\t.filter((loginToken) => loginToken.type && loginToken.type === 'personalAccessToken')\n\t\t\t.map((loginToken) => ({\n\t\t\t\tname: loginToken.name,\n\t\t\t\tcreatedAt: loginToken.createdAt,\n\t\t\t\tlastTokenPart: loginToken.lastTokenPart,\n\t\t\t}));\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttokens: getPersonalAccessTokens(),\n\t\t});\n\t},\n});\n\nRocketChat.API.v1.addRoute('users.removePersonalAccessToken', { authRequired: true }, {\n\tpost() {\n\t\tconst { tokenName } = this.bodyParams;\n\t\tif (!tokenName) {\n\t\t\treturn RocketChat.API.v1.failure('The \\'tokenName\\' param is required');\n\t\t}\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('personalAccessTokens:removeToken', {\n\t\t\ttokenName,\n\t\t}));\n\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n","import Busboy from 'busboy';\n\nRocketChat.API.v1.addRoute('assets.setAsset', { authRequired: true }, {\n\tpost() {\n\t\tconst busboy = new Busboy({ headers: this.request.headers });\n\t\tconst fields = {};\n\t\tlet asset = {};\n\n\t\tMeteor.wrapAsync((callback) => {\n\t\t\tbusboy.on('field', (fieldname, value) => fields[fieldname] = value);\n\t\t\tbusboy.on('file', Meteor.bindEnvironment((fieldname, file, filename, encoding, mimetype) => {\n\t\t\t\tconst isValidAsset = Object.keys(RocketChat.Assets.assets).includes(fieldname);\n\t\t\t\tif (!isValidAsset) {\n\t\t\t\t\tcallback(new Meteor.Error('error-invalid-asset', 'Invalid asset'));\n\t\t\t\t}\n\t\t\t\tconst assetData = [];\n\t\t\t\tfile.on('data', Meteor.bindEnvironment((data) => {\n\t\t\t\t\tassetData.push(data);\n\t\t\t\t}));\n\n\t\t\t\tfile.on('end', Meteor.bindEnvironment(() => {\n\t\t\t\t\tasset = {\n\t\t\t\t\t\tbuffer: Buffer.concat(assetData),\n\t\t\t\t\t\tname: fieldname,\n\t\t\t\t\t\tmimetype,\n\t\t\t\t\t};\n\t\t\t\t}));\n\t\t\t}));\n\t\t\tbusboy.on('finish', () => callback());\n\t\t\tthis.request.pipe(busboy);\n\t\t})();\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('setAsset', asset.buffer, asset.mimetype, asset.name));\n\t\tif (fields.refreshAllClients) {\n\t\t\tMeteor.runAsUser(this.userId, () => Meteor.call('refreshClients'));\n\t\t}\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n\nRocketChat.API.v1.addRoute('assets.unsetAsset', { authRequired: true }, {\n\tpost() {\n\t\tconst { assetName, refreshAllClients } = this.bodyParams;\n\t\tconst isValidAsset = Object.keys(RocketChat.Assets.assets).includes(assetName);\n\t\tif (!isValidAsset) {\n\t\t\tthrow new Meteor.Error('error-invalid-asset', 'Invalid asset');\n\t\t}\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('unsetAsset', assetName));\n\t\tif (refreshAllClients) {\n\t\t\tMeteor.runAsUser(this.userId, () => Meteor.call('refreshClients'));\n\t\t}\n\t\treturn RocketChat.API.v1.success();\n\t},\n});\n"]}